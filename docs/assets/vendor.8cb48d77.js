function e(e,t){const r=Object.create(null),n=e.split(",");for(let i=0;i<n.length;i++)r[n[i]]=!0;return t?e=>!!r[e.toLowerCase()]:e=>!!r[e]}const t=e("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function r(e){return!!e||""===e}function n(e){if(T(e)){const t={};for(let r=0;r<e.length;r++){const i=e[r],o=E(i)?a(i):n(i);if(o)for(const e in o)t[e]=o[e]}return t}return E(e)||k(e)?e:void 0}const i=/;(?![^(]*\))/g,o=/:(.+)/;function a(e){const t={};return e.split(i).forEach((e=>{if(e){const r=e.split(o);r.length>1&&(t[r[0].trim()]=r[1].trim())}})),t}function s(e){let t="";if(E(e))t=e;else if(T(e))for(let r=0;r<e.length;r++){const n=s(e[r]);n&&(t+=n+" ")}else if(k(e))for(const r in e)e[r]&&(t+=r+" ");return t.trim()}const c=e=>null==e?"":T(e)||k(e)&&(e.toString===w||!C(e.toString))?JSON.stringify(e,u,2):String(e),u=(e,t)=>t&&t.__v_isRef?u(e,t.value):S(t)?{[`Map(${t.size})`]:[...t.entries()].reduce(((e,[t,r])=>(e[`${t} =>`]=r,e)),{})}:b(t)?{[`Set(${t.size})`]:[...t.values()]}:!k(t)||T(t)||x(t)?t:String(t),d={},l=[],p=()=>{},m=()=>!1,h=/^on[^a-z]/,f=e=>h.test(e),g=e=>e.startsWith("onUpdate:"),v=Object.assign,y=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},I=Object.prototype.hasOwnProperty,M=(e,t)=>I.call(e,t),T=Array.isArray,S=e=>"[object Map]"===A(e),b=e=>"[object Set]"===A(e),C=e=>"function"==typeof e,E=e=>"string"==typeof e,_=e=>"symbol"==typeof e,k=e=>null!==e&&"object"==typeof e,R=e=>k(e)&&C(e.then)&&C(e.catch),w=Object.prototype.toString,A=e=>w.call(e),x=e=>"[object Object]"===A(e),N=e=>E(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,O=e(",key,ref,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),P=e=>{const t=Object.create(null);return r=>t[r]||(t[r]=e(r))},L=/-(\w)/g,V=P((e=>e.replace(L,((e,t)=>t?t.toUpperCase():"")))),U=/\B([A-Z])/g,D=P((e=>e.replace(U,"-$1").toLowerCase())),q=P((e=>e.charAt(0).toUpperCase()+e.slice(1))),B=P((e=>e?`on${q(e)}`:"")),F=(e,t)=>!Object.is(e,t),G=(e,t)=>{for(let r=0;r<e.length;r++)e[r](t)},j=(e,t,r)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:r})},H=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let W;const Y=[];class K{constructor(e=!1){this.active=!0,this.effects=[],this.cleanups=[],!e&&W&&(this.parent=W,this.index=(W.scopes||(W.scopes=[])).push(this)-1)}run(e){if(this.active)try{return this.on(),e()}finally{this.off()}}on(){this.active&&(Y.push(this),W=this)}off(){this.active&&(Y.pop(),W=Y[Y.length-1])}stop(e){if(this.active){if(this.effects.forEach((e=>e.stop())),this.cleanups.forEach((e=>e())),this.scopes&&this.scopes.forEach((e=>e.stop(!0))),this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.active=!1}}}const Q=e=>{const t=new Set(e);return t.w=0,t.n=0,t},z=e=>(e.w&Z)>0,J=e=>(e.n&Z)>0,$=new WeakMap;let X=0,Z=1;const ee=[];let te;const re=Symbol(""),ne=Symbol("");class ie{constructor(e,t=null,r){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],function(e,t){(t=t||W)&&t.active&&t.effects.push(e)}(this,r)}run(){if(!this.active)return this.fn();if(!ee.includes(this))try{return ee.push(te=this),se.push(ae),ae=!0,Z=1<<++X,X<=30?(({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=Z})(this):oe(this),this.fn()}finally{X<=30&&(e=>{const{deps:t}=e;if(t.length){let r=0;for(let n=0;n<t.length;n++){const i=t[n];z(i)&&!J(i)?i.delete(e):t[r++]=i,i.w&=~Z,i.n&=~Z}t.length=r}})(this),Z=1<<--X,ue(),ee.pop();const e=ee.length;te=e>0?ee[e-1]:void 0}}stop(){this.active&&(oe(this),this.onStop&&this.onStop(),this.active=!1)}}function oe(e){const{deps:t}=e;if(t.length){for(let r=0;r<t.length;r++)t[r].delete(e);t.length=0}}let ae=!0;const se=[];function ce(){se.push(ae),ae=!1}function ue(){const e=se.pop();ae=void 0===e||e}function de(e,t,r){if(!le())return;let n=$.get(e);n||$.set(e,n=new Map);let i=n.get(r);i||n.set(r,i=Q()),pe(i)}function le(){return ae&&void 0!==te}function pe(e,t){let r=!1;X<=30?J(e)||(e.n|=Z,r=!z(e)):r=!e.has(te),r&&(e.add(te),te.deps.push(e))}function me(e,t,r,n,i,o){const a=$.get(e);if(!a)return;let s=[];if("clear"===t)s=[...a.values()];else if("length"===r&&T(e))a.forEach(((e,t)=>{("length"===t||t>=n)&&s.push(e)}));else switch(void 0!==r&&s.push(a.get(r)),t){case"add":T(e)?N(r)&&s.push(a.get("length")):(s.push(a.get(re)),S(e)&&s.push(a.get(ne)));break;case"delete":T(e)||(s.push(a.get(re)),S(e)&&s.push(a.get(ne)));break;case"set":S(e)&&s.push(a.get(re))}if(1===s.length)s[0]&&he(s[0]);else{const e=[];for(const t of s)t&&e.push(...t);he(Q(e))}}function he(e,t){for(const r of T(e)?e:[...e])(r!==te||r.allowRecurse)&&(r.scheduler?r.scheduler():r.run())}const fe=e("__proto__,__v_isRef,__isVue"),ge=new Set(Object.getOwnPropertyNames(Symbol).map((e=>Symbol[e])).filter(_)),ve=Se(),ye=Se(!1,!0),Ie=Se(!0),Me=Te();function Te(){const e={};return["includes","indexOf","lastIndexOf"].forEach((t=>{e[t]=function(...e){const r=ut(this);for(let t=0,i=this.length;t<i;t++)de(r,0,t+"");const n=r[t](...e);return-1===n||!1===n?r[t](...e.map(ut)):n}})),["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){ce();const r=ut(this)[t].apply(this,e);return ue(),r}})),e}function Se(e=!1,t=!1){return function(r,n,i){if("__v_isReactive"===n)return!e;if("__v_isReadonly"===n)return e;if("__v_raw"===n&&i===(e?t?Ze:Xe:t?$e:Je).get(r))return r;const o=T(r);if(!e&&o&&M(Me,n))return Reflect.get(Me,n,i);const a=Reflect.get(r,n,i);if(_(n)?ge.has(n):fe(n))return a;if(e||de(r,0,n),t)return a;if(ht(a)){return!o||!N(n)?a.value:a}return k(a)?e?it(a):rt(a):a}}function be(e=!1){return function(t,r,n,i){let o=t[r];if(!e&&(n=ut(n),o=ut(o),!T(t)&&ht(o)&&!ht(n)))return o.value=n,!0;const a=T(t)&&N(r)?Number(r)<t.length:M(t,r),s=Reflect.set(t,r,n,i);return t===ut(i)&&(a?F(n,o)&&me(t,"set",r,n):me(t,"add",r,n)),s}}const Ce={get:ve,set:be(),deleteProperty:function(e,t){const r=M(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&r&&me(e,"delete",t,void 0),n},has:function(e,t){const r=Reflect.has(e,t);return _(t)&&ge.has(t)||de(e,0,t),r},ownKeys:function(e){return de(e,0,T(e)?"length":re),Reflect.ownKeys(e)}},Ee={get:Ie,set:(e,t)=>!0,deleteProperty:(e,t)=>!0},_e=v({},Ce,{get:ye,set:be(!0)}),ke=e=>k(e)?rt(e):e,Re=e=>k(e)?it(e):e,we=e=>e,Ae=e=>Reflect.getPrototypeOf(e);function xe(e,t,r=!1,n=!1){const i=ut(e=e.__v_raw),o=ut(t);t!==o&&!r&&de(i,0,t),!r&&de(i,0,o);const{has:a}=Ae(i),s=n?we:r?Re:ke;return a.call(i,t)?s(e.get(t)):a.call(i,o)?s(e.get(o)):void(e!==i&&e.get(t))}function Ne(e,t=!1){const r=this.__v_raw,n=ut(r),i=ut(e);return e!==i&&!t&&de(n,0,e),!t&&de(n,0,i),e===i?r.has(e):r.has(e)||r.has(i)}function Oe(e,t=!1){return e=e.__v_raw,!t&&de(ut(e),0,re),Reflect.get(e,"size",e)}function Pe(e){e=ut(e);const t=ut(this);return Ae(t).has.call(t,e)||(t.add(e),me(t,"add",e,e)),this}function Le(e,t){t=ut(t);const r=ut(this),{has:n,get:i}=Ae(r);let o=n.call(r,e);o||(e=ut(e),o=n.call(r,e));const a=i.call(r,e);return r.set(e,t),o?F(t,a)&&me(r,"set",e,t):me(r,"add",e,t),this}function Ve(e){const t=ut(this),{has:r,get:n}=Ae(t);let i=r.call(t,e);i||(e=ut(e),i=r.call(t,e)),n&&n.call(t,e);const o=t.delete(e);return i&&me(t,"delete",e,void 0),o}function Ue(){const e=ut(this),t=0!==e.size,r=e.clear();return t&&me(e,"clear",void 0,void 0),r}function De(e,t){return function(r,n){const i=this,o=i.__v_raw,a=ut(o),s=t?we:e?Re:ke;return!e&&de(a,0,re),o.forEach(((e,t)=>r.call(n,s(e),s(t),i)))}}function qe(e,t,r){return function(...n){const i=this.__v_raw,o=ut(i),a=S(o),s="entries"===e||e===Symbol.iterator&&a,c="keys"===e&&a,u=i[e](...n),d=r?we:t?Re:ke;return!t&&de(o,0,c?ne:re),{next(){const{value:e,done:t}=u.next();return t?{value:e,done:t}:{value:s?[d(e[0]),d(e[1])]:d(e),done:t}},[Symbol.iterator](){return this}}}}function Be(e){return function(...t){return"delete"!==e&&this}}function Fe(){const e={get(e){return xe(this,e)},get size(){return Oe(this)},has:Ne,add:Pe,set:Le,delete:Ve,clear:Ue,forEach:De(!1,!1)},t={get(e){return xe(this,e,!1,!0)},get size(){return Oe(this)},has:Ne,add:Pe,set:Le,delete:Ve,clear:Ue,forEach:De(!1,!0)},r={get(e){return xe(this,e,!0)},get size(){return Oe(this,!0)},has(e){return Ne.call(this,e,!0)},add:Be("add"),set:Be("set"),delete:Be("delete"),clear:Be("clear"),forEach:De(!0,!1)},n={get(e){return xe(this,e,!0,!0)},get size(){return Oe(this,!0)},has(e){return Ne.call(this,e,!0)},add:Be("add"),set:Be("set"),delete:Be("delete"),clear:Be("clear"),forEach:De(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach((i=>{e[i]=qe(i,!1,!1),r[i]=qe(i,!0,!1),t[i]=qe(i,!1,!0),n[i]=qe(i,!0,!0)})),[e,r,t,n]}const[Ge,je,He,We]=Fe();function Ye(e,t){const r=t?e?We:He:e?je:Ge;return(t,n,i)=>"__v_isReactive"===n?!e:"__v_isReadonly"===n?e:"__v_raw"===n?t:Reflect.get(M(r,n)&&n in t?r:t,n,i)}const Ke={get:Ye(!1,!1)},Qe={get:Ye(!1,!0)},ze={get:Ye(!0,!1)},Je=new WeakMap,$e=new WeakMap,Xe=new WeakMap,Ze=new WeakMap;function et(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}((e=>A(e).slice(8,-1))(e))}function rt(e){return e&&e.__v_isReadonly?e:ot(e,!1,Ce,Ke,Je)}function nt(e){return ot(e,!1,_e,Qe,$e)}function it(e){return ot(e,!0,Ee,ze,Xe)}function ot(e,t,r,n,i){if(!k(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const o=i.get(e);if(o)return o;const a=et(e);if(0===a)return e;const s=new Proxy(e,2===a?n:r);return i.set(e,s),s}function at(e){return st(e)?at(e.__v_raw):!(!e||!e.__v_isReactive)}function st(e){return!(!e||!e.__v_isReadonly)}function ct(e){return at(e)||st(e)}function ut(e){const t=e&&e.__v_raw;return t?ut(t):e}function dt(e){return j(e,"__v_skip",!0),e}function lt(e){le()&&((e=ut(e)).dep||(e.dep=Q()),pe(e.dep))}function pt(e,t){(e=ut(e)).dep&&he(e.dep)}const mt=e=>k(e)?rt(e):e;function ht(e){return Boolean(e&&!0===e.__v_isRef)}function ft(e){return vt(e,!1)}class gt{constructor(e,t){this._shallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:ut(e),this._value=t?e:mt(e)}get value(){return lt(this),this._value}set value(e){e=this._shallow?e:ut(e),F(e,this._rawValue)&&(this._rawValue=e,this._value=this._shallow?e:mt(e),pt(this))}}function vt(e,t){return ht(e)?e:new gt(e,t)}function yt(e){return ht(e)?e.value:e}const It={get:(e,t,r)=>yt(Reflect.get(e,t,r)),set:(e,t,r,n)=>{const i=e[t];return ht(i)&&!ht(r)?(i.value=r,!0):Reflect.set(e,t,r,n)}};function Mt(e){return at(e)?e:new Proxy(e,It)}class Tt{constructor(e,t,r){this._setter=t,this.dep=void 0,this._dirty=!0,this.__v_isRef=!0,this.effect=new ie(e,(()=>{this._dirty||(this._dirty=!0,pt(this))})),this.__v_isReadonly=r}get value(){const e=ut(this);return lt(e),e._dirty&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function St(e,t){let r,n;C(e)?(r=e,n=p):(r=e.get,n=e.set);return new Tt(r,n,C(e)||!e.set)}Promise.resolve();function bt(e,t,...r){const n=e.vnode.props||d;let i=r;const o=t.startsWith("update:"),a=o&&t.slice(7);if(a&&a in n){const e=`${"modelValue"===a?"model":a}Modifiers`,{number:t,trim:o}=n[e]||d;o?i=r.map((e=>e.trim())):t&&(i=r.map(H))}let s,c=n[s=B(t)]||n[s=B(V(t))];!c&&o&&(c=n[s=B(D(t))]),c&&_n(c,e,6,i);const u=n[s+"Once"];if(u){if(e.emitted){if(e.emitted[s])return}else e.emitted={};e.emitted[s]=!0,_n(u,e,6,i)}}function Ct(e,t,r=!1){const n=t.emitsCache,i=n.get(e);if(void 0!==i)return i;const o=e.emits;let a={},s=!1;if(!C(e)){const n=e=>{const r=Ct(e,t,!0);r&&(s=!0,v(a,r))};!r&&t.mixins.length&&t.mixins.forEach(n),e.extends&&n(e.extends),e.mixins&&e.mixins.forEach(n)}return o||s?(T(o)?o.forEach((e=>a[e]=null)):v(a,o),n.set(e,a),a):(n.set(e,null),null)}function Et(e,t){return!(!e||!f(t))&&(t=t.slice(2).replace(/Once$/,""),M(e,t[0].toLowerCase()+t.slice(1))||M(e,D(t))||M(e,t))}let _t=null,kt=null;function Rt(e){const t=_t;return _t=e,kt=e&&e.type.__scopeId||null,t}function wt(e){kt=e}function At(){kt=null}function xt(e){const{type:t,vnode:r,proxy:n,withProxy:i,props:o,propsOptions:[a],slots:s,attrs:c,emit:u,render:d,renderCache:l,data:p,setupState:m,ctx:h,inheritAttrs:f}=e;let v;const y=Rt(e);try{let e;if(4&r.shapeFlag){const t=i||n;v=sn(d.call(t,t,l,o,m,p,h)),e=c}else{const r=t;0,v=sn(r.length>1?r(o,{attrs:c,slots:s,emit:u}):r(o,null)),e=t.props?c:Nt(c)}let y=v;if(e&&!1!==f){const t=Object.keys(e),{shapeFlag:r}=y;t.length&&7&r&&(a&&t.some(g)&&(e=Ot(e,a)),y=nn(y,e))}0,r.dirs&&(y.dirs=y.dirs?y.dirs.concat(r.dirs):r.dirs),r.transition&&(y.transition=r.transition),v=y}catch(I){Gr.length=0,kn(I,e,1),v=rn(Br)}return Rt(y),v}const Nt=e=>{let t;for(const r in e)("class"===r||"style"===r||f(r))&&((t||(t={}))[r]=e[r]);return t},Ot=(e,t)=>{const r={};for(const n in e)g(n)&&n.slice(9)in t||(r[n]=e[n]);return r};function Pt(e,t,r){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let i=0;i<n.length;i++){const o=n[i];if(t[o]!==e[o]&&!Et(r,o))return!0}return!1}function Lt(e,t){if(gn){let r=gn.provides;const n=gn.parent&&gn.parent.provides;n===r&&(r=gn.provides=Object.create(n)),r[e]=t}else;}function Vt(e,t,r=!1){const n=gn||_t;if(n){const i=null==n.parent?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides;if(i&&e in i)return i[e];if(arguments.length>1)return r&&C(t)?t.call(n.proxy):t}}function Ut(e){return C(e)?{setup:e,name:e.name}:e}const Dt=e=>!!e.type.__asyncLoader,qt=e=>e.type.__isKeepAlive;function Bt(e,t){Gt(e,"a",t)}function Ft(e,t){Gt(e,"da",t)}function Gt(e,t,r=gn){const n=e.__wdc||(e.__wdc=()=>{let t=r;for(;t;){if(t.isDeactivated)return;t=t.parent}e()});if(Ht(t,n,r),r){let e=r.parent;for(;e&&e.parent;)qt(e.parent.vnode)&&jt(n,t,r,e),e=e.parent}}function jt(e,t,r,n){const i=Ht(t,e,n,!0);$t((()=>{y(n[t],i)}),r)}function Ht(e,t,r=gn,n=!1){if(r){const i=r[e]||(r[e]=[]),o=t.__weh||(t.__weh=(...n)=>{if(r.isUnmounted)return;ce(),vn(r);const i=_n(t,r,e,n);return yn(),ue(),i});return n?i.unshift(o):i.push(o),o}}const Wt=e=>(t,r=gn)=>(!Mn||"sp"===e)&&Ht(e,t,r),Yt=Wt("bm"),Kt=Wt("m"),Qt=Wt("bu"),zt=Wt("u"),Jt=Wt("bum"),$t=Wt("um"),Xt=Wt("sp"),Zt=Wt("rtg"),er=Wt("rtc");function tr(e,t=gn){Ht("ec",e,t)}let rr=!0;function nr(e){const t=ar(e),r=e.proxy,n=e.ctx;rr=!1,t.beforeCreate&&ir(t.beforeCreate,e,"bc");const{data:i,computed:o,methods:a,watch:s,provide:c,inject:u,created:d,beforeMount:l,mounted:m,beforeUpdate:h,updated:f,activated:g,deactivated:v,beforeDestroy:y,beforeUnmount:I,destroyed:M,unmounted:S,render:b,renderTracked:E,renderTriggered:_,errorCaptured:R,serverPrefetch:w,expose:A,inheritAttrs:x,components:N,directives:O,filters:P}=t;if(u&&function(e,t,r=p,n=!1){T(e)&&(e=dr(e));for(const i in e){const r=e[i];let o;o=k(r)?"default"in r?Vt(r.from||i,r.default,!0):Vt(r.from||i):Vt(r),ht(o)&&n?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:e=>o.value=e}):t[i]=o}}(u,n,null,e.appContext.config.unwrapInjectedRef),a)for(const p in a){const e=a[p];C(e)&&(n[p]=e.bind(r))}if(i){const t=i.call(r,r);k(t)&&(e.data=rt(t))}if(rr=!0,o)for(const T in o){const e=o[T],t=St({get:C(e)?e.bind(r,r):C(e.get)?e.get.bind(r,r):p,set:!C(e)&&C(e.set)?e.set.bind(r):p});Object.defineProperty(n,T,{enumerable:!0,configurable:!0,get:()=>t.value,set:e=>t.value=e})}if(s)for(const p in s)or(s[p],n,r,p);if(c){const e=C(c)?c.call(r):c;Reflect.ownKeys(e).forEach((t=>{Lt(t,e[t])}))}function L(e,t){T(t)?t.forEach((t=>e(t.bind(r)))):t&&e(t.bind(r))}if(d&&ir(d,e,"c"),L(Yt,l),L(Kt,m),L(Qt,h),L(zt,f),L(Bt,g),L(Ft,v),L(tr,R),L(er,E),L(Zt,_),L(Jt,I),L($t,S),L(Xt,w),T(A))if(A.length){const t=e.exposed||(e.exposed={});A.forEach((e=>{Object.defineProperty(t,e,{get:()=>r[e],set:t=>r[e]=t})}))}else e.exposed||(e.exposed={});b&&e.render===p&&(e.render=b),null!=x&&(e.inheritAttrs=x),N&&(e.components=N),O&&(e.directives=O)}function ir(e,t,r){_n(T(e)?e.map((e=>e.bind(t.proxy))):e.bind(t.proxy),t,r)}function or(e,t,r,n){const i=n.includes(".")?Zn(r,n):()=>r[n];if(E(e)){const r=t[e];C(r)&&Jn(i,r)}else if(C(e))Jn(i,e.bind(r));else if(k(e))if(T(e))e.forEach((e=>or(e,t,r,n)));else{const n=C(e.handler)?e.handler.bind(r):t[e.handler];C(n)&&Jn(i,n,e)}}function ar(e){const t=e.type,{mixins:r,extends:n}=t,{mixins:i,optionsCache:o,config:{optionMergeStrategies:a}}=e.appContext,s=o.get(t);let c;return s?c=s:i.length||r||n?(c={},i.length&&i.forEach((e=>sr(c,e,a,!0))),sr(c,t,a)):c=t,o.set(t,c),c}function sr(e,t,r,n=!1){const{mixins:i,extends:o}=t;o&&sr(e,o,r,!0),i&&i.forEach((t=>sr(e,t,r,!0)));for(const a in t)if(n&&"expose"===a);else{const n=cr[a]||r&&r[a];e[a]=n?n(e[a],t[a]):t[a]}return e}const cr={data:ur,props:pr,emits:pr,methods:pr,computed:pr,beforeCreate:lr,created:lr,beforeMount:lr,mounted:lr,beforeUpdate:lr,updated:lr,beforeDestroy:lr,beforeUnmount:lr,destroyed:lr,unmounted:lr,activated:lr,deactivated:lr,errorCaptured:lr,serverPrefetch:lr,components:pr,directives:pr,watch:function(e,t){if(!e)return t;if(!t)return e;const r=v(Object.create(null),e);for(const n in t)r[n]=lr(e[n],t[n]);return r},provide:ur,inject:function(e,t){return pr(dr(e),dr(t))}};function ur(e,t){return t?e?function(){return v(C(e)?e.call(this,this):e,C(t)?t.call(this,this):t)}:t:e}function dr(e){if(T(e)){const t={};for(let r=0;r<e.length;r++)t[e[r]]=e[r];return t}return e}function lr(e,t){return e?[...new Set([].concat(e,t))]:t}function pr(e,t){return e?v(v(Object.create(null),e),t):t}function mr(e,t,r,n){const[i,o]=e.propsOptions;let a,s=!1;if(t)for(let c in t){if(O(c))continue;const u=t[c];let d;i&&M(i,d=V(c))?o&&o.includes(d)?(a||(a={}))[d]=u:r[d]=u:Et(e.emitsOptions,c)||u!==n[c]&&(n[c]=u,s=!0)}if(o){const t=ut(r),n=a||d;for(let a=0;a<o.length;a++){const s=o[a];r[s]=hr(i,t,s,n[s],e,!M(n,s))}}return s}function hr(e,t,r,n,i,o){const a=e[r];if(null!=a){const e=M(a,"default");if(e&&void 0===n){const e=a.default;if(a.type!==Function&&C(e)){const{propsDefaults:o}=i;r in o?n=o[r]:(vn(i),n=o[r]=e.call(null,t),yn())}else n=e}a[0]&&(o&&!e?n=!1:!a[1]||""!==n&&n!==D(r)||(n=!0))}return n}function fr(e,t,r=!1){const n=t.propsCache,i=n.get(e);if(i)return i;const o=e.props,a={},s=[];let c=!1;if(!C(e)){const n=e=>{c=!0;const[r,n]=fr(e,t,!0);v(a,r),n&&s.push(...n)};!r&&t.mixins.length&&t.mixins.forEach(n),e.extends&&n(e.extends),e.mixins&&e.mixins.forEach(n)}if(!o&&!c)return n.set(e,l),l;if(T(o))for(let l=0;l<o.length;l++){const e=V(o[l]);gr(e)&&(a[e]=d)}else if(o)for(const d in o){const e=V(d);if(gr(e)){const t=o[d],r=a[e]=T(t)||C(t)?{type:t}:t;if(r){const t=Ir(Boolean,r.type),n=Ir(String,r.type);r[0]=t>-1,r[1]=n<0||t<n,(t>-1||M(r,"default"))&&s.push(e)}}}const u=[a,s];return n.set(e,u),u}function gr(e){return"$"!==e[0]}function vr(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:null===e?"null":""}function yr(e,t){return vr(e)===vr(t)}function Ir(e,t){return T(t)?t.findIndex((t=>yr(t,e))):C(t)&&yr(t,e)?0:-1}const Mr=e=>"_"===e[0]||"$stable"===e,Tr=e=>T(e)?e.map(sn):[sn(e)],Sr=(e,t,r)=>{const n=function(e,t=_t,r){if(!t)return e;if(e._n)return e;const n=(...r)=>{n._d&&Yr(-1);const i=Rt(t),o=e(...r);return Rt(i),n._d&&Yr(1),o};return n._n=!0,n._c=!0,n._d=!0,n}(((...e)=>Tr(t(...e))),r);return n._c=!1,n},br=(e,t,r)=>{const n=e._ctx;for(const i in e){if(Mr(i))continue;const r=e[i];if(C(r))t[i]=Sr(0,r,n);else if(null!=r){const e=Tr(r);t[i]=()=>e}}},Cr=(e,t)=>{const r=Tr(t);e.slots.default=()=>r};function Er(e,t){if(null===_t)return e;const r=_t.proxy,n=e.dirs||(e.dirs=[]);for(let i=0;i<t.length;i++){let[e,o,a,s=d]=t[i];C(e)&&(e={mounted:e,updated:e}),e.deep&&ei(o),n.push({dir:e,instance:r,value:o,oldValue:void 0,arg:a,modifiers:s})}return e}function _r(e,t,r,n){const i=e.dirs,o=t&&t.dirs;for(let a=0;a<i.length;a++){const s=i[a];o&&(s.oldValue=o[a].value);let c=s.dir[n];c&&(ce(),_n(c,r,8,[e.el,s,e,t]),ue())}}function kr(){return{app:null,config:{isNativeTag:m,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Rr=0;function wr(e,t){return function(r,n=null){null==n||k(n)||(n=null);const i=kr(),o=new Set;let a=!1;const s=i.app={_uid:Rr++,_component:r,_props:n,_container:null,_context:i,_instance:null,version:ri,get config(){return i.config},set config(e){},use:(e,...t)=>(o.has(e)||(e&&C(e.install)?(o.add(e),e.install(s,...t)):C(e)&&(o.add(e),e(s,...t))),s),mixin:e=>(i.mixins.includes(e)||i.mixins.push(e),s),component:(e,t)=>t?(i.components[e]=t,s):i.components[e],directive:(e,t)=>t?(i.directives[e]=t,s):i.directives[e],mount(o,c,u){if(!a){const d=rn(r,n);return d.appContext=i,c&&t?t(d,o):e(d,o,u),a=!0,s._container=o,o.__vue_app__=s,d.component.proxy}},unmount(){a&&(e(null,s._container),delete s._container.__vue_app__)},provide:(e,t)=>(i.provides[e]=t,s)};return s}}const Ar=function(e,t){t&&t.pendingBranch?T(e)?t.effects.push(...e):t.effects.push(e):Hn(e,Vn,Ln,Un)};function xr(e){return function(e,t){const{insert:r,remove:n,patchProp:i,createElement:o,createText:a,createComment:s,setText:c,setElementText:u,parentNode:m,nextSibling:h,setScopeId:f=p,cloneNode:g,insertStaticContent:y}=e,I=(e,t,r,n=null,i=null,o=null,a=!1,s=null,c=!!t.dynamicChildren)=>{if(e===t)return;e&&!$r(e,t)&&(n=te(e),J(e,i,o,!0),e=null),-2===t.patchFlag&&(c=!1,t.dynamicChildren=null);const{type:u,ref:d,shapeFlag:l}=t;switch(u){case qr:T(e,t,r,n);break;case Br:S(e,t,r,n);break;case Fr:null==e&&b(t,r,n,a);break;case Dr:L(e,t,r,n,i,o,a,s,c);break;default:1&l?_(e,t,r,n,i,o,a,s,c):6&l?U(e,t,r,n,i,o,a,s,c):(64&l||128&l)&&u.process(e,t,r,n,i,o,a,s,c,ne)}null!=d&&i&&Nr(d,e&&e.ref,o,t||e,!t)},T=(e,t,n,i)=>{if(null==e)r(t.el=a(t.children),n,i);else{const r=t.el=e.el;t.children!==e.children&&c(r,t.children)}},S=(e,t,n,i)=>{null==e?r(t.el=s(t.children||""),n,i):t.el=e.el},b=(e,t,r,n)=>{[e.el,e.anchor]=y(e.children,t,r,n)},C=({el:e,anchor:t},n,i)=>{let o;for(;e&&e!==t;)o=h(e),r(e,n,i),e=o;r(t,n,i)},E=({el:e,anchor:t})=>{let r;for(;e&&e!==t;)r=h(e),n(e),e=r;n(t)},_=(e,t,r,n,i,o,a,s,c)=>{a=a||"svg"===t.type,null==e?k(t,r,n,i,o,a,s,c):x(e,t,i,o,a,s,c)},k=(e,t,n,a,s,c,d,l)=>{let p,m;const{type:h,props:f,shapeFlag:v,transition:y,patchFlag:I,dirs:M}=e;if(e.el&&void 0!==g&&-1===I)p=e.el=g(e.el);else{if(p=e.el=o(e.type,c,f&&f.is,f),8&v?u(p,e.children):16&v&&A(e.children,p,null,a,s,c&&"foreignObject"!==h,d,l),M&&_r(e,null,a,"created"),f){for(const t in f)"value"===t||O(t)||i(p,t,null,f[t],c,e.children,a,s,ee);"value"in f&&i(p,"value",null,f.value),(m=f.onVnodeBeforeMount)&&Or(m,a,e)}w(p,e,e.scopeId,d,a)}M&&_r(e,null,a,"beforeMount");const T=(!s||s&&!s.pendingBranch)&&y&&!y.persisted;T&&y.beforeEnter(p),r(p,t,n),((m=f&&f.onVnodeMounted)||T||M)&&Ar((()=>{m&&Or(m,a,e),T&&y.enter(p),M&&_r(e,null,a,"mounted")}),s)},w=(e,t,r,n,i)=>{if(r&&f(e,r),n)for(let o=0;o<n.length;o++)f(e,n[o]);if(i){if(t===i.subTree){const t=i.vnode;w(e,t,t.scopeId,t.slotScopeIds,i.parent)}}},A=(e,t,r,n,i,o,a,s,c=0)=>{for(let u=c;u<e.length;u++){const c=e[u]=s?cn(e[u]):sn(e[u]);I(null,c,t,r,n,i,o,a,s)}},x=(e,t,r,n,o,a,s)=>{const c=t.el=e.el;let{patchFlag:l,dynamicChildren:p,dirs:m}=t;l|=16&e.patchFlag;const h=e.props||d,f=t.props||d;let g;(g=f.onVnodeBeforeUpdate)&&Or(g,r,t,e),m&&_r(t,e,r,"beforeUpdate");const v=o&&"foreignObject"!==t.type;if(p?N(e.dynamicChildren,p,c,r,n,v,a):s||W(e,t,c,null,r,n,v,a,!1),l>0){if(16&l)P(c,t,h,f,r,n,o);else if(2&l&&h.class!==f.class&&i(c,"class",null,f.class,o),4&l&&i(c,"style",h.style,f.style,o),8&l){const a=t.dynamicProps;for(let t=0;t<a.length;t++){const s=a[t],u=h[s],d=f[s];d===u&&"value"!==s||i(c,s,u,d,o,e.children,r,n,ee)}}1&l&&e.children!==t.children&&u(c,t.children)}else s||null!=p||P(c,t,h,f,r,n,o);((g=f.onVnodeUpdated)||m)&&Ar((()=>{g&&Or(g,r,t,e),m&&_r(t,e,r,"updated")}),n)},N=(e,t,r,n,i,o,a)=>{for(let s=0;s<t.length;s++){const c=e[s],u=t[s],d=c.el&&(c.type===Dr||!$r(c,u)||70&c.shapeFlag)?m(c.el):r;I(c,u,d,null,n,i,o,a,!0)}},P=(e,t,r,n,o,a,s)=>{if(r!==n){for(const c in n){if(O(c))continue;const u=n[c],d=r[c];u!==d&&"value"!==c&&i(e,c,d,u,s,t.children,o,a,ee)}if(r!==d)for(const c in r)O(c)||c in n||i(e,c,r[c],null,s,t.children,o,a,ee);"value"in n&&i(e,"value",r.value,n.value)}},L=(e,t,n,i,o,s,c,u,d)=>{const l=t.el=e?e.el:a(""),p=t.anchor=e?e.anchor:a("");let{patchFlag:m,dynamicChildren:h,slotScopeIds:f}=t;f&&(u=u?u.concat(f):f),null==e?(r(l,n,i),r(p,n,i),A(t.children,n,p,o,s,c,u,d)):m>0&&64&m&&h&&e.dynamicChildren?(N(e.dynamicChildren,h,n,o,s,c,u),(null!=t.key||o&&t===o.subTree)&&Pr(e,t,!0)):W(e,t,n,p,o,s,c,u,d)},U=(e,t,r,n,i,o,a,s,c)=>{t.slotScopeIds=s,null==e?512&t.shapeFlag?i.ctx.activate(t,r,n,a,c):q(t,r,n,i,o,a,c):B(e,t,c)},q=(e,t,r,n,i,o,a)=>{const s=e.component=function(e,t,r){const n=e.type,i=(t?t.appContext:e.appContext)||hn,o={uid:fn++,vnode:e,type:n,parent:t,appContext:i,root:null,next:null,subTree:null,update:null,scope:new K(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:fr(n,i),emitsOptions:Ct(n,i),emit:null,emitted:null,propsDefaults:d,inheritAttrs:n.inheritAttrs,ctx:d,data:d,props:d,attrs:d,slots:d,refs:d,setupState:d,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};o.ctx={_:o},o.root=t?t.root:o,o.emit=bt.bind(null,o),e.ce&&e.ce(o);return o}(e,n,i);if(qt(e)&&(s.ctx.renderer=ne),function(e,t=!1){Mn=t;const{props:r,children:n}=e.vnode,i=In(e);(function(e,t,r,n=!1){const i={},o={};j(o,Xr,1),e.propsDefaults=Object.create(null),mr(e,t,i,o);for(const a in e.propsOptions[0])a in i||(i[a]=void 0);r?e.props=n?i:nt(i):e.type.props?e.props=i:e.props=o,e.attrs=o})(e,r,i,t),((e,t)=>{if(32&e.vnode.shapeFlag){const r=t._;r?(e.slots=ut(t),j(t,"_",r)):br(t,e.slots={})}else e.slots={},t&&Cr(e,t);j(e.slots,Xr,1)})(e,n);const o=i?function(e,t){const r=e.type;e.accessCache=Object.create(null),e.proxy=dt(new Proxy(e.ctx,mn));const{setup:n}=r;if(n){const r=e.setupContext=n.length>1?function(e){const t=t=>{e.exposed=t||{}};let r;return{get attrs(){return r||(r=function(e){return new Proxy(e.attrs,{get:(t,r)=>(de(e,0,"$attrs"),t[r])})}(e))},slots:e.slots,emit:e.emit,expose:t}}(e):null;vn(e),ce();const i=En(n,e,0,[e.props,r]);if(ue(),yn(),R(i)){if(i.then(yn,yn),t)return i.then((t=>{Tn(e,t)})).catch((t=>{kn(t,e,0)}));e.asyncDep=i}else Tn(e,i)}else Sn(e)}(e,t):void 0;Mn=!1}(s),s.asyncDep){if(i&&i.registerDep(s,F),!e.el){const e=s.subTree=rn(Br);S(null,e,t,r)}}else F(s,e,t,r,i,o,a)},B=(e,t,r)=>{const n=t.component=e.component;if(function(e,t,r){const{props:n,children:i,component:o}=e,{props:a,children:s,patchFlag:c}=t,u=o.emitsOptions;if(t.dirs||t.transition)return!0;if(!(r&&c>=0))return!(!i&&!s||s&&s.$stable)||n!==a&&(n?!a||Pt(n,a,u):!!a);if(1024&c)return!0;if(16&c)return n?Pt(n,a,u):!!a;if(8&c){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const r=e[t];if(a[r]!==n[r]&&!Et(u,r))return!0}}return!1}(e,t,r)){if(n.asyncDep&&!n.asyncResolved)return void H(n,t,r);n.next=t,function(e){const t=An.indexOf(e);t>xn&&An.splice(t,1)}(n.update),n.update()}else t.component=e.component,t.el=e.el,n.vnode=t},F=(e,t,r,n,i,o,a)=>{const s=new ie((()=>{if(e.isMounted){let t,{next:r,bu:n,u:c,parent:u,vnode:d}=e,l=r;s.allowRecurse=!1,r?(r.el=d.el,H(e,r,a)):r=d,n&&G(n),(t=r.props&&r.props.onVnodeBeforeUpdate)&&Or(t,u,r,d),s.allowRecurse=!0;const p=xt(e),h=e.subTree;e.subTree=p,I(h,p,m(h.el),te(h),e,i,o),r.el=p.el,null===l&&function({vnode:e,parent:t},r){for(;t&&t.subTree===e;)(e=t.vnode).el=r,t=t.parent}(e,p.el),c&&Ar(c,i),(t=r.props&&r.props.onVnodeUpdated)&&Ar((()=>Or(t,u,r,d)),i)}else{let a;const{el:c,props:u}=t,{bm:d,m:l,parent:p}=e,m=Dt(t);if(s.allowRecurse=!1,d&&G(d),!m&&(a=u&&u.onVnodeBeforeMount)&&Or(a,p,t),s.allowRecurse=!0,c&&ae){const r=()=>{e.subTree=xt(e),ae(c,e.subTree,e,i,null)};m?t.type.__asyncLoader().then((()=>!e.isUnmounted&&r())):r()}else{const a=e.subTree=xt(e);I(null,a,r,n,e,i,o),t.el=a.el}if(l&&Ar(l,i),!m&&(a=u&&u.onVnodeMounted)){const e=t;Ar((()=>Or(a,p,e)),i)}256&t.shapeFlag&&e.a&&Ar(e.a,i),e.isMounted=!0,t=r=n=null}}),(()=>Gn(e.update)),e.scope),c=e.update=s.run.bind(s);c.id=e.uid,s.allowRecurse=c.allowRecurse=!0,c()},H=(e,t,r)=>{t.component=e;const n=e.vnode.props;e.vnode=t,e.next=null,function(e,t,r,n){const{props:i,attrs:o,vnode:{patchFlag:a}}=e,s=ut(i),[c]=e.propsOptions;let u=!1;if(!(n||a>0)||16&a){let n;mr(e,t,i,o)&&(u=!0);for(const o in s)t&&(M(t,o)||(n=D(o))!==o&&M(t,n))||(c?!r||void 0===r[o]&&void 0===r[n]||(i[o]=hr(c,s,o,void 0,e,!0)):delete i[o]);if(o!==s)for(const e in o)t&&M(t,e)||(delete o[e],u=!0)}else if(8&a){const r=e.vnode.dynamicProps;for(let n=0;n<r.length;n++){let a=r[n];const d=t[a];if(c)if(M(o,a))d!==o[a]&&(o[a]=d,u=!0);else{const t=V(a);i[t]=hr(c,s,t,d,e,!1)}else d!==o[a]&&(o[a]=d,u=!0)}}u&&me(e,"set","$attrs")}(e,t.props,n,r),((e,t,r)=>{const{vnode:n,slots:i}=e;let o=!0,a=d;if(32&n.shapeFlag){const e=t._;e?r&&1===e?o=!1:(v(i,t),r||1!==e||delete i._):(o=!t.$stable,br(t,i)),a=t}else t&&(Cr(e,t),a={default:1});if(o)for(const s in i)Mr(s)||s in a||delete i[s]})(e,t.children,r),ce(),Wn(void 0,e.update),ue()},W=(e,t,r,n,i,o,a,s,c=!1)=>{const d=e&&e.children,l=e?e.shapeFlag:0,p=t.children,{patchFlag:m,shapeFlag:h}=t;if(m>0){if(128&m)return void Q(d,p,r,n,i,o,a,s,c);if(256&m)return void Y(d,p,r,n,i,o,a,s,c)}8&h?(16&l&&ee(d,i,o),p!==d&&u(r,p)):16&l?16&h?Q(d,p,r,n,i,o,a,s,c):ee(d,i,o,!0):(8&l&&u(r,""),16&h&&A(p,r,n,i,o,a,s,c))},Y=(e,t,r,n,i,o,a,s,c)=>{t=t||l;const u=(e=e||l).length,d=t.length,p=Math.min(u,d);let m;for(m=0;m<p;m++){const n=t[m]=c?cn(t[m]):sn(t[m]);I(e[m],n,r,null,i,o,a,s,c)}u>d?ee(e,i,o,!0,!1,p):A(t,r,n,i,o,a,s,c,p)},Q=(e,t,r,n,i,o,a,s,c)=>{let u=0;const d=t.length;let p=e.length-1,m=d-1;for(;u<=p&&u<=m;){const n=e[u],d=t[u]=c?cn(t[u]):sn(t[u]);if(!$r(n,d))break;I(n,d,r,null,i,o,a,s,c),u++}for(;u<=p&&u<=m;){const n=e[p],u=t[m]=c?cn(t[m]):sn(t[m]);if(!$r(n,u))break;I(n,u,r,null,i,o,a,s,c),p--,m--}if(u>p){if(u<=m){const e=m+1,l=e<d?t[e].el:n;for(;u<=m;)I(null,t[u]=c?cn(t[u]):sn(t[u]),r,l,i,o,a,s,c),u++}}else if(u>m)for(;u<=p;)J(e[u],i,o,!0),u++;else{const h=u,f=u,g=new Map;for(u=f;u<=m;u++){const e=t[u]=c?cn(t[u]):sn(t[u]);null!=e.key&&g.set(e.key,u)}let v,y=0;const M=m-f+1;let T=!1,S=0;const b=new Array(M);for(u=0;u<M;u++)b[u]=0;for(u=h;u<=p;u++){const n=e[u];if(y>=M){J(n,i,o,!0);continue}let d;if(null!=n.key)d=g.get(n.key);else for(v=f;v<=m;v++)if(0===b[v-f]&&$r(n,t[v])){d=v;break}void 0===d?J(n,i,o,!0):(b[d-f]=u+1,d>=S?S=d:T=!0,I(n,t[d],r,null,i,o,a,s,c),y++)}const C=T?function(e){const t=e.slice(),r=[0];let n,i,o,a,s;const c=e.length;for(n=0;n<c;n++){const c=e[n];if(0!==c){if(i=r[r.length-1],e[i]<c){t[n]=i,r.push(n);continue}for(o=0,a=r.length-1;o<a;)s=o+a>>1,e[r[s]]<c?o=s+1:a=s;c<e[r[o]]&&(o>0&&(t[n]=r[o-1]),r[o]=n)}}o=r.length,a=r[o-1];for(;o-- >0;)r[o]=a,a=t[a];return r}(b):l;for(v=C.length-1,u=M-1;u>=0;u--){const e=f+u,l=t[e],p=e+1<d?t[e+1].el:n;0===b[u]?I(null,l,r,p,i,o,a,s,c):T&&(v<0||u!==C[v]?z(l,r,p,2):v--)}}},z=(e,t,n,i,o=null)=>{const{el:a,type:s,transition:c,children:u,shapeFlag:d}=e;if(6&d)return void z(e.component.subTree,t,n,i);if(128&d)return void e.suspense.move(t,n,i);if(64&d)return void s.move(e,t,n,ne);if(s===Dr){r(a,t,n);for(let e=0;e<u.length;e++)z(u[e],t,n,i);return void r(e.anchor,t,n)}if(s===Fr)return void C(e,t,n);if(2!==i&&1&d&&c)if(0===i)c.beforeEnter(a),r(a,t,n),Ar((()=>c.enter(a)),o);else{const{leave:e,delayLeave:i,afterLeave:o}=c,s=()=>r(a,t,n),u=()=>{e(a,(()=>{s(),o&&o()}))};i?i(a,s,u):u()}else r(a,t,n)},J=(e,t,r,n=!1,i=!1)=>{const{type:o,props:a,ref:s,children:c,dynamicChildren:u,shapeFlag:d,patchFlag:l,dirs:p}=e;if(null!=s&&Nr(s,null,r,e,!0),256&d)return void t.ctx.deactivate(e);const m=1&d&&p,h=!Dt(e);let f;if(h&&(f=a&&a.onVnodeBeforeUnmount)&&Or(f,t,e),6&d)Z(e.component,r,n);else{if(128&d)return void e.suspense.unmount(r,n);m&&_r(e,null,t,"beforeUnmount"),64&d?e.type.remove(e,t,r,i,ne,n):u&&(o!==Dr||l>0&&64&l)?ee(u,t,r,!1,!0):(o===Dr&&384&l||!i&&16&d)&&ee(c,t,r),n&&$(e)}(h&&(f=a&&a.onVnodeUnmounted)||m)&&Ar((()=>{f&&Or(f,t,e),m&&_r(e,null,t,"unmounted")}),r)},$=e=>{const{type:t,el:r,anchor:i,transition:o}=e;if(t===Dr)return void X(r,i);if(t===Fr)return void E(e);const a=()=>{n(r),o&&!o.persisted&&o.afterLeave&&o.afterLeave()};if(1&e.shapeFlag&&o&&!o.persisted){const{leave:t,delayLeave:n}=o,i=()=>t(r,a);n?n(e.el,a,i):i()}else a()},X=(e,t)=>{let r;for(;e!==t;)r=h(e),n(e),e=r;n(t)},Z=(e,t,r)=>{const{bum:n,scope:i,update:o,subTree:a,um:s}=e;n&&G(n),i.stop(),o&&(o.active=!1,J(a,e,t,r)),s&&Ar(s,t),Ar((()=>{e.isUnmounted=!0}),t),t&&t.pendingBranch&&!t.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===t.pendingId&&(t.deps--,0===t.deps&&t.resolve())},ee=(e,t,r,n=!1,i=!1,o=0)=>{for(let a=o;a<e.length;a++)J(e[a],t,r,n,i)},te=e=>6&e.shapeFlag?te(e.component.subTree):128&e.shapeFlag?e.suspense.next():h(e.anchor||e.el),re=(e,t,r)=>{null==e?t._vnode&&J(t._vnode,null,null,!0):I(t._vnode||null,e,t,null,null,null,r),Yn(),t._vnode=e},ne={p:I,um:J,m:z,r:$,mt:q,mc:A,pc:W,pbc:N,n:te,o:e};let oe,ae;t&&([oe,ae]=t(ne));return{render:re,hydrate:oe,createApp:wr(re,oe)}}(e)}function Nr(e,t,r,n,i=!1){if(T(e))return void e.forEach(((e,o)=>Nr(e,t&&(T(t)?t[o]:t),r,n,i)));if(Dt(n)&&!i)return;const o=4&n.shapeFlag?bn(n.component)||n.component.proxy:n.el,a=i?null:o,{i:s,r:c}=e,u=t&&t.r,l=s.refs===d?s.refs={}:s.refs,p=s.setupState;if(null!=u&&u!==c&&(E(u)?(l[u]=null,M(p,u)&&(p[u]=null)):ht(u)&&(u.value=null)),E(c)){const e=()=>{l[c]=a,M(p,c)&&(p[c]=a)};a?(e.id=-1,Ar(e,r)):e()}else if(ht(c)){const e=()=>{c.value=a};a?(e.id=-1,Ar(e,r)):e()}else C(c)&&En(c,s,12,[a,l])}function Or(e,t,r,n=null){_n(e,t,7,[r,n])}function Pr(e,t,r=!1){const n=e.children,i=t.children;if(T(n)&&T(i))for(let o=0;o<n.length;o++){const e=n[o];let t=i[o];1&t.shapeFlag&&!t.dynamicChildren&&((t.patchFlag<=0||32===t.patchFlag)&&(t=i[o]=cn(i[o]),t.el=e.el),r||Pr(e,t))}}function Lr(e,t){return function(e,t,r=!0,n=!1){const i=_t||gn;if(i){const r=i.type;if("components"===e){const e=Cn(r);if(e&&(e===t||e===V(t)||e===q(V(t))))return r}const o=Ur(i[e]||r[e],t)||Ur(i.appContext[e],t);return!o&&n?r:o}}("components",e,!0,t)||e}const Vr=Symbol();function Ur(e,t){return e&&(e[t]||e[V(t)]||e[q(V(t))])}const Dr=Symbol(void 0),qr=Symbol(void 0),Br=Symbol(void 0),Fr=Symbol(void 0),Gr=[];let jr=null;function Hr(e=!1){Gr.push(jr=e?null:[])}let Wr=1;function Yr(e){Wr+=e}function Kr(e){return e.dynamicChildren=Wr>0?jr||l:null,Gr.pop(),jr=Gr[Gr.length-1]||null,Wr>0&&jr&&jr.push(e),e}function Qr(e,t,r,n,i,o){return Kr(tn(e,t,r,n,i,o,!0))}function zr(e,t,r,n,i){return Kr(rn(e,t,r,n,i,!0))}function Jr(e){return!!e&&!0===e.__v_isVNode}function $r(e,t){return e.type===t.type&&e.key===t.key}const Xr="__vInternal",Zr=({key:e})=>null!=e?e:null,en=({ref:e})=>null!=e?E(e)||ht(e)||C(e)?{i:_t,r:e}:e:null;function tn(e,t=null,r=null,n=0,i=null,o=(e===Dr?0:1),a=!1,s=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Zr(t),ref:t&&en(t),scopeId:kt,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:n,dynamicProps:i,dynamicChildren:null,appContext:null};return s?(un(c,r),128&o&&e.normalize(c)):r&&(c.shapeFlag|=E(r)?8:16),Wr>0&&!a&&jr&&(c.patchFlag>0||6&o)&&32!==c.patchFlag&&jr.push(c),c}const rn=function(e,t=null,r=null,i=0,o=null,a=!1){e&&e!==Vr||(e=Br);if(Jr(e)){const n=nn(e,t,!0);return r&&un(n,r),n}c=e,C(c)&&"__vccOpts"in c&&(e=e.__vccOpts);var c;if(t){t=function(e){return e?ct(e)||Xr in e?v({},e):e:null}(t);let{class:e,style:r}=t;e&&!E(e)&&(t.class=s(e)),k(r)&&(ct(r)&&!T(r)&&(r=v({},r)),t.style=n(r))}const u=E(e)?1:(e=>e.__isSuspense)(e)?128:(e=>e.__isTeleport)(e)?64:k(e)?4:C(e)?2:0;return tn(e,t,r,i,o,u,a,!0)};function nn(e,t,r=!1){const{props:i,ref:o,patchFlag:a,children:c}=e,u=t?function(...e){const t={};for(let r=0;r<e.length;r++){const i=e[r];for(const e in i)if("class"===e)t.class!==i.class&&(t.class=s([t.class,i.class]));else if("style"===e)t.style=n([t.style,i.style]);else if(f(e)){const r=t[e],n=i[e];r!==n&&(t[e]=r?[].concat(r,n):n)}else""!==e&&(t[e]=i[e])}return t}(i||{},t):i;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:u,key:u&&Zr(u),ref:t&&t.ref?r&&o?T(o)?o.concat(en(t)):[o,en(t)]:en(t):o,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:c,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Dr?-1===a?16:16|a:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&nn(e.ssContent),ssFallback:e.ssFallback&&nn(e.ssFallback),el:e.el,anchor:e.anchor}}function on(e=" ",t=0){return rn(qr,null,e,t)}function an(e="",t=!1){return t?(Hr(),zr(Br,null,e)):rn(Br,null,e)}function sn(e){return null==e||"boolean"==typeof e?rn(Br):T(e)?rn(Dr,null,e.slice()):"object"==typeof e?cn(e):rn(qr,null,String(e))}function cn(e){return null===e.el||e.memo?e:nn(e)}function un(e,t){let r=0;const{shapeFlag:n}=e;if(null==t)t=null;else if(T(t))r=16;else if("object"==typeof t){if(65&n){const r=t.default;return void(r&&(r._c&&(r._d=!1),un(e,r()),r._c&&(r._d=!0)))}{r=32;const n=t._;n||Xr in t?3===n&&_t&&(1===_t.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=_t}}else C(t)?(t={default:t,_ctx:_t},r=32):(t=String(t),64&n?(r=16,t=[on(t)]):r=8);e.children=t,e.shapeFlag|=r}function dn(e,t,r,n){let i;const o=r&&r[n];if(T(e)||E(e)){i=new Array(e.length);for(let r=0,n=e.length;r<n;r++)i[r]=t(e[r],r,void 0,o&&o[r])}else if("number"==typeof e){i=new Array(e);for(let r=0;r<e;r++)i[r]=t(r+1,r,void 0,o&&o[r])}else if(k(e))if(e[Symbol.iterator])i=Array.from(e,((e,r)=>t(e,r,void 0,o&&o[r])));else{const r=Object.keys(e);i=new Array(r.length);for(let n=0,a=r.length;n<a;n++){const a=r[n];i[n]=t(e[a],a,n,o&&o[n])}}else i=[];return r&&(r[n]=i),i}const ln=e=>e?In(e)?bn(e)||e.proxy:ln(e.parent):null,pn=v(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>ln(e.parent),$root:e=>ln(e.root),$emit:e=>e.emit,$options:e=>ar(e),$forceUpdate:e=>()=>Gn(e.update),$nextTick:e=>Fn.bind(e.proxy),$watch:e=>Xn.bind(e)}),mn={get({_:e},t){const{ctx:r,setupState:n,data:i,props:o,accessCache:a,type:s,appContext:c}=e;let u;if("$"!==t[0]){const s=a[t];if(void 0!==s)switch(s){case 0:return n[t];case 1:return i[t];case 3:return r[t];case 2:return o[t]}else{if(n!==d&&M(n,t))return a[t]=0,n[t];if(i!==d&&M(i,t))return a[t]=1,i[t];if((u=e.propsOptions[0])&&M(u,t))return a[t]=2,o[t];if(r!==d&&M(r,t))return a[t]=3,r[t];rr&&(a[t]=4)}}const l=pn[t];let p,m;return l?("$attrs"===t&&de(e,0,t),l(e)):(p=s.__cssModules)&&(p=p[t])?p:r!==d&&M(r,t)?(a[t]=3,r[t]):(m=c.config.globalProperties,M(m,t)?m[t]:void 0)},set({_:e},t,r){const{data:n,setupState:i,ctx:o}=e;if(i!==d&&M(i,t))i[t]=r;else if(n!==d&&M(n,t))n[t]=r;else if(M(e.props,t))return!1;return("$"!==t[0]||!(t.slice(1)in e))&&(o[t]=r,!0)},has({_:{data:e,setupState:t,accessCache:r,ctx:n,appContext:i,propsOptions:o}},a){let s;return void 0!==r[a]||e!==d&&M(e,a)||t!==d&&M(t,a)||(s=o[0])&&M(s,a)||M(n,a)||M(pn,a)||M(i.config.globalProperties,a)}},hn=kr();let fn=0;let gn=null;const vn=e=>{gn=e,e.scope.on()},yn=()=>{gn&&gn.scope.off(),gn=null};function In(e){return 4&e.vnode.shapeFlag}let Mn=!1;function Tn(e,t,r){C(t)?e.render=t:k(t)&&(e.setupState=Mt(t)),Sn(e)}function Sn(e,t,r){const n=e.type;e.render||(e.render=n.render||p),vn(e),ce(),nr(e),ue(),yn()}function bn(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Mt(dt(e.exposed)),{get:(t,r)=>r in t?t[r]:r in pn?pn[r](e):void 0}))}function Cn(e){return C(e)&&e.displayName||e.name}function En(e,t,r,n){let i;try{i=n?e(...n):e()}catch(o){kn(o,t,r)}return i}function _n(e,t,r,n){if(C(e)){const i=En(e,t,r,n);return i&&R(i)&&i.catch((e=>{kn(e,t,r)})),i}const i=[];for(let o=0;o<e.length;o++)i.push(_n(e[o],t,r,n));return i}function kn(e,t,r,n=!0){t&&t.vnode;if(t){let n=t.parent;const i=t.proxy,o=r;for(;n;){const t=n.ec;if(t)for(let r=0;r<t.length;r++)if(!1===t[r](e,i,o))return;n=n.parent}const a=t.appContext.config.errorHandler;if(a)return void En(a,null,10,[e,i,o])}!function(e,t,r,n=!0){console.error(e)}(e,0,0,n)}let Rn=!1,wn=!1;const An=[];let xn=0;const Nn=[];let On=null,Pn=0;const Ln=[];let Vn=null,Un=0;const Dn=Promise.resolve();let qn=null,Bn=null;function Fn(e){const t=qn||Dn;return e?t.then(this?e.bind(this):e):t}function Gn(e){An.length&&An.includes(e,Rn&&e.allowRecurse?xn+1:xn)||e===Bn||(null==e.id?An.push(e):An.splice(function(e){let t=xn+1,r=An.length;for(;t<r;){const n=t+r>>>1;Kn(An[n])<e?t=n+1:r=n}return t}(e.id),0,e),jn())}function jn(){Rn||wn||(wn=!0,qn=Dn.then(Qn))}function Hn(e,t,r,n){T(e)?r.push(...e):t&&t.includes(e,e.allowRecurse?n+1:n)||r.push(e),jn()}function Wn(e,t=null){if(Nn.length){for(Bn=t,On=[...new Set(Nn)],Nn.length=0,Pn=0;Pn<On.length;Pn++)On[Pn]();On=null,Pn=0,Bn=null,Wn(e,t)}}function Yn(e){if(Ln.length){const e=[...new Set(Ln)];if(Ln.length=0,Vn)return void Vn.push(...e);for(Vn=e,Vn.sort(((e,t)=>Kn(e)-Kn(t))),Un=0;Un<Vn.length;Un++)Vn[Un]();Vn=null,Un=0}}const Kn=e=>null==e.id?1/0:e.id;function Qn(e){wn=!1,Rn=!0,Wn(e),An.sort(((e,t)=>Kn(e)-Kn(t)));try{for(xn=0;xn<An.length;xn++){const e=An[xn];e&&!1!==e.active&&En(e,null,14)}}finally{xn=0,An.length=0,Yn(),Rn=!1,qn=null,(An.length||Nn.length||Ln.length)&&Qn(e)}}const zn={};function Jn(e,t,r){return $n(e,t,r)}function $n(e,t,{immediate:r,deep:n,flush:i,onTrack:o,onTrigger:a}=d){const s=gn;let c,u,l=!1,m=!1;if(ht(e)?(c=()=>e.value,l=!!e._shallow):at(e)?(c=()=>e,n=!0):T(e)?(m=!0,l=e.some(at),c=()=>e.map((e=>ht(e)?e.value:at(e)?ei(e):C(e)?En(e,s,2):void 0))):c=C(e)?t?()=>En(e,s,2):()=>{if(!s||!s.isUnmounted)return u&&u(),_n(e,s,3,[h])}:p,t&&n){const e=c;c=()=>ei(e())}let h=e=>{u=I.onStop=()=>{En(e,s,4)}},f=m?[]:zn;const g=()=>{if(I.active)if(t){const e=I.run();(n||l||(m?e.some(((e,t)=>F(e,f[t]))):F(e,f)))&&(u&&u(),_n(t,s,3,[e,f===zn?void 0:f,h]),f=e)}else I.run()};let v;g.allowRecurse=!!t,v="sync"===i?g:"post"===i?()=>Ar(g,s&&s.suspense):()=>{!s||s.isMounted?function(e){Hn(e,On,Nn,Pn)}(g):g()};const I=new ie(c,v);return t?r?g():f=I.run():"post"===i?Ar(I.run.bind(I),s&&s.suspense):I.run(),()=>{I.stop(),s&&s.scope&&y(s.scope.effects,I)}}function Xn(e,t,r){const n=this.proxy,i=E(e)?e.includes(".")?Zn(n,e):()=>n[e]:e.bind(n,n);let o;C(t)?o=t:(o=t.handler,r=t);const a=gn;vn(this);const s=$n(i,o.bind(n),r);return a?vn(a):yn(),s}function Zn(e,t){const r=t.split(".");return()=>{let t=e;for(let e=0;e<r.length&&t;e++)t=t[r[e]];return t}}function ei(e,t=new Set){if(!k(e)||e.__v_skip)return e;if((t=t||new Set).has(e))return e;if(t.add(e),ht(e))ei(e.value,t);else if(T(e))for(let r=0;r<e.length;r++)ei(e[r],t);else if(b(e)||S(e))e.forEach((e=>{ei(e,t)}));else if(x(e))for(const r in e)ei(e[r],t);return e}function ti(e,t,r){const n=arguments.length;return 2===n?k(t)&&!T(t)?Jr(t)?rn(e,null,[t]):rn(e,t):rn(e,null,t):(n>3?r=Array.prototype.slice.call(arguments,2):3===n&&Jr(r)&&(r=[r]),rn(e,t,r))}const ri="3.2.8",ni="undefined"!=typeof document?document:null,ii=new Map,oi={insert:(e,t,r)=>{t.insertBefore(e,r||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,r,n)=>{const i=t?ni.createElementNS("http://www.w3.org/2000/svg",e):ni.createElement(e,r?{is:r}:void 0);return"select"===e&&n&&null!=n.multiple&&i.setAttribute("multiple",n.multiple),i},createText:e=>ni.createTextNode(e),createComment:e=>ni.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>ni.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},cloneNode(e){const t=e.cloneNode(!0);return"_value"in e&&(t._value=e._value),t},insertStaticContent(e,t,r,n){const i=r?r.previousSibling:t.lastChild;let o=ii.get(e);if(!o){const t=ni.createElement("template");if(t.innerHTML=n?`<svg>${e}</svg>`:e,o=t.content,n){const e=o.firstChild;for(;e.firstChild;)o.appendChild(e.firstChild);o.removeChild(e)}ii.set(e,o)}return t.insertBefore(o.cloneNode(!0),r),[i?i.nextSibling:t.firstChild,r?r.previousSibling:t.lastChild]}};const ai=/\s*!important$/;function si(e,t,r){if(T(r))r.forEach((r=>si(e,t,r)));else if(t.startsWith("--"))e.setProperty(t,r);else{const n=function(e,t){const r=ui[t];if(r)return r;let n=V(t);if("filter"!==n&&n in e)return ui[t]=n;n=q(n);for(let i=0;i<ci.length;i++){const r=ci[i]+n;if(r in e)return ui[t]=r}return t}(e,t);ai.test(r)?e.setProperty(D(n),r.replace(ai,""),"important"):e[n]=r}}const ci=["Webkit","Moz","ms"],ui={};const di="http://www.w3.org/1999/xlink";let li=Date.now,pi=!1;if("undefined"!=typeof window){li()>document.createEvent("Event").timeStamp&&(li=()=>performance.now());const e=navigator.userAgent.match(/firefox\/(\d+)/i);pi=!!(e&&Number(e[1])<=53)}let mi=0;const hi=Promise.resolve(),fi=()=>{mi=0};function gi(e,t,r,n){e.addEventListener(t,r,n)}function vi(e,t,r,n,i=null){const o=e._vei||(e._vei={}),a=o[t];if(n&&a)a.value=n;else{const[r,s]=function(e){let t;if(yi.test(e)){let r;for(t={};r=e.match(yi);)e=e.slice(0,e.length-r[0].length),t[r[0].toLowerCase()]=!0}return[D(e.slice(2)),t]}(t);if(n){gi(e,r,o[t]=function(e,t){const r=e=>{const n=e.timeStamp||li();(pi||n>=r.attached-1)&&_n(function(e,t){if(T(t)){const r=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{r.call(e),e._stopped=!0},t.map((e=>t=>!t._stopped&&e(t)))}return t}(e,r.value),t,5,[e])};return r.value=e,r.attached=(()=>mi||(hi.then(fi),mi=li()))(),r}(n,i),s)}else a&&(!function(e,t,r,n){e.removeEventListener(t,r,n)}(e,r,a,s),o[t]=void 0)}}const yi=/(?:Once|Passive|Capture)$/;const Ii=/^on[a-z]/;const Mi=e=>{const t=e.props["onUpdate:modelValue"];return T(t)?e=>G(t,e):t};function Ti(e){e.target.composing=!0}function Si(e){const t=e.target;t.composing&&(t.composing=!1,function(e,t){const r=document.createEvent("HTMLEvents");r.initEvent(t,!0,!0),e.dispatchEvent(r)}(t,"input"))}const bi={created(e,{modifiers:{lazy:t,trim:r,number:n}},i){e._assign=Mi(i);const o=n||i.props&&"number"===i.props.type;gi(e,t?"change":"input",(t=>{if(t.target.composing)return;let n=e.value;r?n=n.trim():o&&(n=H(n)),e._assign(n)})),r&&gi(e,"change",(()=>{e.value=e.value.trim()})),t||(gi(e,"compositionstart",Ti),gi(e,"compositionend",Si),gi(e,"change",Si))},mounted(e,{value:t}){e.value=null==t?"":t},beforeUpdate(e,{value:t,modifiers:{lazy:r,trim:n,number:i}},o){if(e._assign=Mi(o),e.composing)return;if(document.activeElement===e){if(r)return;if(n&&e.value.trim()===t)return;if((i||"number"===e.type)&&H(e.value)===t)return}const a=null==t?"":t;e.value!==a&&(e.value=a)}},Ci=v({patchProp:(e,n,i,o,a=!1,s,c,u,d)=>{"class"===n?function(e,t,r){const n=e._vtc;n&&(t=(t?[t,...n]:[...n]).join(" ")),null==t?e.removeAttribute("class"):r?e.setAttribute("class",t):e.className=t}(e,o,a):"style"===n?function(e,t,r){const n=e.style;if(r)if(E(r)){if(t!==r){const t=n.display;n.cssText=r,"_vod"in e&&(n.display=t)}}else{for(const e in r)si(n,e,r[e]);if(t&&!E(t))for(const e in t)null==r[e]&&si(n,e,"")}else e.removeAttribute("style")}(e,i,o):f(n)?g(n)||vi(e,n,0,o,c):("."===n[0]?(n=n.slice(1),1):"^"===n[0]?(n=n.slice(1),0):function(e,t,r,n){if(n)return"innerHTML"===t||"textContent"===t||!!(t in e&&Ii.test(t)&&C(r));if("spellcheck"===t||"draggable"===t)return!1;if("form"===t)return!1;if("list"===t&&"INPUT"===e.tagName)return!1;if("type"===t&&"TEXTAREA"===e.tagName)return!1;if(Ii.test(t)&&E(r))return!1;return t in e}(e,n,o,a))?function(e,t,n,i,o,a,s){if("innerHTML"===t||"textContent"===t)return i&&s(i,o,a),void(e[t]=null==n?"":n);if("value"===t&&"PROGRESS"!==e.tagName){e._value=n;const r=null==n?"":n;return e.value!==r&&(e.value=r),void(null==n&&e.removeAttribute(t))}if(""===n||null==n){const i=typeof e[t];if("boolean"===i)return void(e[t]=r(n));if(null==n&&"string"===i)return e[t]="",void e.removeAttribute(t);if("number"===i){try{e[t]=0}catch(c){}return void e.removeAttribute(t)}}try{e[t]=n}catch(u){}}(e,n,o,s,c,u,d):("true-value"===n?e._trueValue=o:"false-value"===n&&(e._falseValue=o),function(e,n,i,o,a){if(o&&n.startsWith("xlink:"))null==i?e.removeAttributeNS(di,n.slice(6,n.length)):e.setAttributeNS(di,n,i);else{const o=t(n);null==i||o&&!r(i)?e.removeAttribute(n):e.setAttribute(n,o?"":i)}}(e,n,o,a))}},oi);let Ei;const _i=(...e)=>{const t=(Ei||(Ei=xr(Ci))).createApp(...e),{mount:r}=t;return t.mount=e=>{const n=function(e){if(E(e)){return document.querySelector(e)}return e}(e);if(!n)return;const i=t._component;C(i)||i.render||i.template||(i.template=n.innerHTML),n.innerHTML="";const o=r(n,!1,n instanceof SVGElement);return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),o},t};var ki="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ri(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var wi={exports:{}};!function(e){var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==ki?ki:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){var t={exports:{}};return e(t,t.exports),t.exports}var i,o,a=function(e){return e&&e.Math==Math&&e},s=a("object"==typeof globalThis&&globalThis)||a("object"==typeof window&&window)||a("object"==typeof self&&self)||a("object"==typeof t&&t)||function(){return this}()||Function("return this")(),c=function(e){try{return!!e()}catch(t){return!0}},u=!c((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),d=Function.prototype,l=d.apply,p=d.call,m="object"==typeof Reflect&&Reflect.apply||(u?p.bind(l):function(){return p.apply(l,arguments)}),h=Function.prototype,f=h.bind,g=h.call,v=u&&f.bind(g,g),y=u?function(e){return e&&v(e)}:function(e){return e&&function(){return g.apply(e,arguments)}},I=function(e){return"function"==typeof e},M=!c((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),T=Function.prototype.call,S=u?T.bind(T):function(){return T.apply(T,arguments)},b={}.propertyIsEnumerable,C=Object.getOwnPropertyDescriptor,E={f:C&&!b.call({1:2},1)?function(e){var t=C(this,e);return!!t&&t.enumerable}:b},_=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},k=y({}.toString),R=y("".slice),w=function(e){return R(k(e),8,-1)},A=Object,x=y("".split),N=c((function(){return!A("z").propertyIsEnumerable(0)}))?function(e){return"String"==w(e)?x(e,""):A(e)}:A,O=function(e){return null==e},P=TypeError,L=function(e){if(O(e))throw P("Can't call method on "+e);return e},V=function(e){return N(L(e))},U="object"==typeof document&&document.all,D=void 0===U&&void 0!==U?function(e){return"object"==typeof e?null!==e:I(e)||e===U}:function(e){return"object"==typeof e?null!==e:I(e)},q={},B=function(e){return I(e)?e:void 0},F=function(e,t){return arguments.length<2?B(q[e])||B(s[e]):q[e]&&q[e][t]||s[e]&&s[e][t]},G=y({}.isPrototypeOf),j=F("navigator","userAgent")||"",H=s.process,W=s.Deno,Y=H&&H.versions||W&&W.version,K=Y&&Y.v8;K&&(o=(i=K.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!o&&j&&(!(i=j.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=j.match(/Chrome\/(\d+)/))&&(o=+i[1]);var Q=o,z=!!Object.getOwnPropertySymbols&&!c((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Q&&Q<41})),J=z&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,$=Object,X=J?function(e){return"symbol"==typeof e}:function(e){var t=F("Symbol");return I(t)&&G(t.prototype,$(e))},Z=String,ee=function(e){try{return Z(e)}catch(t){return"Object"}},te=TypeError,re=function(e){if(I(e))return e;throw te(ee(e)+" is not a function")},ne=function(e,t){var r=e[t];return O(r)?void 0:re(r)},ie=TypeError,oe=Object.defineProperty,ae="__core-js_shared__",se=s[ae]||function(e,t){try{oe(s,e,{value:t,configurable:!0,writable:!0})}catch(r){s[e]=t}return t}(ae,{}),ce=n((function(e){(e.exports=function(e,t){return se[e]||(se[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),ue=Object,de=function(e){return ue(L(e))},le=y({}.hasOwnProperty),pe=Object.hasOwn||function(e,t){return le(de(e),t)},me=0,he=Math.random(),fe=y(1..toString),ge=function(e){return"Symbol("+(void 0===e?"":e)+")_"+fe(++me+he,36)},ve=ce("wks"),ye=s.Symbol,Ie=ye&&ye.for,Me=J?ye:ye&&ye.withoutSetter||ge,Te=function(e){if(!pe(ve,e)||!z&&"string"!=typeof ve[e]){var t="Symbol."+e;z&&pe(ye,e)?ve[e]=ye[e]:ve[e]=J&&Ie?Ie(t):Me(t)}return ve[e]},Se=TypeError,be=Te("toPrimitive"),Ce=function(e,t){if(!D(e)||X(e))return e;var r,n=ne(e,be);if(n){if(void 0===t&&(t="default"),r=S(n,e,t),!D(r)||X(r))return r;throw Se("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var r,n;if("string"===t&&I(r=e.toString)&&!D(n=S(r,e)))return n;if(I(r=e.valueOf)&&!D(n=S(r,e)))return n;if("string"!==t&&I(r=e.toString)&&!D(n=S(r,e)))return n;throw ie("Can't convert object to primitive value")}(e,t)},Ee=function(e){var t=Ce(e,"string");return X(t)?t:t+""},_e=s.document,ke=D(_e)&&D(_e.createElement),Re=function(e){return ke?_e.createElement(e):{}},we=!M&&!c((function(){return 7!=Object.defineProperty(Re("div"),"a",{get:function(){return 7}}).a})),Ae=Object.getOwnPropertyDescriptor,xe={f:M?Ae:function(e,t){if(e=V(e),t=Ee(t),we)try{return Ae(e,t)}catch(r){}if(pe(e,t))return _(!S(E.f,e,t),e[t])}},Ne=/#|\.prototype\./,Oe=function(e,t){var r=Le[Pe(e)];return r==Ue||r!=Ve&&(I(t)?c(t):!!t)},Pe=Oe.normalize=function(e){return String(e).replace(Ne,".").toLowerCase()},Le=Oe.data={},Ve=Oe.NATIVE="N",Ue=Oe.POLYFILL="P",De=Oe,qe=y(y.bind),Be=function(e,t){return re(e),void 0===t?e:u?qe(e,t):function(){return e.apply(t,arguments)}},Fe=M&&c((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ge=String,je=TypeError,He=function(e){if(D(e))return e;throw je(Ge(e)+" is not an object")},We=TypeError,Ye=Object.defineProperty,Ke=Object.getOwnPropertyDescriptor,Qe="enumerable",ze="configurable",Je="writable",$e={f:M?Fe?function(e,t,r){if(He(e),t=Ee(t),He(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Je in r&&!r.writable){var n=Ke(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:ze in r?r.configurable:n.configurable,enumerable:Qe in r?r.enumerable:n.enumerable,writable:!1})}return Ye(e,t,r)}:Ye:function(e,t,r){if(He(e),t=Ee(t),He(r),we)try{return Ye(e,t,r)}catch(n){}if("get"in r||"set"in r)throw We("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},Xe=M?function(e,t,r){return $e.f(e,t,_(1,r))}:function(e,t,r){return e[t]=r,e},Ze=xe.f,et=function(e){var t=function(r,n,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,i)}return m(e,this,arguments)};return t.prototype=e.prototype,t},rt=function(e,t){var r,n,i,o,a,c,u,d,l=e.target,p=e.global,m=e.stat,h=e.proto,f=p?s:m?s[l]:(s[l]||{}).prototype,g=p?q:q[l]||Xe(q,l,{})[l],v=g.prototype;for(i in t)r=!De(p?i:l+(m?".":"#")+i,e.forced)&&f&&pe(f,i),a=g[i],r&&(c=e.dontCallGetSet?(d=Ze(f,i))&&d.value:f[i]),o=r&&c?c:t[i],r&&typeof a==typeof o||(u=e.bind&&r?Be(o,s):e.wrap&&r?et(o):h&&I(o)?y(o):o,(e.sham||o&&o.sham||a&&a.sham)&&Xe(u,"sham",!0),Xe(g,i,u),h&&(pe(q,n=l+"Prototype")||Xe(q,n,{}),Xe(q[n],i,o),e.real&&v&&!v[i]&&Xe(v,i,o)))},nt=$e.f;rt({target:"Object",stat:!0,forced:Object.defineProperty!==nt,sham:!M},{defineProperty:nt});var it,ot=n((function(e){var t=q.Object,r=e.exports=function(e,r,n){return t.defineProperty(e,r,n)};t.defineProperty.sham&&(r.sham=!0)})),at=r(n((function(e){function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),ot(e,n.key,n)}}e.exports=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),ot(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}))),st=r(n((function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports}))),ct=Math.ceil,ut=Math.floor,dt=Math.trunc||function(e){var t=+e;return(t>0?ut:ct)(t)},lt=function(e){var t=+e;return t!=t||0===t?0:dt(t)},pt=Math.max,mt=Math.min,ht=function(e,t){var r=lt(e);return r<0?pt(r+t,0):mt(r,t)},ft=Math.min,gt=function(e){return e>0?ft(lt(e),9007199254740991):0},vt=function(e){return gt(e.length)},yt=function(e){return function(t,r,n){var i,o=V(t),a=vt(o),s=ht(n,a);if(e&&r!=r){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},It={includes:yt(!0),indexOf:yt(!1)},Mt={},Tt=It.indexOf,St=y([].push),bt=function(e,t){var r,n=V(e),i=0,o=[];for(r in n)!pe(Mt,r)&&pe(n,r)&&St(o,r);for(;t.length>i;)pe(n,r=t[i++])&&(~Tt(o,r)||St(o,r));return o},Ct=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Et=Object.keys||function(e){return bt(e,Ct)},_t={f:M&&!Fe?Object.defineProperties:function(e,t){He(e);for(var r,n=V(t),i=Et(t),o=i.length,a=0;o>a;)$e.f(e,r=i[a++],n[r]);return e}},kt=F("document","documentElement"),Rt=ce("keys"),wt=function(e){return Rt[e]||(Rt[e]=ge(e))},At=wt("IE_PROTO"),xt=function(){},Nt=function(e){return"<script>"+e+"<\/script>"},Ot=function(e){e.write(Nt("")),e.close();var t=e.parentWindow.Object;return e=null,t},Pt=function(){try{it=new ActiveXObject("htmlfile")}catch(n){}var e,t;Pt="undefined"!=typeof document?document.domain&&it?Ot(it):((t=Re("iframe")).style.display="none",kt.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Nt("document.F=Object")),e.close(),e.F):Ot(it);for(var r=Ct.length;r--;)delete Pt.prototype[Ct[r]];return Pt()};Mt[At]=!0;var Lt=Object.create||function(e,t){var r;return null!==e?(xt.prototype=He(e),r=new xt,xt.prototype=null,r[At]=e):r=Pt(),void 0===t?r:_t.f(r,t)};rt({target:"Object",stat:!0,sham:!M},{create:Lt});var Vt=q.Object,Ut=function(e,t){return Vt.create(e,t)},Dt=String,qt=TypeError,Bt=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=y(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(n){}return function(r,n){return He(r),function(e){if("object"==typeof e||I(e))return e;throw qt("Can't set "+Dt(e)+" as a prototype")}(n),t?e(r,n):r.__proto__=n,r}}():void 0);rt({target:"Object",stat:!0},{setPrototypeOf:Bt});var Ft=q.Object.setPrototypeOf,Gt=y([].slice),jt=Function,Ht=y([].concat),Wt=y([].join),Yt={},Kt=function(e,t,r){if(!pe(Yt,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";Yt[t]=jt("C,a","return new C("+Wt(n,",")+")")}return Yt[t](e,r)},Qt=u?jt.bind:function(e){var t=re(this),r=t.prototype,n=Gt(arguments,1),i=function(){var r=Ht(n,Gt(arguments));return this instanceof i?Kt(t,r.length,r):t.apply(e,r)};return D(r)&&(i.prototype=r),i};rt({target:"Function",proto:!0,forced:Function.bind!==Qt},{bind:Qt});var zt=function(e){return q[e+"Prototype"]},Jt=zt("Function").bind,$t=Function.prototype,Xt=function(e){var t=e.bind;return e===$t||G($t,e)&&t===$t.bind?Jt:t},Zt=n((function(e){function t(r,n){var i;return e.exports=t=Ft?Xt(i=Ft).call(i):function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),er=r(n((function(e){e.exports=function(e,t){e.prototype=Ut(t.prototype),e.prototype.constructor=e,Zt(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports})));rt({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var tr=9007199254740991,rr={f:Object.getOwnPropertySymbols},nr=Object.assign,ir=Object.defineProperty,or=y([].concat),ar=!nr||c((function(){if(M&&1!==nr({b:1},nr(ir({},"a",{enumerable:!0,get:function(){ir(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=nr({},e)[r]||Et(nr({},t)).join("")!=n}))?function(e,t){for(var r=de(e),n=arguments.length,i=1,o=rr.f,a=E.f;n>i;)for(var s,c=N(arguments[i++]),u=o?or(Et(c),o(c)):Et(c),d=u.length,l=0;d>l;)s=u[l++],M&&!S(a,c,s)||(r[s]=c[s]);return r}:nr;rt({target:"Object",stat:!0,arity:2,forced:Object.assign!==ar},{assign:ar});var sr=q.Object.assign,cr=c((function(){Et(1)}));rt({target:"Object",stat:!0,forced:cr},{keys:function(e){return Et(de(e))}});var ur,dr,lr,pr=q.Object.keys,mr={},hr=s.WeakMap,fr=I(hr)&&/native code/.test(String(hr)),gr="Object already initialized",vr=s.TypeError,yr=s.WeakMap;if(fr||se.state){var Ir=se.state||(se.state=new yr),Mr=y(Ir.get),Tr=y(Ir.has),Sr=y(Ir.set);ur=function(e,t){if(Tr(Ir,e))throw vr(gr);return t.facade=e,Sr(Ir,e,t),t},dr=function(e){return Mr(Ir,e)||{}},lr=function(e){return Tr(Ir,e)}}else{var br=wt("state");Mt[br]=!0,ur=function(e,t){if(pe(e,br))throw vr(gr);return t.facade=e,Xe(e,br,t),t},dr=function(e){return pe(e,br)?e[br]:{}},lr=function(e){return pe(e,br)}}var Cr,Er,_r,kr={set:ur,get:dr,has:lr,enforce:function(e){return lr(e)?dr(e):ur(e,{})},getterFor:function(e){return function(t){var r;if(!D(t)||(r=dr(t)).type!==e)throw vr("Incompatible receiver, "+e+" required");return r}}},Rr=Function.prototype,wr=M&&Object.getOwnPropertyDescriptor,Ar=pe(Rr,"name"),xr={EXISTS:Ar,PROPER:Ar&&"something"===function(){}.name,CONFIGURABLE:Ar&&(!M||M&&wr(Rr,"name").configurable)},Nr=!c((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Or=wt("IE_PROTO"),Pr=Object,Lr=Pr.prototype,Vr=Nr?Pr.getPrototypeOf:function(e){var t=de(e);if(pe(t,Or))return t[Or];var r=t.constructor;return I(r)&&t instanceof r?r.prototype:t instanceof Pr?Lr:null},Ur=function(e,t,r,n){return n&&n.enumerable?e[t]=r:Xe(e,t,r),e},Dr=Te("iterator"),qr=!1;[].keys&&("next"in(_r=[].keys())?(Er=Vr(Vr(_r)))!==Object.prototype&&(Cr=Er):qr=!0);var Br=!D(Cr)||c((function(){var e={};return Cr[Dr].call(e)!==e}));Cr=Br?{}:Lt(Cr),I(Cr[Dr])||Ur(Cr,Dr,(function(){return this}));var Fr={IteratorPrototype:Cr,BUGGY_SAFARI_ITERATORS:qr},Gr={};Gr[Te("toStringTag")]="z";var jr="[object z]"===String(Gr),Hr=Te("toStringTag"),Wr=Object,Yr="Arguments"==w(function(){return arguments}()),Kr=jr?w:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=Wr(e),Hr))?r:Yr?w(t):"Object"==(n=w(t))&&I(t.callee)?"Arguments":n},Qr=jr?{}.toString:function(){return"[object "+Kr(this)+"]"},zr=$e.f,Jr=Te("toStringTag"),$r=function(e,t,r,n){if(e){var i=r?e:e.prototype;pe(i,Jr)||zr(i,Jr,{configurable:!0,value:t}),n&&!jr&&Xe(i,"toString",Qr)}},Xr=Fr.IteratorPrototype,Zr=function(){return this},en=xr.PROPER,tn=Fr.BUGGY_SAFARI_ITERATORS,rn=Te("iterator"),nn="keys",on="values",an="entries",sn=function(){return this},cn=function(e,t,r,n,i,o,a){var s,c,u,d;c=n,d=t+" Iterator",(s=r).prototype=Lt(Xr,{next:_(+!u,c)}),$r(s,d,!1,!0),mr[d]=Zr;var l,p,m,h=function(e){if(e===i&&I)return I;if(!tn&&e in v)return v[e];switch(e){case nn:case on:case an:return function(){return new r(this,e)}}return function(){return new r(this)}},f=t+" Iterator",g=!1,v=e.prototype,y=v[rn]||v["@@iterator"]||i&&v[i],I=!tn&&y||h(i),M="Array"==t&&v.entries||y;if(M&&(l=Vr(M.call(new e)))!==Object.prototype&&l.next&&($r(l,f,!0,!0),mr[f]=sn),en&&i==on&&y&&y.name!==on&&(g=!0,I=function(){return S(y,this)}),i)if(p={values:h(on),keys:o?I:h(nn),entries:h(an)},a)for(m in p)(tn||g||!(m in v))&&Ur(v,m,p[m]);else rt({target:t,proto:!0,forced:tn||g},p);return a&&v[rn]!==I&&Ur(v,rn,I,{name:i}),mr[t]=I,p};$e.f;var un="Array Iterator",dn=kr.set,ln=kr.getterFor(un);cn(Array,"Array",(function(e,t){dn(this,{type:un,target:V(e),index:0,kind:t})}),(function(){var e=ln(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),mr.Arguments=mr.Array;var pn=Te("toStringTag");for(var mn in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var hn=s[mn],fn=hn&&hn.prototype;fn&&Kr(fn)!==pn&&Xe(fn,pn,mn),mr[mn]=mr.Array}var gn=Array.isArray||function(e){return"Array"==w(e)},vn=y(Function.toString);I(se.inspectSource)||(se.inspectSource=function(e){return vn(e)});var yn=se.inspectSource,In=function(){},Mn=[],Tn=F("Reflect","construct"),Sn=/^\s*(?:class|function)\b/,bn=y(Sn.exec),Cn=!Sn.exec(In),En=function(e){if(!I(e))return!1;try{return Tn(In,Mn,e),!0}catch(t){return!1}},_n=function(e){if(!I(e))return!1;switch(Kr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Cn||!!bn(Sn,yn(e))}catch(t){return!0}};_n.sham=!0;var kn=!Tn||c((function(){var e;return En(En.call)||!En(Object)||!En((function(){e=!0}))||e}))?_n:En,Rn=Te("species"),wn=Array,An=function(e,t){return new(gn(r=e)&&(n=r.constructor,(kn(n)&&(n===wn||gn(n.prototype))||D(n)&&null===(n=n[Rn]))&&(n=void 0)),void 0===n?wn:n)(0===t?0:t);var r,n},xn=y([].push),Nn=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,d,l){for(var p,m,h=de(c),f=N(h),g=Be(u,d),v=vt(f),y=0,I=l||An,M=t?I(c,v):r||a?I(c,0):void 0;v>y;y++)if((s||y in f)&&(m=g(p=f[y],y,h),e))if(t)M[y]=m;else if(m)switch(e){case 3:return!0;case 5:return p;case 6:return y;case 2:xn(M,p)}else switch(e){case 4:return!1;case 7:xn(M,p)}return o?-1:n||i?i:M}},On={forEach:Nn(0),map:Nn(1),filter:Nn(2),some:Nn(3),every:Nn(4),find:Nn(5),findIndex:Nn(6),filterReject:Nn(7)},Pn=function(e,t){var r=[][e];return!!r&&c((function(){r.call(null,t||function(){return 1},1)}))},Ln=On.forEach,Vn=Pn("forEach")?[].forEach:function(e){return Ln(this,e,arguments.length>1?arguments[1]:void 0)};rt({target:"Array",proto:!0,forced:[].forEach!=Vn},{forEach:Vn});var Un=zt("Array").forEach,Dn=Array.prototype,qn={DOMTokenList:!0,NodeList:!0},Bn=function(e){var t=e.forEach;return e===Dn||G(Dn,e)&&t===Dn.forEach||pe(qn,Kr(e))?Un:t},Fn=On.findIndex,Gn=!0;"findIndex"in[]&&Array(1).findIndex((function(){Gn=!1})),rt({target:"Array",proto:!0,forced:Gn},{findIndex:function(e){return Fn(this,e,arguments.length>1?arguments[1]:void 0)}});var jn=zt("Array").findIndex,Hn=Array.prototype,Wn=function(e){var t=e.findIndex;return e===Hn||G(Hn,e)&&t===Hn.findIndex?jn:t},Yn=TypeError,Kn=Object.getOwnPropertyDescriptor,Qn=M&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(pl){return pl instanceof TypeError}}()?function(e,t){if(gn(e)&&!Kn(e,"length").writable)throw Yn("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},zn=TypeError,Jn=function(e){if(e>9007199254740991)throw zn("Maximum allowed index exceeded");return e},$n=function(e,t,r){var n=Ee(t);n in e?$e.f(e,n,_(0,r)):e[n]=r},Xn=TypeError,Zn=function(e,t){if(!delete e[t])throw Xn("Cannot delete property "+ee(t)+" of "+ee(e))},ei=Te("species"),ti=function(e){return Q>=51||!c((function(){var t=[];return(t.constructor={})[ei]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},ri=ti("splice"),ni=Math.max,ii=Math.min;rt({target:"Array",proto:!0,forced:!ri},{splice:function(e,t){var r,n,i,o,a,s,c=de(this),u=vt(c),d=ht(e,u),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=u-d):(r=l-2,n=ii(ni(lt(t),0),u-d)),Jn(u+r-n),i=An(c,n),o=0;o<n;o++)(a=d+o)in c&&$n(i,o,c[a]);if(i.length=n,r<n){for(o=d;o<u-n;o++)s=o+r,(a=o+n)in c?c[s]=c[a]:Zn(c,s);for(o=u;o>u-n+r;o--)Zn(c,o-1)}else if(r>n)for(o=u-n;o>d;o--)s=o+r-1,(a=o+n-1)in c?c[s]=c[a]:Zn(c,s);for(o=0;o<r;o++)c[o+d]=arguments[o+2];return Qn(c,u-n+r),i}});var oi=zt("Array").splice,ai=Array.prototype,si=function(e){var t=e.splice;return e===ai||G(ai,e)&&t===ai.splice?oi:t},ci=F("JSON","stringify"),ui=y(/./.exec),di=y("".charAt),li=y("".charCodeAt),pi=y("".replace),mi=y(1..toString),hi=/[\uD800-\uDFFF]/g,fi=/^[\uD800-\uDBFF]$/,gi=/^[\uDC00-\uDFFF]$/,vi=!z||c((function(){var e=F("Symbol")();return"[null]"!=ci([e])||"{}"!=ci({a:e})||"{}"!=ci(Object(e))})),yi=c((function(){return'"\\udf06\\ud834"'!==ci("\udf06\ud834")||'"\\udead"'!==ci("\udead")})),Ii=function(e,t){var r=Gt(arguments),n=t;if((D(t)||void 0!==e)&&!X(e))return gn(t)||(t=function(e,t){if(I(n)&&(t=S(n,this,e,t)),!X(t))return t}),r[1]=t,m(ci,null,r)},Mi=function(e,t,r){var n=di(r,t-1),i=di(r,t+1);return ui(fi,e)&&!ui(gi,i)||ui(gi,e)&&!ui(fi,n)?"\\u"+mi(li(e,0),16):e};ci&&rt({target:"JSON",stat:!0,arity:3,forced:vi||yi},{stringify:function(e,t,r){var n=Gt(arguments),i=m(vi?Ii:ci,null,n);return yi&&"string"==typeof i?pi(i,hi,Mi):i}}),q.JSON||(q.JSON={stringify:JSON.stringify});var Ti=function(e,t,r){return m(q.JSON.stringify,null,arguments)};rt({target:"Array",stat:!0},{isArray:gn});var Si=q.Array.isArray,bi=Ct.concat("length","prototype"),Ci={f:Object.getOwnPropertyNames||function(e){return bt(e,bi)}},Ei=y([].concat),_i=F("Reflect","ownKeys")||function(e){var t=Ci.f(He(e)),r=rr.f;return r?Ei(t,r(e)):t},Ri=Error,wi=y("".replace),Ai=String(Ri("zxcasd").stack),xi=/\n\s*at [^:]*:[^\n]*/,Ni=xi.test(Ai),Oi=function(e,t){if(Ni&&"string"==typeof e&&!Ri.prepareStackTrace)for(;t--;)e=wi(e,xi,"");return e},Pi=function(e,t){D(t)&&"cause"in t&&Xe(e,"cause",t.cause)},Li=Te("iterator"),Vi=Array.prototype,Ui=function(e){return void 0!==e&&(mr.Array===e||Vi[Li]===e)},Di=Te("iterator"),qi=function(e){if(!O(e))return ne(e,Di)||ne(e,"@@iterator")||mr[Kr(e)]},Bi=TypeError,Fi=function(e,t){var r=arguments.length<2?qi(e):t;if(re(r))return He(S(r,e));throw Bi(ee(e)+" is not iterable")},Gi=function(e,t,r){var n,i;He(e);try{if(!(n=ne(e,"return"))){if("throw"===t)throw r;return r}n=S(n,e)}catch(o){i=!0,n=o}if("throw"===t)throw r;if(i)throw n;return He(n),r},ji=TypeError,Hi=function(e,t){this.stopped=e,this.result=t},Wi=Hi.prototype,Yi=function(e,t,r){var n,i,o,a,s,c,u,d=r&&r.that,l=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_RECORD),m=!(!r||!r.IS_ITERATOR),h=!(!r||!r.INTERRUPTED),f=Be(t,d),g=function(e){return n&&Gi(n,"normal",e),new Hi(!0,e)},v=function(e){return l?(He(e),h?f(e[0],e[1],g):f(e[0],e[1])):h?f(e,g):f(e)};if(p)n=e.iterator;else if(m)n=e;else{if(!(i=qi(e)))throw ji(ee(e)+" is not iterable");if(Ui(i)){for(o=0,a=vt(e);a>o;o++)if((s=v(e[o]))&&G(Wi,s))return s;return new Hi(!1)}n=Fi(e,i)}for(c=p?e.next:n.next;!(u=S(c,n)).done;){try{s=v(u.value)}catch(y){Gi(n,"throw",y)}if("object"==typeof s&&s&&G(Wi,s))return s}return new Hi(!1)},Ki=String,Qi=function(e){if("Symbol"===Kr(e))throw TypeError("Cannot convert a Symbol value to a string");return Ki(e)},zi=function(e,t){return void 0===e?arguments.length<2?"":t:Qi(e)},Ji=!c((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",_(1,7)),7!==e.stack)})),$i=Te("toStringTag"),Xi=Error,Zi=[].push,eo=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,i=G(to,this);Bt?r=Bt(Xi(),i?Vr(this):to):(r=i?this:Lt(to),Xe(r,$i,"Error")),void 0!==t&&Xe(r,"message",zi(t)),Ji&&Xe(r,"stack",Oi(r.stack,1)),Pi(r,n);var o=[];return Yi(e,Zi,{that:o}),Xe(r,"errors",o),r};Bt?Bt(eo,Xi):function(e,t,r){for(var n=_i(t),i=$e.f,o=xe.f,a=0;a<n.length;a++){var s=n[a];pe(e,s)||r&&pe(r,s)||i(e,s,o(t,s))}}(eo,Xi,{name:!0});var to=eo.prototype=Lt(Xi.prototype,{constructor:_(1,eo),message:_(1,""),name:_(1,"AggregateError")});rt({global:!0,constructor:!0,arity:2},{AggregateError:eo});var ro,no,io,oo,ao="process"==w(s.process),so=Te("species"),co=function(e){var t=F(e),r=$e.f;M&&t&&!t[so]&&r(t,so,{configurable:!0,get:function(){return this}})},uo=TypeError,lo=function(e,t){if(G(t,e))return e;throw uo("Incorrect invocation")},po=TypeError,mo=function(e){if(kn(e))return e;throw po(ee(e)+" is not a constructor")},ho=Te("species"),fo=function(e,t){var r,n=He(e).constructor;return void 0===n||O(r=He(n)[ho])?t:mo(r)},go=TypeError,vo=function(e,t){if(e<t)throw go("Not enough arguments");return e},yo=/(?:ipad|iphone|ipod).*applewebkit/i.test(j),Io=s.setImmediate,Mo=s.clearImmediate,To=s.process,So=s.Dispatch,bo=s.Function,Co=s.MessageChannel,Eo=s.String,_o=0,ko={},Ro="onreadystatechange";try{ro=s.location}catch(pl){}var wo=function(e){if(pe(ko,e)){var t=ko[e];delete ko[e],t()}},Ao=function(e){return function(){wo(e)}},xo=function(e){wo(e.data)},No=function(e){s.postMessage(Eo(e),ro.protocol+"//"+ro.host)};Io&&Mo||(Io=function(e){vo(arguments.length,1);var t=I(e)?e:bo(e),r=Gt(arguments,1);return ko[++_o]=function(){m(t,void 0,r)},no(_o),_o},Mo=function(e){delete ko[e]},ao?no=function(e){To.nextTick(Ao(e))}:So&&So.now?no=function(e){So.now(Ao(e))}:Co&&!yo?(oo=(io=new Co).port2,io.port1.onmessage=xo,no=Be(oo.postMessage,oo)):s.addEventListener&&I(s.postMessage)&&!s.importScripts&&ro&&"file:"!==ro.protocol&&!c(No)?(no=No,s.addEventListener("message",xo,!1)):no=Ro in Re("script")?function(e){kt.appendChild(Re("script")).onreadystatechange=function(){kt.removeChild(this),wo(e)}}:function(e){setTimeout(Ao(e),0)});var Oo,Po,Lo,Vo,Uo,Do,qo,Bo,Fo={set:Io,clear:Mo},Go=/ipad|iphone|ipod/i.test(j)&&void 0!==s.Pebble,jo=/web0s(?!.*chrome)/i.test(j),Ho=xe.f,Wo=Fo.set,Yo=s.MutationObserver||s.WebKitMutationObserver,Ko=s.document,Qo=s.process,zo=s.Promise,Jo=Ho(s,"queueMicrotask"),$o=Jo&&Jo.value;$o||(Oo=function(){var e,t;for(ao&&(e=Qo.domain)&&e.exit();Po;){t=Po.fn,Po=Po.next;try{t()}catch(r){throw Po?Vo():Lo=void 0,r}}Lo=void 0,e&&e.enter()},yo||ao||jo||!Yo||!Ko?!Go&&zo&&zo.resolve?((qo=zo.resolve(void 0)).constructor=zo,Bo=Be(qo.then,qo),Vo=function(){Bo(Oo)}):ao?Vo=function(){Qo.nextTick(Oo)}:(Wo=Be(Wo,s),Vo=function(){Wo(Oo)}):(Uo=!0,Do=Ko.createTextNode(""),new Yo(Oo).observe(Do,{characterData:!0}),Vo=function(){Do.data=Uo=!Uo}));var Xo=$o||function(e){var t={fn:e,next:void 0};Lo&&(Lo.next=t),Po||(Po=t,Vo()),Lo=t},Zo=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},ea=function(){this.head=null,this.tail=null};ea.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var ta,ra,na=ea,ia=s.Promise,oa="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,aa=!oa&&!ao&&"object"==typeof window&&"object"==typeof document,sa=ia&&ia.prototype,ca=Te("species"),ua=!1,da=I(s.PromiseRejectionEvent),la={CONSTRUCTOR:De("Promise",(function(){var e=yn(ia),t=e!==String(ia);if(!t&&66===Q)return!0;if(!sa.catch||!sa.finally)return!0;if(!Q||Q<51||!/native code/.test(e)){var r=new ia((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[ca]=n,!(ua=r.then((function(){}))instanceof n))return!0}return!t&&(aa||oa)&&!da})),REJECTION_EVENT:da,SUBCLASSING:ua},pa=TypeError,ma=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw pa("Bad Promise constructor");t=e,r=n})),this.resolve=re(t),this.reject=re(r)},ha={f:function(e){return new ma(e)}},fa=Fo.set,ga="Promise",va=la.CONSTRUCTOR,ya=la.REJECTION_EVENT,Ia=kr.getterFor(ga),Ma=kr.set,Ta=ia&&ia.prototype,Sa=ia,ba=Ta,Ca=s.TypeError,Ea=s.document,_a=s.process,ka=ha.f,Ra=ka,wa=!!(Ea&&Ea.createEvent&&s.dispatchEvent),Aa="unhandledrejection",xa=function(e){var t;return!(!D(e)||!I(t=e.then))&&t},Na=function(e,t){var r,n,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,d=e.domain;try{s?(a||(2===t.rejection&&Ua(t),t.rejection=1),!0===s?r=o:(d&&d.enter(),r=s(o),d&&(d.exit(),i=!0)),r===e.promise?u(Ca("Promise-chain cycle")):(n=xa(r))?S(n,r,c,u):c(r)):u(o)}catch(l){d&&!i&&d.exit(),u(l)}},Oa=function(e,t){e.notified||(e.notified=!0,Xo((function(){for(var r,n=e.reactions;r=n.get();)Na(r,e);e.notified=!1,t&&!e.rejection&&La(e)})))},Pa=function(e,t,r){var n,i;wa?((n=Ea.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),s.dispatchEvent(n)):n={promise:t,reason:r},!ya&&(i=s["on"+e])?i(n):e===Aa&&function(e,t){var r=s.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)},La=function(e){S(fa,s,(function(){var t,r=e.facade,n=e.value;if(Va(e)&&(t=Zo((function(){ao?_a.emit("unhandledRejection",n,r):Pa(Aa,r,n)})),e.rejection=ao||Va(e)?2:1,t.error))throw t.value}))},Va=function(e){return 1!==e.rejection&&!e.parent},Ua=function(e){S(fa,s,(function(){var t=e.facade;ao?_a.emit("rejectionHandled",t):Pa("rejectionhandled",t,e.value)}))},Da=function(e,t,r){return function(n){e(t,n,r)}},qa=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Oa(e,!0))},Ba=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw Ca("Promise can't be resolved itself");var n=xa(t);n?Xo((function(){var r={done:!1};try{S(n,t,Da(Ba,r,e),Da(qa,r,e))}catch(i){qa(r,i,e)}})):(e.value=t,e.state=1,Oa(e,!1))}catch(i){qa({done:!1},i,e)}}};va&&(ba=(Sa=function(e){lo(this,ba),re(e),S(ta,this);var t=Ia(this);try{e(Da(Ba,t),Da(qa,t))}catch(r){qa(t,r)}}).prototype,(ta=function(e){Ma(this,{type:ga,done:!1,notified:!1,parent:!1,reactions:new na,rejection:!1,state:0,value:void 0})}).prototype=Ur(ba,"then",(function(e,t){var r=Ia(this),n=ka(fo(this,Sa));return r.parent=!0,n.ok=!I(e)||e,n.fail=I(t)&&t,n.domain=ao?_a.domain:void 0,0==r.state?r.reactions.add(n):Xo((function(){Na(n,r)})),n.promise})),ra=function(){var e=new ta,t=Ia(e);this.promise=e,this.resolve=Da(Ba,t),this.reject=Da(qa,t)},ha.f=ka=function(e){return e===Sa||void 0===e?new ra(e):Ra(e)}),rt({global:!0,constructor:!0,wrap:!0,forced:va},{Promise:Sa}),$r(Sa,ga,!1,!0),co(ga);var Fa=Te("iterator"),Ga=!1;try{var ja=0,Ha={next:function(){return{done:!!ja++}},return:function(){Ga=!0}};Ha[Fa]=function(){return this},Array.from(Ha,(function(){throw 2}))}catch(pl){}var Wa=function(e,t){if(!t&&!Ga)return!1;var r=!1;try{var n={};n[Fa]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(i){}return r},Ya=la.CONSTRUCTOR||!Wa((function(e){ia.all(e).then(void 0,(function(){}))}));rt({target:"Promise",stat:!0,forced:Ya},{all:function(e){var t=this,r=ha.f(t),n=r.resolve,i=r.reject,o=Zo((function(){var r=re(t.resolve),o=[],a=0,s=1;Yi(e,(function(e){var c=a++,u=!1;s++,S(r,t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise}});var Ka=la.CONSTRUCTOR;ia&&ia.prototype,rt({target:"Promise",proto:!0,forced:Ka,real:!0},{catch:function(e){return this.then(void 0,e)}}),rt({target:"Promise",stat:!0,forced:Ya},{race:function(e){var t=this,r=ha.f(t),n=r.reject,i=Zo((function(){var i=re(t.resolve);Yi(e,(function(e){S(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}}),rt({target:"Promise",stat:!0,forced:la.CONSTRUCTOR},{reject:function(e){var t=ha.f(this);return S(t.reject,void 0,e),t.promise}});var Qa=function(e,t){if(He(e),D(t)&&t.constructor===e)return t;var r=ha.f(e);return(0,r.resolve)(t),r.promise},za=la.CONSTRUCTOR,Ja=F("Promise"),$a=!za;rt({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Qa($a&&this===Ja?ia:this,e)}}),rt({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=ha.f(t),n=r.resolve,i=r.reject,o=Zo((function(){var r=re(t.resolve),i=[],o=0,a=1;Yi(e,(function(e){var s=o++,c=!1;a++,S(r,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||n(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||n(i))}))})),--a||n(i)}));return o.error&&i(o.value),r.promise}});var Xa="No one promise resolved";rt({target:"Promise",stat:!0},{any:function(e){var t=this,r=F("AggregateError"),n=ha.f(t),i=n.resolve,o=n.reject,a=Zo((function(){var n=re(t.resolve),a=[],s=0,c=1,u=!1;Yi(e,(function(e){var d=s++,l=!1;c++,S(n,t,e).then((function(e){l||u||(u=!0,i(e))}),(function(e){l||u||(l=!0,a[d]=e,--c||o(new r(a,Xa)))}))})),--c||o(new r(a,Xa))}));return a.error&&o(a.value),n.promise}});var Za=ia&&ia.prototype,es=!!ia&&c((function(){Za.finally.call({then:function(){}},(function(){}))}));rt({target:"Promise",proto:!0,real:!0,forced:es},{finally:function(e){var t=fo(this,F("Promise")),r=I(e);return this.then(r?function(r){return Qa(t,e()).then((function(){return r}))}:e,r?function(r){return Qa(t,e()).then((function(){throw r}))}:e)}});var ts=y("".charAt),rs=y("".charCodeAt),ns=y("".slice),is=function(e){return function(t,r){var n,i,o=Qi(L(t)),a=lt(r),s=o.length;return a<0||a>=s?e?"":void 0:(n=rs(o,a))<55296||n>56319||a+1===s||(i=rs(o,a+1))<56320||i>57343?e?ts(o,a):n:e?ns(o,a,a+2):i-56320+(n-55296<<10)+65536}},os={codeAt:is(!1),charAt:is(!0)},as=os.charAt,ss="String Iterator",cs=kr.set,us=kr.getterFor(ss);cn(String,"String",(function(e){cs(this,{type:ss,string:Qi(e),index:0})}),(function(){var e,t=us(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=as(r,n),t.index+=e.length,{value:e,done:!1})}));var ds=q.Promise;rt({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=ha.f(this),r=Zo(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var ls=ds,ps=E.f,ms=y(ps),hs=y([].push),fs=function(e){return function(t){for(var r,n=V(t),i=Et(n),o=i.length,a=0,s=[];o>a;)r=i[a++],M&&!ms(n,r)||hs(s,e?[r,n[r]]:n[r]);return s}},gs={entries:fs(!0),values:fs(!1)},vs=gs.values;rt({target:"Object",stat:!0},{values:function(e){return vs(e)}});var ys=q.Object.values,Is=Date,Ms=y(Is.prototype.getTime);rt({target:"Date",stat:!0},{now:function(){return Ms(new Is)}});var Ts=q.Date.now,Ss=Te("isConcatSpreadable"),bs=Q>=51||!c((function(){var e=[];return e[Ss]=!1,e.concat()[0]!==e})),Cs=ti("concat"),Es=function(e){if(!D(e))return!1;var t=e[Ss];return void 0!==t?!!t:gn(e)};rt({target:"Array",proto:!0,arity:1,forced:!bs||!Cs},{concat:function(e){var t,r,n,i,o,a=de(this),s=An(a,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(Es(o=-1===t?a:arguments[t]))for(i=vt(o),Jn(c+i),r=0;r<i;r++,c++)r in o&&$n(s,c,o[r]);else Jn(c+1),$n(s,c++,o);return s.length=c,s}});var _s=zt("Array").concat,ks=Array.prototype,Rs=function(e){var t=e.concat;return e===ks||G(ks,e)&&t===ks.concat?_s:t},ws=/MSIE .\./.test(j),As=s.Function,xs=function(e){return ws?function(t,r){var n=vo(arguments.length,1)>2,i=I(t)?t:As(t),o=n?Gt(arguments,2):void 0;return e(n?function(){m(i,this,o)}:i,r)}:e},Ns={setTimeout:xs(s.setTimeout),setInterval:xs(s.setInterval)},Os=Ns.setInterval;rt({global:!0,bind:!0,forced:s.setInterval!==Os},{setInterval:Os});var Ps=Ns.setTimeout;rt({global:!0,bind:!0,forced:s.setTimeout!==Ps},{setTimeout:Ps});var Ls=q.setTimeout,Vs=n((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,u,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,i),!0;case 5:return d.fn.call(d.context,t,n,i,o),!0;case 6:return d.fn.call(d.context,t,n,i,o,a),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var p,m=d.length;for(u=0;u<m;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];d[u].fn.apply(d[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,u=[],d=s.length;c<d;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}));rt({global:!0},{globalThis:s});var Us=s,Ds=Array,qs=Math.max,Bs=function(e,t,r){for(var n=vt(e),i=ht(t,n),o=ht(void 0===r?n:r,n),a=Ds(qs(o-i,0)),s=0;i<o;i++,s++)$n(a,s,e[i]);return a.length=s,a},Fs=Ci.f,Gs="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],js={f:function(e){return Gs&&"Window"==w(e)?function(e){try{return Fs(e)}catch(t){return Bs(Gs)}}(e):Fs(V(e))}},Hs={f:Te},Ws=$e.f,Ys=function(e){var t=q.Symbol||(q.Symbol={});pe(t,e)||Ws(t,e,{value:Hs.f(e)})},Ks=function(){var e=F("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=Te("toPrimitive");t&&!t[n]&&Ur(t,n,(function(e){return S(r,this)}),{arity:1})},Qs=On.forEach,zs=wt("hidden"),Js="Symbol",$s=kr.set,Xs=kr.getterFor(Js),Zs=Object.prototype,ec=s.Symbol,tc=ec&&ec.prototype,rc=s.TypeError,nc=s.QObject,ic=xe.f,oc=$e.f,ac=js.f,sc=E.f,cc=y([].push),uc=ce("symbols"),dc=ce("op-symbols"),lc=ce("wks"),pc=!nc||!nc.prototype||!nc.prototype.findChild,mc=M&&c((function(){return 7!=Lt(oc({},"a",{get:function(){return oc(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=ic(Zs,t);n&&delete Zs[t],oc(e,t,r),n&&e!==Zs&&oc(Zs,t,n)}:oc,hc=function(e,t){var r=uc[e]=Lt(tc);return $s(r,{type:Js,tag:e,description:t}),M||(r.description=t),r},fc=function(e,t,r){e===Zs&&fc(dc,t,r),He(e);var n=Ee(t);return He(r),pe(uc,n)?(r.enumerable?(pe(e,zs)&&e[zs][n]&&(e[zs][n]=!1),r=Lt(r,{enumerable:_(0,!1)})):(pe(e,zs)||oc(e,zs,_(1,{})),e[zs][n]=!0),mc(e,n,r)):oc(e,n,r)},gc=function(e,t){He(e);var r=V(t),n=Et(r).concat(Mc(r));return Qs(n,(function(t){M&&!S(vc,r,t)||fc(e,t,r[t])})),e},vc=function(e){var t=Ee(e),r=S(sc,this,t);return!(this===Zs&&pe(uc,t)&&!pe(dc,t))&&(!(r||!pe(this,t)||!pe(uc,t)||pe(this,zs)&&this[zs][t])||r)},yc=function(e,t){var r=V(e),n=Ee(t);if(r!==Zs||!pe(uc,n)||pe(dc,n)){var i=ic(r,n);return!i||!pe(uc,n)||pe(r,zs)&&r[zs][n]||(i.enumerable=!0),i}},Ic=function(e){var t=ac(V(e)),r=[];return Qs(t,(function(e){pe(uc,e)||pe(Mt,e)||cc(r,e)})),r},Mc=function(e){var t=e===Zs,r=ac(t?dc:V(e)),n=[];return Qs(r,(function(e){!pe(uc,e)||t&&!pe(Zs,e)||cc(n,uc[e])})),n};z||(tc=(ec=function(){if(G(tc,this))throw rc("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Qi(arguments[0]):void 0,t=ge(e),r=function(e){this===Zs&&S(r,dc,e),pe(this,zs)&&pe(this[zs],t)&&(this[zs][t]=!1),mc(this,t,_(1,e))};return M&&pc&&mc(Zs,t,{configurable:!0,set:r}),hc(t,e)}).prototype,Ur(tc,"toString",(function(){return Xs(this).tag})),Ur(ec,"withoutSetter",(function(e){return hc(ge(e),e)})),E.f=vc,$e.f=fc,_t.f=gc,xe.f=yc,Ci.f=js.f=Ic,rr.f=Mc,Hs.f=function(e){return hc(Te(e),e)},M&&oc(tc,"description",{configurable:!0,get:function(){return Xs(this).description}})),rt({global:!0,constructor:!0,wrap:!0,forced:!z,sham:!z},{Symbol:ec}),Qs(Et(lc),(function(e){Ys(e)})),rt({target:Js,stat:!0,forced:!z},{useSetter:function(){pc=!0},useSimple:function(){pc=!1}}),rt({target:"Object",stat:!0,forced:!z,sham:!M},{create:function(e,t){return void 0===t?Lt(e):gc(Lt(e),t)},defineProperty:fc,defineProperties:gc,getOwnPropertyDescriptor:yc}),rt({target:"Object",stat:!0,forced:!z},{getOwnPropertyNames:Ic}),Ks(),$r(ec,Js),Mt[zs]=!0;var Tc=z&&!!Symbol.for&&!!Symbol.keyFor,Sc=ce("string-to-symbol-registry"),bc=ce("symbol-to-string-registry");rt({target:"Symbol",stat:!0,forced:!Tc},{for:function(e){var t=Qi(e);if(pe(Sc,t))return Sc[t];var r=F("Symbol")(t);return Sc[t]=r,bc[r]=t,r}});var Cc=ce("symbol-to-string-registry");rt({target:"Symbol",stat:!0,forced:!Tc},{keyFor:function(e){if(!X(e))throw TypeError(ee(e)+" is not a symbol");if(pe(Cc,e))return Cc[e]}});var Ec=!z||c((function(){rr.f(1)}));rt({target:"Object",stat:!0,forced:Ec},{getOwnPropertySymbols:function(e){var t=rr.f;return t?t(de(e)):[]}}),Ys("asyncIterator"),Ys("hasInstance"),Ys("isConcatSpreadable"),Ys("iterator"),Ys("match"),Ys("matchAll"),Ys("replace"),Ys("search"),Ys("species"),Ys("split"),Ys("toPrimitive"),Ks(),Ys("toStringTag"),$r(F("Symbol"),"Symbol"),Ys("unscopables"),$r(s.JSON,"JSON",!0);var _c=q.Symbol;Ys("asyncDispose"),Ys("dispose"),Ys("matcher"),Ys("metadataKey"),Ys("observable"),Ys("metadata"),Ys("patternMatch"),Ys("replaceAll");var kc=_c,Rc=c((function(){Vr(1)}));rt({target:"Object",stat:!0,forced:Rc,sham:!Nr},{getPrototypeOf:function(e){return Vr(de(e))}});var wc=q.Object.getPrototypeOf,Ac=y([].reverse),xc=[1,2];rt({target:"Array",proto:!0,forced:String(xc)===String(xc.reverse())},{reverse:function(){return gn(this)&&(this.length=this.length),Ac(this)}});var Nc=zt("Array").reverse,Oc=Array.prototype,Pc=function(e){var t=e.reverse;return e===Oc||G(Oc,e)&&t===Oc.reverse?Nc:t},Lc=ti("slice"),Vc=Te("species"),Uc=Array,Dc=Math.max;rt({target:"Array",proto:!0,forced:!Lc},{slice:function(e,t){var r,n,i,o=V(this),a=vt(o),s=ht(e,a),c=ht(void 0===t?a:t,a);if(gn(o)&&(r=o.constructor,(kn(r)&&(r===Uc||gn(r.prototype))||D(r)&&null===(r=r[Vc]))&&(r=void 0),r===Uc||void 0===r))return Gt(o,s,c);for(n=new(void 0===r?Uc:r)(Dc(c-s,0)),i=0;s<c;s++,i++)s in o&&$n(n,i,o[s]);return n.length=i,n}});var qc=zt("Array").slice,Bc=Array.prototype,Fc=function(e){var t=e.slice;return e===Bc||G(Bc,e)&&t===Bc.slice?qc:t},Gc=Hs.f("iterator"),jc=It.includes,Hc=c((function(){return!Array(1).includes()}));rt({target:"Array",proto:!0,forced:Hc},{includes:function(e){return jc(this,e,arguments.length>1?arguments[1]:void 0)}});var Wc=zt("Array").includes,Yc=Te("match"),Kc=TypeError,Qc=function(e){if(D(t=e)&&(void 0!==(r=t[Yc])?r:"RegExp"==w(t)))throw Kc("The method doesn't accept regular expressions");var t,r;return e},zc=Te("match"),Jc=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[zc]=!1,"/./"[e](t)}catch(n){}}return!1},$c=y("".indexOf);rt({target:"String",proto:!0,forced:!Jc("includes")},{includes:function(e){return!!~$c(Qi(L(this)),Qi(Qc(e)),arguments.length>1?arguments[1]:void 0)}});var Xc=zt("String").includes,Zc=Array.prototype,eu=String.prototype,tu=function(e){var t=e.includes;return e===Zc||G(Zc,e)&&t===Zc.includes?Wc:"string"==typeof e||e===eu||G(eu,e)&&t===eu.includes?Xc:t},ru=On.map,nu=ti("map");rt({target:"Array",proto:!0,forced:!nu},{map:function(e){return ru(this,e,arguments.length>1?arguments[1]:void 0)}});var iu=zt("Array").map,ou=Array.prototype,au=function(e){var t=e.map;return e===ou||G(ou,e)&&t===ou.map?iu:t},su=On.filter,cu=ti("filter");rt({target:"Array",proto:!0,forced:!cu},{filter:function(e){return su(this,e,arguments.length>1?arguments[1]:void 0)}});var uu=zt("Array").filter,du=Array.prototype,lu=function(e){var t=e.filter;return e===du||G(du,e)&&t===du.filter?uu:t},pu=n((function(e,t){e.exports=function(){function e(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
e=function(){return t};var t={},r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof kc?kc:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,r){return ot(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(_){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i,o,a,s,c=t&&t.prototype instanceof p?t:p,u=Ut(c.prototype),m=new b(n||[]);return u._invoke=(i=e,o=r,a=m,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return E()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){var n=M(r,a);if(n){if(n===l)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";var c=d(i,o,a);if("normal"===c.type){if(s=a.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(s="completed",a.method="throw",a.arg=c.arg)}}),u}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}t.wrap=u;var l={};function p(){}function m(){}function h(){}var f={};c(f,o,(function(){return this}));var g=wc&&wc(wc(C([])));g&&g!==r&&n.call(g,o)&&(f=g);var v=h.prototype=p.prototype=Ut(f);function y(e){var t;Bn(t=["next","throw","return"]).call(t,(function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function r(i,o,a,s){var c=d(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function M(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],Bn(e).call(e,T,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return m.prototype=h,c(v,"constructor",h),c(h,"constructor",m),m.displayName=c(h,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Ft?Ft(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Ut(v),e},t.awrap=function(e){return{__await:e}},y(I.prototype),c(I.prototype,a,(function(){return this})),t.AsyncIterator=I,t.async=function(e,r,n,i,o){void 0===o&&(o=ls);var a=new I(u(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),c(v,s,"Generator"),c(v,o,(function(){return this})),c(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var r in e)t.push(r);return Pc(t).call(t),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=C,b.prototype={constructor:b,reset:function(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,Bn(t=this.tryEntries).call(t,S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+Fc(r).call(r,1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function t(e){return(t="function"==typeof kc&&"symbol"==typeof Gc?function(e){return typeof e}:function(e){return e&&"function"==typeof kc&&e.constructor===kc&&e!==kc.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),ot(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),ot(e,"prototype",{writable:!1}),e}function o(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=ls))((function(r,o){function a(e){try{c(n.next(e))}catch(t){o(t)}}function s(e){try{c(n.throw(e))}catch(t){o(t)}}function c(e){e.done?r(e.value):i(e.value).then(a,s)}c((n=n.apply(e,t||[])).next())}))}var a={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:72e5},s=12,c=8e3,u=function(){};return function(){function n(e){r(this,n),this.isUploadEnable=!0,this.serverAllowUpload=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=a,this.configPath="dispatcher/req",this.dataReportPath="statics/report/common/form",this.traceMsgCache={},this.reqRetryCount=0,this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Ts(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(e),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return i(n,[{key:"setConfig",value:function(e){var t=sr({},this.reportConfig.common,e.common);this.reportConfig=sr({},this.reportConfig,e),this.reportConfig.common=t,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function(e,t){var r=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(e,sr({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},t)).catch((function(e){var t,n;null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.warn("Reporter immediately upload failed",e)}))}},{key:"report",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r.priority||(r.priority=this.getEventPriority(e,t)),this.reportConfig.isDataReportEnable&&e){if("login"===e&&!1===t.succeed&&t.process_id){var n=this.lastFailLogin[t.process_id]||0;if(t.start_time-n<a.loginFailIgnoreInterval)return;this.lastFailLogin[t.process_id]=t.start_time}var i=Ts();"HIGH"===r.priority?this.highPriorityMsgList.push({module:e,msg:t,createTime:i}):"NORMAL"===r.priority?this.msgList.push({module:e,msg:t,createTime:i}):"LOW"===r.priority&&this.lowPriorityMsgList.push({module:e,msg:t,createTime:i}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(e,t){if(this.reportConfig.isDataReportEnable&&e&&!this.traceMsgCache[e]){var r=sr(sr({start_time:Ts()},t),{extension:[]});this.traceMsgCache[e]=r}}},{key:"reportTraceUpdate",value:function(e){}},{key:"reportTraceUpdateV2",value:function(e,t,r){var n,i=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e]){var o=this.traceMsgCache[e].extension,a=o.length,s=(new Date).getTime();0===a?t.duration=s-this.traceMsgCache[e].start_time:o[a-1].end_time?t.duration=s-o[a-1].end_time:t.duration=s-this.traceMsgCache[e].start_time,o.push(sr({end_time:s},t));var c=o.length-1;(null==r?void 0:r.asyncParams)&&((n=this.traceMsgCache[e]).asyncPromiseArray||(n.asyncPromiseArray=[]),this.traceMsgCache[e].asyncPromiseArray.push(r.asyncParams.then((function(t){i.traceMsgCache[e]&&i.traceMsgCache[e].extension[c]&&sr(i.traceMsgCache[e].extension[c],t)}))))}}},{key:"reportTraceEnd",value:function(e){var t,r,n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e])if("nos"!==e||!1===i){"boolean"==typeof i?this.traceMsgCache[e].succeed=!!i:this.traceMsgCache[e].state=i,this.traceMsgCache[e].duration=Ts()-this.traceMsgCache[e].start_time,Bn(t=this.traceMsgCache[e].extension).call(t,(function(e){delete e.end_time}));var o=this.traceMsgCache[e];if(this.traceMsgCache[e]=null,o.asyncPromiseArray){(r=this.endedAsyncMsgByModule)[e]||(r[e]=[]),this.endedAsyncMsgByModule[e].push(o);var a=function(){var t;n.endedAsyncMsgByModule[e]&&tu(t=n.endedAsyncMsgByModule[e]).call(t,o)&&(delete o.asyncPromiseArray,n.report(e,o,{priority:n.getEventPriority(e,o)}))};ls.all(o.asyncPromiseArray).then(a).catch(a)}else this.report(e,o,{priority:this.getEventPriority(e,o)})}else this.traceMsgCache[e]=null}},{key:"getEventPriority",value:function(e,t){if("exceptions"===e){if(0===t.action)return"HIGH";if(2===t.action)return"HIGH";if(1===t.action&&0!==t.exception_service)return"HIGH"}else{if("msgReceive"===e)return"LOW";if("nim_api_trace"===e)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function(e){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[e]=[],this.traceMsgCache[e]=null)}},{key:"pause",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function(){var e,t=this;this.reportConfig.isDataReportEnable&&(Bn(e=pr(this.traceMsgCache)).call(e,(function(e){t.reportTraceEnd(e,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=u,this.report=u,this.reportTraceStart=u,this.reportTraceUpdate=u,this.reportTraceEnd=u,this.pause=u,this.restore=u,this.destroy=u,this.reqRetryCount=0,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function(){var r,n;return o(this,void 0,void 0,e().mark((function i(){var o,a,u,d,l,p=this;return e().wrap((function(i){for(var m;;)switch(i.prev=i.next){case 0:if(!this.loading){i.next=2;break}return i.abrupt("return");case 2:this.loading=!0,o=this.reportConfig.common||{},a=au(m=this.reportConfig.compassDataEndpoint.split(",")).call(m,(function(e){var t;return Rs(t="".concat(e,"/")).call(t,p.configPath)})),u=e().mark((function t(i){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.initConfigLoaded&&!p.isDestroyed){e.next=2;break}return e.abrupt("return","break");case 2:return e.prev=2,e.next=5,p.reportConfig.request(a[i],{method:"GET",dataType:"json",params:{deviceId:o.dev_id,sdkVer:o.sdk_ver,platform:o.platform,appkey:o.app_key},timeout:p.reportConfig.timeout}).then((function(e){var t,r;if(!p.isDestroyed){if(200===e.status&&e.data&&200===e.data.code){p.initConfigLoaded=!0;var n=e.data.data||{};p.reportConfig.maxSize=n.maxSize>1e3?1e3:n.maxSize,p.reportConfig.maxInterval=n.maxInterval>1e4?1e4:n.maxInterval,p.reportConfig.maxInterval=n.maxInterval<10?10:n.maxInterval,p.reportConfig.minInterval=n.minInterval<2?2:n.minInterval,p.reportConfig.maxDelay=n.maxDelay||300,p.reportConfig.maxInterval=1e3*p.reportConfig.maxInterval,p.reportConfig.minInterval=1e3*p.reportConfig.minInterval,p.reportConfig.maxDelay=1e3*p.reportConfig.maxDelay,n.endpoint?p.dataReportEndpoint=n.endpoint:p.dataReportEndpoint=a[i],p.serverAllowUpload=!0,p.loading=!1,p.reportHeartBeat()}else 200===e.status&&(p.initConfigLoaded=!0);null===(r=null===(t=p.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.log("Get reporter upload config success")}})).catch((function(e){var t,r;p.isDestroyed||(p.loading=!1,null===(r=null===(t=p.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.error("Get reporter upload config failed",e),p.reqRetryCount<s&&(p.reqRetryCount++,Ls((function(){p.isDestroyed||p.initUploadConfig()}),c)))}));case 5:e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(2),!p.isDestroyed){e.next=11;break}return e.abrupt("return",{v:void 0});case 11:p.loading=!1,null===(n=null===(r=p.reportConfig)||void 0===r?void 0:r.logger)||void 0===n||n.error("Exec reporter request failed",e.t0),p.reqRetryCount<s&&(p.reqRetryCount++,Ls((function(){p.isDestroyed||p.initUploadConfig()}),c));case 14:case"end":return e.stop()}}),t,null,[[2,7]])})),d=0;case 7:if(!(d<a.length)){i.next=17;break}return i.delegateYield(u(d),"t0",9);case 9:if("break"!==(l=i.t0)){i.next=12;break}return i.abrupt("break",17);case 12:if("object"!==t(l)){i.next=14;break}return i.abrupt("return",l.v);case 14:d++,i.next=7;break;case 17:case"end":return i.stop()}}),i,this)})))}},{key:"reportHeartBeat",value:function(){var e=this;this.isDestroyed||(this.timer=Ls((function(){e.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function(){if(!this.isDestroyed){var e=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Ts()-this.lastReportTime>=e&&this.upload()}}},{key:"getUploadMsg",value:function(){var e,t,r,n,i,o,a=this,s={},c=Ts();this.highPriorityMsgList=lu(e=this.highPriorityMsgList).call(e,(function(e){return c-e.createTime<a.reportConfig.maxDelay})),this.msgList=lu(t=this.msgList).call(t,(function(e){return c-e.createTime<a.reportConfig.maxDelay})),this.lowPriorityMsgList=lu(r=this.lowPriorityMsgList).call(r,(function(e){return c-e.createTime<a.reportConfig.maxDelay})),this.cacheMsgList=lu(n=this.cacheMsgList).call(n,(function(e){return c-e.createTime<a.reportConfig.maxDelay}));var u=Fc(i=this.highPriorityMsgList).call(i,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=Fc(o=this.highPriorityMsgList).call(o,u.length),u.length<this.reportConfig.maxSize){var d,l,p=this.reportConfig.maxSize-u.length;u=Rs(u).call(u,Fc(d=this.msgList).call(d,0,p)),this.msgList=Fc(l=this.msgList).call(l,p)}if(u.length<this.reportConfig.maxSize){var m,h,f=this.reportConfig.maxSize-u.length;u=Rs(u).call(u,Fc(m=this.lowPriorityMsgList).call(m,0,f)),this.lowPriorityMsgList=Fc(h=this.lowPriorityMsgList).call(h,f)}if(u.length<this.reportConfig.maxSize){var g,v,y=this.reportConfig.maxSize-u.length;u=Rs(u).call(u,Fc(g=this.cacheMsgList).call(g,0,y)),this.cacheMsgList=Fc(v=this.cacheMsgList).call(v,y)}return Bn(u).call(u,(function(e){s[e.module]?s[e.module].push(e.msg):s[e.module]=[e.msg]})),{uploadMsgArr:u,uploadMsg:s}}},{key:"upload",value:function(){var e,t,r=this;if(this.isUploadEnable&&this.serverAllowUpload&&!(this.lastReportTime&&Ts()-this.lastReportTime<this.reportConfig.minInterval)){var n=this.getUploadMsg(),i=n.uploadMsgArr,o=n.uploadMsg;if(i.length){this.lastReportTime=Ts();try{var a,s=Rs(a="".concat(this.dataReportEndpoint,"/")).call(a,this.dataReportPath);this.reportConfig.request(s,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:o},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(e){var t,n,o,a;r.cacheMsgList=Fc(t=Rs(n=r.cacheMsgList).call(n,i)).call(t,0,r.reportConfig.cacheMaxSize),null===(a=null===(o=r.reportConfig)||void 0===o?void 0:o.logger)||void 0===a||a.warn("Reporter upload failed",e)}))}catch(c){null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.warn("Exec reporter request failed",c)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),n}()}()})),mu=zt("Array").values,hu=Array.prototype,fu={DOMTokenList:!0,NodeList:!0},gu=function(e){var t=e.values;return e===hu||G(hu,e)&&t===hu.values||pe(fu,Kr(e))?mu:t},vu=It.indexOf,yu=y([].indexOf),Iu=!!yu&&1/yu([1],1,-0)<0,Mu=Pn("indexOf");rt({target:"Array",proto:!0,forced:Iu||!Mu},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Iu?yu(this,e,t)||0:vu(this,e,t)}});var Tu=zt("Array").indexOf,Su=Array.prototype,bu=function(e){var t=e.indexOf;return e===Su||G(Su,e)&&t===Su.indexOf?Tu:t},Cu=On.every,Eu=Pn("every");rt({target:"Array",proto:!0,forced:!Eu},{every:function(e){return Cu(this,e,arguments.length>1?arguments[1]:void 0)}});var _u=zt("Array").every,ku=Array.prototype,Ru=function(e){var t=e.every;return e===ku||G(ku,e)&&t===ku.every?_u:t},wu=c((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),Au=Object.isExtensible,xu=c((function(){Au(1)}))||wu?function(e){return!!D(e)&&(!wu||"ArrayBuffer"!=w(e))&&(!Au||Au(e))}:Au,Nu=!c((function(){return Object.isExtensible(Object.preventExtensions({}))})),Ou=n((function(e){var t=$e.f,r=!1,n=ge("meta"),i=0,o=function(e){t(e,n,{value:{objectID:"O"+i++,weakData:{}}})},a=e.exports={enable:function(){a.enable=function(){},r=!0;var e=Ci.f,t=y([].splice),i={};i[n]=1,e(i).length&&(Ci.f=function(r){for(var i=e(r),o=0,a=i.length;o<a;o++)if(i[o]===n){t(i,o,1);break}return i},rt({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:js.f}))},fastKey:function(e,t){if(!D(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!pe(e,n)){if(!xu(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!pe(e,n)){if(!xu(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return Nu&&r&&xu(e)&&!pe(e,n)&&o(e),e}};Mt[n]=!0})),Pu=$e.f,Lu=On.forEach,Vu=kr.set,Uu=kr.getterFor,Du=function(e,t,r){var n,i=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=i?"set":"add",u=s[e],d=u&&u.prototype,l={};if(M&&I(u)&&(o||d.forEach&&!c((function(){(new u).entries().next()})))){var p=(n=t((function(t,r){Vu(lo(t,p),{type:e,collection:new u}),null!=r&&Yi(r,t[a],{that:t,AS_ENTRIES:i})}))).prototype,m=Uu(e);Lu(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in d)||o&&"clear"==e||Xe(p,e,(function(r,n){var i=m(this).collection;if(!t&&o&&!D(r))return"get"==e&&void 0;var a=i[e](0===r?0:r,n);return t?this:a}))})),o||Pu(p,"size",{configurable:!0,get:function(){return m(this).collection.size}})}else n=r.getConstructor(t,e,i,a),Ou.enable();return $r(n,e,!1,!0),l[e]=n,rt({global:!0,forced:!0},l),o||r.setStrong(n,e,i),n},qu=function(e,t,r){for(var n in t)r&&r.unsafe&&e[n]?e[n]=t[n]:Ur(e,n,t[n],r);return e},Bu=$e.f,Fu=Ou.fastKey,Gu=kr.set,ju=kr.getterFor,Hu={getConstructor:function(e,t,r,n){var i=e((function(e,i){lo(e,o),Gu(e,{type:t,index:Lt(null),first:void 0,last:void 0,size:0}),M||(e.size=0),O(i)||Yi(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,a=ju(t),s=function(e,t,r){var n,i,o=a(e),s=c(e,t);return s?s.value=r:(o.last=s={index:i=Fu(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=s),n&&(n.next=s),M?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},c=function(e,t){var r,n=a(e),i=Fu(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return qu(o,{clear:function(){for(var e=a(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,M?e.size=0:this.size=0},delete:function(e){var t=this,r=a(t),n=c(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),M?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=a(this),n=Be(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),qu(o,r?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),M&&Bu(o,"size",{get:function(){return a(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=ju(t),o=ju(n);cn(e,t,(function(e,t){Gu(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),co(t)}};Du("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Hu);var Wu=q.Map,Yu=[].push,Ku=function(e){var t,r,n,i,o=arguments.length,a=o>1?arguments[1]:void 0;return mo(this),(t=void 0!==a)&&re(a),O(e)?new this:(r=[],t?(n=0,i=Be(a,o>2?arguments[2]:void 0),Yi(e,(function(e){S(Yu,r,i(e,n++))}))):Yi(e,Yu,{that:r}),new this(r))};rt({target:"Map",stat:!0,forced:!0},{from:Ku});var Qu=function(){return new this(Gt(arguments))};rt({target:"Map",stat:!0,forced:!0},{of:Qu});var zu=function(){for(var e,t=He(this),r=re(t.delete),n=!0,i=0,o=arguments.length;i<o;i++)e=S(r,t,arguments[i]),n=n&&e;return!!n};rt({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:zu}),rt({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var r,n,i=He(this),o=re(i.get),a=re(i.has),s=re(i.set);return S(a,i,e)?(r=S(o,i,e),"update"in t&&(r=t.update(r,e,i),S(s,i,e,r)),r):(n=t.insert(e,i),S(s,i,e,n),n)}});var Ju=Fi;rt({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=He(this),r=Ju(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return!Yi(r,(function(e,r,i){if(!n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),rt({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=He(this),r=Ju(t),n=Be(e,arguments.length>1?arguments[1]:void 0),i=new(fo(t,F("Map"))),o=re(i.set);return Yi(r,(function(e,r){n(r,e,t)&&S(o,i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),rt({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=He(this),r=Ju(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return Yi(r,(function(e,r,i){if(n(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),rt({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=He(this),r=Ju(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return Yi(r,(function(e,r,i){if(n(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var $u=y([].push);rt({target:"Map",stat:!0,forced:!0},{groupBy:function(e,t){re(t);var r=Fi(e),n=new this,i=re(n.has),o=re(n.get),a=re(n.set);return Yi(r,(function(e){var r=t(e);S(i,n,r)?$u(S(o,n,r),e):S(a,n,r,[e])}),{IS_ITERATOR:!0}),n}}),rt({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return Yi(Ju(He(this)),(function(t,r,n){if((i=r)===(o=e)||i!=i&&o!=o)return n();var i,o}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),rt({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var r=new this;re(t);var n=re(r.set);return Yi(e,(function(e){S(n,r,t(e),e)})),r}}),rt({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){return Yi(Ju(He(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),rt({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=He(this),r=Ju(t),n=Be(e,arguments.length>1?arguments[1]:void 0),i=new(fo(t,F("Map"))),o=re(i.set);return Yi(r,(function(e,r){S(o,i,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),rt({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=He(this),r=Ju(t),n=Be(e,arguments.length>1?arguments[1]:void 0),i=new(fo(t,F("Map"))),o=re(i.set);return Yi(r,(function(e,r){S(o,i,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),rt({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=He(this),r=re(t.set),n=arguments.length,i=0;i<n;)Yi(arguments[i++],r,{that:t,AS_ENTRIES:!0});return t}});var Xu=TypeError;rt({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=He(this),r=Ju(t),n=arguments.length<2,i=n?void 0:arguments[1];if(re(e),Yi(r,(function(r,o){n?(n=!1,i=o):i=e(i,o,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw Xu("Reduce of empty map with no initial value");return i}}),rt({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=He(this),r=Ju(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return Yi(r,(function(e,r,i){if(n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Zu=TypeError;rt({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=He(this),n=re(r.get),i=re(r.has),o=re(r.set),a=arguments.length;re(t);var s=S(i,r,e);if(!s&&a<3)throw Zu("Updating absent value");var c=s?S(n,r,e):re(a>2?arguments[2]:void 0)(e,r);return S(o,r,e,t(c,e,r)),r}});var ed=TypeError,td=function(e,t){var r,n=He(this),i=re(n.get),o=re(n.has),a=re(n.set),s=arguments.length>2?arguments[2]:void 0;if(!I(t)&&!I(s))throw ed("At least one callback required");return S(o,n,e)?(r=S(i,n,e),I(t)&&(r=t(r),S(a,n,e,r))):I(s)&&(r=s(),S(a,n,e,r)),r};rt({target:"Map",proto:!0,real:!0,forced:!0},{upsert:td}),rt({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:td});var rd=Wu,nd=n((function(e){function t(r){var n;return e.exports=t=Ft?Xt(n=wc).call(n):function(e){return e.__proto__||wc(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),id=n((function(e){e.exports=function(e){var t;return-1!==bu(t=Function.toString.call(e)).call(t,"[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports})),od=F("Reflect","construct"),ad=Object.prototype,sd=[].push,cd=c((function(){function e(){}return!(od((function(){}),[],e)instanceof e)})),ud=!c((function(){od((function(){}))})),dd=cd||ud;rt({target:"Reflect",stat:!0,forced:dd,sham:dd},{construct:function(e,t){mo(e),He(t);var r=arguments.length<3?e:mo(arguments[2]);if(ud&&!cd)return od(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return m(sd,n,t),new(m(Qt,e,n))}var i=r.prototype,o=Lt(D(i)?i:ad),a=m(e,o,t);return D(a)?a:o}});var ld=q.Reflect.construct,pd=n((function(e){e.exports=function(){if("undefined"==typeof Reflect||!ld)return!1;if(ld.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ld(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports})),md=n((function(e){function t(r,n,i){var o;return pd()?(e.exports=t=Xt(o=ld).call(o),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=t=function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Xt(Function).apply(e,n));return r&&Zt(i,r.prototype),i},e.exports.__esModule=!0,e.exports.default=e.exports),t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),hd=r(n((function(e){function t(r){var n="function"==typeof rd?new rd:void 0;return e.exports=t=function(e){if(null===e||!id(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return md(e,arguments,nd(this).constructor)}return t.prototype=Ut(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Zt(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}))),fd=TypeError,gd=function(e){return function(t,r,n,i){re(r);var o=de(t),a=N(o),s=vt(o),c=e?s-1:0,u=e?-1:1;if(n<2)for(;;){if(c in a){i=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw fd("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(i=r(i,a[c],c,o));return i}},vd=[gd(!1),gd(!0)][0],yd=Pn("reduce");rt({target:"Array",proto:!0,forced:!yd||!ao&&Q>79&&Q<83},{reduce:function(e){var t=arguments.length;return vd(this,e,t,t>1?arguments[1]:void 0)}});var Id,Md,Td,Sd,bd,Cd,Ed,_d,kd,Rd,wd,Ad,xd,Nd,Od,Pd,Ld,Vd,Ud,Dd,qd,Bd,Fd,Gd,jd,Hd,Wd,Yd,Kd,Qd,zd,Jd,$d,Xd,Zd,el,tl,rl,nl,il,ol,al,sl,cl,ul,dl,ll,pl,ml=zt("Array").reduce,hl=Array.prototype,fl=function(e){var t=e.reduce;return e===hl||G(hl,e)&&t===hl.reduce?ml:t};(pl=Id||(Id={}))[pl.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",pl[pl.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC",function(e){e[e.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",e[e.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",e[e.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(Md||(Md={})),function(e){e[e.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",e[e.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",e[e.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(Td||(Td={})),function(e){e[e.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",e[e.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",e[e.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",e[e.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(Sd||(Sd={})),function(e){e[e.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",e[e.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",e[e.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(bd||(bd={})),function(e){e[e.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",e[e.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(Cd||(Cd={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(Ed||(Ed={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(_d||(_d={})),function(e){e[e.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",e[e.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(kd||(kd={})),function(e){e[e.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",e[e.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",e[e.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",e[e.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(Rd||(Rd={})),function(e){e[e.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",e[e.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",e[e.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(wd||(wd={})),function(e){e[e.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",e[e.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",e[e.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",e[e.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(Ad||(Ad={})),function(e){e[e.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",e[e.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",e[e.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",e[e.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",e[e.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",e[e.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",e[e.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",e[e.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",e[e.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(xd||(xd={})),function(e){e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",e[e.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(Nd||(Nd={})),function(e){e[e.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(Od||(Od={})),function(e){e[e.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",e[e.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(Pd||(Pd={})),function(e){e[e.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",e[e.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",e[e.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(Ld||(Ld={})),function(e){e[e.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",e[e.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",e[e.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",e[e.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",e[e.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",e[e.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",e[e.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",e[e.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",e[e.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",e[e.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",e[e.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",e[e.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",e[e.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(Vd||(Vd={})),function(e){e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(Ud||(Ud={})),function(e){e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(Dd||(Dd={})),function(e){e[e.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",e[e.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",e[e.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(qd||(qd={})),function(e){e[e.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",e[e.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(Bd||(Bd={})),function(e){e[e.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(Fd||(Fd={})),function(e){e[e.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(Gd||(Gd={})),function(e){e[e.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",e[e.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(jd||(jd={})),function(e){e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(Hd||(Hd={})),function(e){e[e.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",e[e.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(Wd||(Wd={})),function(e){e[e.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",e[e.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",e[e.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",e[e.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",e[e.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",e[e.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",e[e.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",e[e.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(Yd||(Yd={})),function(e){e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(Kd||(Kd={})),function(e){e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(Qd||(Qd={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(zd||(zd={})),function(e){e[e.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",e[e.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",e[e.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(Jd||(Jd={})),function(e){e[e.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",e[e.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",e[e.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}($d||($d={})),function(e){e[e.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",e[e.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(Xd||(Xd={})),function(e){e[e.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",e[e.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(Zd||(Zd={})),function(e){e[e.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(el||(el={})),function(e){e[e.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=2]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(tl||(tl={})),function(e){e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(rl||(rl={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",e[e.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(nl||(nl={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(il||(il={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(ol||(ol={})),function(e){e[e.teamApply=0]="teamApply",e[e.teamApplyReject=1]="teamApplyReject",e[e.teamInvite=2]="teamInvite",e[e.teamInviteReject=3]="teamInviteReject",e[e.tlistUpdate=4]="tlistUpdate",e[e.superTeamApply=15]="superTeamApply",e[e.superTeamApplyReject=16]="superTeamApplyReject",e[e.superTeamInvite=17]="superTeamInvite",e[e.superTeamInviteReject=18]="superTeamInviteReject"}(al||(al={})),function(e){e[e.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",e[e.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",e[e.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",e[e.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(sl||(sl={})),function(e){e.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",e.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",e.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(cl||(cl={})),function(e){e[e.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL"}(ul||(ul={})),function(e){e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(dl||(dl={})),function(e){e[e.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",e[e.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",e[e.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",e[e.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(ll||(ll={}));var gl={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failed，use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"}},vl=pr(gl),yl=fl(vl).call(vl,(function(e,t){var r=gl[t];return e[t]=r.code,e}),{}),Il=fl(vl).call(vl,(function(e,t){var r=gl[t];return e[r.code]=r.message,e}),{}),Ml=Object.freeze({__proto__:null,V2NIMErrorCode:yl,V2NIMErrorDesc:Il,get V2NIMDataSyncLevel(){return Id},get V2NIMDataSyncType(){return Md},get V2NIMDataSyncState(){return Td},get V2NIMConversationType(){return Sd},get V2NIMLastMessageState(){return bd},get V2NIMFriendAddMode(){return Cd},get V2NIMFriendAddApplicationType(){return Ed},get V2NIMFriendAddApplicationStatus(){return _d},get V2NIMFriendDeletionType(){return kd},get V2NIMFriendVerifyType(){return Rd},get V2NIMLoginAuthType(){return wd},get V2NIMLoginStatus(){return Ad},get V2NIMLoginClientType(){return xd},get V2NIMKickedOfflineReason(){return Nd},get V2NIMLoginClientChange(){return Od},get V2NIMConnectStatus(){return Pd},get V2NIMMessageType(){return Vd},get V2NIMMessageNotificationType(){return Ud},get V2NIMMessageAttachmentUploadState(){return Dd},get V2NIMMessageSendingState(){return qd},get V2NIMQueryDirection(){return Bd},get V2NIMMessageRevokeType(){return Fd},get V2NIMMessagePinState(){return Gd},get V2NIMMessageQuickCommentType(){return jd},get V2NIMClientAntispamOperateType(){return Hd},get V2NIMSortOrder(){return Wd},get V2NIMSystemMessageType(){return Yd},get V2NIMTeamMessageMuteMode(){return Kd},get V2NIMP2PMessageMuteMode(){return Qd},get V2NIMTeamMemberRoleQueryType(){return zd},get V2NIMTeamType(){return Jd},get V2NIMTeamJoinMode(){return $d},get V2NIMTeamAgreeMode(){return Xd},get V2NIMTeamInviteMode(){return Zd},get V2NIMTeamUpdateInfoMode(){return el},get V2NIMTeamChatBannedMode(){return tl},get V2NIMTeamUpdateExtensionMode(){return rl},get V2NIMTeamJoinActionType(){return il},get V2NIMTeamJoinActionStatus(){return ol},get V2NIMTeamNotificationType(){return al},get V2NIMTeamMemberRole(){return nl},get V2NIMAIModelRoleType(){return cl},get V2NIMAIModelType(){return sl},get V2NIMSignallingChannelType(){return dl},get V2NIMSignallingEventType(){return ul},get V2NIMUserStatusType(){return ll}}),Tl=function(e){function t(t){var r;return(r=e.call(this,t.desc)||this).name="V2NIMError",r.code=t.code||0,r.desc=t.desc||Il[r.code]||kl[r.code]||"",r.message=r.desc,r.detail=t.detail||{},r}return er(t,e),t.prototype.toString=function(){var e,t=this.name+"\n code: "+this.code+'\n message: "'+this.message+'"\n detail: '+(this.detail?Ti(this.detail):"");return(null===(e=null==this?void 0:this.detail)||void 0===e?void 0:e.rawError)&&(t+="\n rawError: "+this.detail.rawError.message),t},t}(hd(Error)),Sl=function(e){function t(t,r,n){var i;return void 0===r&&(r={}),(i=e.call(this,{code:yl.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:t,rules:n,data:r}})||this).name="validateError",i.message=i.message+"\n"+Ti(i.detail,null,2),i.data=r,i.rules=n,i}return er(t,e),t}(Tl),bl=function(e){function t(t){var r,n,i,o;return(r=e.call(this,{code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(n=t.detail)||void 0===n?void 0:n.reason,rules:null===(i=t.detail)||void 0===i?void 0:i.rules,data:null===(o=t.detail)||void 0===o?void 0:o.data}})||this).name="ValidateErrorV2",r}return er(t,e),t}(Tl),Cl=function(e){function t(t,r,n){var i;return(i=e.call(this,{code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:t,key:r,rules:n}})||this).name="formatError",i}return er(t,e),t}(Tl),El=function(e){function t(t){var r;return(r=e.call(this,sr({code:400},t))||this).desc=r.desc||"upload file error",r.message=r.desc,r.name="uploadError",r}return er(t,e),t}(Tl),_l=function(e){function t(t,r,n){var i;return void 0===r&&(r={}),void 0===n&&(n=400),(i=e.call(this,{code:n,desc:t,detail:r})||this).name="customError",i.data=r,i}return er(t,e),t}(Tl),kl={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};function Rl(e,t){return t=t||[],lu(e=e||[]).call(e,(function(e){return-1===bu(t).call(t,e)}))}function wl(e,t){return t instanceof RegExp?"__REGEXP "+t.toString():t}function Al(e,t,r,n){var i;void 0===t&&(t={}),void 0===n&&(n=!1);var o={};return Bn(i=pr(e)).call(i,(function(i){var a=e[i].type,s=r?"In "+r+", ":"";if(null==t){var c=s+"param is null or undefined";throw n?new bl({detail:{reason:c,data:{key:i},rules:"required"}}):new Sl(c,{key:i},"required")}if(void 0===t[i]){if(!1===e[i].required)return void(o[i]=t[i]);var u=s+"param '"+i+"' is required";throw n?new bl({detail:{reason:u,data:{key:i},rules:"required"}}):new Sl(u,{key:i},"required")}var d=xl[a];if(d&&!d(t,i,e[i],n)){var l=s+"param '"+i+"' unexpected",p={key:i,value:t[i]};throw n?new bl({detail:{reason:l,data:p,rules:Ti(e[i],wl)}}):new Sl(l,p,Ti(e[i],wl))}o[i]=t[i]})),o}var xl={string:function(e,t,r){var n,i=r.allowEmpty,o=r.max,a=r.min,s=r.regExp,c=e[t];return!("string"!=typeof c||!1===i&&""===c||"number"==typeof o&&c.length>o||"number"==typeof a&&c.length<a||(n=s,"[object RegExp]"===Object.prototype.toString.call(n)&&!s.test(c)))},number:function(e,t,r){var n=r.min,i=r.max,o=e[t];return!("number"!=typeof o||"number"==typeof n&&o<n||"number"==typeof i&&o>i)},boolean:function(e,t){return"boolean"==typeof e[t]},file:function(e,t){return!0},enum:function(e,t,r){var n=gu(r),i=e[t];return!n||bu(n).call(n,i)>-1},jsonstr:function(e,t){try{var r=JSON.parse(e[t]);return"object"==typeof r&&null!==r}catch(n){return!1}},func:function(e,t){return"function"==typeof e[t]},array:function(e,t,r,n){void 0===n&&(n=!1);var i=r.itemType,o=r.rules,a=r.min,s=r.max,c=gu(r),u=e[t];return!(!Si(u)||"number"==typeof s&&u.length>s||"number"==typeof a&&u.length<a||i&&"enum"!==i&&!Ru(u).call(u,(function(e){return typeof e===i}))||"enum"===i&&c&&Rl(u,c).length||(o&&Bn(u).call(u,(function(e,r){return Al(o,e,t+"["+r+"]",n)})),0))},object:function(e,t,r,n){void 0===n&&(n=!1);var i=r.rules,o=r.allowEmpty,a=e[t];if("object"!=typeof a||null===a)return!1;if(i){var s=pr(i),c=pr(a),u=lu(c).call(c,(function(e){return bu(s).call(s,e)>-1}));if(!1===o&&0===u.length)return!1;Al(i,a,t,n)}return!0}};function Nl(e,t){if(!e)throw new Tl({code:yl.V2NIM_ERROR_CODE_ILLEGAL_STATE});Al({conversationId:{type:"string",allowEmpty:!1,regExp:new RegExp("^"+e+"\\|[1-3]\\|")}},{conversationId:t},"",!0)}var Ol=function(e,t,r,n){try{return n?t(He(r)[0],r[1]):t(r)}catch(i){Gi(e,"throw",i)}},Pl=Array,Ll=!Wa((function(e){Array.from(e)}));rt({target:"Array",stat:!0,forced:Ll},{from:function(e){var t=de(e),r=kn(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=void 0!==i;o&&(i=Be(i,n>2?arguments[2]:void 0));var a,s,c,u,d,l,p=qi(t),m=0;if(!p||this===Pl&&Ui(p))for(a=vt(t),s=r?new this(a):Pl(a);a>m;m++)l=o?i(t[m],m):t[m],$n(s,m,l);else for(d=(u=Fi(t,p)).next,s=r?new this:[];!(c=S(d,u)).done;m++)l=o?Ol(u,i,[c.value,m],!0):c.value,$n(s,m,l);return s.length=m,s}});var Vl=q.Array.from,Ul=qi;function Dl(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return ql(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ql(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ql(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Bl=function(){function e(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}var t=e.prototype;return t.addTimer=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=1);var n=(new Date).getTime(),i=this.id;return this.timerList.push({id:i,loop:r,count:0,timeout:n+t,interval:t,callback:e}),this.id++,this.checkTimer(n),i},t.checkTimer=function(e){if(void 0===e&&(e=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var t,r,n=0,i=Dl(this.timerList);!(t=i()).done;){var o=t.value;(0===n||n>o.timeout)&&(n=o.timeout)}0!==this.timerList.length&&(null===this.timer||n<this.timeout||this.timeout<e)&&(this.timer=Ls(Xt(r=this.nowTime).call(r,this),n-e),this.timeout=n)}},t.nowTime=function(){for(var e,t=(new Date).getTime(),r=Dl(this.timerList);!(e=r()).done;){var n=e.value;t>=n.timeout&&(n.callback(),n.count++,n.timeout=t+n.interval)}this.clerTime(),this.checkTimer(t)},t.clerTime=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function(e){for(var t=this.timerList.length-1;t>=0;t--){var r;this.timerList[t].id===e&&si(r=this.timerList).call(r,t,1)}},t.removeFinished=function(){for(var e=this.timerList.length-1;e>=0;e--){var t,r=this.timerList[e];r.loop>=0&&r.count>=r.loop&&si(t=this.timerList).call(t,e,1)}},t.destroy=function(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null},e}(),Fl=n((function(e){function t(r){return e.exports=t="function"==typeof kc&&"symbol"==typeof Gc?function(e){return typeof e}:function(e){return e&&"function"==typeof kc&&e.constructor===kc&&e!==kc.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),Gl=n((function(e){var t=Fl.default;function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,o=i.hasOwnProperty,a="function"==typeof kc?kc:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(e,t,r){return ot(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(R){d=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i,o,a,s,c=t&&t.prototype instanceof h?t:h,u=Ut(c.prototype),d=new E(n||[]);return u._invoke=(i=e,o=r,a=d,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return k()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){var n=S(r,a);if(n){if(n===m)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";var c=p(i,o,a);if("normal"===c.type){if(s=a.done?"completed":"suspendedYield",c.arg===m)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(s="completed",a.method="throw",a.arg=c.arg)}}),u}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}n.wrap=l;var m={};function h(){}function f(){}function g(){}var v={};d(v,s,(function(){return this}));var y=wc&&wc(wc(_([])));y&&y!==i&&o.call(y,s)&&(v=y);var I=g.prototype=h.prototype=Ut(v);function M(e){var t;Bn(t=["next","throw","return"]).call(t,(function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,r){function n(i,a,s,c){var u=p(e[i],e,a);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==t(l)&&o.call(l,"__await")?r.resolve(l.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):r.resolve(l).then((function(e){d.value=e,s(d)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var i;this._invoke=function(e,t){function o(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(o,o):o()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=p(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],Bn(e).call(e,b,this),this.reset(!0)}function _(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=g,d(I,"constructor",g),d(g,"constructor",f),f.displayName=d(g,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Ft?Ft(e,g):(e.__proto__=g,d(e,u,"GeneratorFunction")),e.prototype=Ut(I),e},n.awrap=function(e){return{__await:e}},M(T.prototype),d(T.prototype,c,(function(){return this})),n.AsyncIterator=T,n.async=function(e,t,r,i,o){void 0===o&&(o=ls);var a=new T(l(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},M(I),d(I,u,"Generator"),d(I,s,(function(){return this})),d(I,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=[];for(var r in e)t.push(r);return Pc(t).call(t),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},n.values=_,E.prototype={constructor:E,reset:function(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,Bn(t=this.tryEntries).call(t,C),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+Fc(r).call(r,1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:_(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),m}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}))(),jl=Gl;try{regeneratorRuntime=Gl}catch(pl){"object"==typeof globalThis?globalThis.regeneratorRuntime=Gl:Function("r","regeneratorRuntime = r")(Gl)}function Hl(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function Wl(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(t){o(t)}}function s(e){try{c(n.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function Yl(e){return null!=e&&"object"==typeof e&&wc(e)==Object.prototype}function Kl(e,t){var r=Yl(e)||Si(e),n=Yl(t)||Si(t);if(r&&n){for(var i in t){var o=Kl(e[i],t[i]);void 0!==o&&(e[i]=o)}return e}return t}var Ql={setLogger:function(e){throw new Error("setLogger not implemented.")},platform:"",WebSocket:function(){function e(e,t){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}var t=e.prototype;return t.close=function(e,t){throw new Error("Method not implemented.")},t.send=function(e){throw new Error("Method not implemented.")},t.onclose=function(e){throw new Error("Method not implemented.")},t.onerror=function(e){throw new Error("Method not implemented.")},t.onmessage=function(e){throw new Error("Method not implemented.")},t.onopen=function(e){throw new Error("Method not implemented.")},e}(),localStorage:{},request:function(e,t){throw new Error("request not implemented.")},uploadFile:function(e){throw new Error("uploadFile not implemented.")},getSystemInfo:function(){throw new Error("getSystemInfo not implemented.")},getFileUploadInformation:function(e){throw new Error("getFileUploadInformation not implemented.")},envPayload:{},net:{getNetworkStatus:function(){return ls.resolve({net_type:0,net_connect:!0})},onNetworkStatusChange:function(e){},offNetworkStatusChange:function(){}},logStorage:function(){function e(e){}var t=e.prototype;return t.open=function(){return ls.resolve()},t.close=function(){},t.addLogs=function(e){return ls.resolve()},t.extractLogs=function(){return ls.resolve()},e}()},zl=["error","warn","log","debug"],Jl=function(){},$l=["off","error","warn","log","debug"],Xl=function(){function e(e,t){void 0===t&&(t={}),this.storageArr=[],this.debugLevel="off",this.timer=0,this.strategies={debug:{name:"debg",func:console.log},log:{name:"info",func:console.log},warn:{name:"warn",func:console.warn},error:{name:"erro",func:console.error}},this.debug=Jl,this.log=Jl,this.warn=Jl,this.error=Jl,this.iid=Math.round(1e3*Math.random()),this.debugLevel=tu($l).call($l,e)?e:"off",t.debugLevel&&(this.debugLevel=tu($l).call($l,t.debugLevel)?t.debugLevel:this.debugLevel),this.logStorage=!1===t.storageEnable?null:new Ql.logStorage(null==t?void 0:t.storageName),this.setOptions(t),this.setLogFunc(this.debugLevel),this.setTimer(),this.open()}var t=e.prototype;return t.getDebugMode=function(){return"debug"===this.debugLevel},t.open=function(e){var t=this;this.logStorage&&this.logStorage.open(e).then((function(){t.log("Logger::open success")})).catch((function(e){t.warn("Logger::open failed",e)}))},t.setOptions=function(e){if(e&&e.logFunc){var t=e.logFunc;for(var r in t){var n=r,i=t[n];i&&(this.strategies[n].func=i)}}},t.setLogFunc=function(e,t){var r=this;void 0===t&&(t="log");var n=Wn(zl).call(zl,(function(t){return t===e})),i=Wn(zl).call(zl,(function(e){return e===t}));Bn(zl).call(zl,(function(e,t){r[e]=function(){if(!(t>n&&t>i)){var r=Fc(Array.prototype).call(arguments),o=this.strategies[e],a=this.formatArgs(r,o.name);t<=i&&this.logStorage&&this.prepareSaveLog(a,e),t<=n&&o.func(a)}}}))},t.extractLogs=function(){var e;return this.logStorage?null===(e=this.logStorage)||void 0===e?void 0:e.extractLogs():ls.resolve("")},t.prepareSaveLog=function(e,t){this.storageArr.push({text:e,level:t,time:Ts(),iid:this.iid}),this.timer||this.setTimer(),this.storageArr.length>=100&&(this.triggerTimer(),this.storageArr=[])},t.saveLogs=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logStorage){e.next=2;break}return e.abrupt("return");case 2:return t=this.storageArr,this.storageArr=[],e.prev=4,e.next=7,this.logStorage.addLogs(t);case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:case"end":return e.stop()}}),e,this,[[4,9]])})))},t.clearTimer=function(){this.timer&&clearTimeout(this.timer),this.timer=0},t.setTimer=function(){var e;this.clearTimer(),this.timer=Ls(Xt(e=this.triggerTimer).call(e,this),5e3)},t.triggerTimer=function(){this.clearTimer(),this.saveLogs()},t.formatArgs=function(e,t){var r=new Date;return"[NIM "+this.iid+" "+t+" "+(r.getMonth()+1)+"-"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+":"+r.getMilliseconds()+"] "+au(e).call(e,(function(e){return e instanceof Tl?e.toString():e instanceof Error?e&&e.message?e.message:e:"object"==typeof e?Ti(e):e})).join(" ")},t.destroy=function(){this.debug=Jl,this.log=Jl,this.warn=Jl,this.error=Jl,this.saveLogs(),this.clearTimer(),this.storageArr=[],this.logStorage&&this.logStorage.close()},e}(),Zl=Math.min,ep=[].lastIndexOf,tp=!!ep&&1/[1].lastIndexOf(1,-0)<0,rp=Pn("lastIndexOf"),np=tp||!rp?function(e){if(tp)return m(ep,this,arguments)||0;var t=V(this),r=vt(t),n=r-1;for(arguments.length>1&&(n=Zl(n,lt(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:ep;rt({target:"Array",proto:!0,forced:np!==[].lastIndexOf},{lastIndexOf:np});var ip,op=zt("Array").lastIndexOf,ap=Array.prototype,sp=function(e){var t=e.lastIndexOf;return e===ap||G(ap,e)&&t===ap.lastIndexOf?op:t},cp="\t\n\v\f\r                　\u2028\u2029\ufeff",up=y("".replace),dp="["+cp+"]",lp=RegExp("^"+dp+dp+"*"),pp=RegExp(dp+dp+"*$"),mp=function(e){return function(t){var r=Qi(L(t));return 1&e&&(r=up(r,lp,"")),2&e&&(r=up(r,pp,"")),r}},hp={start:mp(1),end:mp(2),trim:mp(3)},fp=xr.PROPER,gp=hp.trim;rt({target:"String",proto:!0,forced:(ip="trim",c((function(){return!!cp[ip]()||"​᠎"!=="​᠎"[ip]()||fp&&cp[ip].name!==ip})))},{trim:function(){return gp(this)}});var vp,yp=zt("String").trim,Ip=String.prototype,Mp=function(e){var t=e.trim;return"string"==typeof e||e===Ip||G(Ip,e)&&t===Ip.trim?yp:t},Tp=(vp=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return vp()+vp()+vp()+vp()+vp()+vp()+vp()+vp()});function Sp(e){var t;return lu(t=pr(e)).call(t,(function(e){return!(+e>=0)}))}function bp(e,t){var r,n=lu(r=pr(e)).call(r,(function(r){return e[r]==t}));return n.length>0?n[0]:void 0}function Cp(e,t){if(void 0===t&&(t="-"),!e)throw new _l("No sessionId",{},400);var r=bu(e).call(e,t);if(-1===r)throw new _l("Can not find conjunctions",{},400);var n=Fc(e).call(e,0,r);return{accid:Fc(e).call(e,r+1),scene:"super_team"===n?"superTeam":n}}function Ep(){return"undefined"!=typeof tt&&tt.getSystemInfo?"TT":"undefined"!=typeof swan&&swan.getSystemInfo?"BAIDU":"undefined"!=typeof my&&my.getSystemInfo?"ALI":"undefined"!=typeof wx&&wx.getSystemInfo?"WX":"unknow environment"}function _p(e,t){return function(e,t,r,n){for(var i in e=e||{},r=r||{},n=n||function(){},t=t||{}){var o=n(e[i],t[i]);e[i]=void 0===o?t[i]:o}for(var a in r){var s=n(e[a],r[a]);e[a]=void 0===s?r[a]:s}return e}({},e,t,(function(e,t){return void 0===t?e:t}))}function kp(){return ls.resolve()}function Rp(){}function wp(e){var t=sp(e).call(e,"."),r=t>-1?Fc(e).call(e,t+1):"";return/^\d+$/.test(Mp(r).call(r))&&(r=""),r}function Ap(e,t,r){return 0===e.length||e[0][t]<=r?0:e[e.length-1][t]>r?e.length:Wn(e).call(e,(function(n,i){if(e[i-1]&&e[i-1][t]>r&&r>=n[t])return!0}))}var xp=function(){function e(e){this.lastSuccUploadHost="",this.core=e}var t=e.prototype;return t.getFileUploadInformation=function(e){return Ql.getFileUploadInformation(e)},t.request=function(e,t,r){var n=this,i=(new Date).getTime(),o=(null==r?void 0:r.exception_service)||0;return Ql.request(e,t).catch((function(r){var a,s,c,u,d=r;throw n.core.reporter.reportTraceStart("exceptions",{user_id:n.core.options.account||(null===(s=null===(a=n.core)||void 0===a?void 0:a.auth)||void 0===s?void 0:s.account),trace_id:null===(u=null===(c=n.core.clientSocket)||void 0===c?void 0:c.socket)||void 0===u?void 0:u.sessionId,start_time:i,action:1,exception_service:o}),n.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof d.code?d.code:0,description:d.message||""+d.code,operation_type:0,target:e,context:t?Ti(t):""},{asyncParams:Ql.net.getNetworkStatus()}),n.core.reporter.reportTraceEnd("exceptions",1),r}))},t.uploadFile=function(e){var t,r,n,i;return Wl(this,void 0,void 0,jl.mark((function o(){var a,s,c,u,d,l,p,m,h,f,g,v,y,I;return jl.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:c="BROWSER"===Ql.platform,u=c?e.chunkUploadHostBackupList:e.commonUploadHostBackupList,d=c?e.chunkUploadHost:e.commonUploadHost,l=bu(u).call(u,d),p=-1===l?Rs(a=[d]).call(a,u):Rs(s=[d]).call(s,Fc(u).call(u,0,l),Fc(u).call(u,l+1)),m=Math.max(bu(p).call(p,this.lastSuccUploadHost),0),h=null,f=0;case 8:if(!(f<p.length)){o.next=32;break}return g=(new Date).getTime(),v=p[(f+m)%p.length],o.prev=11,o.next=14,Ql.uploadFile(sr(sr({},e),c?{chunkUploadHost:v}:{commonUploadHost:v}));case 14:return y=o.sent,this.lastSuccUploadHost=v,o.abrupt("return",y);case 19:if(o.prev=19,o.t0=o.catch(11),this.core.cloudStorage.nos.nosErrorCount--,h=o.t0,I=o.t0,this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(r=null===(t=this.core)||void 0===t?void 0:t.auth)||void 0===r?void 0:r.account),trace_id:null===(i=null===(n=this.core.clientSocket)||void 0===n?void 0:n.socket)||void 0===i?void 0:i.sessionId,start_time:g,action:1,exception_service:3}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof I.code?I.code:0,description:I.message||""+I.code,operation_type:1,target:v},{asyncParams:Ql.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),!o.t0||o.t0.code!==yl.V2NIM_ERROR_CODE_CANCELLED&&10499!==o.t0.errCode){o.next=29;break}throw o.t0;case 29:f++,o.next=8;break;case 32:throw h;case 33:case"end":return o.stop()}}),o,this,[[11,19]])})))},e}(),Np="weblink.netease.im:443",Op=["https://lbs.netease.im/lbs/webconf.jsp"],Pp="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",Lp="imElite_sdk_abtest_web",Vp="https://statistic.live.126.net,https://statistic-overseas.yunxinfw.com",Up=function(){function e(e,t){this.abtInfo={},this.core=e,this.config=_p({isAbtestEnable:!0,abtestUrl:Pp,abtestProjectKey:Lp},t)}var t=e.prototype;return t.setOptions=function(e){this.config=_p(this.config,e)},t.abtRequest=function(){var e,t;return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.config.isAbtestEnable){r.next=2;break}return r.abrupt("return");case 2:if(!this.abtInfo.experiments){r.next=4;break}return r.abrupt("return");case 4:if(this.config.abtestUrl){r.next=6;break}return r.abrupt("return");case 6:return r.prev=6,r.next=9,this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.7.0",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7});case 9:n=r.sent,r.next=15;break;case 12:r.prev=12,r.t0=r.catch(6),this.core.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(t=null===(e=null==n?void 0:n.data)||void 0===e?void 0:e.data)||void 0===t?void 0:t.abtInfo)||{};case 16:case"end":return r.stop()}}),r,this,[[6,12]])})))},e}();function Dp(e){var t={},r=new ls((function(e,r){t.abort=r}));return t.promise=ls.race([e,r]),t}ls.reject;var qp=function(){function e(){this.abortFns=[]}var t=e.prototype;return t.add=function(e){var t=Dp(e);return this.abortFns.push(t.abort),t.promise},t.clear=function(e){var t;Bn(t=this.abortFns).call(t,(function(t){return t(e||new Tl({code:yl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))})),this.abortFns=[]},t.destroy=function(){this.clear()},e}(),Bp=hp.trim,Fp=s.parseInt,Gp=s.Symbol,jp=Gp&&Gp.iterator,Hp=/^[+-]?0x/i,Wp=y(Hp.exec),Yp=8!==Fp(cp+"08")||22!==Fp(cp+"0x16")||jp&&!c((function(){Fp(Object(jp))}))?function(e,t){var r=Bp(Qi(e));return Fp(r,t>>>0||(Wp(Hp,r)?16:10))}:Fp;rt({global:!0,forced:parseInt!=Yp},{parseInt:Yp});var Kp=q.parseInt;function Qp(e,t){if("object"!=typeof e||null===e)return e;for(var r=(t=t||"").split("."),n=0;n<r.length;n++){var i=r[n],o=e[i],a=bu(i).call(i,"["),s=bu(i).call(i,"]");if(-1!==a&&-1!==s&&a<s){var c=Fc(i).call(i,0,a),u=Kp(Fc(i).call(i,a+1,s));o=e[c],o=Si(o)?o[u]:void 0}if(null==o)return o;e=o}return e}var zp={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},Jp={timestamp:0,rtt:0,baseClock:0,baseTime:0},$p=function(){function e(e,t,r){void 0===r&&(r="getServerTime"),this.serverOrigin=Jp,this.config=zp,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=e,this.logger=e.logger,this.promiseManager=new qp,this.cmdName=r,t&&this.setOptions(t)}var t=e.prototype;return t.setOptions=function(e){this.config=sr({},zp,this.config,e)},t.reset=function(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=Jp,this.currentChance=0},t.setOriginTimetick=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i,o,a,s,c,u,d;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.enable){e.next=2;break}return e.abrupt("return");case 2:if(!this.isSettingNTP){e.next=4;break}return e.abrupt("return");case 4:if(!(this.currentChance>=this.config.maxChances)){e.next=6;break}return e.abrupt("return");case 6:if(t=Qp(this.core,"auth.status"),r=Qp(this.core,"status"),n=Qp(this.core,"V2NIMLoginService.lifeCycle.loginStatus"),"logined"===t||"logined"===r||1===n){e.next=11;break}return e.abrupt("return");case 11:return this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0,i="TimeOrigin::setOriginTimetick:",o=Ts(),this.core.logger.debug(i+" getServerTime start, times "+this.currentChance),e.prev=18,e.next=21,this.promiseManager.add(this.core.sendCmd(this.cmdName));case 21:s=e.sent,a=Qp(s,"content.time"),this.isSettingNTP=!1,e.next=33;break;case 26:return e.prev=26,e.t0=e.catch(18),c=e.t0,this.isSettingNTP=!1,this.logger.warn(i+" Calculate Delay time, getServerTime error",c),c.code!==yl.V2NIM_ERROR_CODE_CANCELLED&&(this.timer=Ls(Xt(u=this.setOriginTimetick).call(u,this),this.failedDelay)),e.abrupt("return");case 33:if(a){e.next=37;break}return this.core.logger.warn(i+" Calculate Delay time incorrect format"),this.config.enable=!1,e.abrupt("return");case 37:d=Ts()-o,this.doSet(a,d);case 39:case"end":return e.stop()}}),e,this,[[18,26]])})))},t.doSet=function(e,t){var r,n="TimeOrigin::setOriginTimetick:";if(t>this.config.tolerantRTT)this.logger.warn(n+" Denied, cause of exceeding the maximum tolerance range of RTT: "+t),this.timer=Ls(Xt(r=this.setOriginTimetick).call(r,this),this.failedDelay);else if(t>this.config.bestRTT){var i;this.serverOrigin.rtt&&t>=this.serverOrigin.rtt?this.logger.warn(n+" Denied, cause of current.RTT >= serverOrigin.RTT: "+t):(this.setServerOrigin(t,e),this.logger.log(n+" Accept within maximum tolerance range of RTT: "+t+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime)),this.timer=Ls(Xt(i=this.setOriginTimetick).call(i,this),this.failedDelay)}else{var o;this.setServerOrigin(t,e),this.logger.debug(n+" Accept within best RTT: "+t+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime),this.currentChance=0,this.timer=Ls(Xt(o=this.setOriginTimetick).call(o,this),this.successDelay)}},t.getNTPTime=function(e){if(void 0===e&&(e=this.getTimeNode()),this.checkNodeReliable(e)){var t=Math.floor(e.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+t}return Ts()},t.checkNodeReliable=function(e){if(void 0===e&&(e=this.getTimeNode()),this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var t=e.clock-this.serverOrigin.baseClock,r=e.time-this.serverOrigin.baseTime;return Math.abs(r-t)<500}return!1},t.checkPerformance=function(){return"BROWSER"===Ql.platform&&!("undefined"==typeof performance||!performance.now)},e.checkPerformance=function(){return"BROWSER"===Ql.platform&&!("undefined"==typeof performance||!performance.now)},t.getTimeNode=function(){return{clock:this.checkPerformance()?performance.now():0,time:Ts()}},e.getTimeNode=function(){return{clock:e.checkPerformance()?performance.now():0,time:Ts()}},t.setServerOrigin=function(e,t){this.serverOrigin={timestamp:t+Math.floor(e/2),rtt:e,baseClock:this.checkPerformance()?performance.now():0,baseTime:Ts()}},e}(),Xp={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]},Zp=function(){function e(e,t){this.traceData=Xp,this.core=e,this.traceData=sr({},Xp,t),this.traceData.extension=[]}var t=e.prototype;return t.reset=function(){this.traceData=sr({},Xp),this.traceData.extension=[]},t.start=function(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time=(new Date).getTime()},t.update=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ql.net.getNetworkStatus();case 2:r=t.sent,n=r.net_type,i=r.net_connect,this.traceData.extension.push(sr({code:0,foreground:!0,foreg_backg_switch:!1,net_type:n,net_connect:i},e));case 6:case"end":return t.stop()}}),t,this)})))},t.end=function(e){var t=this.traceData.extension[0],r=this.traceData.extension[1];if(t&&0===t.operation_type&&r&&1===r.operation_type){var n=t.net_type!==r.net_type||t.net_connect!==r.net_connect;if(e||!n)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()},e}(),em={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1},tm=function(){function e(e){this.traceData=em,this.core=e,this.reset()}var t=e.prototype;return t.reset=function(){this.traceData=sr({},em),this.traceData.history=[]},t.start=function(e){this.reset(),this.traceData.user_id=e,this.traceData.start_time=Ts()},t.updateBegin=function(e){this.traceData.history.push(sr({head:"",body:"",start_time:Ts(),httpdns:!1,index:0},e))},t.updateComplete=function(e){var t;Bn(t=this.traceData.history).call(t,(function(t){t.target===e.target&&(sr(t,e),t.duration=Ts()-t.start_time)}))},t.end=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.traceData.succeed=e,this.traceData.history=lu(r=this.traceData.history).call(r,(function(e){return void 0!==e.code})),0!==this.traceData.history.length){t.next=5;break}return this.reset(),t.abrupt("return");case 5:return this.traceData.duration=Ts()-this.traceData.start_time,t.next=8,Ql.net.getNetworkStatus();case 8:n=t.sent,i=n.net_type,o=n.net_connect,this.traceData.net_type=i,this.traceData.net_connect=o,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset();case 15:case"end":return t.stop()}}),t,this)})))},e}();function rm(e){var t,r,n=!0;return"boolean"==typeof(null===(t=null==e?void 0:e.reporterConfig)||void 0===t?void 0:t.enableCompass)?n=e.reporterConfig.enableCompass:"boolean"==typeof(null===(r=null==e?void 0:e.reporterConfig)||void 0===r?void 0:r.isDataReportEnable)&&(n=e.reporterConfig.isDataReportEnable),n}var nm={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},im="ReporterHook::setMonitorForResources:",om=function(){function e(e,t){this.traceData=nm,this.core=e,this.traceData=sr({},nm,t)}var t=e.prototype;return t.reset=function(){this.traceData=sr({},nm)},t.start=function(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Ts()},t.update=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.traceData.user_id){t.next=2;break}return t.abrupt("return");case 2:this.core.logger.log(im+" upload update",e),sr(this.traceData,e);case 4:case"end":return t.stop()}}),t,this)})))},t.end=function(e){this.traceData.user_id&&(this.core.logger.log(im+" upload end cause of "+e),this.traceData.state=e,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Ts())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=nm)},e}(),am={},sm={},cm={},um={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:tr,lbsUrls:Op,linkUrl:Np,abtestUrl:Pp,isAbtestEnable:!0},dm=function(e){function t(r,n){var i,o,a;if(void 0===n&&(n={}),(a=e.call(this)||this).instanceName="NIM",a.pluginMap={},a.eventBus=new Vs,a.options={},a.V2NIMConversationIdUtil={},a.V2NIMMessageCreator={},a.V2NIMMessageAttachmentCreator={},a.V2NIMClientAntispamUtil={},a.DataStructureConverter={},a.V2NIMMessageConverter={},a.V2NIMMessageLogUtil={},a.V2NIMMessageExtendUtil={},a.V2NIMStorageUtil={},a.V2NIMNotificationService={},a.V2NIMStorageService={},a.auth={},a.V1NIMLoginService={},a.V2NIMLoginService={},a.clientSocket={},a.V2NIMSyncService={},a.V2NIMConversationService={},a.V2NIMConversationGroupService={},a.V2NIMMessageService={},a.V2NIMTeamService={},a.V2NIMUserService={},a.V2NIMFriendService={},a.V2NIMSettingService={},a.V2NIMAIService={},a.V2NIMSignallingService={},a.V2NIMSubscriptionService={},a.V2NIMPassthroughService={},a.YSFService={},a.offlinePush={},a.sync={},a.msg={},a.msgLog={},a.session={},a.cloudSession={},a.misc={},a.user={},a.friend={},a.systemMessage={},a.team={},a.event={},a.msgExtend={},a.cloudStorage={},a.passThrough={},a.superTeam={},a.plugin={},a.signaling={},a.qchatChannel={},a.qchatMedia={},a.qchatMsg={},a.qchatRole={},a.qchatServer={},a.pluginMap=cm,a.logger=new Xl(r.debugLevel,n.loggerConfig),n.privateConf){var s=a.getConfigFromPrivate(n.privateConf),c=s.authConfig,u=s.cloudStorageConfig,d=s.reporterConfig;sr(r,c),a.setInitOptions(r),a.otherOptions=sr(sr({},n),{cloudStorageConfig:sr(sr({storageKeyPrefix:"NIM"},n.cloudStorageConfig),u),reporterConfig:sr(sr({},n.reporterConfig),d),V1NIMLoginServiceConfig:sr(sr(sr({},r),n.V1NIMLoginServiceConfig),c),V2NIMLoginServiceConfig:sr(sr({},n.V2NIMLoginServiceConfig),c)})}else a.setInitOptions(r),a.otherOptions=sr(sr({},n),{V1NIMLoginServiceConfig:sr(sr({},r),n.V1NIMLoginServiceConfig),cloudStorageConfig:sr({storageKeyPrefix:"NIM"},n.cloudStorageConfig)});a.timerManager=new Bl,a.timeOrigin=new $p(st(a)),a.adapters=new xp(st(a)),a.abtest=new Up(st(a),sr(sr({isAbtestEnable:a.options.isAbtestEnable,abtestUrl:a.options.abtestUrl},a.otherOptions.abtestConfig),{abtestProjectKey:Lp}));var l=Ql.getSystemInfo(),p=function(e,t){var r,n,i=null===(r=null==t?void 0:t.reporterConfig)||void 0===r?void 0:r.compassDataEndpoint,o=null===(n=null==t?void 0:t.reporterConfig)||void 0===n?void 0:n.reportConfigUrl;if(i)return i;if(o){var a=o.match(/^https:\/\/([^/]+)\/*/);return Si(a)&&a.length>=1?"https://"+a[1]:(e.error("Invalid reportConfigUrl: "+o),Vp)}return Vp}(a.logger,a.otherOptions);a.reporter=new pu(sr(sr({},p?{compassDataEndpoint:p}:{}),{isDataReportEnable:rm(a.otherOptions),common:{app_key:r.appkey,dev_id:"",platform:"Web",sdk_ver:"10.7.0",env:"online",os_name:l.os,os_ver:l.osVer,lib_env:l.libEnv,host_env:l.hostEnv,host_env_ver:l.hostEnvVer,manufactor:l.manufactor,model:l.model,v2:"v1"!==a.options.apiVersion},request:Ql.request,logger:a.logger,autoStart:!0})),a.reporterHookLinkKeep=new Zp(st(a)),a.reporterHookCloudStorage=new om(st(a)),a.reporterHookLBS=new tm(st(a)),Ql.setLogger(a.logger);var m=a.getServiceKeys(pr(am));return Bn(m).call(m,(function(e){var t=am[e];a[e]=new t(st(a))})),Bn(i=pr(am)).call(i,(function(e){a.callSetOptions(e)})),Bn(o=pr(sm)).call(o,(function(e){var t=sm[e];void 0!==t&&(a[e]=new t(st(a)))})),t.instance=st(a),a.logger.log("NIM init, version:10.7.0, sdk version:100700, appkey:"+r.appkey),a}er(t,e);var r=t.prototype;return r.getServiceKeys=function(e){var t=Wn(e).call(e,(function(e){return"V1NIMLoginService"===e}));if(t>-1){var r=e[t];si(e).call(e,t,1),"v1"===this.options.apiVersion&&e.unshift(r)}var n=Wn(e).call(e,(function(e){return"V2NIMLoginService"===e}));if(n>-1){var i=e[n];si(e).call(e,n,1),"v2"===this.options.apiVersion&&e.unshift(i)}var o=Wn(e).call(e,(function(e){return"sync"===e}));if(o>-1){var a=e[o];si(e).call(e,o,1),"v1"===this.options.apiVersion&&e.push(a)}var s=Wn(e).call(e,(function(e){return"V2NIMSyncService"===e}));if(s>-1){var c=e[s];si(e).call(e,s,1),"v2"===this.options.apiVersion&&e.push(c)}return e},t.getInstance=function(e,r){if(!t.instance){if(e)return new t(e,r);throw new Error("Instance not exist, please input options")}if(e){if(t.instance.options.account===e.account&&t.instance.options.appkey===e.appkey)return t.instance.setOptions(e),t.instance;throw new Error("Unexpected login")}return t.instance},r.setInitOptions=function(e){Al({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.options=sr(sr({},um),e)},r.getConfigFromPrivate=function(e){return e?{authConfig:JSON.parse(Ti({appkey:e.appkey||void 0,lbsUrls:e.weblbsUrl?[e.weblbsUrl]:void 0,linkUrl:e.link_web||void 0})),cloudStorageConfig:JSON.parse(Ti({chunkUploadHost:e.nos_uploader||void 0,commonUploadHost:e.nos_uploader||void 0,commonUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,chunkUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,uploadReplaceFormat:e.nos_downloader_v2?(e.nosSsl?"https://":"http://")+e.nos_downloader_v2:void 0,downloadUrl:void 0!==e.nos_accelerate?e.nos_accelerate:void 0,downloadHostList:""===e.nos_accelerate_host?[]:"string"==typeof e.nos_accelerate_host?[e.nos_accelerate_host]:Si(e.nos_accelerate_host)?e.nos_accelerate_host:void 0})),reporterConfig:JSON.parse(Ti({enableCompass:"boolean"==typeof e.enableCompass?e.enableCompass:void 0,compassDataEndpoint:e.compassDataEndpoint||void 0}))}:{authConfig:{},cloudStorageConfig:{},reporterConfig:{}}},r.connect=function(e){return void 0===e&&(e={}),this.V1NIMLoginService.login(e)},r.setOptions=function(e){if("object"==typeof e&&null!==e){if(Object.prototype.hasOwnProperty.call(e,"account")&&e.account!==this.options.account||Object.prototype.hasOwnProperty.call(e,"appkey")&&e.appkey!==this.options.appkey)throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"apiVersion")&&e.apiVersion!==this.options.apiVersion)throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"binaryWebsocket")&&e.binaryWebsocket!==this.options.binaryWebsocket)throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});Al({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.logger.log("NIM::setOptions options is",e),this.options=sr(sr({},this.options),e),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}},r.disconnect=function(){return this.V1NIMLoginService.logout()},r._disconnect=function(){return"v1"===this.options.apiVersion?this.V1NIMLoginService.logout():"v2"===this.options.apiVersion?0===Qp(this.V2NIMLoginService,"lifeCycle.connectStatus")&&0===Qp(this.V2NIMLoginService,"lifeCycle.loginStatus")?ls.resolve():this.V2NIMLoginService.logout():ls.resolve()},r.destroy=function(){var e=this;return t.instance=void 0,this._disconnect().then((function(){e.status="destroyed",e.removeAllListeners(),e.eventBus.removeAllListeners(),e.logger.destroy(),e.reporter.destroy(),e.timerManager.destroy(),e._clearModuleData("destroy"),e._removeAllModuleListeners(),e.connect=kp,e.disconnect=kp,e._disconnect=kp,e.destroy=kp}))},r._clearModuleData=function(e){void 0===e&&(e="logout");var t=ys(this);Bn(t).call(t,(function(t){t&&"function"==typeof t.reset&&t.reset(e)}))},r._removeAllModuleListeners=function(){var e=ys(this);Bn(e).call(e,(function(e){e&&"function"==typeof e.removeAllListeners&&e.removeAllListeners()}))},r.kick=function(e){return this.V1NIMLoginService.kick(e)},r.sendCmd=function(e,t,r){return this.clientSocket.sendCmd(e,t,r)},r.emit=function(t){var r=this;try{for(var n,i,o=Ts(),a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];var u=(n=e.prototype.emit).call.apply(n,Rs(i=[this,t]).call(i,s)),d=Ts()-o;return d>=10&&this.logger.warn("Core::emit event: "+t+" process takes: "+d+"ms"),u}catch(l){return this.logger.error("Core::emit event: "+t+". Error: "+l),Ls((function(){throw r.logger.error("Core::emit throw error in setTimeout. event: "+t+". Error: "+l),l}),0),!1}},r._registerDep=function(e,t){this[t]&&this[t].name||(this[t]=new e(this),this.callSetOptions(t))},r.callSetOptions=function(e){var t=e+"Config",r=e+"Options",n=this.otherOptions[t]||this.otherOptions[r]||{},i=Qp(this,e+".setOptions");"function"==typeof i&&("cloudStorage"===e&&(n=this.otherOptions[t]||this.otherOptions.serverConfig||{}),i.call(this[e],n))},t.registerService=function(e,t){am[t]=e},t.registerPrivateService=function(e,t){sm[t]=e},t.registerPlugin=function(e,t){cm[t]=e},at(t,[{key:"account",get:function(){return this.auth.account}},{key:"status",get:function(){return this.V1NIMLoginService.status},set:function(e){this.V1NIMLoginService.status=e}},{key:"config",get:function(){return{timeout:8e3,deviceId:this.auth.deviceId}}}]),t}(Vs);dm.sdkVersion=100700,dm.sdkVersionFormat="10.7.0";var lm=n((function(e,t){e.exports=function(){function e(e){if(e){var t,r="";return Bn(t=pr(e)).call(t,(function(t,n){r+=0===n?"?":"&",r+=t+"="+e[t]})),r}return""}var t=function(e){function t(t,r,n,i){var o;return(o=e.call(this,n)||this).source=t,o.code=r,o.desc=n,o.detail=i||{},o}return er(t,e),t}(hd(Error));function r(r,n){void 0===n&&(n={dataType:"json",method:"GET",timeout:5e3});var i="text"===n.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",o="GET"===n.method?e(n.params):"";return new ls((function(e,a){if(window.XMLHttpRequest){var s,c=new XMLHttpRequest;if(c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){try{s=JSON.parse(c.response||"{}")}catch(r){s=c.response}e({status:c.status,data:s})}else Ls((function(){a(new t(1,c.status,"readyState: "+c.readyState+"; statusText: "+c.statusText))}),0)},c.open(n.method,""+r+o),c.timeout=n.timeout||5e3,c.setRequestHeader("Content-Type",i),n.headers)for(var u in n.headers)c.setRequestHeader(u,n.headers[u]);c.ontimeout=function(e){a(new t(1,408,e&&e.message?e.message:"request timeout"))},c.send(Ti(n.data))}else a(new t(2,10400,"request no suppout"))}))}return r}()})),pm=Math.floor,mm=function(e,t){var r=e.length,n=pm(r/2);return r<8?hm(e,t):fm(e,mm(Bs(e,0,n),t),mm(Bs(e,n),t),t)},hm=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},fm=function(e,t,r,n){for(var i=t.length,o=r.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?n(t[a],r[s])<=0?t[a++]:r[s++]:a<i?t[a++]:r[s++];return e},gm=mm,vm=j.match(/firefox\/(\d+)/i),ym=!!vm&&+vm[1],Im=/MSIE|Trident/.test(j),Mm=j.match(/AppleWebKit\/(\d+)\./),Tm=!!Mm&&+Mm[1],Sm=[],bm=y(Sm.sort),Cm=y(Sm.push),Em=c((function(){Sm.sort(void 0)})),_m=c((function(){Sm.sort(null)})),km=Pn("sort"),Rm=!c((function(){if(Q)return Q<70;if(!(ym&&ym>3)){if(Im)return!0;if(Tm)return Tm<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)Sm.push({k:t+n,v:r})}for(Sm.sort((function(e,t){return t.v-e.v})),n=0;n<Sm.length;n++)t=Sm[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));rt({target:"Array",proto:!0,forced:Em||!_m||!km||!Rm},{sort:function(e){void 0!==e&&re(e);var t=de(this);if(Rm)return void 0===e?bm(t):bm(t,e);var r,n,i=[],o=vt(t);for(n=0;n<o;n++)n in t&&Cm(i,t[n]);for(gm(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:Qi(t)>Qi(r)?1:-1}}(e)),r=vt(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)Zn(t,n++);return t}});var wm=zt("Array").sort,Am=Array.prototype,xm=function(e){var t=e.sort;return e===Am||G(Am,e)&&t===Am.sort?wm:t},Nm=n((function(e,t){e.exports=function(){var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&ot(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return T}});var r=function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(e){},this.onProgress=function(e){},this.onUploadProgress=function(e){},this.onComplete=function(e){},t)this[r]=t[r]};function n(e,t){var r=void 0!==kc&&Ul(e)||e["@@iterator"];if(!r){if(Si(e)||(r=function(e,t){if(e){var r;if("string"==typeof e)return i(e,t);var n=Fc(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o={privateObj:{},setItem:function(e,t){o.privateObj[e]=t},getItem:function(e){return o.privateObj[e]},removeItem:function(e){delete o.privateObj[e]},getKeys:function(){return pr(o.privateObj)}},a={getFileKey:function(e){var t=e.size.toString(),r=e.lastModified.toString();return"_NosUploader_"+e.name+Fc(t).call(t,t.length-5)+Fc(r).call(r,r.length-5)},getFileInfo:function(e){var t=o.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(r){return null}},initFile:function(e,t,r){a.clearExpiredInfo();var n=this.getFileKey(t),i={ctx:void 0!==e.ctx?e.ctx:"",bucket:e.bucketName,obj:e.objectName,token:e.token,modifyAt:Ts(),end:!1};return e.payload&&(i.payload=e.payload),r&&o.setItem(n,Ti(i)),n},setUploadContext:function(e,t,r){var n=this.getFileInfo(e);n&&(n.ctx=t,r&&o.setItem(e,Ti(n)))},setComplete:function(e,t){var r=this.getFileInfo(e);r&&(r.modifyAt=Ts(),r.end=!0,t&&o.setItem(e,Ti(r)))},getUploadContext:function(e){var t=this.getFileInfo(e);return t?t.ctx:""},removeFileInfo:function(e){0===bu(e).call(e,"_NosUploader_")&&o.removeItem(e)},clearExpiredInfo:function(){var e,t="function"==typeof o.getKeys?o.getKeys():pr(o),r=Ts(),i=[],s=n(t);try{for(s.s();!(e=s.n()).done;){var c=e.value;if(0===bu(c).call(c,"_NosUploader_")){var u=a.getFileInfo(c);null===u||r-u.modifyAt>T.expireTime?o.removeItem(c):i.push({fileInfo:u,key:c})}}}catch(f){s.e(f)}finally{s.f()}if(i.length>T.maxFileCache){var d,l,p=n(Fc(d=xm(i).call(i,(function(e,t){return t.fileInfo.modifyAt-e.fileInfo.modifyAt}))).call(d,T.maxFileCache));try{for(p.s();!(l=p.n()).done;){var m,h=l.value;0===bu(m=h.key).call(m,"_NosUploader_")&&o.removeItem(h.key)}}catch(f){p.e(f)}finally{p.f()}}}},s=a;function c(e){return(c="function"==typeof kc&&"symbol"==typeof Gc?function(e){return typeof e}:function(e){return e&&"function"==typeof kc&&e.constructor===kc&&e!==kc.prototype?"symbol":typeof e})(e)}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){var t="function"==typeof rd?new rd:void 0;return(d=function(e){var r,n;if(null===e||(n=e,-1===bu(r=Function.toString.call(n)).call(r,"[native code]")))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return l(e,arguments,h(this).constructor)}return i.prototype=Ut(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),m(i,e)})(e)}function l(e,t,r){return(l=p()?ld:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Xt(Function).apply(e,n));return r&&m(i,r.prototype),i}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!ld)return!1;if(ld.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ld(Boolean,[],(function(){}))),!0}catch(e){return!1}}function m(e,t){return(m=Ft||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return(h=Ft?wc:function(e){return e.__proto__||wc(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Ut(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(i,e);var t,r,n=(t=i,r=p(),function(){var e,n=h(t);if(r){var i=h(this).constructor;e=ld(n,arguments,i)}else e=n.apply(this,arguments);return u(this,e)});function i(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=n.call(this,"NosUploadError:"+e)).errCode=t,r.errMsg=e,r}return i}(d(Error)),g=function e(t,r,n){if("uploading"===t.uploadState){var i=t.config,o=t.param,a=s.getUploadContext(t.fileKey);if(!a)return n(0);var c=new XMLHttpRequest,u=i.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName))+"?uploadContext"+"&context=".concat(a)+"&version=".concat(i.version);c.onreadystatechange=function(){var o;if("abort"!==t.uploadState&&4===c.readyState){var a,d,l,p;try{p=JSON.parse(c.responseText)}catch(m){p={errMsg:"JsonParseError in getOffset. xhr.status = "+c.status+". xhr.responseText: "+c.responseText,errCode:500}}200===c.status?p.errCode?t.config.onError(new f(p.errMsg,p.errCode)):n(p.offset):c.status.toString().match(/^5/)?e(t,r-1,n):r>0?("function"==typeof(null===(o=i.logger)||void 0===o?void 0:o.error)&&i.logger.error(Rs(a="getOffset(".concat(u,") error. retry after 3 seconds. ")).call(a,(new Date).toTimeString())),Ls((function(){e(t,r-1,n)}),3500)):c.status?(s.removeFileInfo(t.fileKey),i.onError(new f(Rs(d=Rs(l="getOffset(".concat(u,") error: ")).call(l,c.status," ")).call(d,c.statusText)))):i.onError(new f("getOffset(".concat(u,") error. no Error Code")))}},c.open("get",u),c.setRequestHeader("x-nos-token",o.token),c.timeout=i.getOffsetTimeout,c.send()}},v=function e(t,r,n,i){if("uploading"===t.uploadState){var o=t.param,a=t.config,c=Fc(File.prototype),u=void 0!==o.ctx?o.ctx:"",d=r+a.trunkSize>=t.file.size,l=d?t.file.size:r+a.trunkSize,p=new XMLHttpRequest,m=a.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName));if(p.upload.onprogress=function(e){if("abort"!==t.uploadState){var n=0;e.lengthComputable?(n=(r+e.loaded)/t.file.size,a.onProgress(n),a.onUploadProgress({loaded:e.loaded,total:t.file.size,percentage:n,percentageText:(100*n).toFixed(2)+"%"})):a.onError(new f("browser does not support query upload progress"))}},p.onreadystatechange=function(){var o,c;if("abort"!==t.uploadState&&4===p.readyState){var u,l,h,g;try{g=JSON.parse(p.responseText)}catch(v){"function"==typeof(null===(o=a.logger)||void 0===o?void 0:o.error)&&a.logger.error("JsonParseError in uploadTrunk. xhr.status = "+p.status+". xhr.responseText: "+p.responseText,v),g={errMsg:"JsonParseError in uploadTrunk. xhr.status = "+p.status+". xhr.responseText: "+p.responseText}}200===p.status?(t.setContext(g.context),d?(i(),t.setComplete()):e(t,g.offset,a.retryCount,i)):p.status.toString().match(/^5/)?n>0?e(t,r,n-1,i):(s.removeFileInfo(t.fileKey),a.onError(new f(g.errMsg,g.errCode))):n>0?("function"==typeof(null===(c=a.logger)||void 0===c?void 0:c.error)&&a.logger.error(Rs(u="uploadTrunk(".concat(m,") error. retry after 3 seconds. ")).call(u,(new Date).toTimeString())),Ls((function(){e(t,r,n-1,i)}),3500)):p.status?(s.removeFileInfo(t.fileKey),a.onError(new f(Rs(l=Rs(h="uploadTrunk(".concat(m,") error: ")).call(h,p.status," ")).call(l,p.statusText)))):a.onError(new f("uploadTrunk(".concat(m,") error. no Error Code. Please check your network")))}},p.open("post",m+"?offset=".concat(r)+"&complete=".concat(d)+"&context=".concat(u)+"&version=".concat(a.version)),p.setRequestHeader("x-nos-token",o.token),o.md5&&p.setRequestHeader("content-md5",o.md5),t.file.type&&p.setRequestHeader("content-type",t.file.type),p.timeout=a.trunkUploadTimeout,"undefined"!=typeof FileReader){var h=new FileReader;h.addEventListener("load",(function(e){var t;(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)instanceof ArrayBuffer&&e.target.result.byteLength>0?p.send(e.target.result):a.onError(new f("Read ArrayBuffer failed",194003))})),h.addEventListener("error",(function(e){var t=e.target.error;a.onError(new f("Read ArrayBuffer error. ".concat(t.toString()),194003))})),h.readAsArrayBuffer(c.call(t.file,r,l))}else p.send(c.call(t.file,r,l))}};function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),ot(e,n.key,n)}}var I=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=n,this.file=t,this.param=r,this.fileKey=s.initFile(r,t,this.config.enableCache),this.resume()}var t;return(t=[{key:"resume",value:function(){var e=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var t=this.config;g(this,t.retryCount,(function(r){v(e,r,t.retryCount,(function(){e.setUploadState("ended"),"function"==typeof t.onComplete&&t.onComplete(e.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){"ended"!==this.uploadState&&"abort"!==this.uploadState&&(this.setUploadState("abort"),this.config.onError(new f("Upload Aborted",10499)))}},{key:"setUploadState",value:function(e){e!==this.uploadState&&(this.uploadState=e)}},{key:"setContext",value:function(e){s.setUploadContext(this.fileKey,e,this.config.enableCache),this.param.ctx=e}},{key:"setComplete",value:function(){s.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&y(e.prototype,t),e}(),M={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function(e){var t=s.getFileKey(e),r=s.getFileInfo(t);return null===r?null:Ts()-r.modifyAt>M.expireTime?(s.removeFileInfo(t),null):{uploadInfo:sr({bucketName:r.bucket,objectName:r.obj,token:r.token,ctx:r.ctx},r.payload?{payload:r.payload}:{}),complete:r.end}},setMaxFileCache:function(e){M.maxFileCache=e},setExpireTime:function(e){M.expireTime=e},printCaches:function(){if("undefined"!=typeof localStorage)for(var e=0,t=pr(localStorage);e<t.length;e++){var r=t[e],n=s.getFileInfo(r);n&&console.log(n,"modifiedAt",new Date(n.modifyAt).toTimeString())}},createConfig:function(e){return new r(e)},createTask:function(e,t,r){return new I(e,t,r)}},T=M;return t.default}()})),Om=On.some,Pm=Pn("some");rt({target:"Array",proto:!0,forced:!Pm},{some:function(e){return Om(this,e,arguments.length>1?arguments[1]:void 0)}});var Lm=zt("Array").some,Vm=Array.prototype,Um=function(e){var t=e.some;return e===Vm||G(Vm,e)&&t===Vm.some?Lm:t},Dm={debug:function(){},log:function(){},warn:function(){},error:function(){}};function qm(e){Dm=e}function Bm(){if(!navigator||!navigator.userAgent)return!1;var e=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i];return Um(e).call(e,(function(e){return navigator.userAgent.match(e)}))}function Fm(){var e;return!(!navigator||!navigator.userAgent)&&"object"==typeof navigator&&"string"==typeof navigator.userAgent&&bu(e=navigator.userAgent).call(e,"Electron")>=0}function Gm(){return navigator&&navigator.userAgent}function jm(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=Dm,e.fileInput||e.file){t.next=3;break}throw new Error("File not exist");case 3:if(!e.file){t.next=7;break}a=e.file,t.next=21;break;case 7:if("string"!=typeof e.fileInput){t.next=16;break}if(!((s=document.getElementById(e.fileInput))&&s.files&&s.files[0])){t.next=13;break}a=s.files[0],t.next=14;break;case 13:throw new Error("Can not get file from fileInput");case 14:t.next=21;break;case 16:if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0])){t.next=20;break}a=e.fileInput.files[0],t.next=21;break;case 20:throw new Error("Can not get file from fileInput "+e.fileInput);case 21:if(!(e.maxSize&&a.size>e.maxSize)){t.next=23;break}throw new Error("The file exceeds maxSize limit. maxSize: "+e.maxSize+", get "+a.size);case 23:return t.next=25,new ls((function(t,r){var n,i=Nm.getFileUploadInformation(a),s=Nm.createConfig({enableCache:!0,retryCount:0,directUploadAddr:e.chunkUploadHost,onError:function(e){r(e)},onUploadProgress:e.onUploadProgress||function(){},onComplete:function(e){t(e)}});if(i)if(i.complete)e.onUploadProgress&&e.onUploadProgress({total:a.size,loaded:a.size,percentage:1,percentageText:"100%"}),t(i.uploadInfo);else{n=Nm.createTask(a,i.uploadInfo,s);try{e.onUploadStart&&e.onUploadStart(n)}catch(c){o.error("Adapter uploadFile: options.onUploadStart error",c&&c.message),n.abort(),r(c)}}else{n=Nm.createTask(a,sr(sr({bucketName:e.nosToken.bucket,objectName:decodeURIComponent(e.nosToken.objectName),token:e.nosToken.token},e.md5?{md5:e.md5}:{}),e.payload?{payload:e.payload}:{}),s);try{e.onUploadStart&&e.onUploadStart(n)}catch(c){o.error("Adapter uploadFile: options.onUploadStart error",c&&c.message),n.abort(),r(c)}}}));case 25:return(c=t.sent).name=a.name,c.size=a.size,c.type=a.type,c.ext=sp(r=c.name).call(r,".")>-1?Fc(n=c.name).call(n,sp(i=c.name).call(i,".")+1).toLowerCase():"",t.abrupt("return",c);case 31:case"end":return t.stop()}}),t)})))}function Hm(e){var t;if(e.file)t=e.file;else if("string"==typeof e.fileInput){var r=document.getElementById(e.fileInput);if(!(r&&r.files&&r.files[0]))throw new Error("Can not get file from fileInput");t=r.files[0]}else{if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0]))throw new Error("Can not get file from fileInput "+e.fileInput);t=e.fileInput.files[0]}return Nm.getFileUploadInformation(t)}
/*!
    	 * Platform.js v1.3.6
    	 * Copyright 2014-2020 Benjamin Tan
    	 * Copyright 2011-2013 John-David Dalton
    	 * Available under MIT license
    	 */var Wm=n((function(e,r){(function(){var n={function:!0,object:!0}[typeof window]&&window||this,i=r,o=e&&!e.nodeType&&e,a=i&&o&&"object"==typeof t&&t;!a||a.global!==a&&a.window!==a&&a.self!==a||(n=a);var s=Math.pow(2,53)-1,c=/\bOpera/,u=Object.prototype,d=u.hasOwnProperty,l=u.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function m(e){return e=y(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function h(e,t){for(var r in e)d.call(e,r)&&t(e[r],r,e)}function f(e){return null==e?p(e):l.call(e).slice(8,-1)}function g(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function v(e,t){var r=null;return function(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=s)for(;++r<n;)t(e[r],r,e);else h(e,t)}(e,(function(n,i){r=t(r,n,i,e)})),r}function y(e){return String(e).replace(/^ +| +$/g,"")}var I=function e(t){var r=n,i=t&&"object"==typeof t&&"String"!=f(t);i&&(r=t,t=null);var o=r.navigator||{},a=o.userAgent||"";t||(t=a);var s,u,d=i?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(l.toString()),p="Object",I=i?p:"ScriptBridgingProxyObject",M=i?p:"Environment",T=i&&r.java?"JavaPackage":f(r.java),S=i?p:"RuntimeObject",b=/\bJava/.test(T)&&r.java,C=b&&f(r.environment)==M,E=b?"a":"α",_=b?"b":"β",k=r.document||{},R=r.operamini||r.opera,w=c.test(w=i&&R?R["[[Class]]"]:f(R))?w:R=null,A=t,x=[],N=null,O=t==a,P=O&&R&&"function"==typeof R.version&&R.version(),L=v([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,r){return e||RegExp("\\b"+(r.pattern||g(r))+"\\b","i").exec(t)&&(r.label||r)})),V=function(e){return v(e,(function(e,r){return e||RegExp("\\b"+(r.pattern||g(r))+"\\b","i").exec(t)&&(r.label||r)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=B([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(e){return v(e,(function(e,r,n){return e||(r[U]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+g(n)+"(?:\\b|\\w*\\d)","i").exec(t))&&n}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),q=function(e){return v(e,(function(e,r){var n,i,o,a,s=r.pattern||g(r);return!e&&(e=RegExp("\\b"+s+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(n=e,i=s,o=r.label||r,a={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"},i&&o&&/^Win/i.test(n)&&!/^Windows Phone /i.test(n)&&(a=a[/[\d.]+$/.exec(n)])&&(n="Windows "+a),n=String(n),i&&o&&(n=n.replace(RegExp(i,"i"),o)),e=m(n.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function B(e){return v(e,(function(e,r){var n=r.pattern||g(r);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),r=r.label||r,e=m(e[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function F(e){return v(e,(function(e,r){return e||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(L&&(L=[L]),/\bAndroid\b/.test(q)&&!U&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(U=y(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),D&&!U?U=B([D]):D&&U&&(U=U.replace(RegExp("^("+g(D)+")[-_.\\s]","i"),D+" ").replace(RegExp("^("+g(D)+")[-_.]?(\\w)","i"),D+" $2")),(s=/\bGoogle TV\b/.exec(U))&&(U=s[0]),/\bSimulator\b/i.test(t)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==V&&/\bOPiOS\b/.test(t)&&x.push("running in Turbo/Uncompressed mode"),"IE"==V&&/\blike iPhone OS\b/.test(t)?(D=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,U=s.product):/^iP/.test(U)?(V||(V="Safari"),q="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==V&&/^Linux\b/i.test(q)?q="Kubuntu":D&&"Google"!=D&&(/Chrome/.test(V)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(U))||/\bAndroid\b/.test(q)&&/^Chrome/.test(V)&&/\bVersion\//i.test(t)?(V="Android Browser",q=/\bAndroid\b/.test(q)?q:"Android"):"Silk"==V?(/\bMobi/i.test(t)||(q="Android",x.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&x.unshift("accelerated")):"UC Browser"==V&&/\bUCWEB\b/.test(t)?x.push("speed mode"):"PaleMoon"==V&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?x.push("identifying as Firefox "+s[1]):"Firefox"==V&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(q||(q="Firefox OS"),U||(U=s[1])):!V||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(V))?(V&&!U&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(V=null),(s=U||D||q)&&(U||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(q))&&(V=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(q)?q:s)+" Browser")):"Electron"==V&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&x.push("Chromium "+s),P||(P=F(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",g(V),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==L&&parseFloat(P)>3?"WebKit":/\bOpera\b/.test(V)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(t)&&("Mac OS"==q?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(V)&&"NetFront")&&(L=[s]),"IE"==V&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(V+=" Mobile",q="Windows Phone "+(/\+$/.test(s)?s:s+".x"),x.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(V="IE Mobile",q="Windows Phone 8.x",x.unshift("desktop mode"),P||(P=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=V&&"Trident"==L&&(s=/\brv:([\d.]+)/.exec(t))&&(V&&x.push("identifying as "+V+(P?" "+P:"")),V="IE",P=s[1]),O){if(function(e,t){var r=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!e[t])}(r,"global"))if(b&&(A=(s=b.lang.System).getProperty("os.arch"),q=q||s.getProperty("os.name")+" "+s.getProperty("os.version")),C){try{P=r.require("ringo/engine").version.join("."),V="RingoJS"}catch(j){(s=r.system)&&s.global.system==r.system&&(V="Narwhal",q||(q=s[0].os||null))}V||(V="Rhino")}else"object"==typeof r.process&&!r.process.browser&&(s=r.process)&&("object"==typeof s.versions&&("string"==typeof s.versions.electron?(x.push("Node "+s.versions.node),V="Electron",P=s.versions.electron):"string"==typeof s.versions.nw&&(x.push("Chromium "+P,"Node "+s.versions.node),V="NW.js",P=s.versions.nw)),V||(V="Node.js",A=s.arch,q=s.platform,P=(P=/[\d.]+/.exec(s.version))?P[0]:null));else f(s=r.runtime)==I?(V="Adobe AIR",q=s.flash.system.Capabilities.os):f(s=r.phantom)==S?(V="PhantomJS",P=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof k.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(P=[P,k.documentMode],(s=+s[1]+4)!=P[1]&&(x.push("IE "+P[1]+" mode"),L&&(L[1]=""),P[1]=s),P="IE"==V?String(P[1].toFixed(1)):P[0]):"number"==typeof k.documentMode&&/^(?:Chrome|Firefox)\b/.test(V)&&(x.push("masking as "+V+" "+P),V="IE",P="11.0",L=["Trident"],q="Windows");q=q&&m(q)}if(P&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(P)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(O&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(N=/b/i.test(s)?"beta":"alpha",P=P.replace(RegExp(s+"\\+?$"),"")+("beta"==N?_:E)+(/\d+\+?/.exec(s)||"")),"Fennec"==V||"Firefox"==V&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(q))V="Firefox Mobile";else if("Maxthon"==V&&P)P=P.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(q=null),"Xbox 360"==U&&/\bIEMobile\b/.test(t)&&x.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(V)&&(!V||U||/Browser|Mobi/.test(V))||"Windows CE"!=q&&!/Mobi/i.test(t))if("IE"==V&&O)try{null===r.external&&x.unshift("platform preview")}catch(j){x.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(t))&&(s=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||P)?(q=((s=[s,/BB10/.test(t)])[1]?(U=null,D="BlackBerry"):"Device Software")+" "+s[0],P=null):this!=h&&"Wii"!=U&&(O&&R||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==V&&/\bOS X (?:\d+\.){2,}/.test(q)||"IE"==V&&(q&&!/^Win/.test(q)&&P>5.5||/\bWindows XP\b/.test(q)&&P>8||8==P&&!/\bTrident\b/.test(t)))&&!c.test(s=e.call(h,t.replace(c,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),c.test(V)?(/\bIE\b/.test(s)&&"Mac OS"==q&&(q=null),s="identify"+s):(s="mask"+s,V=w?m(w.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(q=null),O||(P=null)),L=["Presto"],x.push(s));else V+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==V&&"+"==s[1].slice(-1)?(V="WebKit Nightly",N="alpha",P=s[1].slice(0,-1)):P!=s[1]&&P!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(P=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==L&&(L=["Blink"]),O&&(d||s[1])?(L&&(L[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),L&&(L[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==V&&(!P||parseInt(P)>45)?P=s:"Chrome"==V&&/\bHeadlessChrome/i.test(t)&&x.unshift("headless")),"Opera"==V&&(s=/\bzbov|zvav$/.exec(q))?(V+=" ",x.unshift("desktop mode"),"zvav"==s?(V+="Mini",P=null):V+="Mobile",q=q.replace(RegExp(" *"+s+"$"),"")):"Safari"==V&&/\bChrome\b/.exec(L&&L[1])?(x.unshift("desktop mode"),V="Chrome Mobile",P=null,/\bOS X\b/.test(q)?(D="Apple",q="iOS 4.3+"):q=null):/\bSRWare Iron\b/.test(V)&&!P&&(P=F("Chrome")),P&&0==P.indexOf(s=/[\d.]+$/.exec(q))&&t.indexOf("/"+s+"-")>-1&&(q=y(q.replace(s,""))),q&&-1!=q.indexOf(V)&&!RegExp(V+" OS").test(q)&&(q=q.replace(RegExp(" *"+g(V)+" *"),"")),L&&!/\b(?:Avant|Nook)\b/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||"Safari"!=V&&/^iOS/.test(q)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(V)&&L[1])&&(s=L[L.length-1])&&x.push(s),x.length&&(x=["("+x.join("; ")+")"]),D&&U&&U.indexOf(D)<0&&x.push("on "+D),U&&x.push((/^on /.test(x[x.length-1])?"":"on ")+U),q&&(s=/ ([\d.+]+)$/.exec(q),u=s&&"/"==q.charAt(q.length-s[0].length-1),q={architecture:32,family:s&&!u?q.replace(s[0],""):q,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!u?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(A))&&!/\bi686\b/i.test(A)?(q&&(q.architecture=64,q.family=q.family.replace(RegExp(" *"+s),"")),V&&(/\bWOW64\b/i.test(t)||O&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&x.unshift("32-bit")):q&&/^OS X/.test(q.family)&&"Chrome"==V&&parseFloat(P)>=39&&(q.architecture=64),t||(t=null);var G={};return G.description=t,G.layout=L&&L[0],G.manufacturer=D,G.name=V,G.prerelease=N,G.product=U,G.ua=t,G.version=V&&P,G.os=q||{architecture:null,family:null,version:null,toString:function(){return"null"}},G.parse=e,G.toString=function(){return this.description||""},G.version&&x.unshift(P),G.name&&x.unshift(V),q&&V&&(q!=String(q).split(" ")[0]||q!=V.split(" ")[0]&&!U)&&x.push(U?"("+q+")":"on "+q),x.length&&(G.description=x.join(" ")),G}();i&&o?h(I,(function(e,t){i[t]=e})):n.platform=I}).call(t)}));function Ym(){var e,t,r=Wm.version||"";if(Fm())try{var n=navigator.userAgent.match(/Electron\/([\d.]+\d+)/);n&&n[1]&&"string"==typeof n[1]&&(r=n[1])}catch(i){}return{os:(null===(e=Wm.os)||void 0===e?void 0:e.family)||"",osVer:(null===(t=Wm.os)||void 0===t?void 0:t.version)||"",browser:Wm.name||"",browserVer:Wm.version||"",libEnv:"BROWSER",hostEnv:Fm()?"Electron":Bm()?"H5":Gm()?"BROWSER":"Unset",hostEnvEnum:Fm()?5:Bm()?101:Gm()?100:0,hostEnvVer:r,userAgent:navigator&&navigator.userAgent,model:r,manufactor:Wm.name||""}}var Km=null,Qm=null,zm={getNetworkStatus:function(){return ls.resolve({net_type:0,net_connect:"undefined"==typeof navigator||"boolean"!=typeof navigator.onLine||navigator.onLine})},onNetworkStatusChange:function(e){Km=function(){e({isConnected:!0,networkType:0})},Qm=function(){e({isConnected:!1,networkType:0})},window.addEventListener("online",Km),window.addEventListener("offline",Qm)},offNetworkStatusChange:function(){Km&&window.removeEventListener("online",Km),Qm&&window.removeEventListener("offline",Qm),Km=null,Qm=null}},Jm=On.find,$m=!0;"find"in[]&&Array(1).find((function(){$m=!1})),rt({target:"Array",proto:!0,forced:$m},{find:function(e){return Jm(this,e,arguments.length>1?arguments[1]:void 0)}});var Xm=zt("Array").find,Zm=Array.prototype,eh=function(e){var t=e.find;return e===Zm||G(Zm,e)&&t===Zm.find?Xm:t},th="log",rh=function(){function e(e,t){this.db=null,this.stores=[],this.name=e,this.version=t}var t=e.prototype;return t.setName=function(e){this.name=e},t.getDB=function(){if(!this.db)throw new Error("DB not ready");return this.db},t.getStore=function(e){var t,r=eh(t=this.stores).call(t,(function(t){return t.storeName===e}));if(!r)throw new Error("LogStorage: store not found. "+e);return r},t.open=function(){var e=this,t=window.indexedDB.open(this.name,this.version);return new ls((function(r,n){t.onerror=function(e){var t=e.target;n(t.error)},t.onsuccess=function(t){var n,i,o=t.target;e.db=o.result,e.db.removeEventListener("close",Xt(n=e.triggerDBCloseEvt).call(n,e)),e.db.addEventListener("close",Xt(i=e.triggerDBCloseEvt).call(i,e)),e.stores.push(new nh(th,e)),r()},t.onupgradeneeded=function(t){var r=t.target;e.upgradeDBBySchema(r)}}))},t.triggerDBCloseEvt=function(){try{this.db&&this.db.close(),this.db=null}catch(e){}this.open()},t.upgradeDBBySchema=function(e){var t=e.result,r=e.transaction&&t.objectStoreNames.contains(th)?e.transaction.objectStore(th):t.createObjectStore(th,{keyPath:"id",autoIncrement:!0});try{r.index("time")}catch(n){r.createIndex("time","time",{unique:!1})}},t.close=function(){var e;this.db&&(this.db.removeEventListener("close",Xt(e=this.triggerDBCloseEvt).call(e,this)),this.db.close(),this.stores=[],this.db=null)},e}(),nh=function(){function e(e,t){this.idb=null,this.storeName=e,this.idb=t}var t=e.prototype;return t.getDB=function(){if(!this.idb)throw new Error("DB not ready");return this.idb.getDB()},t.getStoreName=function(){return this.storeName},t.bulkCreate=function(e){var t=this.getDB(),r=this.getStoreName(),n=t.transaction(r,"readwrite"),i=n.objectStore(r);return Bn(e).call(e,(function(e){i.add(e)})),new ls((function(e,t){n.oncomplete=function(){e()},n.onerror=function(e){var r=e.target;t(r.error)},n.onabort=function(e){var r=e.target;r.error instanceof Error?t(r.error):t(new Error("TransactionAborted"))}}))},t.bulkDelete=function(e){var t=e.keyName,r=e.lower,n=e.upper,i=e.lowerOpen,o=void 0!==i&&i,a=e.upperOpen,s=void 0!==a&&a,c=IDBKeyRange.bound(r,n,o,s),u=this.getDB(),d=this.getStoreName(),l=u.transaction(d,"readwrite"),p=l.objectStore(d).index(t).openCursor(c),m=0;return p.onsuccess=function(e){var t=e.target.result;t&&(t.delete(),m++,t.continue())},new ls((function(e,t){l.oncomplete=function(){e(m)},l.onerror=function(e){var r=e.target;t(r.error)},l.onabort=function(e){var r=e.target;r.error instanceof Error?t(r.error):t(new Error("TransactionAborted"))}}))},t.readAllAndClear=function(){var e=this.getDB(),t=this.getStoreName(),r=e.transaction(t,"readwrite").objectStore(t);if(!r.getAll)throw new Error("IDBExtract not support");var n=r.getAll();return new ls((function(e,t){n.onsuccess=function(t){var n=t.target;r.clear(),e(n.result)},n.onerror=function(e){var r=e.target;t(r.error)}}))},e}(),ih=function(){function e(e){void 0===e&&(e="nim-logs"),this.idb=new rh(e,1)}var t=e.prototype;return t.open=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e&&this.idb.setName(e),t.next=3,this.idb.open();case 3:return r=this.idb.getStore(th),t.prev=4,t.next=7,r.bulkDelete({keyName:"time",lower:0,upper:Ts()-2592e5});case 7:t.next=11;break;case 9:t.prev=9,t.t0=t.catch(4);case 11:case"end":return t.stop()}}),t,this,[[4,9]])})))},t.close=function(){this.idb.close()},t.addLogs=function(e){return this.idb.getStore(th).bulkCreate(e)},t.extractLogs=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i,o;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.idb.getStore(th),e.next=3,r.readAllAndClear();case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return","");case 6:return i=fl(n).call(n,(function(e,t){var r=t.iid;return e[r]||(e[r]=[]),e[r].push(t),e}),{}),o=au(t=pr(i)).call(t,(function(e){var t=i[e];return"==========iid:"+e+"==========\n "+au(t).call(t,(function(e){return e.text})).join("\n")})).join("\n"),e.abrupt("return",new File([o],"nim-logs.txt",{type:"text/plain"}));case 9:case"end":return e.stop()}}),e,this)})))},e}();function oh(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return ah(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ah(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ah(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var sh={},ch={};function uh(e,t,r,n){var i=sh[e];if(!i)return r.error("createCmd:: can not find cmd config: ",e),null;var o,a={SER:t,SID:i.sid,CID:i.cid,Q:[]};return i.params&&n&&Bn(o=i.params).call(o,(function(e){var t=n[e.name];if(null!=t){var r=e.type,i=e.reflectMapper,o=e.select;switch(e.type){case"PropertyArray":r="ArrayMable",t=au(t).call(t,(function(e){return{t:"Property",v:i?ph(e,i,o):e}}));break;case"Property":t=i?ph(t,i,o):t;break;case"Bool":t=t?"true":"false"}a.Q.push({t:r,v:t})}})),{packet:a,hasPacketResponse:"boolean"!=typeof i.hasPacketResponse||i.hasPacketResponse,hasPacketTimer:"boolean"!=typeof i.hasPacketTimer||i.hasPacketTimer}}function dh(e,t){var r,n;try{n=JSON.parse(e)}catch(p){return void t.error('Parse command error:"'+e+'"')}var i=n.sid+"_"+n.cid,o=n.r;if(tu(r=["4_1","4_2","4_10","4_11"]).call(r,i)){var a=n.r[1].headerPacket;i=a.sid+"_"+a.cid,n.sid=a.sid,n.cid=a.cid,o=n.r[1].body}var s=ch[i],c=[];if(s){for(var u,d=oh(s);!(u=d()).done;){var l=u.value;c.push(lh(n,l.config,l.cmd,o,t))}return c}t.error("parseCmd:: mapper not exist",i,n.code)}function lh(e,t,r,n,i){var o,a={cmd:r,raw:e,error:null,service:null==t?void 0:t.service,content:{},__receiveTimeNode:$p.getTimeNode()};if(!r||!t)return a.notFound=!0,a;(18===t.sid||t.sid>=26&&t.sid<100)&&(e.code=function(e){if("number"!=typeof e||e!=e)throw new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:""+e}});if(e<0||e>=0&&e<1e3||e>=2e4&&e<=20099)return e;var t=(65535&e)>>9;return 1e5+1e3*(t-=t<=38?1:2)+(511&e)}(e.code));var s,c,u,d,l,p=(c=e.code,u=r,d=Il[c],null===(l=kl[c])?null:new Tl({code:c,desc:d||l||c,detail:{cmd:u,timetag:Ts()}}));if(a.error=p,a.error){if(a.error.detail.cmd=r,!(null===(o=null==t?void 0:t.ignoreErrCodes)||void 0===o?void 0:tu(o).call(o,e.code)))return a;i.warn("parseCmd:: ignore error ",a.error),a.error.detail.ignore=!0}return t.response&&Bn(s=t.response).call(s,(function(e,t){var r=n[t],i=e.type,o=e.name,s=e.reflectMapper;if(void 0!==r)switch(i){case"Property":a.content[o]=s?mh(r,s):r;break;case"PropertyArray":a.content[o]=au(r).call(r,(function(e){return s?mh(e,s):e}));break;case"Int":case"Long":case"Byte":a.content[o]=+r;break;case"Bool":a.content[o]="true"===r||!0===r||1===r;break;default:a.content[o]=r}})),a}function ph(e,t,r){var n={};for(var i in e=function(e,t){var r={};for(var n in t){for(var i,o=t[n],a="number"==typeof o?n:o.access?o.access:n,s=e,c=oh(a.split("."));!(i=c()).done;){var u=i.value;if(void 0===s[u]||null===s[u]){s=void 0;break}s=s[u]}void 0!==s&&(r[a]=s)}return r}(e,t),t){var o=t[i],a="number"==typeof o?i:o.access?o.access:i;if(!r||tu(r).call(r,i))if(a in e){if("number"==typeof o)n[o]=e[a];else if("object"==typeof o)if(o.converter){var s=o.converter(e[a],e);void 0!==s&&(n[o.id]=s)}else n[o.id]=e[a]}else"object"==typeof o&&o.def&&("function"==typeof o.def?n[o.id]=o.def(e):n[o.id]=o.def)}return n}function mh(e,t){var r={};for(var n in e){var i=t[n];if("string"==typeof i)r[i]=e[n];else if("object"==typeof i&&"prop"in i){var o=i.access?i.access:i.prop;if(i.converter){var a=i.converter(e[n],e);void 0!==a&&(r[o]=a)}else i.type&&"number"===i.type?r[o]=+e[n]:i.type&&"boolean"===i.type?r[o]=!("0"===e[n]||!e[n]):r[o]=e[n]}}for(var s in t){var c=t[s];if(c&&void 0!==c.def){var u=c.access?c.access:c.prop;u in r||("function"==typeof c.def?r[u]=c.def(e):r[u]=c.def)}}return r=function(e){var t={},r=function(r){var n=r.split(".");fl(n).call(n,(function(t,i,o){return t[i]||(t[i]=isNaN(Number(n[o+1]))?n.length-1==o?e[r]:{}:[])}),t)};for(var n in e)r(n);return t}(r)}function hh(e){for(var t in sr(sh,e.cmdConfig),e.cmdMap){var r=e.cmdMap[t],n=e.cmdConfig[r];if(n)if(Si(ch[t])){for(var i,o=!1,a=oh(ch[t]);!(i=a()).done;){var s=i.value;if(s.cmd===r&&s.config.service===n.service){o=!0;break}}o||ch[t].push({config:n,cmd:r})}else ch[t]=[{config:n,cmd:r}]}}function fh(e){var t,r={};return Bn(t=pr(e)).call(t,(function(t){r[t]=gh(e[t])})),r}function gh(e){var t={};for(var r in e){var n=e[r];"number"==typeof n?t[n]=r:"object"==typeof n&&(t[n.id]={prop:r,type:n.retType,access:n.retAccess?n.retAccess:n.access?n.access:r,def:n.retDef,converter:n.retConverter})}return t}function vh(e){return e?1:0}function yh(e){if(e&&"object"==typeof e)try{return Ti(e)}catch(t){return}}function Ih(e){if(e&&"string"==typeof e)try{return JSON.parse(e)}catch(t){return}}var Mh,Th,Sh,bh,Ch,Eh={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"nimLoginClientChange","2_8":"kick"},_h={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,connectionId:102,ip:103,port:104,time:109,pushType:110,hasTokenPreviously:111},aosPushInfo:{pushType:110,hasTokenPreviously:111}},kh=fh(_h),Rh={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:_h.login}],response:[{type:"Property",name:"loginRes",reflectMapper:kh.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:kh.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:kh.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"ext"},{type:"Int",name:"customClientType"}]},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:kh.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}};function wh(e,t){if(!Yl(t))return{};var r=JSON.parse(Ti(t)),n=Ah(e,r);return JSON.parse(Ti(sr(sr({},r),n)))}function Ah(e,t){if(!Yl(t))return{};var r={},n=pr(e);return Bn(n).call(n,(function(n){var i=e[n].type;if("string"!=typeof i){var o=Ah(e[n],t);pr(o).length>0&&(r[n]=o)}else{var a=e[n],s=a.rawKey||n,c=xh[i](t,s,a);void 0!==c&&(t[s]=void 0,r[n]=c)}})),r}!function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(Mh||(Mh={})),function(e){e[e.p2p=0]="p2p",e[e.team=1]="team",e[e.superTeam=5]="superTeam"}(Th||(Th={})),function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac",e[e.HarmonyOS=65]="HarmonyOS"}(Sh||(Sh={})),function(e){e[e.unread=1]="unread",e[e.read=2]="read",e[e.deleted=3]="deleted",e[e.sending=4]="sending",e[e.sendFailed=5]="sendFailed",e[e.sent=6]="sent",e[e.receipt=7]="receipt",e[e.refused=10]="refused"}(bh||(bh={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(Ch||(Ch={}));var xh={number:function(e,t){if(void 0!==e[t])return+e[t]},string:function(e,t){if(void 0!==e[t])return e[t]},boolean:function(e,t){return+e[t]>0||0!=+e[t]&&void 0},enum:function(e,t,r){return gu(r)[e[t]]},object:function(e,t){if(void 0!==e[t])try{return JSON.parse(e[t])}catch(r){return{}}}};function Nh(e,t){if(!Yl(t))return{};var r=JSON.parse(Ti(t)),n=Oh(e,r);return JSON.parse(Ti(sr(sr({},r),n)))}function Oh(e,t){var r;if(!Yl(t))return fl(r=pr(e)).call(r,(function(t,r){return t[e[r].rawKey||r]=void 0,t}),{});var n={},i=pr(e);return Bn(i).call(i,(function(r){var i=e[r].type;if("string"!=typeof i){var o=Oh(e[r],t[r]);return sr(n,o),void(t[r]=void 0)}var a=e[r],s=a.rawKey||r,c=Ph[i](t,r,a);t[s]=void 0,n[s]=c})),n}var Ph={number:function(e,t){return e[t]},string:function(e,t){return e[t]},boolean:function(e,t){return!0===e[t]?1:!1===e[t]?0:void 0},enum:function(e,t,r){return gu(r)[e[t]]},object:function(e,t){if(void 0!==e[t])try{return Ti(e[t])}catch(r){return""}}},Lh=Ph;function Vh(e,t){return e&&e.length>0?au(e).call(e,(function(e){return sr(sr({},e),{account:e.account,connectionId:e.connectionId,deviceId:e.deviceId,ip:e.ip,mac:e.mac,os:e.os,type:bp(Sh,e.type)||e.type,time:Kp(e.time),online:3!==t})})):[]}var Uh={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}},Dh=qh;function qh(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}qh.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},qh.prototype.reset=function(){this.attempts=0},qh.prototype.setMin=function(e){this.ms=e},qh.prototype.setMax=function(e){this.max=e},qh.prototype.setJitter=function(e){this.jitter=e};var Bh,Fh=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],Gh=["transport not supported","client not handshaken","unauthorized"],jh=["reconnect"],Hh=function(e){function t(t,r){var n;return(n=e.call(this)||this).url=r,n.websocket=null,n.socketConnectTimer=0,n.core=t,n.url=r,n.status="disconnected",n.logger=t.logger,n.connect(),n}er(t,e);var r=t.prototype;return r.connect=function(){var e=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request("https://"+this.url+"/socket.io/1/?t="+Ts(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then((function(t){if("connecting"===e.status){var r=t.data.split(":"),n=r[0];return r[1],e.sessionId=n,e.logger.log("imsocket::XHR success. status "+e.status+", "+("connecting"===e.status?"continue websocket connection":"stop websocket connection")),e._createWebsocket("wss://"+e.url+"/socket.io/1/websocket/"+n)}})).catch((function(t){if("connecting"===e.status){var r='imsocket::XHR fail. raw message: "'+(t=t||{}).message+'", code: "'+t.code+'"',n=t.code;n="v2"===Qp(e.core,"options.apiVersion")?t.code===yl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?yl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:yl.V2NIM_ERROR_CODE_CONNECT_FAILED:408===t.code?408:415;var i=new Tl({code:n,detail:{reason:r,rawError:t}});e.logger.error(r),e.status="disconnected",e.emit("handshakeFailed",i)}}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},r.close=function(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(e){this.logger.warn("imsocket::attempt to send encodePacket error",e)}try{this.websocket.close()}catch(e){this.logger.warn("imsocket::attempt to close websocket error",e)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}},r.clean=function(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},r.onConnect=function(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},r._createWebsocket=function(e){var t,r=this;this.socketConnectTimer=Ls((function(){r.logger.error("imsocket::Websocket connect timeout. url: ",r.socketUrl),r.emit("handshakeFailed",new Tl({code:"v2"===Qp(r.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+r.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new Ql.WebSocket(e),this.websocket.onmessage=Xt(t=this.onMessage).call(t,this),this.websocket.onclose=function(e){var t=(null==e?void 0:e.reason)||(null==e?void 0:e.message)||(null==e?void 0:e.errMsg)||"websocket.onclose";r.logger.log("imsocket::Websocket onclose done. code is "+(null==e?void 0:e.code)+" and reason is "+t),r.clean(),r.emit("disconnect",{code:(null==e?void 0:e.code)||0,reason:t})},this.websocket.onerror=function(e){r.logger.error("imsocket::Websocket onerror",e),"logined"===r.core.status&&r.core.clientSocket.ping()}},r.onMessage=function(e){var t,r=this.decodePacket(e.data);if(r)switch(r.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",r.data);break;case"event":r.name&&this.emit(r.name,r.args);break;case"error":"unauthorized"===r.reason?this.emit("connect_failed",r.reason):this.emit("error",r.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new Tl({code:"v2"===Qp(this.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:"imsocket::Websocket connect failed, onMessage socket error. url: "+this.socketUrl}}));break;case"heartbeat":null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",r.type)}},r.encodePacket=function(e){var t,r,n=e.type,i=e.id,o=void 0===i?"":i,a=e.endpoint,s=void 0===a?"":a,c=e.ack,u=null;if(!n)return"";switch(n){case"error":t=e.reason?bu(Gh).call(Gh,e.reason):"",r=e.advice?bu(jh).call(jh,e.advice):"",""===t&&""===r||(u=t+(""!==r?"+"+r:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":t={name:e.name},t=e.args&&e.args.length?{name:e.name,args:e.args}:{name:e.name},u=Ti(t);break;case"json":u=Ti(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+Ti(e.args):"")}var d=[bu(Fh).call(Fh,n),o+("data"===c?"+":""),s];return null!=u&&d.push(u),d.join(":")},r.decodePacket=function(e){if(e)if("�"!=e.charAt(0)){var t=e.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(t){var r,n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c={type:Fh[+n],endpoint:a};switch(i&&(c.id=i,c.ack=!o||"data"),c.type){case"error":r=s.split("+"),c.reason=Gh[+r[0]]||"";break;case"message":c.data=s||"";break;case"connect":c.qs=s||"";break;case"event":try{var u=JSON.parse(s);c.name=u.name,c.args=u.args}catch(d){this.logger.error("imsocket::parseData::type::event error",d)}c.args=c.args||[];break;case"json":try{c.data=JSON.parse(s)}catch(d){this.logger.error("imsocket::parseData::type::json error",d)}break;case"ack":if((r=s.match(/^([0-9]+)(\+)?(.*)/))&&(c.ackId=r[1],c.args=[],r[3]))try{c.args=r[3]?JSON.parse(r[3]):[]}catch(d){this.logger.error("imsocket::parseData::type::ack error",d)}}return c}}else this.logger.error("imsocket::unrecognize dataStr",Fc(e).call(e,0,20))},r.send=function(e){var t,r={data:e,type:"message",endpoint:""};null===(t=this.websocket)||void 0===t||t.send(this.encodePacket(r))},t}(Vs);function Wh(e){e=e||[];for(var t=[],r=0;r<e.length;r++)-1===bu(t).call(t,e[r])&&t.push(e[r]);return t}function Yh(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return Kh(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kh(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Kh(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Bh||(Bh={}));var Qh=function(){function e(e,t){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new Dh({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new rd,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,t&&(this.auth=t),this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager}var t=e.prototype;return t.setSessionId=function(e){},t.connect=function(e,t){return void 0===e&&(e={}),Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Al({linkUrls:{type:"array",itemType:"string",required:!1}},e),/^(unconnected|waitReconnect)$/.test(this.core.status)){r.next=5;break}return n="Core socket status is "+this.core.status+", and would not connect",this.logger.warn(n),r.abrupt("return",ls.reject(n));case 5:this.core.status="connecting",e.linkUrls&&e.linkUrls.length>0&&(this.linkUrls=Rs(i=e.linkUrls).call(i,this.linkUrls),this.linkUrls=Wh(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push(Np),o=0;case 9:if(!(o<this.linkUrls.length)){r.next=31;break}return a=this.linkUrls[o],s=(new Date).getTime(),r.prev=12,r.next=15,this.doConnect(a);case 15:return this.core.status="connected",this.logger.log("clientsocketV1::connect success with url: "+a),r.abrupt("return",a);case 20:r.prev=20,r.t0=r.catch(12),c=r.t0,t&&t(c,a),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:s,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof c.code?c.code:0,description:c.message||""+c.code,operation_type:0,target:a},{asyncParams:Ql.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("clientsocketV1::connect failed with url: "+a,r.t0);case 28:o++,r.next=9;break;case 31:throw 0===this.retryCount?this.doDisconnect(Bh.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(Bh.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed");case 33:case"end":return r.stop()}}),r,this,[[12,20]])})))},t.doConnect=function(e){var t=this,r=!1;return new ls((function(n,i){var o;t.socket=new Hh(t.core,e),t.socket.on("connect",(function(){t.logger.log("clientSocketV1::on connect",e),t.core.reporterHookLinkKeep&&(t.core.reporterHookLinkKeep.start(),t.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e})),r=!0,n()})),t.socket.on("message",Xt(o=t.onMessage).call(o,t)),t.socket.on("disconnect",(function(n){return Wl(t,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.logger.log("clientSocketV1::socket on disconnect",n),!this.core.reporterHookLinkKeep){t.next=5;break}return t.next=4,this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e});case 4:this.core.reporterHookLinkKeep.end(!1);case 5:r=!0,this.doDisconnect(Bh.OFFLINE,"SocketOnDisconnect");case 7:case"end":return t.stop()}}),t,this)})))})),t.socket.on("handshakeFailed",(function(e){r?t.ping():(t.logger.error('clientsocketV1::handshake failed: "'+(e&&e.message)+'"'),t.cleanSocket()),r=!0,i(e)}))}))},t.cleanSocket=function(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.beforeConnect=function(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.resetConnectStatus=function(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},t.doDisconnect=function(e,t,r){var n,i,o,a,s;if(this.logger.log("doDisconnect: type "+e+", description "+t),"unconnected"!==this.core.status){var c={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new Tl({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var u=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(e===Bh.ACTIVE||u)this.logger.log("doDisconnect: emit disconnect, type "+e,u),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(n=this.auth)||void 0===n||n.emit("disconnect"),this.destroyOnlineListener();else if(e===Bh.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var d="string"==typeof t?{reason:"unknow",message:t}:t;this.core.eventBus.emit("kicked",d),this.core.emit("kicked",d),null===(i=this.auth)||void 0===i||i.emit("kicked",d),this.destroyOnlineListener()}else e===Bh.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):e===Bh.OFFLINE&&(null===(a=null===(o=this.auth)||void 0===o?void 0:o.authenticator)||void 0===a?void 0:a.checkLoginTerminalCode(null==r?void 0:r.code))?(this.logger.log("doDisconnect: login terminal code "+(null==r?void 0:r.code)+", no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(s=this.auth)||void 0===s||s.emit("disconnect")):e===Bh.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},t.attempToReconnect=function(){var e,t,r=this;if("waitReconnect"!==this.core.status){0===this.retryCount&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(e=this.auth)||void 0===e||e.emit("disconnect"));var n=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+n),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:n}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:n}),null===(t=this.auth)||void 0===t||t.emit("willReconnect",{retryCount:this.retryCount,duration:n}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=Ls((function(){return Wl(r,void 0,void 0,jl.mark((function e(){var t=this;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("waitReconnect"===this.core.status){e.next=3;break}return this.logger.warn("doDisconnect: reconnectTimer status is "+this.core.status+", would not go on reconnecting"),e.abrupt("return");case 3:return e.next=5,Ql.net.getNetworkStatus();case 5:!1===e.sent.net_connect?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(Bh.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}));case 7:case"end":return e.stop()}}),e,this)})))}),n)}else this.logger.warn("doDisconnect: already is waiting reconnect")},t.sendCmd=function(e,t,r){var n=this;if("logined"!==this.core.status&&"login"!==e&&"chatroomLogin"!==e&&"qchatLogin"!==e)return this.logger.warn("instance status is "+this.core.status+", so can not sendCmd "+e),ls.reject({cmd:e,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return ls.reject("No_socket");var i="heartbeat"!==e,o=i?this.packetSer++:0,a=uh(e,o,this.logger,t);if(!a){var s="SendCmd "+o+" "+e+" error";return this.logger.error(s),ls.reject(new Error(s))}var c=a.packet,u=a.hasPacketResponse,d=a.hasPacketTimer,l=Ti(c);i&&(this.logger.getDebugMode()?this.logger.debug("clientsocketV1::sendCmd",e,"ser:"+o,l):this.logger.log("clientsocketV1::sendCmd",e,"ser:"+o));var p=(new Date).getTime();return new ls((function(i,a){u&&n.sendingCmdMap.set(o,{cmd:e,params:t,callback:[i,a],timer:d?Ls((function(){var t=new Tl({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:e,ser:o,timetag:Ts()}});n.markCmdInvalid(o,t,e)}),r&&r.timeout?r.timeout:n.core.config.timeout):null});try{n.socket.send(l),u||i(c)}catch(p){var s=new Tl({code:415,detail:{reason:p&&p.message||"Unable to send packet",cmd:e,ser:o,timetag:Ts(),rawError:p}});n.markCmdInvalid(o,s,e),a(p)}})).catch((function(e){var t,r=[408,415];if(!tu(r).call(r,e.code))return ls.reject(e);n.reporter.reportTraceStart("exceptions",{user_id:n.core.options.account,trace_id:null===(t=n.socket)||void 0===t?void 0:t.sessionId,start_time:p,action:2,exception_service:6});var i=Qp(e,"data.disconnect_reason")||"",o=408===e.code?"Send failed due to timeout":"Send failed. Reason unknown";return o=415===e.code?Ti({disconnect_reason:i}):o,n.reporter.reportTraceUpdateV2("exceptions",{code:e.code||415,description:o,operation_type:1,target:c.SID+"-"+c.CID,context:""+c.SER},{asyncParams:Ql.net.getNetworkStatus()}),n.reporter.reportTraceEnd("exceptions",1),ls.reject(e)}))},t.onMessage=function(e){var t=dh(e,this.logger);if(t)for(var r,n=Yh(t);!(r=n()).done;){var i=r.value,o=i.raw.ser;if(i.error&&this.logger.error("core:onMessage packet error",i.raw.sid+"_"+i.raw.cid+", ser:"+o+",",i.error),i.notFound)return void this.logger.warn("clientsocketV1::onMessage packet not found",i.raw.sid+"_"+i.raw.cid+", ser:"+o);"heartbeat"!==i.cmd&&(this.logger.getDebugMode()?this.logger.debug("imsocket::recvCmd ser:"+o,i.cmd,i.content):this.logger.log("imsocket::recvCmd ser:"+o,i.cmd)),this.packetHandler(i)}},t.packetHandler=function(e){var t,r,n=this;if(e){var i=e.raw.ser,o=this.sendingCmdMap.get(i);if(o&&o.cmd===e.cmd){var a=o.callback,s=o.timer,c=o.params;if(clearTimeout(s),e.params=c,this.sendingCmdMap.delete(i),"heartbeat"===e.cmd)return void a[0]();var u=null===(t=this.core[e.service])||void 0===t?void 0:t.process(e);u&&"function"==typeof u.then?u.then((function(e){a[0](e)})).catch((function(e){a[1](e)})):(this.logger.log("imsocket:: handlerFn without promise",e.service,e.cmd),a[0]())}else{var d=null===(r=this.core[e.service])||void 0===r?void 0:r.process(e);d&&"function"==typeof d.then&&d.catch((function(e){n.logger.error("imsocket::no obj cache, no process handler",e)}))}}},t.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("packet "+e+", "+r+" is invalid:",t),i[1](t)}},t.markAllCmdInvaild=function(e){var t,r=this;this.logger.log("markAllCmdInvaild",e),Bn(t=this.sendingCmdMap).call(t,(function(t){var n=t.callback,i=t.timer,o=t.cmd;r.logger.log('markAllCmdInvaild:: cmd "'+o+'"'),i&&clearTimeout(i),n[1](e)})),this.sendingCmdMap.clear()},t.ping=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){var r=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.pingTimer),t.prev=1,t.next=4,this.sendCmd("heartbeat");case 4:t.next=18;break;case 6:return t.prev=6,t.t0=t.catch(1),t.next=10,this.testHeartBeat5Timeout();case 10:if(!t.sent){t.next=18;break}if(!this.core.reporterHookLinkKeep){t.next=16;break}return t.next=15,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url});case 15:this.core.reporterHookLinkKeep.end(!0);case 16:return this.doDisconnect(Bh.OFFLINE,"PingError"),t.abrupt("return");case 18:this.pingTimer=Ls((function(){r.ping()}),3e4);case 19:case"end":return t.stop()}}),t,this,[[1,6]])})))},t.testHeartBeat5Timeout=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.log("clientsocketV1:: test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.initOnlineListener=function(){var e=this;this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,Ql.net.onNetworkStatusChange((function(t){e.logger.log("clientsocketV1::onlineListener:network change",t),t.isConnected&&"logined"===e.core.status?e.ping():t.isConnected&&"waitReconnect"===e.core.status?(e.reconnectTimer&&clearTimeout(e.reconnectTimer),e.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){e.logger.error("clientsocketV1::attempToReconnect failed "+e.retryCount)}))):t.isConnected||e.doDisconnect(Bh.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function(){this.logger.log("clientsocketV1::onlineListener:destroy"),Ql.net.offNetworkStatusChange(),this.hasNetworkListener=!1},t.disconnect=function(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(Bh.ACTIVE,"UserActiveDisconnect"),ls.resolve();default:return ls.resolve()}},e}(),zh=function(){function e(e){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=e,this.auth=e.V1NIMLoginService,this.logger=this.core.logger}var t=e.prototype;return t.getLbsInfos=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.socketLinkUrls.length>0)){e.next=5;break}return t=this.socketLinkUrls,this.socketLinkUrls=[],this.core.logger.log("V1NIMLoginService::getLbsInfos:use cache link",t),e.abrupt("return",ls.resolve(t));case 5:return this.core.reporterHookLBS.start(this.core.account),r=Wh(this.auth.config.lbsUrls),e.prev=7,e.next=10,this.ladderLoad(r);case 10:if(200===(n=e.sent).status&&n.data){e.next=14;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",n.status,n),new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V1NIMLoginService::getLbsInfos failed, status "+n.status}});case 14:this.success(n),e.next=25;break;case 17:if(e.prev=17,e.t0=e.catch(7),i=e.t0,this.core.logger.error("V1NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",e.t0),this.reportForFail(r[0],i.code,i.message),!this.checkTerminator(i.code)){e.next=24;break}throw e.t0;case 24:this.socketLinkUrls=[this.auth.config.linkUrl];case 25:return e.abrupt("return",this.socketLinkUrls);case 26:case"end":return e.stop()}}),e,this,[[7,17]])})))},t.checkTerminator=function(e){return e===yl.V2NIM_ERROR_CODE_CANCELLED||e===yl.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function(e){return e+(bu(e).call(e,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function(e){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(e),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function(e,t,r,n){var i=this;this.timer&&clearTimeout(this.timer);var o=e[t];this.timer=Ls((function(){o&&(i.setLadderTimer(e,t+1,r,n),i.core.logger.log("V1NIMLoginService::getLbsInfos "+t+":",o),i.reportForLbsStart(o,t),i.requstLbs(o).then((function(e){i.reset(),r(sr(sr({},e),{url:o}))})).catch((function(r){var a;if(i.core.logger.warn("V1NIMLoginService::getLbsInfos "+t+" failed:",r),i.failedCount+=1,i.reportForFailOnce(o,r.code,(null===(a=r.detail)||void 0===a?void 0:a.reason)||r.message),i.failedCount>=e.length||i.checkTerminator(r.code))return i.reset(),void n(r)})))}),2e3)},t.ladderLoad=function(e){var t=this;return new ls((function(r,n){e.length>1&&t.setLadderTimer(e,1,r,n);var i=e[0];t.core.logger.log("V1NIMLoginService::getLbsInfos 0:",i),t.reportForLbsStart(i,0),t.requstLbs(i).then((function(e){t.reset(),r(sr(sr({},e),{url:i}))})).catch((function(r){var o;t.failedCount+=1,t.core.logger.warn("V1NIMLoginService::getLbsInfos 0 failed:",r),t.reportForFailOnce(i,r.code,(null===(o=r.detail)||void 0===o?void 0:o.reason)||r.message),(t.failedCount>=e.length||t.checkTerminator(r.code))&&(t.reset(),n(r))}))}))},t.success=function(e){var t,r,n,i,o=e.data,a=[this.auth.config.linkUrl];Qp(o,"common.link")&&(a=Rs(i=Qp(o,"common.link")).call(i,a)),Qp(o,'common["link.default"]')&&(a=Rs(a).call(a,Qp(o,'common["link.default"]'))),this.socketLinkUrls=a,o["nos-chunk"]&&(this.logger.log("getLbsInfos success. lbs.nos-chunk",o["nos-chunk"]),null===(r=this.core.cloudStorage)||void 0===r||r.setOptions({chunkUploadHost:o["nos-chunk"]})),Si(o.nosup)&&o.nosup.length>0&&(this.logger.log("getLbsInfos success. lbs.nosup",o.nosup),null===(n=this.core.cloudStorage)||void 0===n||n.setOptions({commonUploadHostBackupList:o.nosup,commonUploadHost:o.nosup[0]})),this.core.logger.log("V1NIMLoginService::getLbsInfos success, socket link:",Fc(t=this.socketLinkUrls).call(t,0),"chunkUploadHost: ",e.data["nos-chunk"]),this.reportForLbsSuccess(e.url,e.data)},t.reportForLbsStart=function(e,t){this.core.reporterHookLBS.updateBegin({target:e,index:t})},t.reportForLbsSuccess=function(e,t){this.core.reporterHookLBS.updateComplete({target:e,code:200,body:Ti(t)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,code:200,succeed:!0},{asyncParams:Ql.net.getNetworkStatus()})},t.reportForFailOnce=function(e,t,r){this.core.reporterHookLBS.updateComplete({target:e,code:t,body:r})},t.reportForFail=function(e,t,r){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,description:r,code:t,succeed:!1},{asyncParams:Ql.net.getNetworkStatus()})},t.reset=function(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},e}(),Jh=function(){function e(e){this.core=e}var t=e.prototype;return t.verifyAuthentication=function(e){var t,r,n;return void 0===e&&(e=!1),Wl(this,void 0,void 0,jl.mark((function i(){var o,a,s,c,u,d,l,p,m,h,f,g;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=this.core.options,s=Ql.getSystemInfo(),c=sr(sr({},a),{appLogin:e?0:1,appkey:a.appkey,account:a.account,token:a.token,deviceId:this.core.auth.deviceId,clientSession:this.core.auth.clientSession,clientType:16,protocolVersion:1,sdkVersion:100700,sdkHumanVersion:"10.7.0",os:s.os,browser:s.browser,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.7.0":Fc(o=s.userAgent.replace("{{appkey}}",a.appkey)).call(o,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:s.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:s.hostEnvEnum}),u=s.os.toLowerCase(),"UNIAPP"!==Ql.platform||"ios"!==u&&"android"!==u||(c.isReactNative=1,c.clientType="ios"===u?2:1,d=!!(null===(t=this.core.offlinePush.authConfig)||void 0===t?void 0:t.honorCertificateName),s.pushDeviceInfo&&s.pushDeviceInfo.MANUFACTURER&&(c.deviceInfo=Ti(sr({IS_SUPPORT_HONOR:d},s.pushDeviceInfo)))),this.core.logger.log("clientSocketV1::do login ",a.account,null===(n=null===(r=this.core.clientSocket)||void 0===r?void 0:r.socket)||void 0===n?void 0:n.sessionId),i.next=8,this.core.clientSocket.sendCmd("login",{login:c});case 8:if(!(l=i.sent).error){i.next=11;break}throw l.error;case 11:return p=l.content,m=p.loginRes,h=p.loginPorts,f=p.aosPushInfo,g=Vh(h,2),(g=lu(g).call(g,(function(e){return e.connectionId!==m.connectionId}))).length>0&&this.core.emit("multiPortLogin",g),i.abrupt("return",sr(sr({},m),{aosPushInfo:f}));case 16:case"end":return i.stop()}}),i,this)})))},t.checkLoginTerminalCode=function(e){if(void 0===e)return!1;var t=[201,302,317,403,404,417,422];return tu(t).call(t,e)},e}(),$h=function(e){function t(t,r){var n;return(n=e.call(this)||this).name=t,n.logger=r.logger,n.core=r,n}er(t,e);var r=t.prototype;return r.checkV2=function(){var e=this.core.options.apiVersion;if("v2"===e)return!0;throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'The version "'+e+'" of client is not supported.'}})},r.checkLogin=function(){if(1!==this.core.V2NIMLoginService.getLoginStatus())throw new Tl({code:yl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"The client is not logged in."}})},r.emit=function(t){for(var r=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];this.logger.debug(this.name+"::emit event: '"+t.toString()+"',",void 0!==i[0]?i[0]:"",void 0!==i[1]?i[1]:"",void 0!==i[2]?i[2]:"");try{var a,s;return(a=e.prototype.emit).call.apply(a,Rs(s=[this,t]).call(s,i))}catch(c){return Ls((function(){throw r.logger.error(r.name+"::emit throw error in setTimeout. event: "+t.toString()+". Error",c),c}),0),!1}},r.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t){if(e.error)return this.logger.error(e.cmd+"::recvError",e.error),ls.reject(e.error);try{var r=t.call(this,e);return ls.resolve(r)}catch(i){return ls.reject(i)}}var n=Qp(e,"error.detail.ignore");return e.error&&!n?ls.reject(e.error):ls.resolve(e)},t}(Vs),Xh=function(){function e(e,t){this.name=e,this.core=t,this.name=e,this.logger=t.logger,this.core=t}return e.prototype.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var r=Qp(e,"error.detail.ignore");return e.error&&!r?ls.reject(e.error):ls.resolve(e)},e}(),Zh={"6_3":"notifylog","6_4":"uploadLog","6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect"},ef={type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},tf={notifylog:{sid:6,cid:3,service:"misc"},uploadLog:{sid:6,cid:4,service:"misc",hasPacketResponse:!1,params:[{type:"String",name:"url"},{type:"Property",name:"data",reflectMapper:{type:1,content:2}}]},getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:gh(ef)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:ef}]}},rf={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}},nf=function(e){function t(t){var r;return(r=e.call(this,"misc",t)||this).core=t,hh({cmdMap:Zh,cmdConfig:tf}),r.setListener(),r}er(t,e);var r=t.prototype;return r.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.core.timeOrigin.setOriginTimetick()})),this.core.eventBus.on("logined",(function(){e.core.timeOrigin.setOriginTimetick()}))},r.getServerTime=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.clientSocket.sendCmd("getServerTime");case 2:return t=e.sent,e.abrupt("return",Kp(t.content.time));case 4:case"end":return e.stop()}}),e,this)})))},r.notifyDetectHandler=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.content.data,(r=wh(rf,n)).t3=e.__receiveTimeNode.time,r.t4=Ts(),t.prev=3,t.next=6,this.core.clientSocket.sendCmd("uploadDetect",{data:r});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),this.core.logger.warn("misc::notifyDetectHandler:upload failed",t.t0);case 11:case"end":return t.stop()}var n}),t,this,[[3,8]])})))},r.notifylogHandler=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.prev=1,e.next=4,this.core.logger.extractLogs();case 4:t=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return");case 10:if(t){e.next=12;break}return e.abrupt("return");case 12:if("string"!=typeof t){e.next=14;break}return e.abrupt("return");case 14:return r="",e.prev=15,e.next=18,this.core.cloudStorage.uploadFile({type:"file",file:t});case 18:n=e.sent,r=n.url,e.next=25;break;case 22:return e.prev=22,e.t1=e.catch(15),e.abrupt("return");case 25:if(r){e.next=27;break}return e.abrupt("return");case 27:return r+=(bu(r).call(r,"?")>0?"&":"?")+"download="+(new Date).getTime()+"_web.log",e.prev=28,e.next=31,this.core.clientSocket.sendCmd("uploadLog",{url:r});case 31:e.next=36;break;case 33:return e.prev=33,e.t2=e.catch(28),e.abrupt("return");case 36:case"end":return e.stop()}}),e,this,[[1,7],[15,22],[28,33]])})))},t}(Xh),of={needReconnect:!0,reconnectionAttempts:tr,lbsUrls:Op,linkUrl:Np,xhrConnectTimeout:8e3,socketConnectTimeout:8e3},af=function(e){function t(t,r){var n;(n=e.call(this,"V1NIMLoginService",t)||this).account="",n.token="",n.deviceId="",n.processId="",n.clientSession="",n.status="unconnected",n.config=of,n.isManualLoginAttempt=!1,n.core._registerDep(nf,"misc"),hh({cmdMap:Eh,cmdConfig:Rh}),t.V1NIMLoginService=st(n),r&&n.setOptions(r);var i=new Qh(n.core,st(n));return n.clientSocket=i,"v1"===n.core.options.apiVersion&&(n.core.clientSocket=i,n.core.auth=st(n)),n.lbs=new zh(t),n.authenticator=new Jh(t),n.doLoginStepsManager=new qp,n}er(t,e);var r=t.prototype;return r.reset=function(){this.lbs.reset()},r.setOptions=function(e){e&&pr(e).length>0?(this.config=_p(this.config,e),this.account=e.account||this.core.options.account,this.token=e.token||this.core.options.token,this.core.options=sr(sr({},this.core.options),this.config)):(this.config=_p(this.core.options,this.config),this.account=this.core.options.account,this.token=this.core.options.token);var t="",r="";this.config.isFixedDeviceId?(t=Ql.localStorage.getItem("__NIM_DEVC_ID__")||Tp(),r=Ql.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||Tp(),Ql.localStorage.setItem("__NIM_DEVC_ID__",t),Ql.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",r)):(t=Tp(),r=Tp()),this.deviceId=t,this.clientSession=r,this.core.reporter.setConfig({common:{dev_id:t}})},r.connect=function(e){return void 0===e&&(e={}),this.login(e)},r.login=function(e){return void 0===e&&(e={}),Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkApiVersion(),e.isAutoReconnect||(this.isManualLoginAttempt=!0,this.processId=Tp()),t.next=4,this._connect(e);case 4:return this.core.abtest.abtRequest(),t.prev=5,t.next=8,this.doLogin(e.isAutoReconnect);case 8:this.processId=Tp(),this.isManualLoginAttempt=!1,t.next=16;break;case 12:throw t.prev=12,t.t0=t.catch(5),this.isManualLoginAttempt=!1,t.t0;case 16:case"end":return t.stop()}}),t,this,[[5,12]])})))},r._connect=function(e){return void 0===e&&(e={}),Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.core.status)){t.next=4;break}return r="NIM status is "+this.core.status+", and would not connect",this.logger.warn(r),t.abrupt("return",ls.reject(r));case 4:return this.clientSocket.beforeConnect(),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",{user_id:this.core.options.account,action:e.isAutoReconnect?"auto_login":"manual_login",binary_websocket:!1,process_id:this.processId}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:Ti(sr(sr({},this.core.options),{account:"***",token:"***"})),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:Ql.net.getNetworkStatus()}),t.next=10,this.lbs.getLbsInfos();case 10:return n=t.sent,t.prev=11,t.next=14,this.clientSocket.connect({linkUrls:n,isAutoReconnect:e.isAutoReconnect},(function(e,t){o.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:e.code||408,description:"ws_handshake_failed:"+e.message,succeed:!1},{asyncParams:Ql.net.getNetworkStatus()})}));case 14:(i=t.sent)&&this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:i,code:200,succeed:!0},{asyncParams:Ql.net.getNetworkStatus()}),t.next=22;break;case 18:throw t.prev=18,t.t0=t.catch(11),this.core.reporter.reportTraceEnd("login",!1),t.t0;case 22:case"end":return t.stop()}}),t,this,[[11,18]])})))},r.doLogin=function(e){return void 0===e&&(e=!1),Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.authenticator.verifyAuthentication(e);case 3:r=t.sent,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:200,succeed:!0},{asyncParams:Ql.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!0),this.core.status="logined",t.next=21;break;case 9:if(t.prev=9,t.t0=t.catch(0),n=t.t0,i=Qp(n,"data.disconnect_reason")||"",o=415===n.code?Ti({disconnect_reason:i}):n.message,this.core.logger.warn("nim login:: login failed",t.t0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:n.code||0,succeed:!1,description:o},{asyncParams:Ql.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!1),this.clientSocket.doDisconnect(Bh.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed",t.t0),!this.isManualLoginAttempt){t.next=20;break}throw t.t0;case 20:return t.abrupt("return");case 21:return t.prev=21,t.next=24,this.core.cloudStorage.init();case 24:t.next=29;break;case 26:t.prev=26,t.t1=t.catch(21),this.core.logger.error("NIM:login cloudStorage init failed ",t.t1);case 29:this.core.eventBus.emit("logined",r),this.core.emit("logined",r),this.emit("logined",r),this.core.logger.log("login done"),this.clientSocket.resetConnectStatus(),this.clientSocket.ping();case 35:case"end":return t.stop()}}),t,this,[[0,9],[21,26]])})))},r.disconnect=function(){return this.logout()},r.logout=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),e.t0=this.status,e.next="logined"===e.t0?5:"connected"===e.t0||"connecting"===e.t0||"waitReconnect"===e.t0?18:"unconnected"===e.t0||"destroyed"===e.t0?21:22;break;case 5:return e.prev=5,e.next=8,this.clientSocket.sendCmd("logout",void 0,{timeout:1e3});case 8:this.clientSocket.doDisconnect(Bh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),e.next=17;break;case 12:e.prev=12,e.t1=e.catch(5),this.logger.error("Instance::disconnect sendCmd:logout error",e.t1),this.clientSocket.doDisconnect(Bh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData();case 17:return e.abrupt("break",22);case 18:return this.clientSocket.doDisconnect(Bh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),e.abrupt("return",ls.resolve());case 21:return e.abrupt("return",ls.resolve());case 22:case"end":return e.stop()}}),e,this,[[5,12]])})))},r.kick=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this._checkApiVersion(),r.next=3,this.clientSocket.sendCmd("kick",e);case 3:return n=r.sent,r.abrupt("return",null===(t=n.content)||void 0===t?void 0:t.deviceIds);case 5:case"end":return r.stop()}}),r,this)})))},r._checkApiVersion=function(){if("v1"!==this.core.options.apiVersion)throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v1"'}})},r.nimLoginClientChangeHandler=function(e){if(e.error)this.logger.error("nimLoginClientChangeHandler:: error, ",e.error);else{var t=e.content,r=Vh(t.datas,t.state);r.length>0&&(this.core.emit("multiPortLogin",r),this.emit("multiPortLogin",r))}},r.kickedHandler=function(e){if(e.error)this.logger.error("kickedHandler:: error, ",e.error);else{var t=(r=e.content,n=wh({clientType:{type:"enum",values:Sh},customClientType:{type:"number"}},r),i=Uh[n.reason],sr(n,i=i||{reason:"unknow",message:"Unknown reason"}));this.logger.warn("kicked::",t),this.clientSocket.doDisconnect(Bh.KICKED,t),this.core._clearModuleData()}var r,n,i},r.getConnectStatus=function(){switch(this.core.status){case"unconnected":case"destroyed":default:return 0;case"connecting":return 2;case"connected":case"logined":return 1;case"waitReconnect":return 3}},r.getLoginStatus=function(){switch(this.core.status){case"unconnected":case"destroyed":case"waitReconnect":default:return 0;case"connecting":case"connected":return 2;case"logined":return 1}},r.getLoginUser=function(){return this.core.options.account},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Rs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Rs(o=[this,t]).call(o,c))},t}($h);function sf(e){return wh({type:{type:"number"},port:{type:"number"},customClientType:{type:"number"},timestamp:{type:"number"},loginType:{type:"number"}},e)}function cf(e){e=e||{};var t={};for(var r in e)t[e[r]]=r;return t}var uf={"26_3":"v2Login","26_5":"v2Logout","26_8":"v2KickOffline","26_9":"v2BeKicked","26_10":"v2LoginClientChange","36_1":"v2GetChatroomLinkAddress"},df={"1_2":"heartbeat","2_7":"nimLoginClientChange","24_8":"qchatLoginClientChange"},lf={webLoginReqTag:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,clientId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,thirdPartyExtension:116,token:1e3},mixAuthRepTag:{clientId:1,consid:2,clientIP:3,port:4,type:5,customClientType:6,timestamp:7,customTag:8,os:9,pushType:10,hasTokenPreviously:11,loginType:12},nimAuthRepTag:{type:3,os:4,mac:5,clientId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,consid:102,clientIP:103,port:104,timestamp:109,pushType:110,hasTokenPreviously:111},qchatAuthRepTag:{clientId:8,consid:102,clientIP:103,port:104,type:6,customClientType:13,timestamp:105,os:30,pushType:100,hasTokenPreviously:101}},pf={v2Login:{sid:26,cid:3,service:"auth",params:[{type:"Property",name:"tag",reflectMapper:lf.webLoginReqTag}],response:[{type:"Property",name:"data",reflectMapper:cf(lf.mixAuthRepTag)},{type:"PropertyArray",name:"loginClients",reflectMapper:cf(lf.mixAuthRepTag)}]},v2Logout:{sid:26,cid:5,service:"auth"},v2KickOffline:{sid:26,cid:8,service:"auth",params:[{type:"StrArray",name:"clientIds"}],response:[{type:"StrArray",name:"clientIds"}]},v2BeKicked:{sid:26,cid:9,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"reasonDesc"},{type:"Int",name:"customClientType"}]},v2LoginClientChange:{sid:26,cid:10,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:cf(lf.mixAuthRepTag)}]},v2GetChatroomLinkAddress:{sid:36,cid:1,service:"auth",params:[{type:"Long",name:"roomId"},{type:"Bool",name:"miniProgram"}],response:[{type:"StrArray",name:"linkAddress"}]}},mf={heartbeat:{sid:1,cid:2,service:"auth"},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:cf(lf.nimAuthRepTag)}]},qchatLoginClientChange:{sid:24,cid:8,service:"auth",response:[{type:"Byte",name:"state"},{type:"Property",name:"data",reflectMapper:cf(lf.qchatAuthRepTag)}]}},hf=os.codeAt;rt({target:"String",proto:!0},{codePointAt:function(e){return hf(this,e)}});var ff=zt("String").codePointAt,gf=String.prototype,vf=function(e){var t=e.codePointAt;return"string"==typeof e||e===gf||G(gf,e)&&t===gf.codePointAt?ff:t},yf=RangeError,If=String.fromCharCode,Mf=String.fromCodePoint,Tf=y([].join),Sf=!!Mf&&1!=Mf.length;rt({target:"String",stat:!0,arity:1,forced:Sf},{fromCodePoint:function(e){for(var t,r=[],n=arguments.length,i=0;n>i;){if(t=+arguments[i++],ht(t,1114111)!==t)throw yf(t+" is not a valid code point");r[i]=t<65536?If(t):If(55296+((t-=65536)>>10),t%1024+56320)}return Tf(r,"")}});var bf=q.String.fromCodePoint,Cf=function(e){var t;if(void 0!==e)return(t=wf(e)).sign=1,t},Ef=function(e){return"[object Array]"===Object.prototype.toString.call(e)},_f=function(e){var t;return Um(t=["number"==typeof e,"string"==typeof e&&e.length>0,Ef(e)&&e.length>0,e instanceof wf]).call(t,(function(e){return!0===e}))},kf="Invalid Number",Rf="Invalid Number - Division By Zero";function wf(e){var t;if(!(this instanceof wf))return new wf(e);if(this.number=[],this.sign=1,this.rest=0,_f(e)){if(Ef(e)){for((e.length&&"-"===e[0]||"+"===e[0])&&(this.sign="+"===e[0]?1:-1,e.shift(0)),t=e.length-1;t>=0;t--)if(!this.addDigit(e[t]))return}else for("-"!==(e=e.toString()).charAt(0)&&"+"!==e.charAt(0)||(this.sign="+"===e.charAt(0)?1:-1,e=e.substring(1)),t=e.length-1;t>=0;t--)if(!this.addDigit(Kp(e.charAt(t),10)))return}else this.number=kf}wf.prototype.addDigit=function(e){return/^\d$/.test(e)?(this.number.push(e),this):(this.number=kf,!1)},wf.prototype._compare=function(e){var t,r;if(!_f(e))return null;if(t=wf(e),this.sign!==t.sign)return this.sign;if(this.number.length>t.number.length)return this.sign;if(this.number.length<t.number.length)return-1*this.sign;for(r=this.number.length-1;r>=0;r--){if(this.number[r]>t.number[r])return this.sign;if(this.number[r]<t.number[r])return-1*this.sign}return 0},wf.prototype.gt=function(e){return this._compare(e)>0},wf.prototype.gte=function(e){return this._compare(e)>=0},wf.prototype.equals=function(e){return 0===this._compare(e)},wf.prototype.lte=function(e){return this._compare(e)<=0},wf.prototype.lt=function(e){return this._compare(e)<0},wf.prototype.subtract=function(e){var t;return void 0===e?this:(t=wf(e),this.sign!==t.sign?(this.number=wf._add(this,t),this):(this.sign=this.lt(t)?-1:1,this.number=Cf(this).lt(Cf(t))?wf._subtract(t,this):wf._subtract(this,t),this))},wf._add=function(e,t){var r,n=0,i=Math.max(e.number.length,t.number.length);for(r=0;r<i||n>0;r++)e.number[r]=(n+=(e.number[r]||0)+(t.number[r]||0))%10,n=Math.floor(n/10);return e.number},wf._subtract=function(e,t){var r,n,i=0,o=e.number.length;for(r=0;r<o;r++)e.number[r]-=(t.number[r]||0)+i,e.number[r]+=10*(i=e.number[r]<0?1:0);for(r=0,o=e.number.length-1;0===e.number[o-r]&&o-r>0;)r++;return r>0&&si(n=e.number).call(n,-r),e.number},wf.prototype.multiply=function(e){if(void 0===e)return this;var t,r,n=wf(e),i=0,o=[];if(this.isZero()||n.isZero())return wf(0);for(this.sign*=n.sign,t=0;t<this.number.length;t++)for(i=0,r=0;r<n.number.length||i>0;r++)o[t+r]=(i+=(o[t+r]||0)+this.number[t]*(n.number[r]||0))%10,i=Math.floor(i/10);return this.number=o,this},wf.prototype.divide=function(e){if(void 0===e)return this;var t,r,n=wf(e),i=[],o=wf(0);if(n.isZero())return this.number=Rf,this;if(this.isZero())return this.rest=wf(0),this;if(this.sign*=n.sign,n.sign=1,1===n.number.length&&1===n.number[0])return this.rest=wf(0),this;for(t=this.number.length-1;t>=0;t--)for(o.multiply(10),o.number[0]=this.number[t],i[t]=0;n.lte(o);)i[t]++,o.subtract(n);for(t=0,r=i.length-1;0===i[r-t]&&r-t>0;)t++;return t>0&&si(i).call(i,-t),this.rest=o,this.number=i,this},wf.prototype.mod=function(e){return this.divide(e).rest},wf.prototype.isZero=function(){var e;for(e=0;e<this.number.length;e++)if(0!==this.number[e])return!1;return!0},wf.prototype.toString=function(){var e,t="";if("string"==typeof this.number)return this.number;for(e=this.number.length-1;e>=0;e--)t+=this.number[e];return this.sign>0?t:"-"+t};var Af=Math.pow(2,32);function xf(e){for(var t=new Uint8Array(5),r=new DataView(t.buffer),n=0;0!=(4294967168&e);)r.setUint8(n++,127&e|128),e>>>=7;return r.setUint8(n++,127&e),Fc(t).call(t,0,n)}function Nf(e){if("function"==typeof TextEncoder)return(new TextEncoder).encode(e);var t=function(e){for(var t=[],r=e.length,n=0;n<r;){var i=vf(e).call(e,n),o=0,a=0;for(i<=127?(o=0,a=0):i<=2047?(o=6,a=192):i<=65535?(o=12,a=224):i<=2097151&&(o=18,a=240),t.push(a|i>>o),o-=6;o>=0;)t.push(128|i>>o&63),o-=6;n+=i>=65536?2:1}return t}(e);return new Uint8Array(t)}function Of(e){return"function"==typeof TextDecoder?new TextDecoder("utf-8").decode(e):function(e){for(var t="",r=0;r<e.length;){var n=e[r],i=0,o=0;if(n<=127?(i=0,o=255&n):n<=223?(i=1,o=31&n):n<=239?(i=2,o=15&n):n<=244&&(i=3,o=7&n),e.length-r-i>0)for(var a=0;a<i;)o=o<<6|63&(n=e[r+a+1]),a+=1;else o=65533,i=e.length-r;t+=bf(o),r+=i+1}return t}(e)}var Pf=function(){function e(e){this.offset=0,this.buffer=new Uint8Array(e),this.view=new DataView(e)}var t=e.prototype;return t.checkBufferBoundaryAccess=function(){return this.offset>=this.buffer.byteLength},t.length=function(){var e;return(null===(e=this.view)||void 0===e?void 0:e.byteLength)||0},t.getBuffer=function(){return this.view.buffer},t.getOffset=function(){return this.offset},t.popRaw=function(e){try{var t,r=Fc(t=this.buffer).call(t,this.offset,this.offset+e);return this.offset+=e,r}catch(n){throw new Error("UnpackException raw "+(n&&n.message))}},t.popByte=function(){try{var e=this.view.getUint8(this.offset);return this.offset+=1,e}catch(t){throw new Error("UnpackException byte "+(t&&t.message))}},t.popVarbin=function(){return this.popRaw(this.popVarInt())},t.popString=function(){try{return Of(this.popVarbin())}catch(e){throw new Error("UnpackException string "+(e&&e.message))}},t.popInt=function(){try{var e=this.view.getUint32(this.offset,!0);return this.offset+=4,e}catch(t){throw new Error("UnpackException int "+(t&&t.message))}},t.popVarInt=function(){var e=1,t=0,r=0,n=0;do{if(t+=(127&(r=this.popByte()))*e,e*=128,(n+=1)>5)throw new Error("Variable length quantity is too long")}while(0!=(128&r));return t},t.popLong=function(){try{var e,t=function(e,t){void 0===t&&(t=!1);var r=new DataView(e.buffer),n=t?[4,0]:[0,4],i=n[0],o=n[1],a=r.getUint32(i,t),s=r.getUint32(o,t);return a>0?a*Af+s:s}(Fc(e=this.buffer).call(e,this.offset,this.offset+8),!0);return this.offset+=8,Number(t)}catch(r){throw new Error("UnpackException long "+(r&&r.message))}},t.popShort=function(){try{var e=this.view.getUint16(this.offset,!0);return this.offset+=2,e}catch(t){throw new Error("UnpackException short "+(t&&t.message))}},t.popBoolean=function(){return this.popByte()>0},t.toString=function(){return Vl(new Uint8Array(this.buffer)).toString()},t.reset=function(){this.offset=0,this.buffer=null,this.view=null},e}(),Lf=function(){function e(e){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.bodyArr=[],this.unpack=new Pf(e)}var t=e.prototype;return t.reset=function(){this.innerHeader=null,this.bodyArr=[],this.unpack.reset()},t.getBodyDetail=function(){return this.bodyArr.join("")},t.unmarshalHeader=function(){var e,t=this._unmarshalHeader();this.packetLength=t.packetLength,this.serviceId=t.serviceId,this.commandId=t.commandId,this.serialId=t.serialId,this.tag=t.tag,this.resCode=t.resCode,4===t.serviceId&&tu(e=[1,2,10,11]).call(e,t.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())},t._unmarshalHeader=function(){var e=this.unpack.popVarInt(),t=this.unpack.popByte(),r=this.unpack.popByte(),n=this.unpack.popShort(),i=this.unpack.popByte(),o=200;return this.hasRescode(i)&&(o=this.unpack.popShort()),{packetLength:e,serviceId:t,commandId:r,serialId:n,tag:i,resCode:o}},t.hasRescode=function(t){return 0!=((t=t||this.tag)&e.RES_CODE)},t.getHeader=function(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}},t.getInnerHeader=function(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null},t.unmarshalProperty=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nProperty("+e+") {");for(var r=0;r<e;r++){var n=this.unpack.popVarInt();this.bodyArr.push(n+":");var i=this.unpack.popString();this.bodyArr.push('"'+i.length+" "+this.unpack.getOffset()+'",'),t[n]=i}return this.bodyArr.push("},"),t},t.unmarshalPropertyArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nPropertyArray("+e+") [");for(var r=0;r<e;r++)t.push(this.unmarshalProperty());return this.bodyArr.push("],"),t},t.unmarshalLong=function(){var e=this.unpack.popLong();return this.bodyArr.push("\nLong:"+e),e},t.unmarshalLongArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nLongArray "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popLong();this.bodyArr.push(n+","),t.push(n)}return t},t.unmarshalStrArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nStrArray "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popString();this.bodyArr.push(n+","),t.push(n)}return t},t.unmarshalStrLongMap=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nStrLongMap "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popString();this.bodyArr.push(n+",");var i=this.unpack.popLong();this.bodyArr.push(i+";"),t[n]=i}return t},t.unmarshalStrStrMap=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nStrStrMap "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popString();this.bodyArr.push(n+",");var i=this.unpack.popString();this.bodyArr.push(i+";"),t[n]=i}return t},t.unmarshalLongLongMap=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nStrLongLongMap "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popLong();this.bodyArr.push(n+",");var i=this.unpack.popLong();this.bodyArr.push(i+";"),t[n]=i}return{m_map:t}},t.unmarshalKVArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nKVArray "+e+":");for(var r=0;r<e;r++)t.push(this.unmarshalStrStrMap());return t},t.unmarshal=function(e){var t,r=this,n=sr(sr({},this.getHeader()),{r:[]});if(this.innerHeader&&(n.r[0]=this.msgId,n.r[1]={body:[],headerPacket:this.getInnerHeader()}),!tu(t=[200,406,808,810,7101]).call(t,n.code))return Ti(n);if(this.packetLength>0&&this.packetLength>this.unpack.length())throw new Error("UnpackException packetLength("+this.packetLength+") greater than bufferLength("+this.unpack.length()+")");var i=[];return e&&Bn(e).call(e,(function(e){if(!r.unpack.checkBufferBoundaryAccess())switch(e.type){case"PropertyArray":i.push(r.unmarshalPropertyArray());break;case"Property":i.push(r.unmarshalProperty());break;case"Byte":i.push(r.unpack.popByte());break;case"Int":i.push(r.unpack.popInt());break;case"Bool":i.push(r.unpack.popBoolean());break;case"Long":i.push(r.unmarshalLong());break;case"LongArray":i.push(r.unmarshalLongArray());break;case"String":i.push(r.unpack.popString());break;case"StrArray":i.push(r.unmarshalStrArray());break;case"StrStrMap":i.push(r.unmarshalStrStrMap());break;case"StrLongMap":i.push(r.unmarshalStrLongMap());break;case"LongLongMap":i.push(r.unmarshalLongLongMap());break;case"KVArray":i.push(r.unmarshalKVArray())}})),this.innerHeader?n.r[1].body=i:n.r=i,Ti(n)},e}();Lf.RES_CODE=2;var Vf=function(){function e(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}var t=e.prototype;return t.reset=function(){this.offset=0,this.buffer=null,this.view=null},t.size=function(){return this.offset},t.getBuffer=function(){var e;return Fc(e=this.buffer).call(e,0,this.offset).buffer},t.ensureCapacity=function(e){var t=this.offset+e;if(t>this.capacity)throw new Error("PackException over limit");if(t>this.buffer.byteLength){var r=Math.ceil(t/this.pageSize)*this.pageSize,n=new Uint8Array(r);n.set(this.buffer),this.buffer=n,this.view=new DataView(this.buffer.buffer)}},t.putRaw=function(e){this.ensureCapacity(e.length);try{this.buffer.set(e,this.offset),this.offset+=e.length}catch(t){throw new Error("PackException raw")}},t.putByte=function(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e)}catch(t){throw new Error("PackException byte")}},t.putString=function(e){try{var t=Nf(e);this.putVarbin(t)}catch(r){throw new Error("PackException string")}},t.putInt=function(e){this.ensureCapacity(4);try{this.view.setInt32(this.offset,e,!0),this.offset+=4}catch(t){throw new Error("PackException int")}},t.putVarInt=function(e){var t=xf(e);this.putRaw(t)},t.putBoolean=function(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e?1:0)}catch(t){throw new Error("PackException boolean")}},t.putLong=function(e){this.ensureCapacity(8);try{var t=function(e,t){void 0===t&&(t=!1);var r=new Uint8Array(8),n=new DataView(r.buffer),i=Number(e>Af-1?e/Af:0),o=Number(4294967295&e),a=t?[4,0]:[0,4],s=a[0],c=a[1];return n.setUint32(s,i,t),n.setUint32(c,o,t),r}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(r){throw new Error("PackException long")}},t.putStringAsLong=function(e){this.ensureCapacity(8);try{var t=function(e,t){var r,n;void 0===t&&(t=!1);var i=new Uint8Array(8),o=new DataView(i.buffer),a=Pc(r=wf(e).divide(Af).number).call(r).join(""),s=Pc(n=wf(e).mod(Af).number).call(n).join(""),c=Number(a),u=Number(s),d=t?[4,0]:[0,4],l=d[0],p=d[1];return o.setUint32(l,c,t),o.setUint32(p,u,t),i}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(r){throw new Error("PackException stringAsLong")}},t.putShort=function(e){this.ensureCapacity(2);try{this.view.setInt16(this.offset,e,!0),this.offset+=2}catch(t){throw new Error("PackException short")}},t.putVarbin=function(e){if(!e)return this.ensureCapacity(1),this.putVarInt(0);if(e.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var t=xf(e.length);this.ensureCapacity(t.length+e.length);try{this.buffer.set(t,this.offset),this.offset+=t.length,this.buffer.set(e,this.offset),this.offset+=e.length}catch(r){throw new Error("PackException varbin")}},e}();function Uf(e){if("number"!=typeof e){if(null==e)return!1;e=Number(e)}if(isNaN(e))throw new Error("Number type conversion error");return!0}function Df(e){return null==e}var qf,Bf=function(){function e(e,t,r){this.pack=new Vf,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=e,this.commandId=t,this.serialId=r}var t=e.prototype;return t.marshalHeader=function(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)},t.marshalProperty=function(e){var t=this,r=pr(e),n=lu(r).call(r,(function(e){return!Df(e)}));this.pack.putVarInt(n.length),Bn(n).call(n,(function(r){t.pack.putVarInt(Number(r)),Si(e[r])||"[object Object]"===Object.prototype.toString.call(e[r])?t.pack.putString(Ti(e[r])):t.pack.putString(String(e[r]))}))},t.marshalPropertyArray=function(e){var t=this,r=e.length;this.pack.putVarInt(r),Bn(e).call(e,(function(e){t.marshalProperty(null==e?void 0:e.v)}))},t.marshalStrArray=function(e){var t=this,r=lu(e).call(e,(function(e){return!Df(e)})),n=r.length;this.pack.putVarInt(n),Bn(r).call(r,(function(e){t.pack.putString(String(e))}))},t.marshalLongArray=function(e){var t=this,r=lu(e).call(e,(function(e){return Uf(e)})),n=r.length;this.pack.putVarInt(n),Bn(r).call(r,(function(e){t.putLong(e)}))},t.marshalStrStrMap=function(e){var t=this,r=pr(e),n=lu(r).call(r,(function(t){return!Df(e[t])&&!Df(t)}));this.pack.putVarInt(n.length),Bn(n).call(n,(function(r){t.pack.putString(String(r)),t.pack.putString(String(e[r]))}))},t.marshalStrLongMap=function(e){var t=this,r=pr(e),n=lu(r).call(r,(function(t){return Uf(e[t])&&!Df(t)}));this.pack.putVarInt(n.length),Bn(n).call(n,(function(r){t.pack.putString(String(r)),t.putLong(e[r])}))},t.marshalLongLongMap=function(e){var t=this,r=pr(e),n=lu(r).call(r,(function(t){var r=Number(t);return Uf(r)&&Uf(e[r])}));this.pack.putVarInt(n.length),Bn(n).call(n,(function(r){var n=Number(r);t.putLong(n),t.putLong(e[n])}))},t.marshalKVArray=function(e){var t=this,r=e.length;this.pack.putVarInt(r),Bn(e).call(e,(function(e){t.marshalStrStrMap(e)}))},t.putLong=function(e){"string"==typeof e&&e.length>15?this.pack.putStringAsLong(e):this.pack.putLong(Number(e))},t.marshal=function(e,t){var r=this;return this.marshalHeader(),t&&Bn(t).call(t,(function(t,n){var i,o=t.type,a=null===(i=e[n])||void 0===i?void 0:i.v;if(!Df(a))switch(o){case"PropertyArray":r.marshalPropertyArray(a);break;case"Property":r.marshalProperty(a);break;case"Byte":if(!Uf(a))return;r.pack.putByte(Number(a));break;case"Int":if(!Uf(a))return;r.pack.putInt(Number(a));break;case"Bool":"false"===a?a=!1:"true"===a&&(a=!0),r.pack.putBoolean(a);break;case"Long":if(!Uf(a))return;r.putLong(a);break;case"LongArray":r.marshalLongArray(a);break;case"String":r.pack.putString(String(a));break;case"StrArray":r.marshalStrArray(a);break;case"StrStrMap":r.marshalStrStrMap(a);break;case"StrLongMap":r.marshalStrLongMap(a);break;case"LongLongMap":r.marshalLongLongMap(a);break;case"KVArray":r.marshalKVArray(a)}})),this.pack.getBuffer()},t.reset=function(){this.pack.reset()},e}(),Ff=function(e){function t(t,r){var n;return(n=e.call(this)||this).url=r,n.websocket=null,n.socketConnectTimer=0,n.core=t,n.url=r,n.status="disconnected",n.logger=t.logger,n.connect(),n}er(t,e);var r=t.prototype;return r.connect=function(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this._createWebsocket("wss://"+this.url+"/websocket")):this.logger.warn("imsocket::socket is connecting or connected",this.status)},r.close=function(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(e){this.logger.warn("imsocket::attempt to close websocket error",e)}this.clean(),this.emit("disconnect")}},r.clean=function(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},r.onConnect=function(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},r._createWebsocket=function(e){var t,r=this;this.socketConnectTimer=Ls((function(){r.logger.error("imsocket::Websocket connect timeout. url: ",e),r.emit("connectFailed",new Tl({code:"v2"===Qp(r.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+e}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new Ql.WebSocket(e),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=Xt(t=this.onMessage).call(t,this),this.websocket.onclose=function(){r.logger.log("imsocket::Websocket onclose done"),"connected"===r.status?(r.clean(),r.emit("disconnect")):(r.clean(),r.emit("connectFailed",new Tl({code:"v2"===Qp(r.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=function(e){r.logger.error("imsocket::Websocket onerror",e),"connected"===r.status?(r.clean(),r.emit("disconnect")):(r.clean(),r.emit("connectFailed",new Tl({code:"v2"===Qp(r.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=function(){r.onConnect()}},r.onMessage=function(e){if(e.data){var t=new Lf(e.data),r={sid:-1,cid:-1,ser:-1,packetLength:-1},n=null;try{t.unmarshalHeader(),r=t.getHeader(),n=t.getInnerHeader()}catch(p){this.reportBinaryError({err:p,sid:n?n.sid:null==r?void 0:r.sid,cid:n?n.cid:null==r?void 0:r.cid,rawBuf:e.data,type:"decode"})}var i=n?n.sid:r.sid,o=n?n.cid:r.cid,a=i+"_"+o,s=ch[a];if(s&&s.length>0){var c,u=s[0].config;try{c=t.unmarshal(u.response)}catch(m){var d=t.getBodyDetail();this.reportBinaryError({err:m,rawBuf:e.data,sid:i,cid:o,parseDetail:d,type:"decode"}),t.reset();var l=sr(sr({},r),{sid:i,cid:o,code:yl.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error('imsocket::onMessage "'+l.sid+"_"+l.cid+'", ser '+l.ser+", packetLength "+l.packetLength+" unmarshal error. "+d+" \n",m),void this.emit("message",Ti(l))}this.emit("message",c)}else this.core.logger.warn("imsocket::onMessage cmd not found",a);t.reset()}},r.send=function(e,t,r,n,i){var o,a,s=new Bf(e,t,r),c=sh[n],u="";try{u=Ti(i),a=s.marshal(JSON.parse(u),c.params)}catch(d){throw this.reportBinaryError({err:d,sid:e,cid:t,rawStr:u,type:"encode"}),s.reset(),new Tl({code:yl.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:e+"-"+t+", ser "+r+" marshal error",rawError:d}})}null===(o=this.websocket)||void 0===o||o.send(a),s.reset()},r.reportBinaryError=function(e){var t,r,n,i=e.err,o=e.rawStr,a=e.sid,s=e.cid,c=e.type,u=e.parseDetail,d=e.rawBuf;if(d){try{n=function(e){if("function"!=typeof btoa)return"";for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return r=null,btoa(t)}(d)}catch(p){n="reportBinaryError::arrayBufferToBase64 parsing failed, error: "+(null==p?void 0:p.message)+", sid: "+a+", cid: "+s,this.core.logger.error(n)}d=null}this.core.reporter.reportTraceStart("exceptions",{user_id:null===(t=this.core.auth)||void 0===t?void 0:t.account,trace_id:null===(r=this.core.clientSocket.socket)||void 0===r?void 0:r.sessionId,start_time:Ts(),action:2,exception_service:9});var l=i?(i.message+";;;"||i.code+";;;")+(u?"parseDetail: "+u+";;;":"")+(o?" rawStr: "+o:"")+(n?" rawBuf: "+n:""):"";this.core.reporter.reportTraceUpdateV2("exceptions",{code:"encode"===c?yl.V2NIM_ERROR_CODE_PACK_ERROR:yl.V2NIM_ERROR_CODE_UNPACK_ERROR,description:l,operation_type:"encode"===c?3:4,target:a+"-"+s},{asyncParams:Ql.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)},t}(Vs);function Gf(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return jf(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jf(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function jf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(qf||(qf={}));var Hf,Wf=function(){function e(e){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new Dh({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new rd,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}var t=e.prototype;return t.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.isReconnect=!0}))},t.setSessionId=function(e){this.socket&&(this.socket.sessionId=e)},t.connect=function(e,t){var r,n;return void 0===t&&(t=!1),Wl(this,void 0,void 0,jl.mark((function i(){var o,a,s,c;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.isReconnect=t,1!==(o=this.core.auth.getConnectStatus())){i.next=7;break}return a="clientSocket::connect status is "+o+", and would not repeat connect",s=new Tl({code:yl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:a}}),this.logger.warn(a),i.abrupt("return",ls.reject(s));case 7:return this.auth.lifeCycle.processEvent("connect"),i.prev=8,i.next=11,this.auth.doLoginStepsManager.add(this.doConnect(e));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+e+", isReconnect: "+t),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:Ql.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),i.next=28;break;case 16:if(i.prev=16,i.t0=i.catch(8),c=i.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:c.code||0,description:"connectFailed:"+c.message,mixlink:!0,succeed:!1},{asyncParams:Ql.net.getNetworkStatus()}),c.code!==yl.V2NIM_ERROR_CODE_CANCELLED&&c.code!==yl.V2NIM_ERROR_CODE_TIMEOUT){i.next=25;break}throw null===(r=this.socket)||void 0===r||r.close(),null===(n=this.socket)||void 0===n||n.removeAllListeners(),this.socket=void 0,i.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+e,c),this.auth.lifeCycle.processEvent("connectFail",c),i.t0;case 28:case"end":return i.stop()}}),i,this,[[8,16]])})))},t.doConnect=function(e){var t=this,r=!1;return new ls((function(n,i){var o;t.socket=new Ff(t.core,e),t.socket.on("connect",(function(){t.logger.log("clientSocketV2::socket on connect",e),t.core.reporterHookLinkKeep.start(),t.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),r=!0,n()})),t.socket.on("message",Xt(o=t.onMessage).call(o,t)),t.socket.on("disconnect",(function(n){return Wl(t,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!0,this.logger.log("clientSocketV2::socket on disconnect "+e,n),t.next=4,this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(qf.OFFLINE,"SocketOnDisconnect");case 6:case"end":return t.stop()}}),t,this)})))})),t.socket.on("connectFailed",(function(n){r?t.ping():(t.logger.error("clientSocketV2::connectFailed:"+e+", reason:"+(n&&n.message)),t.cleanSocket()),r=!0,i(n)}))}))},t.cleanSocket=function(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function(e,t){if(this.logger.log("clientSocketV2::doDisconnect: type "+e+", reason ",t),0!==this.core.auth.getConnectStatus()){var r={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new Tl({code:yl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:r}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===qf.ACTIVE||e===qf.KICKED?this.destroyOnlineListener():e===qf.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Tl({code:yl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function(e,t,r){var n=this,i=this.core.auth.getLoginStatus(),o=["v2Login","login","chatroomLogin","v2ChatroomLogin"],a={cmd:e};if(1!==i&&!tu(o).call(o,e))return this.logger.warn("clientSocketV2::NIM login status is "+i+", so can not sendCmd "+e),ls.reject(new Tl({code:yl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:sr({reason:"Can not sendCmd due to no logined"},a)}));var s="heartbeat"!==e,c=s?this.packetSer++:0,u=uh(e,c,this.logger,t);if(!u){var d=new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:sr(sr({},a),{reason:"SendCmd::createCmd error: "+c+" "+e})});return this.logger.error(d),ls.reject(d)}var l=u.packet,p=u.hasPacketResponse,m=u.hasPacketTimer,h=Ti(l);s&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c,h):this.logger.log("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c));var f=(new Date).getTime();return new ls((function(i,o){p&&n.sendingCmdMap.set(c,{cmd:e,params:t,callback:[i,o],timer:m?Ls((function(){var t=new Tl({code:yl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:sr({ser:c,reason:"Packet Timeout: ser "+c+" cmd "+e,timetag:(new Date).getTime()},a)});n.markCmdInvalid(c,t,e)}),r&&r.timeout?r.timeout:n.packetTimeout):null});try{n.socket.send(l.SID,l.CID,c,e,l.Q),p||i(l)}catch(u){var s=new Tl({code:yl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:sr({ser:c,reason:"Unable to send packet"+(u&&u.message?": "+u.message:""),timetag:(new Date).getTime(),rawError:u},a)});n.markCmdInvalid(c,s,e),o(s)}})).catch((function(e){return Wl(n,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e,n=[yl.V2NIM_ERROR_CODE_DISCONNECT,yl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,yl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],tu(n).call(n,r.code)){t.next=4;break}return t.abrupt("return",ls.reject(r));case 4:return this.reportSendCmdFailed(r,{sid:l.SID,cid:l.CID,ser:c},f),t.abrupt("return",ls.reject(r));case 6:case"end":return t.stop()}}),t,this)})))}))},t.reportSendCmdFailed=function(e,t,r){var n;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(n=this.socket)||void 0===n?void 0:n.sessionId,start_time:r,action:2,exception_service:6});var i=Qp(e,"detail.disconnect_reason")||"",o=e.code===yl.V2NIM_ERROR_CODE_DISCONNECT?Ti({disconnect_reason:i}):e.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:e.code,description:o,operation_type:1,target:t.sid+"-"+t.cid,context:""+t.ser},{asyncParams:Ql.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)},t.onMessage=function(e){var t=dh(e,this.logger);if(t){var r=t[0],n=r.raw.ser;"heartbeat"!==r.cmd&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::recvCmd "+r.raw.sid+"_"+r.raw.cid+","+r.cmd+",ser:"+n,e):this.logger.log("clientSocketV2::recvCmd "+r.raw.sid+"_"+r.raw.cid+","+r.cmd+",ser:"+n+",code:"+r.raw.code));for(var i,o=Gf(t);!(i=o()).done;){var a=i.value;if(a.error&&this.logger.error("clientSocketV2::onMessage packet error",a.raw.sid+"_"+a.raw.cid+", ser:"+n+",",a.error),a.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",a.raw.sid+"_"+a.raw.cid+", ser:"+n);this.packetHandler(a)}}},t.packetHandler=function(e){var t,r,n=this;if(e){var i=e.raw.ser,o=this.sendingCmdMap.get(i);if(o&&o.cmd===e.cmd){var a=o.callback,s=o.timer,c=o.params;if(clearTimeout(s),e.params=c,this.sendingCmdMap.delete(i),"heartbeat"===e.cmd)return void a[0]();var u=null===(t=this.core[e.service])||void 0===t?void 0:t.process(e);u&&"function"==typeof u.then?u.then((function(e){a[0](e)})).catch((function(e){a[1](e)})):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),a[0](e))}else{var d=null===(r=this.core[e.service])||void 0===r?void 0:r.process(e);d&&"function"==typeof d.then&&d.catch((function(e){n.logger.error("clientSocketV2::no obj cache, no process handler",e)}))}}},t.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("clientSocketV2::packet "+e+", "+r+" is invalid:",t),i[1](t)}},t.markAllCmdInvaild=function(e){var t,r=this;this.logger.log("markAllCmdInvaild",e),Bn(t=this.sendingCmdMap).call(t,(function(t){var n=t.callback,i=t.timer,o=t.cmd;r.logger.log("clientSocketV2::markAllCmdInvaild:cmd "+o),i&&clearTimeout(i),n[1](e)})),this.sendingCmdMap.clear()},t.ping=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){var r=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.pingTimer),t.prev=1,t.next=4,this.sendCmd("heartbeat");case 4:t.next=20;break;case 6:if(t.prev=6,t.t0=t.catch(1),t.t0.code!==yl.V2NIM_ERROR_CODE_DISCONNECT){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,this.testHeartBeat5Timeout();case 13:if(!t.sent){t.next=20;break}return t.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(qf.OFFLINE,"PingError"),t.abrupt("return");case 20:this.pingTimer=Ls((function(){r.ping()}),3e4);case 21:case"end":return t.stop()}}),t,this,[[1,6]])})))},t.testHeartBeat5Timeout=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.log("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.initOnlineListener=function(){var e=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,Ql.net.onNetworkStatusChange((function(t){e.logger.log("clientSocketV2::onlineListener:network change",t);var r=e.auth.getConnectStatus(),n=e.auth.getLoginStatus();t.isConnected&&1===n?e.ping():t.isConnected&&3===r?(e.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),e.auth.reconnect.clearReconnectTimer(),e.auth.reconnect.doReLogin()):t.isConnected||e.doDisconnect(qf.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function(){this.logger.log("clientSocketV2::onlineListener:destroy"),Ql.net.offNetworkStatusChange(),this.hasNetworkListener=!1},e}();function Yf(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return Kf(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kf(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Kf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Hf||(Hf={}));var Qf=function(){function e(e){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new Dh({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new rd,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}var t=e.prototype;return t.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.isReconnect=!0}))},t.setSessionId=function(e){this.socket&&(this.socket.sessionId=e)},t.connect=function(e,t){var r,n;return void 0===t&&(t=!1),Wl(this,void 0,void 0,jl.mark((function i(){var o,a,s,c;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.isReconnect=t,1!==(o=this.core.auth.getConnectStatus())){i.next=7;break}return a="clientSocket::connect status is "+o+", and would not repeat connect",s=new Tl({code:yl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:a}}),this.logger.warn(a),i.abrupt("return",ls.reject(s));case 7:return this.auth.lifeCycle.processEvent("connect"),i.prev=8,i.next=11,this.auth.doLoginStepsManager.add(this.doConnect(e));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+e+", isReconnect: "+t),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:Ql.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),i.next=28;break;case 16:if(i.prev=16,i.t0=i.catch(8),c=i.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:c.code||0,description:"connectFailed:"+c.message,mixlink:!0,succeed:!1},{asyncParams:Ql.net.getNetworkStatus()}),c.code!==yl.V2NIM_ERROR_CODE_CANCELLED&&c.code!==yl.V2NIM_ERROR_CODE_TIMEOUT){i.next=25;break}throw null===(r=this.socket)||void 0===r||r.close(),null===(n=this.socket)||void 0===n||n.removeAllListeners(),this.socket=void 0,i.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+e,c),this.auth.lifeCycle.processEvent("connectFail",c),i.t0;case 28:case"end":return i.stop()}}),i,this,[[8,16]])})))},t.doConnect=function(e){var t=this,r=!1;return new ls((function(n,i){var o;t.socket=new Hh(t.core,e),t.socket.on("connect",(function(){t.logger.log("clientSocketV2::socket on connect",e),t.core.reporterHookLinkKeep.start(),t.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),r=!0,n()})),t.socket.on("message",Xt(o=t.onMessage).call(o,t)),t.socket.on("disconnect",(function(n){return Wl(t,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!0,this.logger.log("clientSocketV2::socket on disconnect",n),t.next=4,this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Hf.OFFLINE,"SocketOnDisconnect");case 6:case"end":return t.stop()}}),t,this)})))})),t.socket.on("handshakeFailed",(function(e){r?t.ping():(t.logger.error('clientSocketV2::handshake failed: "'+(e&&e.message)+'"'),t.cleanSocket()),r=!0,i(e)}))}))},t.cleanSocket=function(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function(e,t){if(this.logger.log("clientSocketV2::doDisconnect: type "+e+", reason ",t),0!==this.core.auth.getConnectStatus()){var r={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new Tl({code:yl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:r}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===Hf.ACTIVE||e===Hf.KICKED?this.destroyOnlineListener():e===Hf.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Tl({code:yl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function(e,t,r){var n=this,i=this.core.auth.getLoginStatus(),o=["v2Login","login","chatroomLogin","v2ChatroomLogin"],a={cmd:e};if(1!==i&&!tu(o).call(o,e))return this.logger.warn("clientSocketV2::NIM login status is "+i+", so can not sendCmd "+e),ls.reject(new Tl({code:yl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:sr({reason:"Can not sendCmd due to no logined"},a)}));var s="heartbeat"!==e,c=s?this.packetSer++:0,u=uh(e,c,this.logger,t);if(!u){var d=new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:sr(sr({},a),{reason:"SendCmd::createCmd error: "+c+" "+e})});return this.logger.error(d),ls.reject(d)}var l=u.packet,p=u.hasPacketResponse,m=u.hasPacketTimer,h=Ti(l);s&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c,h):this.logger.log("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c));var f=(new Date).getTime();return new ls((function(i,o){p&&n.sendingCmdMap.set(c,{cmd:e,params:t,callback:[i,o],timer:m?Ls((function(){var t=new Tl({code:yl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:sr({ser:c,reason:"Packet Timeout: ser "+c+" cmd "+e,timetag:(new Date).getTime()},a)});n.markCmdInvalid(c,t,e)}),r&&r.timeout?r.timeout:n.packetTimeout):null});try{n.socket.send(h),p||i(l)}catch(u){var s=new Tl({code:yl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:sr({ser:c,reason:"Unable to send packet"+(u&&u.message?": "+u.message:""),timetag:(new Date).getTime(),rawError:u},a)});n.markCmdInvalid(c,s,e),o(s)}})).catch((function(e){return Wl(n,void 0,void 0,jl.mark((function t(){var r,n,i,o,a;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e,i=[yl.V2NIM_ERROR_CODE_DISCONNECT,yl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,yl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],tu(i).call(i,n.code)){t.next=4;break}return t.abrupt("return",ls.reject(n));case 4:return this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(r=this.socket)||void 0===r?void 0:r.sessionId,start_time:f,action:2,exception_service:6}),o=Qp(n,"detail.disconnect_reason")||"",a=n.code===yl.V2NIM_ERROR_CODE_DISCONNECT?Ti({disconnect_reason:o}):n.detail.reason,this.reporter.reportTraceUpdateV2("exceptions",{code:n.code,description:a,operation_type:1,target:l.SID+"-"+l.CID,context:""+l.SER},{asyncParams:Ql.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),t.abrupt("return",ls.reject(n));case 10:case"end":return t.stop()}}),t,this)})))}))},t.onMessage=function(e){var t=dh(e,this.logger);if(t)for(var r,n=Yf(t);!(r=n()).done;){var i=r.value,o=i.raw.ser;if(i.error&&this.logger.error("clientSocketV2::onMessage packet error",i.raw.sid+"_"+i.raw.cid+", ser:"+o+",",i.error),i.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",i.raw.sid+"_"+i.raw.cid+", ser:"+o);"heartbeat"!==i.cmd&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::recvCmd "+i.raw.sid+"_"+i.raw.cid+","+i.cmd+",ser:"+o,i.content):this.logger.log("clientSocketV2::recvCmd "+i.raw.sid+"_"+i.raw.cid+","+i.cmd+",ser:"+o+";code:"+i.raw.code)),this.packetHandler(i)}},t.packetHandler=function(e){var t,r,n=this;if(e){var i=e.raw.ser,o=this.sendingCmdMap.get(i);if(o&&o.cmd===e.cmd){var a=o.callback,s=o.timer,c=o.params;if(clearTimeout(s),e.params=c,this.sendingCmdMap.delete(i),"heartbeat"===e.cmd)return void a[0]();var u=null===(t=this.core[e.service])||void 0===t?void 0:t.process(e);u&&"function"==typeof u.then?u.then((function(e){a[0](e)})).catch((function(e){a[1](e)})):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),a[0](e))}else{var d=null===(r=this.core[e.service])||void 0===r?void 0:r.process(e);d&&"function"==typeof d.then&&d.catch((function(e){n.logger.error("clientSocketV2::no obj cache, no process handler",e)}))}}},t.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("clientSocketV2::packet "+e+", "+r+" is invalid:",t),i[1](t)}},t.markAllCmdInvaild=function(e){var t,r=this;this.logger.log("markAllCmdInvaild",e),Bn(t=this.sendingCmdMap).call(t,(function(t){var n=t.callback,i=t.timer,o=t.cmd;r.logger.log("clientSocketV2::markAllCmdInvaild:cmd "+o),i&&clearTimeout(i),n[1](e)})),this.sendingCmdMap.clear()},t.ping=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){var r=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.pingTimer),t.prev=1,t.next=4,this.sendCmd("heartbeat");case 4:t.next=20;break;case 6:if(t.prev=6,t.t0=t.catch(1),t.t0.code!==yl.V2NIM_ERROR_CODE_DISCONNECT){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,this.testHeartBeat5Timeout();case 13:if(!t.sent){t.next=20;break}return t.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(Hf.OFFLINE,"PingError"),t.abrupt("return");case 20:this.pingTimer=Ls((function(){r.ping()}),3e4);case 21:case"end":return t.stop()}}),t,this,[[1,6]])})))},t.testHeartBeat5Timeout=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.log("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.initOnlineListener=function(){var e=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,Ql.net.onNetworkStatusChange((function(t){e.logger.log("clientSocketV2::onlineListener:network change",t);var r=e.auth.getConnectStatus(),n=e.auth.getLoginStatus();t.isConnected&&1===n?e.ping():t.isConnected&&3===r?(e.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),e.auth.reconnect.clearReconnectTimer(),e.auth.reconnect.doReLogin()):t.isConnected||e.doDisconnect(Hf.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function(){this.logger.log("clientSocketV2::onlineListener:destroy"),Ql.net.offNetworkStatusChange(),this.hasNetworkListener=!1},e}(),zf=function(){function e(e){this.currenRetryCount=0,this.backoff=new Dh({max:8e3,min:1600,jitter:.01}),this.reconnectTimer=0,this.core=e,this.auth=e.V2NIMLoginService}var t=e.prototype;return t.reset=function(){this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.clearReconnectTimer=function(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.attempToReLogin=function(){var e=this,t=this.backoff.duration();if("function"==typeof this.reconnectDelayProvider)try{var r=this.reconnectDelayProvider(t);"number"==typeof r&&r>=0&&(t=r>=1e3?r:r+200+Math.ceil(300*Math.random()))}catch(n){this.core.logger.error("reconnect::connectDelayProvider excute failed,",n)}return this.currenRetryCount++,this.core.logger.log("reconnect::reconnect timer is about to be set, delay "+t+" ms, current retry count is "+this.currenRetryCount),this.core.reporter.reportTraceStart("login",{user_id:this.auth.getLoginUser(),action:"auto_login",binary_websocket:this.auth.binaryWebsocket}),this.clearReconnectTimer(),this.reconnectTimer=Ls((function(){e.core.logger.log("reconnect::reconnect timer is now triggered");var t=e.auth.getConnectStatus();3===t?e.doReLogin():e.core.logger.warn("reconnect::reconnect timer is over because connect status now is "+t)}),t),!0},t.doReLogin=function(){var e=this;this.auth.loginOption.forceMode=!1,this.auth.originLoginPromise=this.auth.doLogin(!0);var t=this.auth.previousLoginManager.add(this.auth.originLoginPromise);return t.then((function(){e.core.reporter.reportTraceEnd("login",!0)})).catch((function(t){var r=t;if(e.core.logger.warn("reconnect::try login but failed due to",r),e.core.reporter.reportTraceEnd("login",!1),e.auth.checkLoginTerminalCode(r&&r.code))return e.auth.clientSocket.doDisconnect(qf.ACTIVE,"ReloginTerminated"),void e.auth.lifeCycle.processEvent("exited",r);r&&399===r.code&&e.auth.lbs.reset(),e.auth.lifeCycle.processEvent("waiting")})),t},t._setReconnectDelayProvider=function(e){this.reconnectDelayProvider=e},e}(),Jf=function(){function e(e){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=e,this.auth=e.V2NIMLoginService}var t=e.prototype;return t.getLbsInfos=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.socketLinkUrls.length>0)){e.next=5;break}return t=this.socketLinkUrls.shift(),this.socketLinkUrls=[],this.core.logger.log("V2NIMLoginService::getLbsInfos:use cache link",t),e.abrupt("return",ls.resolve(t));case 5:return this.auth.lifeCycle.processEvent("addressing"),this.core.reporterHookLBS.start(this.core.account),r=Wh(this.auth.config.lbsUrls),e.prev=8,e.next=11,this.ladderLoad(r);case 11:if(200===(n=e.sent).status&&n.data){e.next=15;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",n.status,n),new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V2NIMLoginService::getLbsInfos failed, status "+n.status}});case 15:this.success(n),e.next=26;break;case 18:if(e.prev=18,e.t0=e.catch(8),i=e.t0,this.core.logger.error("V2NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",e.t0),this.reportForFail(r[0],i.code,i.message),!this.checkTerminator(i.code)){e.next=25;break}throw e.t0;case 25:this.socketLinkUrls=[this.auth.config.linkUrl];case 26:return e.abrupt("return",this.socketLinkUrls.shift());case 27:case"end":return e.stop()}}),e,this,[[8,18]])})))},t.checkTerminator=function(e){return e===yl.V2NIM_ERROR_CODE_CANCELLED||e===yl.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function(e){return e+(bu(e).call(e,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function(e){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(e),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function(e,t,r,n){var i=this;this.timer&&clearTimeout(this.timer);var o=e[t];this.timer=Ls((function(){o&&(i.setLadderTimer(e,t+1,r,n),i.core.logger.log("V2NIMLoginService::getLbsInfos "+t+":",o),i.reportForLbsStart(o,t),i.requstLbs(o).then((function(e){i.reset(),r(sr(sr({},e),{url:o}))})).catch((function(r){var a;if(i.core.logger.warn("V2NIMLoginService::getLbsInfos "+t+" failed:",r),i.failedCount+=1,i.reportForFailOnce(o,r.code,(null===(a=r.detail)||void 0===a?void 0:a.reason)||r.message),i.failedCount>=e.length||i.checkTerminator(r.code))return i.reset(),void n(r)})))}),2e3)},t.ladderLoad=function(e){var t=this;return new ls((function(r,n){e.length>1&&t.setLadderTimer(e,1,r,n);var i=e[0];t.core.logger.log("V2NIMLoginService::getLbsInfos 0:",i),t.reportForLbsStart(i,0),t.requstLbs(i).then((function(e){t.reset(),r(sr(sr({},e),{url:i}))})).catch((function(r){var o;t.failedCount+=1,t.core.logger.warn("V2NIMLoginService::getLbsInfos 0 failed:",r),t.reportForFailOnce(i,r.code,(null===(o=r.detail)||void 0===o?void 0:o.reason)||r.message),(t.failedCount>=e.length||t.checkTerminator(r.code))&&(t.reset(),n(r))}))}))},t.success=function(e){var t,r,n,i,o=e.data.common,a=o["mix.link"]||[],s=o["link.default"]||[];this.socketLinkUrls=Rs(t=Rs(a).call(a,s)).call(t,this.auth.config.linkUrl),e.data["nos-chunk"]&&(null===(n=this.core.cloudStorage)||void 0===n?void 0:n.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nos-chunk",e.data["nos-chunk"]),this.core.cloudStorage.setOptions({chunkUploadHost:e.data["nos-chunk"]})),Si(e.data.nosup)&&e.data.nosup.length>0&&(null===(i=this.core.cloudStorage)||void 0===i?void 0:i.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nosup",e.data.nosup),this.core.cloudStorage.setOptions({commonUploadHostBackupList:e.data.nosup,commonUploadHost:e.data.nosup[0]})),this.core.logger.log("V2NIMLoginService::getLbsInfos success, socket link:",Fc(r=this.socketLinkUrls).call(r,0),"chunkUploadHost: ",e.data["nos-chunk"]),this.reportForLbsSuccess(e.url,e.data)},t.reportForLbsStart=function(e,t){this.core.reporterHookLBS.updateBegin({target:e,index:t})},t.reportForLbsSuccess=function(e,t){this.core.reporterHookLBS.updateComplete({target:e,code:200,body:Ti(t)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,code:200,succeed:!0},{asyncParams:Ql.net.getNetworkStatus()})},t.reportForFailOnce=function(e,t,r){this.core.reporterHookLBS.updateComplete({target:e,code:t,body:r})},t.reportForFail=function(e,t,r){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,description:r,code:t,succeed:!1},{asyncParams:Ql.net.getNetworkStatus()})},t.reset=function(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},e}(),$f=function(){function e(e){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=e,this.auth=e.V2NIMLoginService}var t=e.prototype;return t.verifyAuthentication=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.auth.doLoginStepsManager.add(this.refreshLoginToken(this.auth.account));case 2:return n=t.sent,t.next=5,this.auth.doLoginStepsManager.add(this.refreshThirdPartyExt(this.auth.account));case 5:return i=t.sent,this.auth.token=n,o=Ql.getSystemInfo(),a={appkey:this.core.options.appkey,account:this.auth.account,token:n,authType:this.auth.loginOption.authType,appLogin:e?0:1,clientType:16,clientSession:this.auth.clientSession,clientId:this.auth.deviceId,sdkVersion:100700,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.7.0":Fc(r=o.userAgent.replace("{{appkey}}",this.core.options.appkey)).call(r,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:o.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:o.hostEnvEnum,sdkHumanVersion:this.core.options.flutterSdkVersion||"10.7.0",os:o.os,browser:o.browser,protocolVersion:1,customClientType:this.auth.config.customClientType,customTag:this.auth.config.customTag,thirdPartyExtension:i},s=o.os.toLowerCase(),"UNIAPP"!==Ql.platform||"ios"!==s&&"android"!==s?"React Native"===Ql.platform&&(this.core.logger.log("V2NIMLoginService deviceInfo",this.core.V2NIMLoginService.deviceInfo,"os",s),a.isReactNative=1,a.clientType="ios"===s?2:1,a.deviceInfo=Ti(sr({IS_SUPPORT_HONOR:!0},this.core.V2NIMLoginService.deviceInfo))):(a.isReactNative=1,a.clientType="ios"===s?2:1,o.pushDeviceInfo&&o.pushDeviceInfo.MANUFACTURER&&(a.deviceInfo=Ti(sr({IS_SUPPORT_HONOR:!0},o.pushDeviceInfo)))),this.core.logger.log("V2NIMLoginService::do login ",a.account,a.clientSession,a.appLogin),t.prev=12,t.next=15,this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2Login",{tag:a}));case 15:c=t.sent,t.next=26;break;case 18:if(t.prev=18,t.t0=t.catch(12),u=t.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:u.code||0,succeed:!1,description:u.message},{asyncParams:Ql.net.getNetworkStatus()}),u.code!==yl.V2NIM_ERROR_CODE_CANCELLED&&u.code!==yl.V2NIM_ERROR_CODE_TIMEOUT){t.next=24;break}throw u;case 24:throw this.processLoginFailed(u),u;case 26:return d=c.content,l=d.data,p=d.loginClients,this.changeLoginClient(1,p),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:200,succeed:!0},{asyncParams:Ql.net.getNetworkStatus()}),this.loginClientOfThisConnection=sf(l),this.core.clientSocket.setSessionId(l.consid),Ql.localStorage.setItem(this.lastLoginClientKey,Ti(sr({account:this.auth.account},this.loginClientOfThisConnection))),t.abrupt("return",this.loginClientOfThisConnection);case 33:case"end":return t.stop()}}),t,this,[[12,18]])})))},t.refreshLoginToken=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.auth.loginOption.authType){t.next=2;break}return t.abrupt("return",this.auth.token);case 2:if("function"==typeof this.auth.loginOption.tokenProvider){t.next=4;break}return t.abrupt("return",this.auth.token);case 4:return t.prev=4,t.next=7,this.auth.loginOption.tokenProvider(e);case 7:if("string"!=typeof(r=t.sent)){t.next=12;break}return t.abrupt("return",r);case 12:throw this.core.logger.error("V2NIMLoginService::excute tokenProvider complete but got Unexpected value:",r),new Tl({code:yl.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute tokenProvider complete but got Unexpected value",rawData:r}});case 14:t.next=23;break;case 16:throw t.prev=16,t.t0=t.catch(4),n=t.t0,i=n,n.code!==yl.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute tokenProvider error:",n),i=new Tl({code:yl.V2NIM_ERROR_CODE_CALLBACK_FAILED,desc:"Excute tokenProvider error",detail:{rawError:t.t0}})),this.processLoginFailed(n),i;case 23:case"end":return t.stop()}}),t,this,[[4,16]])})))},t.refreshThirdPartyExt=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof this.auth.loginOption.loginExtensionProvider){t.next=2;break}return t.abrupt("return","");case 2:return t.prev=2,t.next=5,this.auth.loginOption.loginExtensionProvider(e);case 5:if("string"!=typeof(r=t.sent)){t.next=10;break}return t.abrupt("return",r);case 10:throw this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider complete but got Unexpected value:",r),new Tl({code:yl.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider complete but got Unexpected value",rawData:r}});case 12:t.next=25;break;case 14:if(t.prev=14,t.t0=t.catch(2),n=t.t0,i=n,n.code!==yl.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider error:",n),i=new Tl({code:yl.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider error",rawError:t.t0}})),2!==this.auth.loginOption.authType){t.next=24;break}throw this.processLoginFailed(n),i;case 24:return t.abrupt("return","");case 25:case"end":return t.stop()}}),t,this,[[2,14]])})))},t.processLoginFailed=function(e){this.auth.clientSocket.doDisconnect(qf.ACTIVE,e),this.checkLoginTerminalCode(e.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",e)},t.changeLoginClient=function(e,t){var r=this,n=au(t).call(t,(function(e){return sf(e)}));if(1===e)this.loginClients=n,this.auth.emit("onLoginClientChanged",e,this.loginClients);else if(2===e){var i=lu(n).call(n,(function(e){var t,n=lu(t=r.loginClients).call(t,(function(t){return t.clientId===e.clientId}));return r.loginClients.push(e),0===n.length}));i.length>0&&this.auth.emit("onLoginClientChanged",e,i)}else if(3===e){var o=lu(n).call(n,(function(e){var t;return function(e,t){t=t||function(){return!0};for(var r=[],n=(e=e||[]).length,i=0,o=0;o<n;o++)t(e[o-i])&&(r.push(si(e).call(e,o-i,1)[0]),i+=1)}(r.loginClients,(function(t){return t.clientId===e.clientId&&t.consid===e.consid})),0===lu(t=r.loginClients).call(t,(function(t){return t.clientId===e.clientId})).length}));o.length>0&&this.auth.emit("onLoginClientChanged",e,o)}},t.checkAutoLogin=function(e){if(e)return!1;var t=Ql.localStorage.getItem(this.lastLoginClientKey);if(!t)return!1;var r="",n="";try{var i=JSON.parse(t);r=Qp(i,"clientId"),n=Qp(i,"account")}catch(o){return!1}return r===this.auth.deviceId&&n===this.auth.account},t.checkLoginTerminalCode=function(e){var t=[yl.V2NIM_ERROR_CODE_CANCELLED,yl.V2NIM_ERROR_CODE_TIMEOUT,yl.V2NIM_ERROR_CODE_HANDSHAKE,302,317,yl.V2NIM_ERROR_CODE_FORBIDDEN,yl.V2NIM_ERROR_CODE_NOT_FOUND,yl.V2NIM_ERROR_CODE_PARAMETER_ERROR,yl.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,yl.V2NIM_ERROR_CODE_IM_DISABLED,yl.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,yl.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,yl.V2NIM_ERROR_CODE_APPKEY_BLOCKED,yl.V2NIM_ERROR_CODE_INVALID_TOKEN,yl.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,yl.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,yl.V2NIM_ERROR_CODE_ACCOUNT_BANNED,yl.V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST];return tu(t).call(t,e)},t.reset=function(){this.loginClients=[],this.loginClientOfThisConnection={}},t.clearLastLoginClient=function(){Ql.localStorage.removeItem(this.lastLoginClientKey)},e}(),Xf=function(){function e(e){this.name="V2NIMLoginLifeCycle",this.loginStatus=0,this.connectStatus=0,this.core=e,this.auth=e.V2NIMLoginService,this.logger=e.logger}var t=e.prototype;return t.processEvent=function(e,t,r){var n=this.getConnectStatus();switch(e){case"addressing":this.logger.log(this.name+"::addressing"),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connect":this.logger.log(this.name+"::connecting"),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connectSucc":this.logger.log(this.name+"::connect success"),this.setLoginStatus(2),this.setConnectStatus(1);break;case"connectFail":this.logger.log(this.name+"::connect fail",t),this.setLoginStatus(3),this.setConnectStatus(0,t);break;case"connectionBroken":this.logger.log(this.name+"::connectionBroken:",t),this.setLoginStatus(3),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleDisconnected",t);break;case"loginSucc":this.logger.log(this.name+"::login success, verify authentication success"),this.setLoginStatus(1),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",r);break;case"loginFail":if(this.logger.log(this.name+"::login fail due to verify authentication failed:",t),!t)return;this.setLoginStatus(this.auth.authenticator.checkLoginTerminalCode(t.code)?0:3),this.setConnectStatus(0,t),this.auth.emit("onLoginFailed",t);break;case"logout":this.logger.log(this.name+"::logout"),this.setLoginStatus(0),this.setConnectStatus(0),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(this.name+"::kicked",r),this.setLoginStatus(0),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"exited":this.logger.log(this.name+"::exited",t),this.setLoginStatus(0),this.setConnectStatus(0,t);break;case"waiting":this.logger.log(this.name+"::waiting to reconnect"),this.setLoginStatus(3),this.setConnectStatus(3),2!==n&&this.auth.reconnect.attempToReLogin()}},t.getConnectStatus=function(){return this.connectStatus},t.getLoginStatus=function(){return this.loginStatus},t.setLoginStatus=function(e){e!==this.loginStatus&&(this.loginStatus=e,this.auth.emit("onLoginStatus",e))},t.setConnectStatus=function(e,t){if(e!==this.connectStatus){var r=this.connectStatus;this.connectStatus=e,this.auth.emit("onConnectStatus",e),this.delegateConnectEvent(r,e,t)}},t.delegateConnectEvent=function(e,t,r){1===e&&0===t&&r&&this.auth.emit("onDisconnected",r),2===e&&0===t&&r&&this.auth.emit("onConnectFailed",r)},e}(),Zf=function(){function e(e){this.core=e,this.auth=e.V2NIMLoginService,this.datas=[],this.mainSyncFlag=!1,this.conversationSyncFlag=!1}var t=e.prototype;return t.switchDataSync=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.type,i=e.state,o=e.error,a=e.subType,1===n&&3===i&&("mainSync"===a?this.mainSyncFlag=!0:"conversationSync"===a&&(this.conversationSyncFlag=!0)),s=lu(r=this.datas).call(r,(function(e){return e.type===n})),(c=s.length>0?s[0]:null)?(c.state=i,c.error=o):this.datas.push({type:n,state:i,error:o}),1===n&&(2===i?this.auth.emit("onDataSync",n,i,o):3===i&&this.mainSyncFlag&&this.conversationSyncFlag&&(this.auth.emit("onDataSync",n,i,o),this.mainSyncFlag=!1,this.conversationSyncFlag=!1));case 6:case"end":return t.stop()}}),t,this)})))},t.reset=function(){this.datas=[],this.mainSyncFlag=!1,this.conversationSyncFlag=!1},e}();function eg(e,t){e=e||{};var r={};return Bn(t=t||[]).call(t,(function(t){void 0!==e[t]&&(r[t]=e[t])})),r}var tg=["https://lbs.netease.im/lbs/webconf.jsp"],rg={retryCount:3,timeout:6e4,forceMode:!1,authType:0,syncLevel:0},ng=function(e){function t(t,r){var n;void 0===r&&(r={}),(n=e.call(this,"V2NIMLoginService",t)||this).account="",n.previousLoginAccount="",n.token="",n.deviceId="",n.clientSession="",n.processId="",n.kickedDetail=null,n.binaryWebsocket=!0,n.core._registerDep(nf,"misc"),hh({cmdMap:uf,cmdConfig:pf}),"v2"===t.options.apiVersion&&(hh({cmdMap:df,cmdConfig:mf}),n.core.auth=st(n)),n.previousLoginManager=new qp,n.doLoginStepsManager=new qp,n.loginTimerManager=new Bl,n.loginOption=sr({},rg),n.config={lbsUrls:tg,linkUrl:"weblink.netease.im:443"},n.setOptions(r),t.V2NIMLoginService=st(n);var i,o=n.core.options.binaryWebsocket,a="BROWSER"===Ql.platform&&"function"==typeof TextDecoder&&"function"==typeof TextEncoder&&"function"==typeof Uint8Array;return"boolean"==typeof o&&(a=a&&o),a?(n.binaryWebsocket=!0,i=new Wf(n.core)):(n.binaryWebsocket=!1,i=new Qf(n.core)),n.clientSocket=i,"v2"===n.core.options.apiVersion&&(n.core.clientSocket=i),n.lifeCycle=new Xf(t),n.reconnect=new zf(t),n.lbs=new Jf(t),n.authenticator=new $f(t),n.dataSync=new Zf(t),n}er(t,e);var r=t.prototype;return r.setOptions=function(e){Al({lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e,"",!0),this.config=_p(this.config,e);var t="",r="";this.config.isFixedDeviceId?(t=Ql.localStorage.getItem("__NIM_DEVC_ID__")||Tp(),r=Ql.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||Tp(),Ql.localStorage.setItem("__NIM_DEVC_ID__",t),Ql.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",r)):(t=Tp(),r=Tp()),this.deviceId=t,this.clientSession=r,this.core.reporter.setConfig({common:{dev_id:t}})},r.reset=function(){this.account="",this.token="",this.processId="",this.lbs.reset(),this.reconnect.reset(),this.authenticator.reset(),this.authenticator.clearLastLoginClient(),this.dataSync.reset()},r.login=function(e,t,r){return void 0===r&&(r={}),Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a=this;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this._checkApiVersion(),i=Ql.getSystemInfo()||{},o=i.os?i.os.toLowerCase():"","React Native"!==Ql.platform||"android"!==o||!this.hasSettingService||!this.core.V2NIMSettingService.offlinePushPlugin){n.next=13;break}return n.prev=4,n.next=7,this.core.V2NIMSettingService.getRNDeviceInfo();case 7:this.deviceInfo=n.sent,n.next=13;break;case 10:n.prev=10,n.t0=n.catch(4),this.logger.error(n.t0);case 13:if(e){n.next=15;break}throw new bl({detail:{reason:"Empty account"}});case 15:if(Al({retryCount:{type:"number",min:0,required:!1},forceMode:{type:"boolean",required:!1},authType:{type:"enum",values:[0,1,2],required:!1},syncLevel:{type:"enum",values:[1,0],required:!1}},r,"",!0),0!==r.authType||t){n.next=18;break}throw new bl({detail:{reason:"When authType is 0, token cannot be empty"}});case 18:if(""!==this.previousLoginAccount&&this.previousLoginAccount!==e&&this.core._clearModuleData(),0!==this.getLoginStatus()){n.next=23;break}this.logger.log("V2NIMLoginService::login:allowLogin:"+e,r),n.next=29;break;case 23:if(1!==this.getLoginStatus()){n.next=27;break}return n.abrupt("return",this.smoothForLogined(e,t,r));case 27:if(2!==this.getLoginStatus()){n.next=29;break}return n.abrupt("return",this.smoothForLogining(e,t,r));case 29:return this.account=e,this.previousLoginAccount=e,this.token=t,this.processId=Tp(),this.loginOption=_p(rg,r),this.kickedDetail=null,this.loginTimerManager.destroy(),this.loginTimerManager.addTimer((function(){var e=new Tl({code:yl.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});a.doLoginStepsManager.clear(e),a.previousLoginManager.clear(e),a.originLoginPromise=void 0,a.lifeCycle.processEvent("exited",e)}),this.loginOption.timeout>0?this.loginOption.timeout:6e4,1),n.prev=37,n.next=40,this.multiTryDoLogin();case 40:this.loginTimerManager.destroy(),n.next=47;break;case 43:throw n.prev=43,n.t1=n.catch(37),this.loginTimerManager.destroy(),n.t1;case 47:case"end":return n.stop()}}),n,this,[[4,10],[37,43]])})))},r.getChatroomLinkAddress=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({roomId:{type:"string",regExp:/^\d+$/,required:!0,allowEmpty:!1},miniProgram:{type:"boolean",required:!1}},{roomId:e,miniProgram:t},"",!0),n="unknow environment"!==Ep(),t=void 0===t?n:t,r.next=5,this.clientSocket.sendCmd("v2GetChatroomLinkAddress",{roomId:e,miniProgram:t});case 5:return i=r.sent,r.abrupt("return",i.content.linkAddress);case 7:case"end":return r.stop()}}),r,this)})))},r.multiTryDoLogin=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),n=0;case 2:if(!(n<=this.loginOption.retryCount)){t.next=32;break}return i="V2NIMLoginService::times of login try: "+n,n>0?this.logger.warn(i):this.logger.log(i),t.prev=5,this.originLoginPromise=e||this.doLogin(!1),e=void 0,t.next=10,this.previousLoginManager.add(this.originLoginPromise);case 10:return o=t.sent,this.core.reporter.reportTraceEnd("login",!0),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,t.abrupt("return",o);case 18:if(t.prev=18,t.t0=t.catch(5),r=t.t0||r,this.logger.error("V2NIMLoginService::login failed, times of login try: "+n+", err.code: "+(null==r?void 0:r.code)+', err.message: "'+(null==r?void 0:r.message)+'"'),r.code!==yl.V2NIM_ERROR_CODE_CANCELLED&&this.core.reporter.reportTraceEnd("login",!1),this.reconnect.clearReconnectTimer(),!this.checkLoginTerminalCode(r&&r.code)){t.next=28;break}throw this.lifeCycle.processEvent("exited",r),r;case 28:r&&399===r.code&&this.lbs.reset();case 29:n++,t.next=2;break;case 32:throw this.lifeCycle.processEvent("exited",r),r;case 34:case"end":return t.stop()}}),t,this,[[5,18]])})))},r.doLogin=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=!!e||this.authenticator.checkAutoLogin(this.loginOption.forceMode),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",i?{user_id:this.account,action:"auto_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}:{user_id:this.account,action:"manual_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:Ti(this.loginOption),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:Ql.net.getNetworkStatus()}),n.next=6,this.doLoginStepsManager.add(this.lbs.getLbsInfos());case 6:return o=n.sent,n.next=9,this.doLoginStepsManager.add(this.clientSocket.connect(o,e));case 9:return n.next=11,this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(i));case 11:if(a=n.sent,this.lifeCycle.processEvent("loginSucc",void 0,sr(sr({},a),{isReconnect:e})),this.processId=Tp(),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.clientSocket.ping(),this.core.abtest.abtRequest(),"function"==typeof(null===(t=this.core.V2NIMClientAntispamUtil)||void 0===t?void 0:t.downloadLocalAntiSpamVocabs)&&this.core.V2NIMClientAntispamUtil.downloadLocalAntiSpamVocabs(),"function"!=typeof(null===(r=this.core.cloudStorage)||void 0===r?void 0:r.init)){n.next=28;break}return n.prev=20,n.next=23,this.core.cloudStorage.init();case 23:n.next=28;break;case 25:n.prev=25,n.t0=n.catch(20),this.logger.warn("doLogin::cloudStorage init error",n.t0);case 28:return n.abrupt("return",a);case 29:case"end":return n.stop()}}),n,this,[[20,25]])})))},r.smoothForLogined=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=this.checkIsSameLogin(e,t,r),this.logger.warn("V2NIMLoginService::smoothForLogined:Logined, isSameLogin "+i),!i){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,this.logout();case 8:return n.abrupt("return",this.login(e,t,r));case 9:case"end":return n.stop()}}),n,this)})))},r.smoothForLogining=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=this.checkIsSameLogin(e,t,r),this.logger.warn("V2NIMLoginService::smoothForLogining:Logining progress exists, abort the previous login attempt and start next attempt, isSameLogin "+i),this.previousLoginManager.clear(),this.reconnect.reset(),this.account=e,this.previousLoginAccount=e,this.token=t,this.loginOption=_p(this.loginOption,r),!i){n.next=18;break}if(this.originLoginPromise){n.next=11;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});case 11:return this.reconnect.reset(),n.next=14,ls.resolve();case 14:return n.next=16,this.multiTryDoLogin(this.originLoginPromise);case 16:n.next=25;break;case 18:return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(qf.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout"),n.next=24,ls.resolve();case 24:return n.abrupt("return",this.login(e,t,r));case 25:case"end":return n.stop()}}),n,this)})))},r.checkIsSameLogin=function(e,t,r){return this.account===e&&this.loginOption.authType===r.authType&&(0!==r.authType||this.token===t)},r.logout=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0,t=this.getConnectStatus(),r=this.getLoginStatus(),e.t0=r,e.next=1===e.t0?10:2===e.t0?25:3===e.t0?29:0===e.t0?33:35;break;case 10:return e.prev=10,e.next=13,this.clientSocket.sendCmd("v2Logout",void 0,{timeout:1e3});case 13:this.clientSocket.doDisconnect(qf.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),e.next=24;break;case 18:e.prev=18,e.t1=e.catch(10),this.logger.error("Instance::disconnect sendCmd:logout error",e.t1),this.clientSocket.doDisconnect(qf.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout");case 24:return e.abrupt("break",37);case 25:case 29:return this.clientSocket.doDisconnect(qf.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),e.abrupt("break",37);case 33:throw this.core._clearModuleData(),new Tl({code:yl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. loginStatus "+r+". connectStatus "+t}});case 35:throw this.core._clearModuleData(),new Tl({code:yl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. illegal status: loginStatus "+r+". connectStatus "+t}});case 37:case"end":return e.stop()}}),e,this,[[10,18]])})))},r.getConnectStatus=function(){return this.lifeCycle.getConnectStatus()},r.getLoginStatus=function(){return this.lifeCycle.getLoginStatus()},r.getLoginUser=function(){return this.account},r.getLoginClients=function(){var e;return au(e=function(e,t){e=e||[],t=t||"";for(var r=[],n=[],i=0;i<e.length;i++){var o=e[i][t];-1===bu(n).call(n,o)&&(n.push(o),r.push(e[i]))}return r}(this.authenticator.loginClients,"clientId")).call(e,(function(e){return eg(e,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])}))},r.getCurrentLoginClient=function(){var e;if(null===(e=this.authenticator.loginClientOfThisConnection)||void 0===e?void 0:e.clientId)return eg(this.authenticator.loginClientOfThisConnection,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])},r.getDataSync=function(){var e=this.dataSync.datas;return e&&e.length>0?au(e).call(e,(function(e){return{type:e.type,state:e.state}})):null},r.setReconnectDelayProvider=function(e){this.reconnect._setReconnectDelayProvider(e)},r.kickOffline=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkApiVersion(),Al({clientId:{type:"string",allowEmpty:!1}},e,"",!0),t.next=4,this.clientSocket.sendCmd("v2KickOffline",{clientIds:[e.clientId]});case 4:if(0!==Qp(t.sent,"content.clientIds.length")){t.next=8;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_REQUEST_FAILED});case 8:case"end":return t.stop()}}),t,this)})))},r.getKickedOfflineDetail=function(){return this.kickedDetail},r.checkLoginTerminalCode=function(e){return this.authenticator.checkLoginTerminalCode(e)},r.checkIllegalState=function(){if(!this.getLoginUser())throw new Tl({code:yl.V2NIM_ERROR_CODE_ILLEGAL_STATE})},r._checkApiVersion=function(){if("v2"!==this.core.options.apiVersion)throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v2"'}})},r.v2LoginHandler=function(e){if(e.error)throw this.clientSocket.doDisconnect(qf.ACTIVE,e.error),e.error;return e},r.v2LoginClientChangeHandler=function(e){this.authenticator.changeLoginClient(Kp(e.content.state),e.content.datas)},r.nimLoginClientChangeHandler=function(e){this.authenticator.changeLoginClient(Kp(e.content.state),e.content.datas)},r.qchatLoginClientChangeHandler=function(e){var t=Kp(e.content.state);t=1===t?2:3,this.authenticator.changeLoginClient(t,[e.content.data])},r.v2BeKickedHandler=function(e){if(e.error)this.core.logger.error("v2BeKickedHandler error, ",e.error);else{var t=wh({reason:{type:"number"},clientType:{type:"number"},customClientType:{type:"number"}},e.content);this.core.logger.warn("v2Bekicked::",t),this.kickedDetail=t,this.clientSocket.doDisconnect(qf.KICKED,t),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new Tl({code:yl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),t),this.emit("onKickedOffline",t)}},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onLoginFailed"===t||"onDisconnected"===t||"onConnectFailed"===t){var c=a[0];this.logger.log(""+i,c.toString())}else if("onDataSync"===t){var u=a[2];this.logger.log(""+i,a[0],a[1],u&&u.toString())}else{var d,l;(d=this.logger).log.apply(d,Rs(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,a))},at(t,[{key:"hasSettingService",get:function(){var e;return!!(null===(e=this.core.V2NIMSettingService)||void 0===e?void 0:e.name)}}]),t}($h),ig=gs.entries;rt({target:"Object",stat:!0},{entries:function(e){return ig(e)}});var og=q.Object.entries,ag=function(){function e(){this.map=new rd,this.readTimeMap=new rd}var t=e.prototype;return t.set=function(e){var t=this;Bn(e).call(e,(function(e){e=t.processConversation(e),au(t).set(e.conversationId,e)}))},t.reset=function(){au(this).clear()},t.count=function(){return au(this).size},t.sort=function(){var e,t=this,r=Vl(gu(e=au(this)).call(e));xm(r).call(r,(function(e,t){return t.sortOrder-e.sortOrder})),au(this).clear(),Bn(r).call(r,(function(e){au(t).set(e.conversationId,e)}))},t.processConversation=function(e){return"string"==typeof e.lastMessage&&delete e.lastMessage,void 0===e.localExtension&&(e.localExtension=""),e},t.getById=function(e){return au(this).get(e)},t.getAll=function(){var e,t=Vl(gu(e=au(this)).call(e));return xm(t).call(t,(function(e,t){return t.sortOrder-e.sortOrder}))},t.getByOption=function(e,t,r){var n,i=r.conversationTypes,o=r.onlyUnread,a=r.conversationGroupIds,s=[];Bn(n=au(this)).call(n,(function(e){if((!(i&&i.length>0)||tu(i).call(i,e.type))&&(!o||e.unreadCount)&&(!r.ignoreMuted||!e.mute)){if(a){var t=e.groupIds,n=(null==t?void 0:t.length)||0;if(0===a.length&&n>0)return;if(a.length>0&&0===n)return;if(a.length>0&&n>0&&!Um(a).call(a,(function(e){return t&&tu(t).call(t,e)})))return}s.push(e)}})),s=xm(s).call(s,(function(e,t){return t.sortOrder-e.sortOrder}));var c=0;e>0&&(c=Ap(s,"sortOrder",e),s[c]&&s[c].sortOrder===e&&(c+=1));var u=Fc(s).call(s,c).length;return(s=Fc(s).call(s,c,c+t)).length>0?{offset:u>t?s[s.length-1].sortOrder:0,finished:!(u>t),conversationList:s}:{offset:0,finished:!0,conversationList:s}},t.upsert=function(e){var t=e.conversationId,r=au(this).get(t);if(!r)return e=this.processConversation(sr({},e)),au(this).set(t,e),e.unreadCount>0;var n=e.unreadCount!==r.unreadCount,i=sr({},r,e);return i=this.processConversation(i),au(this).set(t,i),n},t.bulkUpsert=function(e){var t=this,r=!1;return Bn(e).call(e,(function(e){t.upsert(e)&&(r=!0)})),r},t.deleteById=function(e){var t=this.getById(e);if(t)return au(this).delete(e),t},t.updateReadTime=function(e,t){this.readTimeMap.set(e,t)},t.getReadTime=function(e){return this.readTimeMap.get(e)||0},e}(),sg=y("".startsWith),cg=y("".slice),ug=Math.min,dg=Jc("startsWith");rt({target:"String",proto:!0,forced:!dg},{startsWith:function(e){var t=Qi(L(this));Qc(e);var r=gt(ug(arguments.length>1?arguments[1]:void 0,t.length)),n=Qi(e);return sg?sg(t,n,r):cg(t,r,r+n.length)===n}});var lg=zt("String").startsWith,pg=String.prototype,mg=function(e){var t=e.startsWith;return"string"==typeof e||e===pg||G(pg,e)&&t===pg.startsWith?lg:t},hg=function(){function e(e){this.name="V2NIMConversationIdUtil",this.core=e}var t=e.prototype;return t.p2pConversationId=function(e){return this.core.account+"|1|"+e},t.teamConversationId=function(e){return this.core.account+"|2|"+e},t.superTeamConversationId=function(e){return this.core.account+"|3|"+e},t.messageConversationId=function(e){return 1===e.conversationType?e.senderId===this.core.account?this.p2pConversationId(e.receiverId):this.p2pConversationId(e.senderId):2===e.conversationType?this.teamConversationId(e.receiverId):this.superTeamConversationId(e.receiverId)},t.parseConversationType=function(e){try{if(e&&mg(e).call(e,this.core.account+"|")){var t=e.replace(this.core.account+"|","");return Number(t[0])}return this.core.logger.warn("conversationId is not start with "+this.core.account),0}catch(r){return 0}},t.parseConversationTargetId=function(e){try{if(e&&mg(e).call(e,this.core.account+"|")){var t=e.replace(this.core.account+"|","");return Fc(t).call(t,2)}return this.core.logger.warn("conversationId is not start with "+this.core.account),""}catch(r){return""}},t.convertToV1ConversationId=function(e){var t=this.parseConversationType(e);return(1===t?"p2p":2===t?"team":"superTeam")+"|"+this.parseConversationTargetId(e)},e}();function fg(e,t){var r=typeof e;if(r!==typeof t)return!1;if("object"===r){if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!1;if(Si(e)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!fg(e[n],t[n]))return!1;return!0}if(e instanceof RegExp&&t instanceof RegExp)return e.toString()===t.toString();if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(null===e&&null===t)return!0;if(pr(e).length!==pr(t).length)return!1;for(var i in e)if(!fg(e[i],t[i]))return!1;return!0}return e===t}var gg={"31_1":"v2TeamCreate","32_1":"v2SuperTeamCreate","31_5":"v2TeamInviteMembers","32_5":"v2SuperTeamInviteMembers","31_6":"v2TeamKickMembers","32_6":"v2SuperTeamKickMembers","31_8":"v2TeamLeave","32_7":"v2SuperTeamLeave","31_7":"v2TeamUpdateInfo","32_8":"v2SuperTeamUpdateInfo","31_9":"v2TeamGetInfo","32_9":"v2SuperTeamGetInfo","31_12":"v2TeamDismiss","32_4":"v2SuperTeamDismiss","31_13":"v2TeamApplyToJoin","32_20":"v2SuperTeamApplyToJoin","31_14":"v2TeamAcceptJoinApplication","32_21":"v2SuperTeamAcceptJoinApplication","31_15":"v2TeamRejectJoinApplication","32_22":"v2SuperTeamRejectJoinApplication","31_16":"v2TeamAddManagers","32_26":"v2SuperTeamAddManagers","31_17":"v2TeamRemoveManagers","32_27":"v2SuperTeamRemoveManagers","31_18":"v2TeamTransferOwner","32_31":"v2SuperTeamTransferOwner","31_19":"v2TeamUpdateSelfMemberInfo","32_10":"v2SuperTeamUpdateSelfMemberInfo","31_20":"v2TeamUpdateMember","32_30":"v2SuperTeamUpdateMember","31_21":"v2TeamAcceptInvitation","32_23":"v2SuperTeamAcceptInvitation","31_22":"v2TeamRejectInvite","32_24":"v2SuperTeamRejectInvite","31_33":"v2TeamGetMemberInvitor","32_35":"v2SuperTeamGetMemberInvitor","31_25":"v2TeamMemberSetChatBannedStatus","32_29":"v2SuperTeamMemberSetChatBannedStatus","31_32":"v2TeamSetChatBannedMode","32_28":"v2SuperTeamSetChatBannedMode","31_34":"v2TeamGetByIds","32_36":"v2SuperTeamGetByIds","31_35":"v2TeamMemberGetListByIds","32_37":"v2SuperTeamMemberGetListByIds","31_36":"v2TeamMemberGetList","8_101":"v2TeamCreateMultiSync","8_109":"v2TeamSync","8_119":"v2TeamMemberUpdateMultiSync","8_126":"v2TeamMembersOfSelfInSync","21_101":"v2SuperTeamCreateMultiSync","21_109":"v2SuperTeamSync","21_110":"v2SuperTeamMemberUpdateMultiSync","21_111":"v2SuperTeamMembersOfSelfInSync"},vg={antispamBusinessId:1},yg="V2NIMTeamService",Ig={teamId:1,name:3,teamType:{id:4,retConverter:function(e){return 0==+e?1:+e}},ownerAccountId:5,memberLimit:{id:6,retType:"number"},isValidTeam:{id:8,retConverter:function(e,t){return 1==+e&&(void 0===t[13]||1==+t[13])}},memberCount:{id:9,retType:"number"},memberUpdateTime:{id:10,retType:"number"},createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},intro:14,announcement:15,joinMode:{id:16,retType:"number"},serverExtension:18,customerExtension:19,avatar:20,agreeMode:{id:21,retType:"number"},inviteMode:{id:22,retType:"number"},updateInfoMode:{id:23,retType:"number"},updateExtensionMode:{id:24,retType:"number"},chatBannedMode:{id:101,retType:"number"}},Mg={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},joinTime:{id:10,retType:"number"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,followAccountIds:{id:16,retConverter:function(e){try{return JSON.parse(e)}catch(t){return[]}}}},Tg={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,joinTime:{id:15,retType:"number"},followAccountIds:{id:17,retConverter:function(e){try{return JSON.parse(e)}catch(t){return[]}}}},Sg={accountIds:{id:1,converter:function(e){return Ti(e)}},operation:2},bg={v2TeamCreate:{sid:31,cid:1,service:yg,params:[{type:"Property",name:"team",reflectMapper:Ig},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:vg}],response:[{type:"Property",name:"team",reflectMapper:gh(Ig)},{type:"StrArray",name:"failedList"}]},v2SuperTeamCreate:{sid:32,cid:1,service:yg,params:[{type:"Property",name:"team",reflectMapper:Ig},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:vg}],response:[{type:"Property",name:"team",reflectMapper:gh(Ig)},{type:"StrArray",name:"failedList"}]},v2TeamInviteMembers:{sid:31,cid:5,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},v2SuperTeamInviteMembers:{sid:32,cid:5,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},v2TeamUpdateInfo:{sid:31,cid:7,service:yg,params:[{type:"Property",name:"team",reflectMapper:Ig},{type:"Property",name:"antispamConfig",reflectMapper:vg}],response:[{type:"Long",name:"teamId"},{type:"Long",name:"timestamp"}]},v2SuperTeamUpdateInfo:{sid:32,cid:8,service:yg,params:[{type:"Property",name:"team",reflectMapper:Ig},{type:"Property",name:"antispamConfig",reflectMapper:vg}],response:[{type:"Long",name:"timestamp"}]},v2TeamLeave:{sid:31,cid:8,service:yg,params:[{type:"Long",name:"teamId"}]},v2SuperTeamLeave:{sid:32,cid:7,service:yg,params:[{type:"Long",name:"teamId"}]},v2TeamGetInfo:{sid:31,cid:9,service:yg,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:gh(Ig)}]},v2SuperTeamGetInfo:{sid:32,cid:9,service:yg,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:gh(Ig)}]},v2TeamGetByIds:{sid:31,cid:34,service:yg,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:gh(Ig)},{type:"LongArray",name:"tids"}]},v2SuperTeamGetByIds:{sid:32,cid:36,service:yg,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:gh(Ig)},{type:"LongArray",name:"tids"}]},v2TeamDismiss:{sid:31,cid:12,service:yg,params:[{type:"Long",name:"teamId"}]},v2SuperTeamDismiss:{sid:32,cid:4,service:yg,params:[{type:"Long",name:"teamId"}]},v2TeamAcceptInvitation:{sid:31,cid:21,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:gh(Ig)}]},v2SuperTeamAcceptInvitation:{sid:32,cid:23,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:gh(Ig)}]},v2TeamRejectInvite:{sid:31,cid:22,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectInvite:{sid:32,cid:24,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamKickMembers:{sid:31,cid:6,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamKickMembers:{sid:32,cid:6,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamApplyToJoin:{sid:31,cid:13,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:gh(Ig)},{type:"Int",name:"isInTeam"}]},v2SuperTeamApplyToJoin:{sid:32,cid:20,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:gh(Ig)},{type:"Int",name:"isInTeam"}]},v2TeamAcceptJoinApplication:{sid:31,cid:14,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2SuperTeamAcceptJoinApplication:{sid:32,cid:21,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2TeamRejectJoinApplication:{sid:31,cid:15,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectJoinApplication:{sid:32,cid:22,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamAddManagers:{sid:31,cid:16,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamAddManagers:{sid:32,cid:26,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamRemoveManagers:{sid:31,cid:17,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamRemoveManagers:{sid:32,cid:27,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamTransferOwner:{sid:31,cid:18,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2SuperTeamTransferOwner:{sid:32,cid:31,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2TeamUpdateSelfMemberInfo:{sid:31,cid:19,service:yg,params:[{type:"Property",name:"teamMember",reflectMapper:Mg},{type:"Property",name:"specialFollowUpdate",reflectMapper:Sg}],response:[{type:"Property",name:"data",reflectMapper:gh(Mg)}]},v2SuperTeamUpdateSelfMemberInfo:{sid:32,cid:10,service:yg,params:[{type:"Property",name:"teamMember",reflectMapper:Tg},{type:"Property",name:"specialFollowUpdate",reflectMapper:Sg}],response:[{type:"Property",name:"data",reflectMapper:gh(Tg)}]},v2TeamUpdateMember:{sid:31,cid:20,service:yg,params:[{type:"Property",name:"teamMember",reflectMapper:Mg}]},v2SuperTeamUpdateMember:{sid:32,cid:30,service:yg,params:[{type:"Property",name:"teamMember",reflectMapper:Tg}]},v2TeamGetMemberInvitor:{sid:31,cid:33,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2SuperTeamGetMemberInvitor:{sid:32,cid:35,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2TeamMemberSetChatBannedStatus:{sid:31,cid:25,service:yg,params:[{type:"Long",name:"teamId"},{type:"String",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2SuperTeamMemberSetChatBannedStatus:{sid:32,cid:29,service:yg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2TeamSetChatBannedMode:{sid:31,cid:32,service:yg,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2SuperTeamSetChatBannedMode:{sid:32,cid:28,service:yg,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2TeamMemberGetListByIds:{sid:31,cid:35,service:yg,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(Mg)}]},v2SuperTeamMemberGetListByIds:{sid:32,cid:37,service:yg,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(Tg)}]},v2TeamMemberGetList:{sid:31,cid:36,service:yg,params:[{type:"Property",name:"tag",reflectMapper:{teamId:1,teamType:2,roleQueryType:3,onlyChatBanned:{id:4,converter:function(e){return+e}},nextToken:5,limit:6,direction:7}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(Mg)},{type:"Property",name:"pageInfo",reflectMapper:{1:"hasMore",2:"nextToken"}}]},v2TeamSync:{sid:8,cid:109,service:yg,response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"datas",reflectMapper:gh(Ig)}]},v2TeamCreateMultiSync:{sid:8,cid:101,service:yg,response:[{type:"Property",name:"data",reflectMapper:gh(Ig)}]},v2TeamMemberUpdateMultiSync:{sid:8,cid:119,service:yg,response:[{type:"Property",name:"data",reflectMapper:gh(Mg)}]},v2TeamMembersOfSelfInSync:{sid:8,cid:126,service:yg,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(Mg)},{type:"Long",name:"timetag"}]},v2SuperTeamSync:{sid:21,cid:109,service:yg,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(Ig)},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},v2SuperTeamCreateMultiSync:{sid:21,cid:101,service:yg,response:[{type:"Property",name:"data",reflectMapper:gh(Ig)}]},v2SuperTeamMemberUpdateMultiSync:{sid:21,cid:110,service:yg,response:[{type:"Property",name:"data",reflectMapper:gh(Tg)}]},v2SuperTeamMembersOfSelfInSync:{sid:21,cid:111,service:yg,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(Tg)},{type:"Long",name:"timetag"}]}};function Cg(e,t){if(!e)return{};var r=e;return r.tinfo&&(r.tinfo=mh(r.tinfo,gh(Ig)),r.tinfo.teamType=t),r.uinfos,void 0!==r.mute&&(r.mute=Kp(r.mute)),r}function Eg(e,t,r){return void 0===r&&(r={}),sr({teamId:e,teamType:t,name:"",ownerAccountId:"",memberLimit:0,memberCount:0,createTime:0,updateTime:0,intro:"",announcement:"",avatar:"",joinMode:0,agreeMode:0,inviteMode:0,updateInfoMode:0,updateExtensionMode:0,chatBannedMode:0,isValidTeam:!0},r)}function _g(e,t,r,n){return void 0===n&&(n={}),sr({teamId:e,teamType:t,accountId:r,joinTime:0,inTeam:!0,memberRole:0,chatBanned:!1},n)}function kg(e,t){return void 0===t&&(t=1),au(e).call(e,(function(e){return void 0===(n=t)&&(n=1),(r=e).teamType=n,r.chatBanned=void 0!==r.chatBanned&&r.chatBanned,r;var r,n}))}function Rg(e,t){var r,n=sr(sr({},t),{conversationId:e.V2NIMConversationIdUtil.messageConversationId(t),isSelf:t.senderId===e.account,sendingState:1,messageStatus:{errorCode:(null===(r=null==t?void 0:t.messageStatus)||void 0===r?void 0:r.errorCode)||200}});return n.threadReply&&(n.threadReply=sr(sr({},n.threadReply),{conversationType:n.conversationType,conversationId:n.conversationId})),n.threadRoot&&(n.threadRoot=sr(sr({},n.threadRoot),{conversationType:n.conversationType,conversationId:n.conversationId})),n}function wg(e,t){return sr(sr({},t),{conversationId:e.V2NIMConversationIdUtil.messageConversationId(t)})}function Ag(e,t){var r=t.createTime,n=t.senderId,i=t.receiverId,o=t.conversationType;return{conversationType:o,conversationId:e.V2NIMConversationIdUtil.messageConversationId({conversationType:o,senderId:n,receiverId:i}),senderId:t.senderId,receiverId:t.receiverId,messageServerId:t.messageServerId,createTime:r,messageClientId:t.messageClientId}}function xg(e,t){var r={7:1,8:2,12:3,13:1,14:2}[t.sysMsgType];return{postscript:t.postscript,revokeType:{7:1,8:2,12:3,13:4,14:5}[t.sysMsgType]||0,revokeAccountId:t.opeAccount||t.senderId,callbackExtension:t.callbackExtension,serverExtension:t.attach||"",messageRefer:{conversationType:r,conversationId:e.V2NIMConversationIdUtil.messageConversationId(sr(sr({},t),{conversationType:r,senderId:t.senderId,receiverId:t.receiverId})),senderId:t.senderId,receiverId:t.receiverId,messageServerId:t.messageServerId,createTime:t.deleteMsgCreatetime,messageClientId:t.messageClientId}}}function Ng(e,t){return{conversationId:1===t.conversationType?e.V2NIMConversationIdUtil.p2pConversationId(t.receiverId):2===t.conversationType?e.V2NIMConversationIdUtil.teamConversationId(t.teamId):e.V2NIMConversationIdUtil.superTeamConversationId(t.teamId),deleteTime:t.deleteTime,serverExtension:t.serverExtension}}function Og(e,t){var r={0:0,401:401,1:1,402:402,2:2,403:403,3:3,404:404,4:4,405:405,5:5,410:410,6:6,406:406,7:7,407:407,8:8,408:408,9:9,411:411,10:10,409:409};return void 0===r[t]&&e.logger.warn("[V2NIMMessageService] undefined notification type: "+t),"number"==typeof r[t]?r[t]:-1}function Pg(e,t){return 5===e.messageType?function(e,t){var r,n,i,o,a,s=t.attachment||{};if(t.attachment&&"type"in t.attachment)return t;var c=void 0;if(null===(r=s.data)||void 0===r?void 0:r.tinfo){var u=s.id,d=s.data,l=u>400?2:1,p=Cg(sr({},d),l).tinfo;c={},p.teamId,c=Hl(p,["teamId"])}var m=sr(sr(sr(sr({raw:s.raw,type:Og(e,s.id)},c?{updatedTeamInfo:c}:{}),{targetIds:(null===(n=s.data)||void 0===n?void 0:n.ids)||((null===(i=s.data)||void 0===i?void 0:i.id)?[s.data.id]:[])}),"string"==typeof(null===(o=s.data)||void 0===o?void 0:o.attach)?{serverExtension:s.data.attach}:{}),"number"==typeof(null===(a=s.data)||void 0===a?void 0:a.mute)?{chatBanned:0!==s.data.mute}:{});return sr(sr({},t),{attachment:m})}(t,e):100===e.messageType?function(e,t){var r,n,i;if("string"==typeof(null===(r=t.attachment)||void 0===r?void 0:r.raw)&&(null===(i=null===(n=e.V2NIMMessageService)||void 0===n?void 0:n.customAttachmentParsers)||void 0===i?void 0:i.length)>0){var o=t.subType||0,a=e.V2NIMMessageService.customAttachmentParsers,s=t.attachment.raw;Um(a).call(a,(function(r){try{var n=r(o,s);if(Yl(n))return n.raw=s,t.attachment=n,!0}catch(i){return e.logger.warn("customAttachmentParser: subType "+o+", raw: "+s+". parse error with "+i),!1}return!1}))}return t}(t,e):e}function Lg(e,t){if(!t)return"";switch(e){case 100:return t.raw||"";case 1:case 3:case 2:case 6:return function(e){var t=e,r=t.width,n=t.height,i=t.duration;t.path,t.file,t.raw,t.ctx,t.payload,t.bucketName,t.objectName,t.token;var o=t.ext,a=Hl(t,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","ext"]),s="string"==typeof o&&"."===o[0]?Fc(o).call(o,1):o;return Ti(sr(sr(sr(sr(sr({},a),void 0===o?{}:{ext:s}),void 0===r?{}:{w:r}),void 0===n?{}:{h:n}),void 0===i?{}:{dur:i}))}(t);case 4:return Ti({lat:(r=t).latitude,lng:r.longitude,title:r.address});case 12:return function(e){e.raw;var t=Hl(e,["raw"]);try{var r;return Ti(sr(sr({},t),{durations:au(r=e.durations).call(r,(function(e){return{accid:e.accountId,duration:e.duration}}))}))}catch(n){return Ti(e)}}(t);default:return t.raw||Ti(t)}var r}function Vg(e,t){var r,n,i;try{switch(r=JSON.parse(e),t){case 100:return{raw:e};case 4:return n=e,{latitude:(i=r).lat,longitude:i.lng,address:i.title,raw:n};case 2:case 3:case 1:case 6:return function(e,t){var r=t.w,n=t.h,i=t.dur,o=t.ext,a=Hl(t,["w","h","dur","ext"]),s="string"==typeof o&&"."!==o[0]?"."+o:o;return sr(sr(sr(sr(sr(sr({},a),void 0===o?{}:{ext:s}),void 0===r?{}:{width:r}),void 0===n?{}:{height:n}),void 0===i?{}:{duration:i}),{raw:e})}(e,r);case 12:return function(e,t){var r;return sr(sr({},t),{durations:au(r=t.durations).call(r,(function(e){return{accountId:e.accid,duration:e.duration}})),raw:e})}(e,r);default:return"object"==typeof r&&r?sr(sr({},r),{raw:e}):{raw:e}}}catch(i){return"object"==typeof r&&r?sr(sr({},r),{raw:e}):{raw:e}}}var Ug="V2NIMMessageService",Dg={"30_1":"v2SendP2pMessage","31_2":"v2SendTeamMessage","30_31":"v2MessageP2pModify","31_37":"v2MessageTeamModify","32_38":"v2MessageSuperTeamModify","7_33":"v2MessageOnModified","4_27":"v2MessageSyncModified","4_28":"v2MessageSuperTeamSyncModified","4_5":"v2BatchMarkRead","4_12":"syncP2PMessagReceipts","30_11":"v2SendP2PMessageReceipt","31_28":"v2SendTeamMessageReceipts","32_2":"v2SendSuperTeamMessage","7_12":"onP2PMessageReceipts","8_31":"onTeamMessageReceipts","31_29":"v2GetTeamMessageReceipts","31_30":"v2GetTeamMessageReceiptDetail","7_2":"onMsg","8_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_3":"onMsg","21_102":"onMsg","4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","30_13":"v2RevokeMessage","32_17":"v2RevokeSuperTeamMessage","7_14":"onRevokeMessage","7_15":"syncRevokeMessage","21_18":"onRevokeMessage","21_117":"onRevokeMessage","30_23":"v2DeleteMessage","30_24":"v2DeleteMessages","4_21":"syncOnDeleteMessages","7_123":"onDeleteMessage","7_124":"onDeleteMessages","29_17":"v2DownloadLocalAntiSpamVocabs"},qg={conversationType:{id:0,converter:Yg,retConverter:Kg},receiverId:1,senderId:2,fromClientType:4,fromDeviceId:5,fromNick:6,createTime:{id:7,retType:"number"},messageType:{id:8,retType:"number"},text:9,attachment:{id:10,converter:function(e,t){return Lg(t.messageType,e)},retConverter:function(e,t){return Vg(e,Number(t[8]))}},messageClientId:11,messageServerId:12,resend:{id:13,converter:vh,retType:"boolean"},userUpdateTime:{id:14,retType:"number"},serverExtension:15,pushPayload:{id:16,access:"pushConfig.pushPayload"},pushContent:{id:17,access:"pushConfig.pushContent"},forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function(e){if(e["pushConfig.forcePush"])return"#%@all@%#"},converter:function(e,t){if(t["pushConfig.forcePush"]){if(0===e.length)return"#%@all@%#";try{return Ti(e)}catch(r){return"#%@all@%#"}}},retConverter:function(e){if("#%@all@%#"===e)return e;if(e)try{return JSON.parse(e)}catch(t){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,access:"pushConfig.forcePush",converter:vh,retType:"boolean"},antispamCustomMessageEnabled:{id:21,def:function(e){return Qp(e,"antispamConfig.antispamCustomMessage")?1:void 0},retConverter:function(){}},antispamCustomMessage:{id:22,access:"antispamConfig.antispamCustomMessage"},antispamBusinessId:{id:23,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:24,access:"clientAntispamHit",converter:vh,retType:"boolean"},antispamEnabled:{id:25,access:"antispamConfig.antispamEnabled",converter:vh,retType:"boolean"},needAck:{id:26,access:"messageConfig.readReceiptEnabled",converter:vh,retType:"boolean"},lastMessageUpdateEnabled:{id:28,access:"messageConfig.lastMessageUpdateEnabled",converter:vh,retType:"boolean"},threadReplySenderId:{id:29,access:"threadReply.senderId"},threadReplyReceiverId:{id:30,access:"threadReply.receiverId"},threadReplyTime:{id:31,access:"threadReply.createTime",retType:"number"},threadReplyServerId:{id:32,access:"threadReply.messageServerId"},threadReplyClientId:{id:33,access:"threadReply.messageClientId"},threadRootSenderId:{id:34,access:"threadRoot.senderId"},threadRootReceiverId:{id:35,access:"threadRoot.receiverId"},threadRootTime:{id:36,access:"threadRoot.createTime",retType:"number"},threadRootServerId:{id:37,access:"threadRoot.messageServerId"},threadRootClientId:{id:38,access:"threadRoot.messageClientId"},callbackExtension:40,subType:{id:41,retType:"number"},antispamCheating:{id:42,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:43,access:"routeConfig.routeEnvironment"},antispamExtension:{id:44,access:"antispamConfig.antispamExtension"},antispamResult:45,__clientExt:{id:46,converter:yh,retConverter:Ih},robotFunction:{id:47,access:"robotConfig.function"},robotTopic:{id:48,access:"robotConfig.topic"},robotCustomContent:{id:49,access:"robotConfig.customContent"},robotAccount:{id:50,access:"robotConfig.accountId"},_conversationOnlineSyncNotify:{id:51},_conversationOnlineSyncData:{id:52},aiAgentMsgDirection:{id:55,access:"aiConfig.aiStatus",retAccess:"aiConfig.aiStatus",retType:"number"},aiAgentAccount:{id:56,access:"aiConfig.accountId",retAccess:"aiConfig.accountId"},aiAgentContent:{id:57,access:"aiConfig.content",converter:yh,retConverter:Rp},aiAgentMessages:{id:58,access:"aiConfig.messages",converter:yh,retConverter:Rp},aiAgentPromptVariables:{id:59,access:"aiConfig.promptVariables",retConverter:Rp},aiAgentModelConfigParams:{id:60,access:"aiConfig.modelConfigParams",converter:yh,retConverter:Rp},errorCode:{id:61,access:"messageStatus.errorCode",retType:"number"},modifyTime:{id:62,retType:"number"},modifyAccountId:63,historyEnabled:{id:100,access:"messageConfig.historyEnabled",converter:vh,retType:"boolean"},roamingEnabled:{id:101,access:"messageConfig.roamingEnabled",converter:vh,retType:"boolean"},onlineSyncEnabled:{id:102,access:"messageConfig.onlineSyncEnabled",converter:vh,retType:"boolean"},routeEnabled:{id:105,access:"routeConfig.routeEnabled",converter:vh,retType:"boolean"},pushEnable:{id:107,access:"pushConfig.pushEnabled",converter:vh,retType:"boolean"},offlineEnabled:{id:108,access:"messageConfig.offlineEnabled",converter:vh,retType:"boolean"},unreadEnabled:{id:109,access:"messageConfig.unreadEnabled",converter:vh,retType:"boolean"},pushNickEnabled:{id:110,access:"pushConfig.pushNickEnabled",converter:vh,retType:"boolean"},msgAckSnapshot:{id:112,retType:"number"},receiverIds:{id:154,access:"targetConfig.receiverIds",converter:yh,retConverter:function(){}},inclusive:{id:155,access:"targetConfig.inclusive",converter:function(e){return e?1:2},retConverter:function(){}},newMemberVisible:{id:156,access:"targetConfig.newMemberVisible",converter:function(e){return e?1:2},retConverter:function(){}}},Bg=gh(qg),Fg={conversationType:{id:1,access:"messageRefer.conversationType",retType:"number"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},messageServerId:{id:4,access:"messageRefer.messageServerId"},messageClientId:{id:5,access:"messageRefer.messageClientId"},createTime:{id:6,access:"messageRefer.createTime",retType:"number"},deleteTime:{id:7,retType:"number"},serverExtension:8};gh(Fg);var Gg={version:1,md5:2,nosurl:3,thesaurus:4},jg={createTime:{id:0,retType:"number"},sysMsgType:1,receiverId:2,senderId:3,postscript:4,attach:5,pushContent:8,pushPayload:9,messageClientId:10,messageServerId:11,deleteMsgCreatetime:{id:14,retType:"number"},opeAccount:16,env:21,callbackExtension:22},Hg={receiverId:0,messageServerId:1,readCount:{id:100,retType:"number"},unreadCount:{id:101,retType:"number"},messageClientId:102,latestReadAccount:103},Wg={v2BatchMarkRead:{sid:4,cid:5,service:Ug,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},v2SendP2pMessage:{sid:30,cid:1,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:qg}],response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},onMsg:{sid:7,cid:2,service:Ug,response:[{type:"Property",name:"msg",reflectMapper:gh(qg)}]},syncOfflineMsgs:{sid:4,cid:4,service:Ug,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(qg)}]},syncRoamingMsgs:{sid:4,cid:9,service:Ug,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(qg)}]},v2SendP2PMessageReceipt:{sid:30,cid:11,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:qg}],response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},v2RevokeMessage:{sid:30,cid:13,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:jg}]},v2DeleteMessage:{sid:30,cid:23,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Fg}],response:[{type:"Long",name:"timetag"}]},v2DeleteMessages:{sid:30,cid:24,service:Ug,params:[{type:"PropertyArray",name:"tag",reflectMapper:Fg}],response:[{type:"Long",name:"timetag"}]},v2SendTeamMessage:{sid:31,cid:2,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:qg}],response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},v2SendTeamMessageReceipts:{sid:31,cid:28,service:Ug,params:[{type:"PropertyArray",name:"tag",reflectMapper:Hg}],response:[{type:"PropertyArray",name:"tag",reflectMapper:gh(Hg)}]},v2SendSuperTeamMessage:{sid:32,cid:2,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:qg}],response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},v2RevokeSuperTeamMessage:{sid:32,cid:17,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:jg}]},syncP2PMessagReceipts:{sid:4,cid:12,service:Ug,response:[{type:"PropertyArray",name:"data",reflectMapper:gh(qg)}]},onP2PMessageReceipts:{sid:7,cid:12,service:Ug,response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},v2GetTeamMessageReceipts:{sid:31,cid:29,service:Ug,params:[{type:"PropertyArray",name:"tag",reflectMapper:Hg}],response:[{type:"PropertyArray",name:"data",reflectMapper:gh(Hg)}]},v2GetTeamMessageReceiptDetail:{sid:31,cid:30,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Hg,select:["receiverId","messageServerId"]}],response:[{type:"Property",name:"data",reflectMapper:gh(Hg)},{type:"StrArray",name:"readAccountList"},{type:"StrArray",name:"unreadAccountList"}]},onTeamMessageReceipts:{sid:8,cid:31,service:Ug,response:[{type:"PropertyArray",name:"data",reflectMapper:gh(Hg)}]},onRevokeMessage:{sid:7,cid:14,service:Ug,response:[{type:"Property",name:"data",reflectMapper:gh(jg)}]},syncRevokeMessage:{sid:7,cid:15,service:Ug,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(jg)}]},syncOnDeleteMessages:{sid:4,cid:21,service:Ug,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(Fg)}]},onDeleteMessage:{sid:7,cid:123,service:Ug,response:[{type:"Property",name:"data",reflectMapper:gh(Fg)}]},onDeleteMessages:{sid:7,cid:124,service:Ug,response:[{type:"PropertyArray",name:"data",reflectMapper:gh(Fg)}]},v2DownloadLocalAntiSpamVocabs:{sid:29,cid:17,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Gg}],response:[{type:"Property",name:"data",reflectMapper:gh(Gg)}]},v2MessageP2pModify:{sid:30,cid:31,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:qg}],response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},v2MessageTeamModify:{sid:31,cid:37,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:qg}],response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},v2MessageSuperTeamModify:{sid:32,cid:38,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:qg}],response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},v2MessageOnModified:{sid:7,cid:33,service:Ug,response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},v2MessageSyncModified:{sid:4,cid:27,service:Ug,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(qg)},{type:"Long",name:"time"}]},v2MessageSuperTeamSyncModified:{sid:4,cid:28,service:Ug,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(qg)},{type:"Long",name:"time"}]}};function Yg(e){return 1===e?0:2===e?1:3===e?5:void 0}function Kg(e){var t=Kp(e);return 0===t?1:1===t?2:5===t?3:0}var Qg,zg={type:{type:"number"},lastMessageState:{type:"number"},unreadCount:{type:"number"},stickTop:{type:"boolean"},sortOrder:{type:"number"},version:{type:"number"},deleteFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function Jg(e,t){return t&&t.length>0?au(t).call(t,(function(t){return Xg(e,t)})):[]}function $g(e,t,r,n){var i,o;void 0===r&&(r=0);var a=t=Pg(t,e),s=a.messageType,c=a.subType,u=a.text,d=a.attachment,l=a.serverExtension,p="";if(t.senderId!==e.account){p=Qp(t,"fromNick");var m=null===(o=null===(i=e.V2NIMFriendService)||void 0===i?void 0:i.model)||void 0===o?void 0:o.getFriend(t.senderId);m&&m.alias&&(p=m.alias)}return JSON.parse(Ti({lastMessageState:r,messageRefer:Ag(e,t),messageType:s,subType:c,text:u,attachment:d,serverExtension:l,callbackExtension:t.callbackExtension,sendingState:n,senderName:p}))}function Xg(e,t){var r,n,i,o,a,s,c,u,d,l=wh(zg,t);if(l.groupIds?l.groupIds=JSON.parse(l.groupIds):delete l.groupIds,"string"==typeof l.lastMessage)if(""===l.lastMessage);else if(1===l.lastMessageState){var p=xg(e,mh(JSON.parse(l.lastMessage),gh(jg)));l.lastMessage=(r=e,i=(n=p).messageRefer,o=n.revokeAccountId,a=n.revokeType,s=n.callbackExtension,c=n.serverExtension,u=n.postscript,d=function(e,t,r,n){var i,o,a,s,c,u,d,l;if(t!==e.account){var p=null===(o=null===(i=e.V2NIMFriendService)||void 0===i?void 0:i.model)||void 0===o?void 0:o.getFriend(t);if(p&&p.alias)return p.alias;if(2===r){var m=null===(s=null===(a=e.V2NIMTeamService)||void 0===a?void 0:a.memberModel)||void 0===s?void 0:s.getById(n,1,t);if(m&&m.teamNick)return m.teamNick}else if(3===r){var h=null===(u=null===(c=e.V2NIMTeamService)||void 0===c?void 0:c.memberModel)||void 0===u?void 0:u.getById(n,1,t);if(h&&h.teamNick)return h.teamNick}var f=null===(l=null===(d=e.V2NIMUserService)||void 0===d?void 0:d.model)||void 0===l?void 0:l.getUser(t);return f&&f.name?f.name:void 0}}(r,n.revokeAccountId,n.messageRefer.conversationType,n.messageRefer.receiverId)||"",JSON.parse(Ti({lastMessageState:1,messageRefer:i,revokeAccountId:o,revokeType:a,callbackExtension:s,serverExtension:c,text:u||"",senderName:d})))}else if(0===l.lastMessageState){var m=mh(JSON.parse(l.lastMessage),gh(qg));l.lastMessage=$g(e,m,l.lastMessageState,m.senderId===e.account?1:void 0)}else 2===l.lastMessageState&&delete l.lastMessage;return l}function Zg(e){var t=e.version,r=e.deleteFlag;return{conversation:Hl(e,["version","deleteFlag"]),version:t,deleteFlag:r}}!function(e){e[e.createConversation=1]="createConversation",e[e.deleteConversation=2]="deleteConversation",e[e.updateConversation=3]="updateConversation",e[e.setConversationTop=4]="setConversationTop",e[e.clearConversationUnread=5]="clearConversationUnread",e[e.addConversationToGroup=6]="addConversationToGroup",e[e.removeConversationFromGroup=7]="removeConversationFromGroup",e[e.modifyConversationOnSendMessage=8]="modifyConversationOnSendMessage",e[e.modifyConversationOnDeleteMessage=9]="modifyConversationOnDeleteMessage",e[e.modifyConversationOnRecallMessage=10]="modifyConversationOnRecallMessage",e[e.modifyConversationOnClearMessage=11]="modifyConversationOnClearMessage",e[e.oneClickClearConversationUnread=12]="oneClickClearConversationUnread",e[e.modifyConversationOnUpdateMessage=13]="modifyConversationOnUpdateMessage"}(Qg||(Qg={}));var ev={type:{type:"number"},oneClickClearUnreadType:{type:"number"},oneClickClearUnreadConversationType:{type:"object"},oneClickClearUnreadVersion:{type:"number"},deleteConversationClearMessage:{type:"boolean"}};function tv(e){return wh(ev,e)}var rv=function(){function e(e,t){this.fieldVersion={},this.conversationIdsForBackFill={},this.tempPacket=[],this.isSyncing=!1,this.nextCursor=0,this.core=e,this.service=t}var t=e.prototype;return t.reset=function(){this.tempPacket=[],this.fieldVersion={},this.conversationIdsForBackFill={},this.isSyncing=!1,this.nextCursor=0},t.doSync=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isSyncing=!0,this.service.emit("onSyncStarted"),e.prev=2,e.next=5,this.core.sendCmd("v2ConversationSync",{tag:{cursor:this.nextCursor}});case 5:t=e.sent,e.next=18;break;case 8:if(e.prev=8,e.t0=e.catch(2),(r=e.t0).code!==yl.V2NIM_ERROR_CODE_CANCELLED){e.next=13;break}return e.abrupt("return");case 13:return this.isSyncing=!1,this.service.emit("onSyncFailed",r),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:r,subType:"conversationSync"}),this.processTempPacket(),e.abrupt("return");case 18:n=0===Kp(Qp(t,"content.info.syncType")),i=Qp(t,"content.info.nextCursor"),this.doSyncAndSuccess(n,i);case 21:case"end":return e.stop()}}),e,this,[[2,8]])})))},t.doSyncAndSuccess=function(e,t){var r;e&&xm(r=this.service.model).call(r),this.isSyncing=!1,this.nextCursor=Kp(t)||0,this.service.unread.resetTotalAfterSyncDone(),this.service.unread.digestUnreadCountChange(),this.service.emit("onSyncFinished"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,subType:"conversationSync"}),this.processTempPacket()},t.setBackFillIds=function(e){var t=this;return Bn(e).call(e,(function(e){if(2===e.lastMessageState&&t.service.hasMessageService){t.conversationIdsForBackFill[e.conversationId]=!0;var r=t.core.V2NIMMessageService.model.getLastMessageOfConversation(e.conversationId);e.lastMessage=r?$g(t.core,r,e.lastMessageState,r.sendingState):""}else t.conversationIdsForBackFill[e.conversationId]=!1;delete e.lastMessageState})),e},t.recvConversationFromSyncAction=function(e){var t=this,r=Qp(e,"content.info").syncType,n=Jg(this.core,Qp(e,"content.datas"));0===(r=Kp(r))?(Bn(n).call(n,(function(e){t.initFieldVersion(e.conversationId,e.version)})),n=this.setBackFillIds(n),this.setModel(n)):(n=this.setBackFillIds(n),this.recvConversationForCreated(n)<n.length&&this.recvConversationForChanged(n))},t.recvConversation=function(e){var t=this;if(this.isSyncing)this.tempPacket.push(e);else{var r=Jg(this.core,Qp(e,"content.datas")),n=lu(r).call(r,(function(e){return!!e.conversationId})),i=tv(Qp(e,"content.info")),o=au(n).call(n,(function(e){return"id:"+e.conversationId+", ver:"+e.version})).join(";");if(this.core.logger.getDebugMode()?this.core.logger.debug("V2NIMConversation::recvConversation: "+o+".",i,n):this.core.logger.log("V2NIMConversation::recvConversation: "+o+".",i),2===i.type){var a=au(n).call(n,(function(e){return delete t.fieldVersion[e.conversationId],t.service.model.deleteById(e.conversationId),e.conversationId}));return this.service.emit("onConversationDeleted",a),void this.service.unread.digestUnreadCountChange()}12!==i.type?(i.type,n=this.setBackFillIds(n),this.recvConversationForCreated(n)<n.length&&this.recvConversationForChanged(n)):this.compareAndClearUnreadInModel(i.oneClickClearUnreadVersion,i.oneClickClearUnreadType,{conversationGroupIds:i.oneClickClearUnreadGroupId?[i.oneClickClearUnreadGroupId]:void 0,conversationTypes:i.oneClickClearUnreadConversationType})}},t.recvConversationForCreated=function(e){var t=this,r=lu(e).call(e,(function(e){return!t.fieldVersion[e.conversationId]}));return fl(r).call(r,(function(e,r){if(!t.fieldVersion[r.conversationId]){t.initFieldVersion(r.conversationId,r.version),e=!!t.updateModel(r)||e;var n=t.service.model.getById(r.conversationId);return n&&t.service.triggerConversationCreated(n),e}return e}),!1)&&this.service.unread.digestUnreadCountChange(),r.length},t.recvConversationForChanged=function(e){var t,r=this,n=this.bulkCompare(e);if(0!==n.length){this.bulkUpdateModel(n);var i=lu(t=au(n).call(n,(function(e){return r.service.model.getById(e.conversationId)}))).call(t,(function(e){return!!e}));this.service.triggerConversationChanged(i)}},t.processTempPacket=function(){var e,t=this;Bn(e=this.tempPacket).call(e,(function(e){t.recvConversation(e)})),this.tempPacket=[]},t.bulkCompare=function(e){var t,r=this;return lu(t=au(e).call(e,(function(e){return r.compare(e)}))).call(t,(function(e){return!!e}))},t.compare=function(e){var t=this,r=e.version,n=e.conversationId,i=e.deleteFlag,o=e.type,a=["stickTop","groupIds","serverExtension","localExtension","lastMessage","lastMessageState","unreadCount","sortOrder","createTime","updateTime"],s={},c=0;return Bn(a).call(a,(function(i){var o=i;if(void 0!==e[o]){var a=t.fieldVersion[n];a&&"number"==typeof a[o]&&a[o]>=r||(t.fieldVersion[n]=t.fieldVersion[n]||{},t.fieldVersion[n][o]=r,s[o]=e[o],c+=1)}})),c?sr(sr({},s),{conversationId:n,deleteFlag:i,version:r,type:o}):void 0},t.bulkUpdateModel=function(e){var t=this,r=!1;Bn(e).call(e,(function(e){t.updateModel(e)&&(r=!0)})),r&&this.service.unread.digestUnreadCountChange()},t.initFieldVersion=function(e,t){this.fieldVersion[e]={stickTop:t,groupIds:t,serverExtension:t,lastMessage:t,lastMessageState:t,unreadCount:t,sortOrder:t,createTime:t,updateTime:t}},t.initConversation=function(e,t){var r=Ts();return sr({conversationId:e,type:this.core.V2NIMConversationIdUtil.parseConversationType(e),stickTop:!1,localExtension:"",serverExtension:"",unreadCount:0,createTime:r,updateTime:r,sortOrder:r},t)},t.updateModel=function(e){var t=Zg(e),r=t.deleteFlag,n=t.conversation;if(r){var i=this.service.model.deleteById(n.conversationId);return!!(i&&i.unreadCount>0)}return this.service.model.upsert(n)},t.setModel=function(e){var t,r=au(t=lu(e).call(e,(function(e){return!e.deleteFlag}))).call(t,(function(e){return Zg(e).conversation}));this.service.model.set(r)},t.updateModelWithLastMessage=function(e,t,r,n){var i=this.service.model.getById(e),o=t?$g(this.core,t,r,n):void 0;if(!fg(null==i?void 0:i.lastMessage,o))if(i){var a=sr(sr({},i),{sortOrder:o?i.stickTop?o.messageRefer.createTime+1e15:o.messageRefer.createTime:i.sortOrder,lastMessage:o});this.service.model.upsert(a),this.service.triggerConversationChanged([a])}else{this.initFieldVersion(e,-1);var s=this.initConversation(e,{lastMessage:o});this.service.model.upsert(s),this.service.triggerConversationCreated(s)}},t.updateModelByRevoke=function(e){var t=this,r=[];Bn(e).call(e,(function(e){var n=e.postscript,i=e.messageRefer,o=Hl(e,["postscript","messageRefer"]),a=i.conversationId,s=t.service.model.getById(a);s&&s.lastMessage&&s.lastMessage.messageRefer.messageClientId===i.messageClientId&&1!==s.lastMessage.lastMessageState&&(s.lastMessage.lastMessageState=1,n&&(s.lastMessage.text=n),sr(s.lastMessage,o),t.service.model.upsert(s),r.push(s))})),r.length>0&&this.service.triggerConversationChanged(r)},t.compareAndUpdateModel=function(e){var t=this;this.core.logger.log("V2NIMConversation::compareAndUpdateModel",au(e).call(e,(function(e){return e.conversationId})));var r=!1,n=[];Bn(e).call(e,(function(e){var i=t.compare(e);if(i){var o=t.service.model.getById(e.conversationId);t.updateModel(i)&&(r=!0);var a=t.service.model.getById(e.conversationId);a&&(o?n.push(a):t.service.triggerConversationCreated(a))}})),n.length>0&&this.service.triggerConversationChanged(n),r&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteModel=function(e){var t=this;this.core.logger.log("V2NIMConversation::compareAndDeleteModel",e);var r=fl(e).call(e,(function(e,r){delete t.fieldVersion[r];var n=t.service.model.deleteById(r);return!!(n&&n.unreadCount>0)||e}),!1);this.service.emit("onConversationDeleted",e),r&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteGroupInModel=function(e,t){var r,n=this;this.core.logger.log("V2NIMConversation::compareAndDeleteGroupInModel",e,t);var i=[];Bn(r=pr(this.fieldVersion)).call(r,(function(r){var o=n.fieldVersion[r];if(void 0===o.groupIds||e>o.groupIds){o.groupIds=e;var a=n.service.model.getById(r);if(a&&a.groupIds&&a.groupIds.length>0){var s,c=lu(s=a.groupIds).call(s,(function(e){return e!==t}));if(c.length!==a.groupIds.length){var u=sr(sr({},a),{groupIds:c});n.service.model.upsert(u),u&&i.push(u)}}}})),i.length>0&&this.service.triggerConversationChanged(i)},t.compareAndClearUnreadInModel=function(e,t,r){var n=this;this.core.logger.log("V2NIMConversation::compareAndClearUnreadInModel",e,t,r);var i=[],o=[];if(1===t)o=this.service.model.getAll();else if(r){var a=this.service.model.count();o=this.service.model.getByOption(0,a,r).conversationList}Bn(o).call(o,(function(t){var r=t.conversationId,o=n.fieldVersion[r];if(void 0===o.unreadCount||e>o.unreadCount){o.unreadCount=e;var a=t.unreadCount,s=sr(sr({},t),{unreadCount:0});n.service.model.upsert(s),a>0&&i.push(s)}})),i.length>0&&this.service.triggerConversationChanged(i),this.service.unread.digestUnreadCountChange()},t.backfillLastMsg=function(e,t){var r=this,n=e=Wh(e);(t||0!==(n=lu(e).call(e,(function(e){return r.conversationIdsForBackFill[e]}))).length)&&Bn(n).call(n,(function(e){var t=Qp(r.service.model.getById(e),"lastMessage.messageRefer.messageClientId"),n=r.service.hasMessageService?r.core.V2NIMMessageService.model.getLastMessageOfConversation(e):void 0;(n&&n.messageClientId)!==t&&(r.conversationIdsForBackFill[e]=!1,n?r.updateModelWithLastMessage(e,n,2,n.sendingState):r.updateModelWithLastMessage(e,void 0,2,0))}))},e}(),nv={"28_1":"v2ConversationCreate","28_2":"v2ConversationDelete","28_3":"v2ConversationUpdate","28_4":"v2ConversationSetTop","28_5":"v2ConversationUnreadClear","28_6":"v2ConversationGet","28_7":"v2ConversationGetByIds","28_8":"v2ConversationGetList","28_17":"v2ConversationsDelete","28_18":"v2ConversationsUnreadClear","28_19":"v2ConversationSync","28_20":"v2ConversationNotifySync","28_21":"v2ConversationNotifySyncOnline","28_23":"v2ConversationClearTotalUnread","28_24":"v2ConversationClearTypeUnread","28_25":"v2ConversationClearGroupUnread","4_14":"syncConversationReadTime","4_20":"syncSuperTeamReadTime","4_22":"v2SyncSessionsWithMoreRoaming","4_25":"v2SyncSessionReliableInfo","30_16":"v2MarkConversationReadTime","32_25":"v2MarkSuperTeamReadTime","7_116":"v2MultiDeviceConversationReadTime","21_125":"v2MultiDeviceSuperTeamReadTime"},iv="V2NIMConversationService",ov={conversationId:1,type:2,serverExtension:3,groupIds:4,lastMessage:5,lastMessageState:6,unreadCount:7,stickTop:8,sortOrder:9,version:10,deleteFlag:11,createTime:12,updateTime:13},av={type:1,oneClickClearUnreadType:2,oneClickClearUnreadConversationType:3,oneClickClearUnreadGroupId:4,oneClickClearUnreadVersion:5,deleteConversationClearMessage:6},sv={v2ConversationCreate:{sid:28,cid:1,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:cf(ov)}]},v2ConversationDelete:{sid:28,cid:2,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,clearMessage:2}}],response:[{type:"Property",name:"data",reflectMapper:cf(ov)}]},v2ConversationUpdate:{sid:28,cid:3,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,serverExtension:2}}],response:[{type:"Property",name:"data",reflectMapper:cf(ov)}]},v2ConversationSetTop:{sid:28,cid:4,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,stickTop:2}}],response:[{type:"Property",name:"data",reflectMapper:cf(ov)}]},v2ConversationUnreadClear:{sid:28,cid:5,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:cf(ov)}]},v2ConversationGet:{sid:28,cid:6,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:cf(ov)}]},v2ConversationGetByIds:{sid:28,cid:7,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:cf(ov)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGetList:{sid:28,cid:8,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:cf(ov)},{type:"Property",name:"info",reflectMapper:{1:"hasMore",2:"offset"}}]},v2ConversationsDelete:{sid:28,cid:17,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,clearMessage:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:cf(ov)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationsUnreadClear:{sid:28,cid:18,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:cf(ov)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationSync:{sid:28,cid:19,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}}]},v2ConversationNotifySync:{sid:28,cid:20,service:iv,response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}},{type:"PropertyArray",name:"datas",reflectMapper:cf(ov)}]},v2ConversationNotifySyncOnline:{sid:28,cid:21,service:iv,response:[{type:"Property",name:"info",reflectMapper:cf(av)},{type:"PropertyArray",name:"datas",reflectMapper:cf(ov)}]},v2ConversationClearTotalUnread:{sid:28,cid:23,service:iv,response:[{type:"Property",name:"info",reflectMapper:cf(av)}]},v2ConversationClearTypeUnread:{sid:28,cid:24,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{conversationType:1}}],response:[{type:"Property",name:"info",reflectMapper:cf(av)}]},v2ConversationClearGroupUnread:{sid:28,cid:25,service:iv,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:cf(av)}]},syncConversationReadTime:{sid:4,cid:14,service:iv,response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamReadTime:{sid:4,cid:20,service:iv,response:[{type:"LongLongMap",name:"superTeam"}]},v2SyncSessionsWithMoreRoaming:{sid:4,cid:22,service:iv,response:[]},v2SyncSessionReliableInfo:{sid:4,cid:25,service:iv,response:[]},v2MarkConversationReadTime:{sid:30,cid:16,service:iv,params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MarkSuperTeamReadTime:{sid:32,cid:25,service:iv,params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceConversationReadTime:{sid:30,cid:116,service:iv,response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceSuperTeamReadTime:{sid:21,cid:125,service:iv,response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]}},cv=function(){function e(e,t){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.core=e,this.service=t}var t=e.prototype;return t.reset=function(){this.totalUnreadCount=void 0,this.unreadCountByFilter={}},t.getTotalUnreadCount=function(){return this.totalUnreadCount},t.resetTotalAfterSyncDone=function(){var e,t=fl(e=this.service.model.getAll()).call(e,(function(e,t){return e+(t.unreadCount||0)}),0),r=this.totalUnreadCount;return void 0!==r&&r===t||(this.totalUnreadCount=t,this.service.emit("onTotalUnreadCountChanged",t)),t},t.digestUnreadCountChange=function(){this._digest()},t._digest=function(){var e,t=this,r=this.totalUnreadCount,n=fl(e=this.service.model.getAll()).call(e,(function(e,t){return e+(t.unreadCount||0)}),0);this.core.logger.log("V2NIMConversation::digestUnreadCountChange:oldUnreadCount "+r+", newUnreadCount "+n),r!==n&&(this.totalUnreadCount=n,this.service.emit("onTotalUnreadCountChanged",n));var i=pr(this.unreadCountByFilter);Bn(i).call(i,(function(e){var r=JSON.parse(e),n=t.getUnreadCountByFilter(r),i=t.unreadCountByFilter[e];t.unreadCountByFilter[e]=n,r.equals=Xt(dv).call(dv,r),i!==n&&t.service.emit("onUnreadCountChangedByFilter",r,n)}))},t.getUnreadCountByIds=function(e){var t=this;return fl(e).call(e,(function(e,r){var n=t.service.model.getById(r);return e+(n&&n.unreadCount||0)}),0)},t.getUnreadCountByFilter=function(e){var t,r=this.service.model.count(),n=this.service.model.getByOption(0,r,{conversationTypes:e.conversationTypes,conversationGroupIds:e.conversationGroupId?[e.conversationGroupId]:void 0,ignoreMuted:e.ignoreMuted});return fl(t=n.conversationList).call(t,(function(e,t){return e+(t.unreadCount||0)}),0)},t.addFilter=function(e){var t=uv(e);if(void 0!==this.unreadCountByFilter[t])throw new Tl({code:yl.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var r=JSON.parse(t),n=this.getUnreadCountByFilter(r);this.unreadCountByFilter[t]=n,this.service.emit("onUnreadCountChangedByFilter",r,n)},t.deleteFilter=function(e){var t=uv(e);if(void 0===this.unreadCountByFilter[t])throw new Tl({code:yl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[t]},e}();function uv(e){var t=e.conversationTypes;return t&&(t=xm(t).call(t)),Ti({conversationGroupId:e.conversationGroupId,conversationTypes:t,ignoreMuted:e.ignoreMuted})}function dv(e){return Ti(this)===uv(e)}var lv={createTime:{type:"number"},updateTime:{type:"number"}};function pv(e){return e&&e.length>0?au(e).call(e,(function(e){return mv(e)})):[]}function mv(e){return wh(lv,e)}function hv(e){var t,r=JSON.parse(e);return au(t=pr(r)).call(t,(function(e){return{conversationId:e,error:new Tl({code:r[e]})}}))}var fv,gv={type:{type:"number"},deleteVersion:{type:"number"},conversationIds:{type:"object"}};function vv(e){return wh(gv,e)}!function(e){e[e.createConversationGroup=1]="createConversationGroup",e[e.deleteConversationGroup=2]="deleteConversationGroup",e[e.updateConversationGroup=3]="updateConversationGroup",e[e.addConversationToGroup=4]="addConversationToGroup",e[e.removeConversationFromGroup=5]="removeConversationFromGroup"}(fv||(fv={}));var yv=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMConversationService",t)||this).config={},n.model=new ag,n.versionCache=new rv(n.core,st(n)),n.unread=new cv(n.core,st(n)),n.core._registerDep(hg,"V2NIMConversationIdUtil"),"v2"!==n.core.options.apiVersion?st(n):(hh({cmdMap:nv,cmdConfig:sv}),n.setOptions(r),n.setListener(),n)}er(t,e);var r=t.prototype;return r.setOptions=function(e){this.config=sr(this.config,e)},r.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.versionCache.doSync()})),this.core.eventBus.on("V2NIMConversationService/conversationOnlineSyncNotify",(function(t,r){var n;!1!==(null===(n=null==r?void 0:r.messageConfig)||void 0===n?void 0:n.lastMessageUpdateEnabled)&&(t.content.info=mh(t.content.info,cf(av)),t.content.data=mh(t.content.data,cf(ov)),r&&(t.content.data.lastMessage=$g(e.core,r,0)),t.content.datas=[t.content.data],e.v2ConversationNotifySyncOnlineHandler.call(e,t))})),this.core.eventBus.on("V2NIMConversationService/sendMessage",(function(t,r){var n,i;1===r&&!0===(null===(n=t.messageConfig)||void 0===n?void 0:n.historyEnabled)||!1!==(null===(i=null==t?void 0:t.messageConfig)||void 0===i?void 0:i.lastMessageUpdateEnabled)&&e.versionCache.updateModelWithLastMessage(t.conversationId,t,2,r)})),this.core.eventBus.on("V2NIMConversationService/deleteMessages",(function(t){var r=au(t).call(t,(function(e){return e.messageRefer.conversationId}));e.versionCache.backfillLastMsg(r,!0)})),this.core.eventBus.on("V2NIMConversationService/revokeMessages",(function(t){e.versionCache.updateModelByRevoke(t)})),this.core.eventBus.on("V2NIMConversationService/checkBackFill",(function(t){e.versionCache.backfillLastMsg(t,!1)})),this.core.eventBus.on("V2NIMConversationService/setMute",(function(t,r){var n=e.model.getById(t);n&&n.mute!==r&&(n.mute=r,e.model.upsert(n),e.emit("onConversationChanged",[n]))}))},r.reset=function(){this.versionCache.reset(),this.model.reset(),this.unread.reset()},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];if("onConversationCreated"===t){var d=c[0];this.logger.log(""+a,"id:"+d.conversationId+";unread:"+d.unreadCount+";lastMsg:"+(null===(i=d.lastMessage)||void 0===i?void 0:i.messageRefer.messageClientId)+"/"+(null===(o=d.lastMessage)||void 0===o?void 0:o.messageRefer.messageServerId))}else if("onConversationChanged"===t){var l=c[0];this.logger.log(""+a,au(l).call(l,(function(e){var t,r;return"id:"+e.conversationId+";unread:"+e.unreadCount+";lastMsg:"+(null===(t=e.lastMessage)||void 0===t?void 0:t.messageRefer.messageClientId)+"/"+(null===(r=e.lastMessage)||void 0===r?void 0:r.messageRefer.messageServerId)})))}else{var p,m;(p=this.logger).log.apply(p,Rs(m=[""+a]).call(m,c))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,c))},r.getConversationList=function(e,t){this.checkV2(),Al({offset:{type:"number",min:0}},{offset:e},"",!0),Al({limit:{type:"number",min:1}},{limit:t},"",!0),this.core.V2NIMLoginService.checkIllegalState();var r=this.model.getByOption(e,t,{});return r.conversationList=this.computedFieldForConversations(r.conversationList),ls.resolve(r)},r.getConversationListByOption=function(e,t,r){this.checkV2(),Al({offset:{type:"number",min:0}},{offset:e},"",!0),Al({limit:{type:"number",min:1}},{limit:t},"",!0),Al({option:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1},conversationGroupIds:{type:"array",itemType:"string",required:!1}}}},{option:r},"",!0),this.core.V2NIMLoginService.checkIllegalState();var n=this.model.getByOption(e,t,r);return n.conversationList=this.computedFieldForConversations(n.conversationList),ls.resolve(n)},r.getConversation=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Nl(this.core.account,e),this.core.V2NIMLoginService.checkIllegalState(),!(r=this.model.getById(e))){t.next=8;break}return t.abrupt("return",this.computedFieldForConversation(r));case 8:throw new Tl({code:yl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 9:case"end":return t.stop()}}),t,this)})))},r.getConversationListByIds=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),n=lu(r=au(e).call(e,(function(e){return i.model.getById(e)}))).call(r,(function(e){return!!e})),n=this.computedFieldForConversations(n),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.createConversation=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Nl(this.core.account,e),t.next=4,this.core.sendCmd("v2ConversationCreate",{tag:{conversationId:e}});case 4:if(r=t.sent,n=Qp(r,"content.data"),i=Xg(this.core,n),this.versionCache.compareAndUpdateModel([i]),!(o=this.model.getById(e))){t.next=13;break}return t.abrupt("return",this.computedFieldForConversation(o));case 13:throw new Tl({code:yl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 14:case"end":return t.stop()}}),t,this)})))},r.deleteConversation=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Nl(this.core.account,e),Al({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),r.prev=3,r.next=6,this.core.sendCmd("v2ConversationDelete",{tag:{conversationId:e,clearMessage:Number(t||!1)}});case 6:r.next=11;break;case 8:r.prev=8,r.t0=r.catch(3),this.logger.warn("V2NIMConversationService:deleteConversation: delete conversation failed: "+e);case 11:this.model.getById(e)&&(t&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",[e]),this.versionCache.compareAndDeleteModel([e]));case 12:case"end":return r.stop()}}),r,this,[[3,8]])})))},r.deleteConversationListByIds=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a=this;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),Al({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationsDelete",{tag:{conversationIds:Ti(e),clearMessage:Number(t||!1)}});case 5:return n=r.sent,i=hv(Qp(n,"content.info.failedMap")),(o=lu(i).call(i,(function(e){return e.error.code!==yl.V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST||!a.model.getById(e.conversationId)}))).length<e.length&&(t&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",e),this.versionCache.compareAndDeleteModel(e)),r.abrupt("return",o);case 10:case"end":return r.stop()}}),r,this)})))},r.stickTopConversation=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Nl(this.core.account,e),Al({stickTop:{type:"boolean"}},{stickTop:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationSetTop",{tag:{conversationId:e,stickTop:Number(t)}});case 5:n=r.sent,i=Qp(n,"content.data"),o=Xg(this.core,i),this.versionCache.compareAndUpdateModel([o]);case 9:case"end":return r.stop()}}),r,this)})))},r.updateConversation=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Nl(this.core.account,e),Al({updateInfo:{type:"object",required:!0,rules:{serverExtension:{type:"string"}}}},{updateInfo:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationUpdate",{tag:sr({conversationId:e},t)});case 5:n=r.sent,i=Qp(n,"content.data"),o=Xg(this.core,i),this.versionCache.compareAndUpdateModel([o]);case 9:case"end":return r.stop()}}),r,this)})))},r.updateConversationLocalExtension=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Nl(this.core.account,e),Al({localExtension:{type:"string"}},{localExtension:t},"",!0),n=this.model.getById(e)){r.next=6;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 6:if(n.localExtension!==t){r.next=8;break}return r.abrupt("return");case 8:i=sr(sr({},n),{localExtension:t}),this.model.upsert(i),this.triggerConversationChanged([i]);case 11:case"end":return r.stop()}}),r,this)})))},r.getTotalUnreadCount=function(){return this.checkV2(),this.unread.getTotalUnreadCount()||0},r.getUnreadCountByIds=function(e){this.checkV2(),Al({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var t=this.unread.getUnreadCountByIds(e);return ls.resolve(t)},r.getUnreadCountByFilter=function(e){this.checkV2(),this.valiteFilter(e);var t=this.unread.getUnreadCountByFilter(e);return ls.resolve(t)},r.clearTotalUnreadCount=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),e.next=3,this.core.sendCmd("v2ConversationClearTotalUnread");case 3:t=e.sent,r=tv(Qp(t,"content.info")),this.versionCache.compareAndClearUnreadInModel(r.oneClickClearUnreadVersion,r.oneClickClearUnreadType);case 6:case"end":return e.stop()}}),e,this)})))},r.clearUnreadCountByIds=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationsUnreadClear",{tag:{conversationIds:Ti(e)}});case 4:return r=t.sent,n=Jg(this.core,Qp(r,"content.datas")),i=hv(Qp(r,"content.info.failedMap")),this.versionCache.compareAndUpdateModel(n),t.abrupt("return",i);case 9:case"end":return t.stop()}}),t,this)})))},r.clearUnreadCountByGroupId=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al({groupId:{type:"string"}},{groupId:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationClearGroupUnread",{tag:{groupId:e}});case 4:case"end":return t.stop()}}),t,this)})))},r.clearUnreadCountByTypes=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al({types:{type:"array",itemType:"number",min:1}},{types:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationClearTypeUnread",{tag:{conversationType:Ti(e)}});case 4:r=t.sent,n=tv(Qp(r,"content.info")),this.versionCache.compareAndClearUnreadInModel(n.oneClickClearUnreadVersion,n.oneClickClearUnreadType,{conversationTypes:n.oneClickClearUnreadConversationType});case 7:case"end":return t.stop()}}),t,this)})))},r.markConversationRead=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),this.checkLogin(),Nl(this.core.account,e),i=this.model.getById(e)){n.next=6;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Conversation not exist"}});case 6:if(o=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),a=this.core.V2NIMConversationIdUtil.parseConversationType(e),s=this.model.getReadTime(e),!(null===(r=null===(t=null==i?void 0:i.lastMessage)||void 0===t?void 0:t.messageRefer)||void 0===r?void 0:r.createTime)){n.next=13;break}c=i.lastMessage.messageRefer.createTime,n.next=19;break;case 13:if(!this.core.timeOrigin.checkNodeReliable()){n.next=17;break}c=this.core.timeOrigin.getNTPTime(),n.next=19;break;case 17:return this.logger.log("markConversationRead","NTP time is not reliable",e),n.abrupt("return",s||0);case 19:if(!(s>=c)){n.next=22;break}return this.logger.log("markConversationRead","currentReadTime >= readTime",e,s,c),n.abrupt("return",s);case 22:if(3!==a){n.next=27;break}return n.next=25,this.core.sendCmd("v2MarkSuperTeamReadTime",{timetag:c,to:o});case 25:n.next=29;break;case 27:return n.next=29,this.core.sendCmd("v2MarkConversationReadTime",{scene:1===a?0:2===a?1:2,timetag:c,to:o});case 29:return this.model.updateReadTime(e,c),n.abrupt("return",c);case 31:case"end":return n.stop()}}),n,this)})))},r.getConversationReadTime=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Nl(this.core.account,e),t.abrupt("return",this.model.getReadTime(e));case 3:case"end":return t.stop()}}),t,this)})))},r.subscribeUnreadCountByFilter=function(e){var t;this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.addFilter(e)},r.unsubscribeUnreadCountByFilter=function(e){var t;this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.deleteFilter(e)},r.v2ConversationNotifySyncHandler=function(e){this.versionCache.recvConversationFromSyncAction(e)},r.v2ConversationNotifySyncOnlineHandler=function(e){this.versionCache.recvConversation(e)},r.syncConversationReadTimeHandler=function(e){var t,r,n;if(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.p2p)for(var i=0,o=og(e.content.p2p);i<o.length;i++){var a=o[i],s=a[0],c=a[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(s),c),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(s),c)}if(null===(n=null===(r=null==e?void 0:e.content)||void 0===r?void 0:r.team)||void 0===n?void 0:n.m_map)for(var u=0,d=og(e.content.team.m_map);u<d.length;u++){var l=d[u],p=l[0],m=l[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(p),m),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(p),m)}},r.syncSuperTeamReadTimeHandler=function(e){var t,r;if(null===(r=null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.superTeam)||void 0===r?void 0:r.m_map)for(var n=0,i=og(e.content.superTeam.m_map);n<i.length;n++){var o=i[n],a=o[0],s=o[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(a),s),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(a),s)}},r.v2MultiDeviceConversationReadTimeHandler=function(e){var t;(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.to)&&(0===e.content.scene?(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.to),e.content.timetag),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.to),e.content.timetag)):(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(e.content.to),e.content.timetag),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(e.content.to),e.content.timetag)))},r.v2MultiDeviceSuperTeamReadTimeHandler=function(e){var t;(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.to)&&(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(e.content.to),e.content.timetag),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(e.content.to),e.content.timetag))},r.valiteFilter=function(e){if(Al({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},conversationGroupId:{type:"string",allowEmpty:!1,required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:e},"",!0),void 0===e.conversationTypes&&void 0===e.conversationGroupId&&!0!==e.ignoreMuted)throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})},r.computedFieldForConversations=function(e){var t=this;return au(e).call(e,(function(e){return t.computedFieldForConversation(e)}))},r.computedFieldForConversation=function(e){var t,r,n,i,o;if(0===e.type)return e;var a=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),c={};if((null===(t=this.core.V2NIMSettingService)||void 0===t?void 0:t.name)&&(c.mute=this.core.V2NIMSettingService.getConversationMuteStatus(e.conversationId)),1===a&&this.hasUserService){var u,d=this.core.V2NIMUserService.model.getUser(s),l=this.hasFriendService?this.core.V2NIMFriendService.model.getFriend(s):void 0;e.conversationId!==(null===(r=e.lastMessage)||void 0===r?void 0:r.messageRefer.conversationId)||0!==(null===(n=e.lastMessage)||void 0===n?void 0:n.lastMessageState)&&2!==(null===(i=e.lastMessage)||void 0===i?void 0:i.lastMessageState)||(u=null===(o=e.lastMessage)||void 0===o?void 0:o.senderName),c.name=(null==l?void 0:l.alias)||(null==d?void 0:d.name)||u||s,c.avatar=(null==d?void 0:d.avatar)||""}else if(2===a&&this.hasTeamService){var p=this.core.V2NIMTeamService.model.getById(s,1);c.name=(null==p?void 0:p.name)||s,c.avatar=(null==p?void 0:p.avatar)||""}else if(3===a&&this.hasTeamService){var m=this.core.V2NIMTeamService.model.getById(s,2);c.name=(null==m?void 0:m.name)||s,c.avatar=(null==m?void 0:m.avatar)||""}return sr(e,c),e},r.triggerConversationChanged=function(e){e=this.computedFieldForConversations(e),e=JSON.parse(Ti(e)),Bn(e).call(e,(function(e){e.lastMessage||(e.lastMessage=void 0),delete e.lastMessageState})),this.emit("onConversationChanged",e)},r.triggerConversationCreated=function(e){e=this.computedFieldForConversation(e),delete(e=JSON.parse(Ti(e))).lastMessageState,this.emit("onConversationCreated",e)},at(t,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}},{key:"hasFriendService",get:function(){var e;return!!(null===(e=this.core.V2NIMFriendService)||void 0===e?void 0:e.name)}},{key:"hasTeamService",get:function(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}},{key:"hasMessageService",get:function(){var e;return!!(null===(e=this.core.V2NIMMessageService)||void 0===e?void 0:e.name)}}]),t}($h),Iv={"28_9":"v2ConversationGroupCreate","28_10":"v2ConversationGroupDelete","28_11":"v2ConversationGroupUpdate","28_12":"v2ConversationGroupGet","28_13":"v2ConversationGroupsGet","28_14":"v2ConversationGroupListGet","28_15":"v2ConversationGroupAddTo","28_16":"v2ConversationGroupRemoveFrom","28_22":"v2ConversationGroupNotifySyncOnline"},Mv="V2NIMConversationGroupService",Tv={groupId:1,name:2,serverExtension:3,createTime:4,updateTime:5},Sv={v2ConversationGroupCreate:{sid:28,cid:9,service:Mv,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:cf(Tv)},{type:"PropertyArray",name:"conversations",reflectMapper:cf(ov)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupDelete:{sid:28,cid:10,service:Mv,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"groupList"}}]},v2ConversationGroupUpdate:{sid:28,cid:11,service:Mv,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:cf(Tv)}]},v2ConversationGroupGet:{sid:28,cid:12,service:Mv,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"data",reflectMapper:cf(Tv)}]},v2ConversationGroupsGet:{sid:28,cid:13,service:Mv,params:[{type:"Property",name:"tag",reflectMapper:{groupIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:cf(Tv)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupListGet:{sid:28,cid:14,service:Mv,response:[{type:"PropertyArray",name:"datas",reflectMapper:cf(Tv)}]},v2ConversationGroupAddTo:{sid:28,cid:15,service:Mv,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:cf(ov)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupRemoveFrom:{sid:28,cid:16,service:Mv,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:cf(ov)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupNotifySyncOnline:{sid:28,cid:22,service:Mv,response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"conversationIds"}},{type:"Property",name:"data",reflectMapper:cf(Tv)}]}},bv=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMConversationGroupService",t)||this).config={},n.core._registerDep(yv,"V2NIMConversationService"),"v2"!==n.core.options.apiVersion?st(n):(hh({cmdMap:Iv,cmdConfig:Sv}),n.setOptions(r),n)}er(t,e);var r=t.prototype;return r.setOptions=function(e){this.config=sr(this.config,e)},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onConversationsAddedToGroup"===t){var c=a[0],u=a[1];this.logger.log(""+i,"groupId:"+c,"conversations:"+au(u).call(u,(function(e){return e.conversationId})).join(","))}else{var d,l;(d=this.logger).log.apply(d,Rs(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,a))},r.createConversationGroup=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c,u=this;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al({name:{type:"string",allowEmpty:!1}},{name:e},"",!0),Al({serverExtension:{type:"string",required:!1}},{serverExtension:t},"",!0),Al({conversationIds:{type:"array",itemType:"string",required:!1}},{conversationIds:r},"",!0),n.next=6,this.core.sendCmd("v2ConversationGroupCreate",{tag:{name:e,serverExtension:t||"",conversationIds:r&&Ti(r)}});case 6:return i=n.sent,o=mv(Qp(i,"content.data")),a=Jg(this.core,Qp(i,"content.conversations")),s=hv(Qp(i,"content.info.failedMap")),this.emit("onConversationGroupCreated",o),a.length>0&&(this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(a),this.emit("onConversationsAddedToGroup",o.groupId,lu(c=au(a).call(a,(function(e){return u.core.V2NIMConversationService.model.getById(e.conversationId)}))).call(c,(function(e){return!!e})))),n.abrupt("return",{group:o,failedList:s});case 13:case"end":return n.stop()}}),n,this)})))},r.deleteConversationGroup=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationGroupDelete",{tag:{groupId:e}});case 4:r=t.sent,n=vv(Qp(r,"content.info")),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(n.deleteVersion,e),this.emit("onConversationGroupDeleted",e);case 8:case"end":return t.stop()}}),t,this)})))},r.updateConversationGroup=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),Al({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Al({name:{type:"string",required:!1}},{name:t},"",!0),Al({serverExtension:{type:"string",required:!1}},{serverExtension:r},"",!0),void 0!==t||void 0!==r){n.next=6;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return n.next=8,this.core.sendCmd("v2ConversationGroupUpdate",{tag:{groupId:e,name:t,serverExtension:r}});case 8:i=n.sent,o=mv(Qp(i,"content.data")),this.emit("onConversationGroupChanged",o);case 11:case"end":return n.stop()}}),n,this)})))},r.addConversationsToGroup=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u=this;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Al({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationGroupAddTo",{tag:{groupId:e,conversationIds:Ti(t)}});case 5:return i=r.sent,o=Qp(i,"content.info.failedMap")||"",a=[],o&&(a=hv(o)),s=Jg(this.core,Qp(i,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(s),(c=lu(n=au(s).call(s,(function(e){return u.core.V2NIMConversationService.model.getById(e.conversationId)}))).call(n,(function(e){return!!e}))).length>0&&this.emit("onConversationsAddedToGroup",e,c),r.abrupt("return",a);case 14:case"end":return r.stop()}}),r,this)})))},r.removeConversationsFromGroup=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Al({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationGroupRemoveFrom",{tag:{groupId:e,conversationIds:Ti(t)}});case 5:return n=r.sent,i=Qp(n,"content.info.failedMap")||"",o=[],i&&(o=hv(i)),a=Jg(this.core,Qp(n,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(a),this.emit("onConversationsRemovedFromGroup",e,au(a).call(a,(function(e){return e.conversationId}))),r.abrupt("return",o);case 13:case"end":return r.stop()}}),r,this)})))},r.getConversationGroup=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationGroupGet",{tag:{groupId:e}});case 4:return r=t.sent,t.abrupt("return",mv(Qp(r,"content.data")));case 6:case"end":return t.stop()}}),t,this)})))},r.getConversationGroupList=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),e.next=3,this.core.sendCmd("v2ConversationGroupListGet");case 3:return t=e.sent,e.abrupt("return",pv(Qp(t,"content.datas")));case 5:case"end":return e.stop()}}),e,this)})))},r.getConversationGroupListByIds=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al({groupIds:{type:"array",itemType:"string",min:1}},{groupIds:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationGroupsGet",{tag:{groupIds:e&&Ti(e)}});case 4:return n=t.sent,i=pv(Qp(n,"content.datas")),t.abrupt("return",lu(r=au(e).call(e,(function(e){return lu(i).call(i,(function(t){return t.groupId===e}))[0]}))).call(r,(function(e){return!!e})));case 7:case"end":return t.stop()}}),t,this)})))},r.v2ConversationGroupNotifySyncOnlineHandler=function(e){var t,r=this,n=vv(Qp(e,"content.info")),i=n.type,o=n.deleteVersion,a=n.conversationIds,s=mv(Qp(e,"content.data"));if(this.core.logger.log("v2ConversationGroupNotifySyncOnlineHandler",n,s),1===i)this.emit("onConversationGroupCreated",s),a&&a.length>0&&this.emit("onConversationsAddedToGroup",s.groupId,lu(t=au(a).call(a,(function(e){return r.core.V2NIMConversationService.model.getById(e)}))).call(t,(function(e){return!!e})));else if(2===i)this.emit("onConversationGroupDeleted",s.groupId),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(o,s.groupId);else if(3===i)this.emit("onConversationGroupChanged",s);else if(4===i){var c,u=lu(c=au(a).call(a,(function(e){return r.core.V2NIMConversationService.model.getById(e)}))).call(c,(function(e){return!!e}));this.emit("onConversationsAddedToGroup",s.groupId,u)}else 5===i&&this.emit("onConversationsRemovedFromGroup",s.groupId,a)},t}($h),Cv=function(){function e(){this.messages=new rd,this.maxSize=2e3}var t=e.prototype;return t.reset=function(){this.messages.clear()},t.getMessageById=function(e){if(e)return this.messages.get(e)},t.getMessagesByConversationId=function(e){var t,r=[];return Bn(t=this.messages).call(t,(function(t){t.conversationId===e&&r.push(t)})),r},t.getLastMessageOfConversation=function(e){var t=this.getMessagesByConversationId(e);if(0!==t.length)return fl(t).call(t,(function(e,t){return t.createTime>e.createTime?t:e}),t[0])},t.upsertMessages=function(e){var t,r,n,i=this;Bn(e).call(e,(function(e){i.messages.set(e.messageClientId,e)}));var o=this.messages.size;if(!(o<=this.maxSize))for(var a=xm(t=lu(r=Vl(gu(n=this.messages).call(n))).call(r,(function(e){return 3!==e.sendingState}))).call(t,(function(e,t){return e.createTime-t.createTime})),s=o-this.maxSize>100?o-this.maxSize:100,c=0;c<s;c++){var u=a[c];u&&this.messages.delete(u.messageClientId)}},t.deleteMessage=function(e){this.messages.delete(e)},t.deleteMessages=function(e,t){var r,n=this;Bn(r=this.messages).call(r,(function(r){e===r.conversationId&&(!t||t&&r.createTime<t)&&n.messages.delete(r.messageClientId)}))},e}(),Ev={accountId:{type:"string",allowEmpty:!1},content:{type:"object",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number",allowEmpty:!1}}},messages:{type:"array",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number"},role:{type:"enum",values:["assistant","user","system"]}}},promptVariables:{type:"jsonstr",required:!1},modelConfigParams:{type:"object",required:!1,rules:{prompt:{type:"string",required:!1},maxTokens:{type:"number",required:!1},topP:{type:"number",required:!1},temperature:{type:"number",required:!1}}}},_v=sr({requestId:{type:"string",allowEmpty:!1}},Ev),kv=[1,3,2,0],Rv=[2,7,12,100,6,1,-1,4,5,11,0,10,3],wv={routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}},Av={pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forceContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}},xv={antispamEnabled:{type:"boolean",required:!1},antispamBusinessId:{type:"string",required:!1},antispamCustomMessage:{type:"string",required:!1},antispamCheating:{type:"string",required:!1},antispamExtension:{type:"string",required:!1}},Nv={messageConfig:{type:"object",required:!1,rules:{readReceiptEnabled:{type:"boolean",required:!1},lastMessageUpdateEnabled:{type:"boolean",required:!1},historyEnabled:{type:"boolean",required:!1},roamingEnabled:{type:"boolean",required:!1},onlineSyncEnabled:{type:"boolean",required:!1},offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},routeConfig:{type:"object",required:!1,rules:wv},pushConfig:{type:"object",required:!1,rules:Av},antiSpamConfig:{type:"object",required:!1,rules:xv},robotConfig:{type:"object",required:!1,rules:{accountId:{type:"string",required:!1},topic:{type:"string",required:!1},function:{type:"string",required:!1},customContent:{type:"string",required:!1}}},aiConfig:{type:"object",required:!1,rules:Ev},targetConfig:{type:"object",required:!1,rules:{receiverIds:{type:"array",itemType:"string"},inclusive:{type:"boolean"},newMemberVisible:{type:"boolean",required:!1}}},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},Ov={message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:Rv},messageClientId:{type:"string",allowEmpty:!1}}},params:{type:"object",rules:Nv,required:!1},replyMessage:{type:"object",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Pv={conversationId:{type:"string",allowEmpty:!1},message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:Rv},messageClientId:{type:"string",allowEmpty:!1},attachment:{type:"object",required:!1,rules:{file:{type:"file",required:!1}}}}},params:{type:"object",required:!1,rules:Nv}},Lv={message:{type:"object",rules:{messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:kv},createTime:{type:"number"}}},params:{type:"object",rules:{postscript:{type:"string",required:!1},serverExtension:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},env:{type:"string",required:!1}},required:!1}},Vv={conversationId:{type:"string",allowEmpty:!1},messageTypes:{type:"array",required:!1,itemType:"enum",values:Rv},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},anchorMessage:{type:"object",required:!1,rules:{messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Uv={conversationType:{type:"enum",values:kv},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1}},Dv={messageRefers:{type:"array",required:!0,rules:Uv}},qv={conversationId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:kv},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},Bv={messages:{type:"array",rules:qv}},Fv={conversationId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},onlineSync:{type:"boolean",required:!1},deleteRoam:{type:"boolean",required:!1}},Gv={serverExtension:{type:"string",required:!1}},jv={messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[1]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},Hv={messages:{type:"array",rules:{messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},min:1}},Wv={voiceUrl:{type:"string",required:!1,allowEmpty:!1},file:{type:"file",required:!1},voicePath:{type:"string",required:!1,allowEmpty:!1},mimeType:{type:"string",required:!1,allowEmpty:!1},sampleRate:{type:"string",required:!1,allowEmpty:!1},duration:{type:"number",required:!0,min:0},sceneName:{type:"string",required:!1}},Yv={message:{type:"object",rules:{conversationType:{type:"enum",values:kv},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}},index:{type:"number",min:1},serverExtension:{type:"string",required:!1},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},needBadge:{type:"boolean",required:!1},title:{type:"string",required:!1,allowEmpty:!1},content:{type:"string",required:!1,allowEmpty:!1},pushPayload:{type:"string",required:!1,allowEmpty:!1}}}},Kv={messages:{type:"array",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Qv={params:{type:"object",rules:{collectionType:{type:"number",min:1},collectionData:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},uniqueId:{type:"string",required:!1}}}},zv={collections:{type:"array",min:1,rules:{collectionId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Jv={serverExtension:{type:"string",required:!1},collection:{type:"object",rules:{collectionId:{type:"string",allowEmpty:!1},collectionType:{type:"number"},createTime:{type:"number"}}}},$v={beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",required:!1,values:[1,0]},collectionType:{type:"number",required:!1},anchorCollection:{type:"object",required:!1,rules:{collectionId:{type:"string",allowEmpty:!1,required:!1},createTime:{type:"number",required:!1}}}},Xv={keyword:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},sortOrder:{type:"enum",values:[1,0],required:!1},conversationLimit:{type:"number",min:0,required:!1},messageLimit:{type:"number",min:1,required:!1},p2pAccountIds:{type:"array",required:!1,itemType:"string"},teamIds:{type:"array",required:!1,itemType:"string"},senderAccountIds:{type:"array",required:!1,itemType:"string"},messageTypes:{type:"array",required:!1,itemType:"enum",values:Rv},messageSubtypes:{type:"array",required:!1,itemType:"number"}},Zv={message:{type:"object",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}}}},ey={messages:{type:"array",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}},min:1}},ty={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},ry=sr(sr({},ty),{duration:{type:"number",required:!1}}),ny=sr(sr({},ry),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),iy=sr(sr({},ty),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),oy={messageRefer:{type:"object",required:!0,rules:Uv},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},excludeMessageServerId:{type:"string",required:!1,allowEmpty:!1}},ay={senderId:{type:"string",allowEmpty:!1},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1}},sy={subType:{type:"number",min:0,required:!1},text:{type:"string",required:!1},attachment:{type:"object",required:!1},serverExtension:{type:"string",required:!1},routeConfig:{type:"object",required:!1,rules:wv},pushConfig:{type:"object",required:!1,rules:Av},antiSpamConfig:{type:"object",required:!1,rules:xv},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},cy=function(){function e(e,t){this.p2pMessageReceipts={},this.core=e,this.service=t}var t=e.prototype;return t.sendP2PMessageReceipt=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al(jv,e,"",!0),e.senderId!==this.core.account){t.next=3;break}throw new bl({detail:{reason:"sendP2PMessageReceipt. sender: "+e.senderId+" is not allowed to send msg receipt"}});case 3:if(!(this.p2pMessageReceipts[e.conversationId]>e.createTime)){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,this.core.sendCmd("v2SendP2PMessageReceipt",{tag:{receiverId:e.senderId,messageClientId:e.messageClientId,createTime:e.createTime}});case 7:this.p2pMessageReceipts[e.conversationId]=e.createTime;case 8:case"end":return t.stop()}}),t,this)})))},t.isPeerRead=function(e){if(1!==e.conversationType)return!1;if(e.senderId!==this.core.account)return!1;if(e.senderId===this.core.account&&e.receiverId===this.core.account)return!0;var t=this.core.V2NIMConversationIdUtil.messageConversationId(e),r=this.p2pMessageReceipts[t]||0;return e.createTime<=r},t.getP2PMessageReceipt=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Nl(this.core.account,e),1===this.core.V2NIMConversationIdUtil.parseConversationType(e)){t.next=4;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getP2PMessageReceipt: conversationId is not p2p conversationId"}});case 4:return t.abrupt("return",{conversationId:e,timestamp:this.p2pMessageReceipts[e]||0});case 5:case"end":return t.stop()}}),t,this)})))},t.getTeamMessageReceipts=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al(ey,{messages:e},"",!0),!Um(e).call(e,(function(e){return e.senderId!==i.core.account}))){t.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 3:if(!Um(e).call(e,(function(t){return t.receiverId!==e[0].receiverId}))){t.next=5;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: exist messages receiverId is not same"}});case 5:return t.next=7,this.core.sendCmd("v2GetTeamMessageReceipts",{tag:e});case 7:return n=t.sent,t.abrupt("return",au(r=n.content.data).call(r,(function(e){return sr(sr({},e),{conversationId:i.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId)})})));case 9:case"end":return t.stop()}}),t,this)})))},t.getTeamMessageReceiptDetail=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al(Zv,{message:e},"",!0),e.senderId===this.core.account){t.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceiptDetail::senderId "+e.senderId+" incorrect"}});case 3:return t.next=5,this.core.sendCmd("v2GetTeamMessageReceiptDetail",{tag:e});case 5:return r=t.sent,t.abrupt("return",{readReceipt:{conversationId:this.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId),messageClientId:e.messageClientId,messageServerId:e.messageServerId,readCount:r.content.readAccountList.length,unreadCount:r.content.unreadAccountList.length},readAccountList:r.content.readAccountList,unreadAccountList:r.content.unreadAccountList});case 7:case"end":return t.stop()}}),t,this)})))},t.sendTeamMessageReceipts=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Um(e).call(e,(function(t){return t.conversationId!==e[0].conversationId}))){t.next=2;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: conversationId not same"}});case 2:if(Al(Hv,{messages:e},"",!0),!Um(e).call(e,(function(e){return e.senderId===r.core.account}))){t.next=5;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 5:return t.next=7,this.core.sendCmd("v2SendTeamMessageReceipts",{tag:e});case 7:return t.abrupt("return");case 8:case"end":return t.stop()}}),t,this)})))},t.syncP2PMessagReceiptsHandler=function(e){var t,r=this,n=au(t=e.content.data).call(t,(function(e){var t=r.core.V2NIMConversationIdUtil.p2pConversationId(e.senderId),n=e.createTime;return r.p2pMessageReceipts[t]=n,{conversationId:t,timestamp:n}}));this.service.emit("onReceiveP2PMessageReadReceipts",n)},t.onP2PMessageReceiptsHandler=function(e){var t=this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.data.senderId),r=e.content.data.createTime;this.p2pMessageReceipts[t]=r,this.service.emit("onReceiveP2PMessageReadReceipts",[{conversationId:t,timestamp:r}])},t.onTeamMessageReceiptsHandler=function(e){var t,r=this,n=au(t=e.content.data).call(t,(function(e){return{conversationId:r.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId),messageServerId:e.messageServerId,messageClientId:e.messageClientId,readCount:e.readCount,unreadCount:e.unreadCount,latestReadAccount:e.latestReadAccount}}));this.service.emit("onReceiveTeamMessageReadReceipts",n)},e}(),uy=function(){function e(e){this.core=e}var t=e.prototype;return t.doSendFile=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u,d;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.attachment,r.prev=1,r.next=4,this.core.V2NIMStorageService._uploadFile({taskId:e.messageClientId,uploadParams:{fileObj:(null==n?void 0:n.file)||(null==n?void 0:n.path),sceneName:null==n?void 0:n.sceneName}},t,{fileType:e.messageType});case 4:for(u in(o=r.sent)[0],a=o[1],s=sr(sr({},n),{uploadState:1}),void 0!==a.w&&(s.width=s.width||a.w),void 0!==a.h&&(s.height=s.height||a.h),void 0!==a.dur&&(s.duration=s.duration||a.dur),s.ext=s.ext&&-1===bu(i=s.ext).call(i,".")?"."+s.ext:s.ext,c=["w","h","dur","ext","name"],a)tu(c).call(c,u)||(s[u]=a[u]);s.raw,s.file,s.path,d=Hl(s,["raw","file","path"]),e.attachment=JSON.parse(Ti(d)),e.attachment&&(e.attachment.raw=Lg(e.messageType,e.attachment)),r.next=23;break;case 19:throw r.prev=19,r.t0=r.catch(1),e.attachment&&(e.attachment.uploadState=2),r.t0;case 23:case"end":return r.stop()}}),r,this,[[1,19]])})))},t.cancelMessageAttachmentUpload=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({messageClientId:{type:"string",allowEmpty:!1}},e,"",!0),tu(r=[2,6,1,3]).call(r,e.messageType)){t.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"cancelMessageAttachmentUpload: messageType "+e.messageType+" incorrect"}});case 3:if(2!==e.sendingState&&1!==e.sendingState){t.next=5;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"cancelMessageAttachmentUpload: message is already failed or succeeded"}});case 5:return t.next=7,this.core.V2NIMStorageService._cancelUploadFile(e.messageClientId);case 7:case"end":return t.stop()}}),t,this)})))},e}(),dy="V2NIMNotificationService",ly={"30_7":"v2SendCustomNotification","32_16":"v2SendCustomNotificationWithSuperTeam","7_3":"onSysNotification","21_19":"onSysNotification","4_6":"v2SyncOfflineSysNotifications","4_18":"v2SyncOfflineSysNotifications","7_14":"v2NotificationRevoke","21_18":"v2NotificationRevoke","21_117":"v2NotificationRevoke","4_19":"v2NotificationSyncRevoke","7_15":"v2NotificationSyncRevoke","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg"},py={timestamp:{id:0,retType:"number"},type:{id:1,retType:"number"},receiverId:2,senderId:3,postscript:4,content:5,idServer:6,offlineEnabled:{id:7,converter:vh,retConverter:function(e,t){return"0"!==t[6]&&!!Kp(e)},access:"notificationConfig.offlineEnabled"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"},deletedIdClient:10,deletedIdServer:11,antispamEnabled:{id:12,converter:vh,retType:"boolean",access:"antispamConfig.antispamEnabled"},antispamCustomNotification:{id:13,access:"antispamConfig.antispamCustomNotification"},deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function(e){if(101===e.type&&e["pushConfig.forcePush"])return"#%@all@%#"},converter:function(e,t){if(t["pushConfig.forcePush"])return e?Ti(e):"#%@all@%#"}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,converter:vh,retType:"boolean",access:"pushConfig.forcePush"},routeEnvironment:{id:21,access:"routeConfig.routeEnvironment"},callbackExt:22,clientNotificationId:{id:23,access:"notificationConfig.clientNotificationId"},conversationOnlineSyncNotify:24,conversationOnlineSyncData:25,routeEnabled:{id:105,converter:vh,retType:"boolean",access:"routeConfig.routeEnabled"},pushEnabled:{id:107,converter:vh,retType:"boolean",access:"pushConfig.pushEnabled"},unreadEnabled:{id:109,converter:vh,retType:"boolean",access:"notificationConfig.unreadEnabled"},pushNickEnabled:{id:110,converter:vh,retType:"boolean",access:"pushConfig.pushNickEnabled"}},hy={id:1,senderId:2,timestamp:{id:4,retType:"number"},content:5},fy={v2SendCustomNotification:{sid:30,cid:7,service:dy,params:[{type:"Property",name:"tag",reflectMapper:py}]},v2SendCustomNotificationWithSuperTeam:{sid:32,cid:16,service:dy,params:[{type:"Property",name:"tag",reflectMapper:py}]},onSysNotification:{sid:7,cid:3,service:dy,response:[{type:"Property",name:"data",reflectMapper:gh(py)}]},syncBroadcastMsg:{sid:4,cid:16,service:dy,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(hy)}]},onBroadcastMsg:{sid:7,cid:17,service:dy,response:[{type:"Property",name:"data",reflectMapper:gh(hy)}]},v2SyncOfflineSysNotifications:{sid:4,cid:9,service:dy,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(py)}]},v2NotificationRevoke:{sid:7,cid:14,service:dy,response:[{type:"Property",name:"data",reflectMapper:gh(py)}]},v2NotificationSyncRevoke:{sid:7,cid:15,service:dy,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(py)},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]}},gy="YSFService",vy={"4_5":"ysfBatchMarkRead","101_1":"ysfSendMessage","101_2":"ysfOnMsg","4_100":"ysfSyncOfflineMsgs","101_3":"ysfOnSysNotification","101_7":"ysfSendCustomNotification","4_101":"ysfSyncSysNotification"},yy={ysfBatchMarkRead:{sid:4,cid:5,service:gy,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},ysfSendMessage:{sid:101,cid:1,service:gy,params:[{type:"Property",name:"tag",reflectMapper:qg}],response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},ysfOnMsg:{sid:101,cid:2,service:gy,response:[{type:"Property",name:"data",reflectMapper:gh(qg)}]},ysfSyncOfflineMsgs:{sid:4,cid:100,service:gy,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(qg)}]},ysfOnSysNotification:{sid:101,cid:3,service:gy,response:[{type:"Property",name:"data",reflectMapper:gh(py)}]},ysfSendCustomNotification:{sid:101,cid:7,service:gy,params:[{type:"Property",name:"tag",reflectMapper:py}]},ysfSyncSysNotification:{sid:4,cid:101,service:gy,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(py)}]}},Iy={content:{type:"string",allowEmpty:!1},params:{type:"object",required:!1,rules:{notificationConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forcePushContent:{type:"string",required:!1},forcePushAccounts:{type:"array",required:!1,itemType:"string"}}},antispamConfig:{type:"object",required:!1,rules:{antispamEnabled:{type:"boolean",required:!1},antispamCustomNotification:{type:"string",required:!1}}},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}}}}},My=function(){function e(e){this.core=e}return e.prototype.generateNotificationTag=function(e,t,r){var n;void 0===r&&(r={});var i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),a=Ts(),s=((n={})[1]=100,n[2]=101,n[3]=103,n);return sr(sr({},r),{notificationConfig:sr({unreadEnabled:!0,offlineEnabled:!0},null==r?void 0:r.notificationConfig),pushConfig:sr({pushEnabled:!0,pushNickEnabled:!0},null==r?void 0:r.pushConfig),antispamConfig:sr({antispamEnabled:!0},null==r?void 0:r.antispamConfig),routeConfig:sr({routeEnabled:!0},null==r?void 0:r.routeConfig),timestamp:a,type:s[i],receiverId:o,content:t})},e}();function Ty(e){var t="object"==typeof e?e:void 0,r="string"==typeof e?e:void 0;if(!t&&!r)throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect file and path"}});if("string"==typeof r)if(0===bu(r).call(r,"nim-external")){var n=document.getElementById(r);if(!(n&&n.files&&n.files[0]))throw new Tl({code:yl.V2NIM_ERROR_CODE_FILE_NOT_FOUND,detail:{reason:"getFileOrPath::file not exist: "+r}});t=n.files[0]}else if("BROWSER"===Ql.platform)throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect path: "+r}});if("object"==typeof t&&void 0===t.size)throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::file no size"}});return{file:t,path:r}}var Sy,by,Cy={attachment:{type:"object",rules:{url:{type:"string",allowEmpty:!1}}},thumbSize:{type:"object",rules:{width:{type:"number",required:!1,min:0},height:{type:"number",required:!1,min:0}}}},Ey=function(e){function t(t){var r;return(r=e.call(this,"V2NIMStorageUtil",t)||this).core=t,r}er(t,e);var r=t.prototype;return r.imageThumbUrl=function(e,t){return e+"?imageView&thumbnail="+t+"z"+t},r.videoCoverUrl=function(e,t){return e+"?vframe&offset="+t},r.getImageThumbUrl=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(Cy,{attachment:n=e,thumbSize:t},"",!0),t.width=t.width||0,t.height=t.height||0,0===t.width&&0===t.height&&(t.width=150),i=n.url,r.prev=7,r.next=10,this.core.V2NIMStorageService.shortUrlToLong(n.url);case 10:i=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),this.core.logger.warn("shortUrlToLong error:",r.t0);case 16:return r.abrupt("return",{url:this.core.cloudStorage.getThumbUrl(i,t)});case 17:case"end":return r.stop()}}),r,this,[[7,13]])})))},r.getVideoCoverUrl=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(Cy,{attachment:n=e,thumbSize:t},"",!0),t.width=t.width||0,t.height=t.height||0,0===t.width&&0===t.height&&(t.width=150),i=n.url,r.prev=7,r.next=10,this.core.V2NIMStorageService.shortUrlToLong(n.url);case 10:i=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),this.core.logger.warn("shortUrlToLong error:",r.t0);case 16:return r.abrupt("return",{url:this.core.cloudStorage.getVideoCoverUrl(i,t)});case 17:case"end":return r.stop()}}),r,this,[[7,13]])})))},t}($h),_y={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},ky={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function Ry(e){return void 0===e&&(e="file"),Ti(_y[e]||{}).replace(/"/gi,'\\"')}!function(e){e[e.nos=1]="nos",e[e.s3=2]="s3"}(Sy||(Sy={})),function(e){e[e.dontNeed=-1]="dontNeed",e[e.time=2]="time",e[e.urls=3]="urls"}(by||(by={}));var wy={chunkUploadHost:"https://wannos-web.127.net",chunkUploadHostBackupList:["https://fileup.chatnos.com","https://oss.chatnos.com"],commonUploadHost:"https://fileup.chatnos.com",commonUploadHostBackupList:["https://oss.chatnos.com"],chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0};function Ay(e,t){e=e||{},t=t||function(){return!0};var r={};for(var n in e)t(e[n])&&(r[n]=e[n]);return r}var xy=function(){function e(e,t){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=e,this.cloudStorage=t}var t=e.prototype;return t.reset=function(){this.nosErrorCount=0},t.getNosAccessToken=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getNosAccessToken",{tag:e});case 2:return r=t.sent,n=Qp(r,"content.nosAccessTokenTag.token"),i=e.url,t.abrupt("return",{token:n,url:-1!==bu(i).call(i,"?")?i+"&token="+n:i+"?token="+n});case 6:case"end":return t.stop()}}),t,this)})))},t.deleteNosAccessToken=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("deleteNosAccessToken",{tag:e});case 2:case"end":return t.stop()}}),t,this)})))},t.nosUpload=function(e,t){var r,n,i,o,a,s,c,u;return Wl(this,void 0,void 0,jl.mark((function d(){var l,p,m,h,f,g,v,y,I,M,T,S,b,C,E,_,k,R;return jl.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:if(l=Qp(this.core,"config.cdn.bucket"),p={tag:e.nosScenes||l||"nim"},e.nosSurvivalTime&&(p.expireSec=e.nosSurvivalTime),m=this.core.adapters.getFileUploadInformation(e),t||m){d.next=18;break}return d.prev=6,d.next=9,this.core.sendCmd("getNosToken",{responseBody:Ry(e.type),nosToken:p});case 9:h=d.sent,d.next=18;break;case 12:if(d.prev=12,d.t0=d.catch(6),this.core.logger.error("uploadFile:: getNosToken error",d.t0),!(d.t0 instanceof Tl)){d.next=17;break}throw d.t0;case 17:throw new El({code:"v2"===Qp(this.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:d.t0,curProvider:1}});case 18:return f=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",m?null===(r=m.uploadInfo)||void 0===r?void 0:r.objectName:t?null==t?void 0:t.objectName:h.content.nosToken.objectName),g="",t&&t.shortUrl&&(g=t.shortUrl),(null===(o=null===(i=null===(n=null==m?void 0:m.uploadInfo)||void 0===n?void 0:n.payload)||void 0===i?void 0:i.mixStoreToken)||void 0===o?void 0:o.shortUrl)&&(g=m.uploadInfo.payload.mixStoreToken.shortUrl),v=g||f,d.prev=23,I=m?{token:null===(a=null==m?void 0:m.uploadInfo)||void 0===a?void 0:a.token,bucket:null===(s=null==m?void 0:m.uploadInfo)||void 0===s?void 0:s.bucketName,objectName:null===(c=null==m?void 0:m.uploadInfo)||void 0===c?void 0:c.objectName}:t||h.content.nosToken,this.core.logger.log("uploadFile:: uploadFile params",{nosToken:I,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,platform:Ql.platform}),M="BROWSER"===Ql.platform?this.config.chunkUploadHost:this.config.commonUploadHost+"/"+(I&&I.bucket),this.core.reporterHookCloudStorage.update({remote_addr:M,operation_type:t?2:0}),d.next=30,this.core.adapters.uploadFile(sr(sr(sr({},e),{nosToken:I,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,maxSize:e.maxSize||this.config.chunkMaxSize}),t?{payload:{mixStoreToken:t}}:{}));case 30:y=d.sent,d.next=65;break;case 33:if(d.prev=33,d.t1=d.catch(23),this.core.logger.error("uploadFile::nos uploadFile error:",d.t1),T="v2"===Qp(this.core,"options.apiVersion"),d.t1.code!==yl.V2NIM_ERROR_CODE_CANCELLED&&10499!==d.t1.errCode){d.next=39;break}throw new El({code:T?yl.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:Qp(d.t1,"message")||"Request abort",rawError:d.t1,curProvider:1}});case 39:if(!T||d.t1.errCode!==yl.V2NIM_ERROR_CODE_FILE_OPEN_FAILED){d.next=41;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:Qp(d.t1,"message")||"Read file failed",rawError:d.t1,curProvider:1}});case 41:return d.next=43,Ql.net.getNetworkStatus();case 43:if(!1!==d.sent.net_connect){d.next=47;break}throw new El({code:"v2"===Qp(this.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:d.t1,curProvider:1}});case 47:if(!t){d.next=64;break}if(!(this.nosErrorCount<=0)){d.next=60;break}d.prev=49,this.cloudStorage.mixStorage._addCircuitTimer(),d.next=56;break;case 53:throw d.prev=53,d.t2=d.catch(49),new El({code:"v2"===Qp(this.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:d.t2,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:e.file||e.filePath}});case 56:return this.nosErrorCount=Qp(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),d.abrupt("return",this.cloudStorage._uploadFile(e));case 60:return this.nosErrorCount--,d.abrupt("return",this.nosUpload(e,t));case 62:d.next=65;break;case 64:throw new El({code:"v2"===Qp(this.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:d.t1,curProvider:1}});case 65:if(S=null==y?void 0:y.type,(b=S&&bu(S).call(S,"/")>-1?Fc(S).call(S,0,bu(S).call(S,"/")):"")||(b=e.type||""),(C={image:"imageInfo",video:"vinfo",audio:"vinfo"})[b]){d.next=71;break}return d.abrupt("return",sr({url:v},y));case 71:return d.prev=71,d.next=74,this.core.adapters.request(f+"?"+C[b],{method:"GET",dataType:"json",timeout:5e3},{exception_service:3});case 74:E=d.sent,d.next=81;break;case 77:return d.prev=77,d.t3=d.catch(71),this.core.logger.error("uploadFile:: fetch file info error",d.t3),d.abrupt("return",sr({url:v},y));case 81:if(!E){d.next=88;break}return _=E.data,k="imageInfo"===C[b]?_:null===(u=null==_?void 0:_.GetVideoInfo)||void 0===u?void 0:u.VideoInfo,R={url:v,name:y.name,size:y.size,ext:y.ext,w:null==k?void 0:k.Width,h:null==k?void 0:k.Height,orientation:null==k?void 0:k.Orientation,dur:null==k?void 0:k.Duration,audioCodec:null==k?void 0:k.AudioCodec,videoCodec:null==k?void 0:k.VideoCodec,container:null==k?void 0:k.Container},d.abrupt("return",Ay(R,(function(e){return void 0!==e})));case 88:return d.abrupt("return",sr({url:v},y));case 89:case"end":return d.stop()}}),d,this,[[6,12],[23,33],[49,53],[71,77]])})))},t._getNosCdnHost=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.core.sendCmd("getNosCdnHost");case 3:r=t.sent,t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),this.core.logger.error("getNosCdnHost::error",t.t0),t.abrupt("return");case 10:if(r){t.next=12;break}return t.abrupt("return");case 12:n=null===(e=null==r?void 0:r.content)||void 0===e?void 0:e.nosConfigTag,0!==(i=Kp(null==n?void 0:n.expire))&&n.cdnDomain?-1===i?(this.config.cdn.bucket=n.bucket,this.config.cdn.cdnDomain=n.cdnDomain,this.config.cdn.objectNamePrefix=n.objectNamePrefix):(this.config.cdn.bucket=n.bucket,this.config.cdn.cdnDomain=n.cdnDomain,this.config.cdn.objectNamePrefix=n.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){o._getNosCdnHost()}),1e3*i)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return t.stop()}}),t,this,[[0,6]])})))},at(e,[{key:"config",get:function(){return this.cloudStorage.config}}]),e}(),Ny={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},Oy={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4,policyVersion:5},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4,policyVersion:5},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},Py={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:Oy.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:cf(Oy.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Oy.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:cf(Oy.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:cf(Oy.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:cf(Oy.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:cf(Oy.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:Oy.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:cf(Oy.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:Oy.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:cf(Oy.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Oy.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:cf(Oy.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Oy.nosAccessTokenTag}]}},Ly=function(){function e(e,t){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=e,this.cloudStorage=t,this.logger=e.logger}var t=e.prototype;return t.reset=function(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10},t.getGrayscaleConfig=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Ql.localStorage)try{Ql.localStorage.getItem&&Ql.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(Ql.localStorage.getItem(this.GRAYKEY))[e])}catch(o){Ql.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",o)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){r.next=17;break}return r.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(n=r.sent).content||!n.content.grayConfigTag){r.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(n.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(n.content.grayConfigTag.ttl)}catch(o){this.logger.error("getGrayscaleConfig error",o)}if(this.grayConfig){r.next=10;break}return r.abrupt("return");case 10:i=Ql.localStorage.getItem(this.GRAYKEY)?JSON.parse(Ql.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),i[e]=this.grayConfig,Ql.localStorage.setItem(this.GRAYKEY,Ti(i)),r.next=17;break;case 16:this.logger.log("uploadFile:: result grayConfig:",n.content);case 17:if(!(null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable)){r.next=20;break}return r.next=20,this._getMixStorePolicy(e);case 20:case"end":return r.stop()}}),r,this)})))},t._getMixStorePolicy=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(new Date).getTime(),Ql.localStorage)try{this.mixStorePolicy=JSON.parse(Ql.localStorage.getItem(this.MIXSTOREKEY))[e],this.curProvider=Kp(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>r&&(i=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-r,this.core.timerManager.addTimer(Xt(n=this._getMixStorePolicy).call(n,this,e),i))}catch(u){Ql.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(Ql.localStorage.getItem(this.MIXSTOREKEY))[e]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",u)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=r)){t.next=31;break}return t.prev=3,t.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]});case 6:a=t.sent,s=a.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.mixStorePolicy.policyVersion=s.policyVersion,this.mixStorePolicy.ttl=Number(s.ttl),this.mixStorePolicy.providers=s.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=Kp(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=s.nosPolicy?JSON.parse(s.nosPolicy):null,this.mixStorePolicy.s3Policy=s.s3Policy?JSON.parse(s.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(Xt(o=this._getMixStorePolicy).call(o,this,e),1e3*this.mixStorePolicy.ttl),c=Ql.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(Ql.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),c[e]=this.mixStorePolicy,Ql.localStorage.setItem(this.MIXSTOREKEY,Ti(c)),t.next=31;break;case 24:if(t.prev=24,t.t0=t.catch(3),this.logger.error("getMixStorePolicy error",t.t0),0!==this.mixStoreErrorCount){t.next=29;break}throw new Error("getMixStorePolicy all count error");case 29:this._getMixStorePolicy(e),this.mixStoreErrorCount--;case 31:this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 32:case"end":return t.stop()}}),t,this,[[3,24]])})))},t._addCircuitTimer=function(){var e=this,t=this.mixStorePolicy.providers,r=t[(bu(t).call(t,String(this.curProvider))+1)%t.length];if(!r)throw new Error("uploadFile nextProvider error");if(r===t[0])throw new Error("uploadFile all policy fail");if(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+r),this.curProvider=Kp(r),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy){var n=this.mixStorePolicy[1===this.curProvider?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!n||0===n)throw new Error("uploadFile circuit error");this.circuitTimer=this.core.timerManager.addTimer((function(){e.logger.log("uploadFile:: upload policy will change,now policy:"+e.curProvider+" nextProvider:"+Kp(e.mixStorePolicy.providers[0])),e.curProvider=Kp(e.mixStorePolicy.providers[0]),e.core.timerManager.deleteTimer(e.circuitTimer)}),1e3*n)}throw new Error("uploadFile will not retry again")},t.getFileAuthToken=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:e});case 2:return r=t.sent,t.abrupt("return",r.content.mixStoreAuthTokenResTag);case 4:case"end":return t.stop()}}),t,this)})))},e}(),Vy=hp.trim,Uy=y("".charAt),Dy=s.parseFloat,qy=s.Symbol,By=qy&&qy.iterator,Fy=1/Dy(cp+"-0")!=-1/0||By&&!c((function(){Dy(Object(By))}))?function(e){var t=Vy(Qi(e)),r=Dy(t);return 0===r&&"-"==Uy(t,0)?-0:r}:Dy;rt({global:!0,forced:parseFloat!=Fy},{parseFloat:Fy});var Gy,jy,Hy,Wy,Yy=q.parseFloat,Ky=-1,Qy=function(){function e(e,t){this.s3=null,this.core=e,this.cloudStorage=t,this.logger=e.logger}var t=e.prototype;return t.s3Upload=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u,d,l,p,m,h,f,g,v=this;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Ky+=1,!e.file){r.next=5;break}n=e.file,r.next=20;break;case 5:if("string"!=typeof e.fileInput){r.next=15;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((i=document.getElementById(e.fileInput))&&i.files&&i.files[0])){r.next=12;break}n=i.files[0],r.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:r.next=20;break;case 15:if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0])){r.next=19;break}n=e.fileInput.files[0],r.next=20;break;case 19:throw new Error("Can not get file from fileInput "+e.fileInput);case 20:if(this.mixStorePolicy.s3Policy){r.next=22;break}throw new Error("dont get s3 policy");case 22:return o={accessKeyId:t.accessKeyId,secretAccessKey:t.secretAccessKey,sessionToken:t.sessionToken,region:t.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},a=this.s3,s=decodeURIComponent(t.bucket),c=decodeURIComponent(t.objectName),u=n,d="https://"+s+".s3.amazonaws.com/"+c,l={},(p=this.mixStorePolicy.s3Policy)&&p.uploadConfig&&Si(p.uploadConfig.uploadUrl)&&p.uploadConfig.uploadUrl.length>0&&(m=p.uploadConfig.uploadUrl.length,Ky%=m,l.endpoint=p.uploadConfig.uploadUrl[Ky],l.s3ForcePathStyle=!0,d=l.endpoint+"/"+s+"/"+c),this.core.reporterHookCloudStorage.update({remote_addr:d,operation_type:1}),(h=new a(l)).config.update(o),f={Bucket:s,Key:c,Body:u,Metadata:{token:t.token},ContentType:u.type||"application/octet-stream"},this.core.logger.log("uploadFile:: s3 upload params:",f),(g=h.upload(f)).on("httpUploadProgress",(function(t){var r=Yy((t.loaded/t.total).toFixed(2));e.onUploadProgress&&e.onUploadProgress({total:t.total,loaded:t.loaded,percentage:r,percentageText:Math.round(100*r)+"%"})})),r.abrupt("return",new ls((function(r,n){var i=(new Date).getTime();g.send((function(o,a){return Wl(v,void 0,void 0,jl.mark((function d(){var l,p,m,h,f,g,v;return jl.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:if(!o||"RequestAbortedError"!==o.code){d.next=5;break}this.logger.error("uploadFile:","api::s3:upload file abort.",o),n(new El({code:"v2"===Qp(this.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:o,curProvider:2}})),d.next=41;break;case 5:if(!o){d.next=26;break}return this.logger.error("uploadFile:","api::s3:upload file failed.",o),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(p=null===(l=this.core)||void 0===l?void 0:l.auth)||void 0===p?void 0:p.account),trace_id:null===(m=this.core.clientSocket.socket)||void 0===m?void 0:m.sessionId,start_time:i,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof o.status?o.status:"number"==typeof o.code?o.code:0,description:o.message||""+o.code,operation_type:1,target:Ti({bucket:s,object:c})},{asyncParams:Ql.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),d.next=12,Ql.net.getNetworkStatus();case 12:if(!1!==d.sent.net_connect){d.next=16;break}return d.abrupt("return",n(new El({code:"v2"===Qp(this.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:o,curProvider:this.cloudStorage.mixStorage.curProvider}})));case 16:d.prev=16,this.cloudStorage.mixStorage._addCircuitTimer(),d.next=23;break;case 20:return d.prev=20,d.t0=d.catch(16),d.abrupt("return",n(new El({code:"v2"===Qp(this.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:d.t0,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:e.file||e.filePath}})));case 23:r(this.cloudStorage._uploadFile(e)),d.next=41;break;case 26:if(h=(h=(h=this.mixStorePolicy.s3Policy.cdnSchema).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",a.Key),f={size:u.size,name:u.name,url:t.shortUrl?t.shortUrl:h,ext:u.name.split(".")[1]||"unknown"},g=e.type||"",(v={image:"imageInfo"})[g]){d.next=36;break}return d.abrupt("return",r(f));case 36:return d.t1=r,d.next=39,this.getS3FileInfo({url:h,infoSuffix:v[g],s3Result:f});case 39:return d.t2=d.sent,d.abrupt("return",(0,d.t1)(d.t2));case 41:case"end":return d.stop()}}),d,this,[[16,20]])})))})),e.onUploadStart&&e.onUploadStart(g)})));case 39:case"end":return r.stop()}}),r,this)})))},t.getS3FileInfo=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.url,i=e.infoSuffix,o=e.s3Result,r.prev=1,r.next=4,this.core.adapters.request(n+"?"+i,{method:"GET",dataType:"text",timeout:5e3},{exception_service:3});case 4:a=r.sent,r.next=11;break;case 7:return r.prev=7,r.t0=r.catch(1),this.core.logger.error("uploadFile:: fetch file info error",r.t0),r.abrupt("return",o);case 11:if(!a){r.next=18;break}return s=a.data,c="imageInfo"===i?s:null===(t=null==s?void 0:s.GetVideoInfo)||void 0===t?void 0:t.VideoInfo,u=sr(sr({},o),{w:null==c?void 0:c.Width,h:null==c?void 0:c.Height,orientation:null==c?void 0:c.Orientation,dur:null==c?void 0:c.Duration,audioCodec:null==c?void 0:c.AudioCodec,videoCodec:null==c?void 0:c.VideoCodec,container:null==c?void 0:c.Container}),r.abrupt("return",Ay(u,(function(e){return void 0!==e})));case 18:return this.core.logger.error("uploadFile:: fetch s3 file info no result",n+"?"+i),r.abrupt("return",o);case 20:case"end":return r.stop()}}),r,this,[[1,7]])})))},at(e,[{key:"mixStorePolicy",get:function(){return this.cloudStorage.mixStorage.mixStorePolicy}}]),e}(),zy=function(){function e(e,t){void 0===t&&(t={}),this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=e.logger,this.core=e,this.nos=new xy(e,this),this.mixStorage=new Ly(e,this),this.aws=new Qy(e,this),hh({cmdMap:Ny,cmdConfig:Py}),this.setOptions(t),this.setListeners()}var t=e.prototype;return t.setOptions=function(e){void 0===e&&(e={});var t=e.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=t+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=t+"-AllMixStorePolicy";var r=e.s3,n=Hl(e,["s3"]),i=sr({},wy,this.config);if(n&&Object.prototype.hasOwnProperty.call(n,"cdn")){var o=sr(sr({},i.cdn),n.cdn);this.config=sr({},i,n),this.config.cdn=o}else this.config=sr({},i,n);r&&(this.aws.s3=r)},t.setListeners=function(){var e,t,r,n;this.core.eventBus.on("kicked",Xt(e=this._clearUnCompleteTask).call(e,this)),this.core.eventBus.on("disconnect",Xt(t=this._clearUnCompleteTask).call(t,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",Xt(r=this._clearUnCompleteTask).call(r,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",Xt(n=this._clearUnCompleteTask).call(n,this))},t._clearUnCompleteTask=function(){var e,t=this;Bn(e=pr(this.uploadTaskMap)).call(e,(function(e){var r=t.uploadTaskMap[e];r&&r.abort&&r.abort()})),this.uploadTaskMap={}},t.init=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mixStorage.reset(),this.nos.reset(),!this.config.isNeedToGetUploadPolicyFromServer){e.next=5;break}return e.next=5,this.mixStorage.getGrayscaleConfig(this.core.options.appkey);case 5:return e.next=7,this.nos._getNosCdnHost();case 7:case"end":return e.stop()}}),e,this)})))},t.processCallback=function(e,t){var r=this,n=e.onUploadProgress,i=e.onUploadDone,o=e.onUploadStart;return{onUploadStart:"function"==typeof o?function(e){r.uploadTaskMap[t]=e;try{o(e)}catch(n){r.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",n)}}:function(e){r.uploadTaskMap[t]=e},onUploadProgress:"function"==typeof n?function(e){r.core.reporterHookCloudStorage.update({transferred_size:e.loaded,full_size:e.total});try{n(e)}catch(t){r.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",t)}}:function(e){r.core.reporterHookCloudStorage.update({transferred_size:e.loaded,full_size:e.total})},onUploadDone:"function"==typeof i?function(e){r.core.reporterHookCloudStorage.end(0);try{i(e)}catch(t){r.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",t)}}:function(){r.core.reporterHookCloudStorage.end(0)},taskKey:t}},t.uploadFile=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c,u;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},e),e.fileInput||e.file||e.filePath){t.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!e.type||"file"===e.type){t.next=7;break}if(!(r=Qp(e,"file.type"))||"string"!=typeof r||-1!==bu(r).call(r,e.type)){t.next=7;break}throw new Error('The meta type "'+r+'" does not match "'+e.type+'"');case 7:return this.core.reporterHookCloudStorage.start(),e.file?this.core.reporterHookCloudStorage.update({full_size:e.file.size}):"string"==typeof e.fileInput?(n=document.getElementById(e.fileInput))&&n.files&&n.files[0]&&this.core.reporterHookCloudStorage.update({full_size:n.files[0].size}):e.fileInput&&e.fileInput.files&&e.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:e.fileInput.files[0].size}),i=Tp(),o=this.processCallback(e,i),a=o.onUploadStart,s=o.onUploadProgress,c=o.onUploadDone,e.onUploadStart=a,e.onUploadProgress=s,e.onUploadDone=c,u=null,t.prev=15,t.next=18,this._uploadFile(e);case 18:u=t.sent,e.md5&&(u.md5=e.md5),delete this.uploadTaskMap[i],t.next=28;break;case 23:throw t.prev=23,t.t0=t.catch(15),delete this.uploadTaskMap[i],this.core.reporterHookCloudStorage.end((t.t0&&t.t0.code)===yl.V2NIM_ERROR_CODE_CANCELLED?3:1),t.t0;case 28:return u&&(u.size=void 0===u.size?void 0:Number(u.size),u.w=void 0===u.w?void 0:Number(u.w),u.h=void 0===u.h?void 0:Number(u.h),u.dur=void 0===u.dur?void 0:Number(u.dur)),u.url=decodeURIComponent(u.url),e.onUploadDone({size:u.size,name:u.name,url:u.url,ext:u.name.split(".")[1]||"unknown"}),t.abrupt("return",u);case 32:case"end":return t.stop()}}),t,this,[[15,23]])})))},t._uploadFile=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Qp(this.mixStorage,"grayConfig.mixStoreEnable")&&Qp(this.mixStorage,"mixStorePolicy.providers.length")){n.next=3;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),n.abrupt("return",this.nos.nosUpload(e));case 3:if(this.logger.log("uploadFile::_uploadFile, grayConfig enable:"+Qp(this.mixStorage,"grayConfig.mixStoreEnable")+" curProvider:"+Qp(this.mixStorage,"curProvider")),i=this.core.adapters.getFileUploadInformation(e),o=!0,i?!1===i.complete&&2===this.mixStorage.curProvider&&(o=!1):o=!1,this.aws.s3||(this.mixStorage.curProvider=1),a=ky,o){n.next=23;break}return n.prev=10,n.next=13,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:e.nosSurvivalTime,returnBody:Ry(e.type),policyVersion:this.mixStorage.mixStorePolicy.policyVersion}});case 13:s=n.sent,a=s.content.mixStoreTokenResTag,n.next=23;break;case 17:if(n.prev=17,n.t0=n.catch(10),this.core.logger.error("uploadFile:: getMixStoreToken error",n.t0),!(n.t0 instanceof Tl)){n.next=22;break}throw n.t0;case 22:throw new El({code:"v2"===Qp(this.core,"options.apiVersion")?yl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:n.t0,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}});case 23:if(o){n.next=27;break}return n.abrupt("return",2===this.mixStorage.curProvider?this.aws.s3Upload(e,a):this.nos.nosUpload(e,a));case 27:return n.abrupt("return",this.nos.nosUpload(e,null===(r=null===(t=null==i?void 0:i.uploadInfo)||void 0===t?void 0:t.payload)||void 0===r?void 0:r.mixStoreToken));case 28:case"end":return n.stop()}}),n,this,[[10,17]])})))},t.getThumbUrl=function(e,t){var r,n,i,o,a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var s=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);s[0],s[1],s[2],s[3],s[4];var c=s[5];if(s[6],s[7],null===(r=this.grayConfig)||void 0===r?void 0:r.mixStoreEnable){var u=this._getUrlType(e);if(2===u&&this.mixStorePolicy.s3Policy&&Qp(this.mixStorePolicy,"s3Policy.thumbPolicy.imagethumb"))return(null===(i=null===(n=this.mixStorePolicy.s3Policy)||void 0===n?void 0:n.thumbPolicy)||void 0===i?void 0:i.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString());if(1===u&&this.mixStorePolicy.nosPolicy&&Qp(this.mixStorePolicy,"nosPolicy.thumbPolicy.imagethumb"))return(null===(a=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.thumbPolicy)||void 0===a?void 0:a.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString())}return tu(e).call(e,"?")?e+"&imageView&thumbnail="+t.width+"x"+t.height:e+"?imageView&thumbnail="+t.width+"x"+t.height},t.getVideoCoverUrl=function(e,t){var r,n,i,o,a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var s=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);s[0],s[1],s[2],s[3],s[4];var c=s[5];if(s[6],s[7],null===(r=this.grayConfig)||void 0===r?void 0:r.mixStoreEnable){var u=this._getUrlType(e);if(2===u&&this.mixStorePolicy.s3Policy&&Qp(this.mixStorePolicy,"s3Policy.thumbPolicy.vframe"))return(null===(i=null===(n=this.mixStorePolicy.s3Policy)||void 0===n?void 0:n.thumbPolicy)||void 0===i?void 0:i.vframe).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png");if(1===u&&this.mixStorePolicy.nosPolicy&&Qp(this.mixStorePolicy,"nosPolicy.thumbPolicy.vframe"))return(null===(a=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.thumbPolicy)||void 0===a?void 0:a.vframe).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png")}return tu(e).call(e,"?")?e+"&vframe&offset=0&resize="+t.width+"x"+t.height+"&type=png":e+"?vframe&offset=0&resize="+t.width+"x"+t.height+"&type=png"},t.getPrivateUrl=function(e){var t;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),"";var r=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);r[0];var n=r[1];r[2];var i=r[3];r[4];var o=r[5];if(r[6],r[7],null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable){var a=this._getUrlType(e);return 2===a&&this.mixStorePolicy.s3Policy&&(e=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",o)),1===a&&this.mixStorePolicy.nosPolicy&&(e=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",o)),e}var s=this.config,c=s.downloadUrl,u=s.downloadHostList,d=s.nosCdnEnable,l=this.config.cdn.cdnDomain,p=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",m=decodeURIComponent(o),h=bu(m).call(m,p);if(l&&h>-1&&d)return""+n+l+"/"+Fc(m).call(m,h);if(tu(u).call(u,i)&&tu(o).call(o,"/")){var f=bu(o).call(o,"/"),g=o.substring(0,f),v=o.substring(f+1);return c.replace("{bucket}",g).replace("{object}",v)}var y=lu(u).call(u,(function(e){return"string"==typeof i&&tu(i).call(i,e)}))[0],I=y?i.replace(y,"").replace(/\W/g,""):null;return I?c.replace("{bucket}",I).replace("{object}",o):e},t.getOriginUrl=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e&&tu(e).call(e,"_im_url=1")){t.next=2;break}return t.abrupt("return",e);case 2:return t.next=4,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:e}});case 4:return r=t.sent,t.abrupt("return",r.content.nosSafeUrlTag.originUrl);case 6:case"end":return t.stop()}}),t,this)})))},t.getFileToken=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},e),r=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,n=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,r!==String(-1)||n!==String(-1)){t.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(2!==e.type){t.next=17;break}if(!(r&&bu(r).call(r,String(2))>=0||n&&bu(n).call(n,String(2))>0)){t.next=13;break}return t.abrupt("return",this.mixStorage.getFileAuthToken(e));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:t.next=33;break;case 17:if(e.urls&&e.urls.length){t.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(o=[],a=[],Bn(i=e.urls).call(i,(function(e){var t=s._getUrlType(e);1===t&&a.push(e),2===t&&o.push(e)})),(!n||0!==o.length&&bu(n).call(n,String(3))<0)&&(this.logger.warn("s3 url don't support url token"),o=[]),(!r||0!==a.length&&bu(r).call(r,String(3))<0)&&(this.logger.warn("nos url don't support url token"),a=[]),0!==o.length||0!==a.length){t.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==o.length&&0!==a.length){t.next=33;break}return e.urls=Ti(e.urls),t.abrupt("return",this.mixStorage.getFileAuthToken(e));case 33:case"end":return t.stop()}}),t,this)})))},t._getUrlType=function(e){var t,r;return this.mixStorePolicy.nosPolicy&&Um(t=this.mixStorePolicy.nosPolicy.dlcdns).call(t,(function(t){return bu(e).call(e,t)>=0}))?1:this.mixStorePolicy.s3Policy&&Um(r=this.mixStorePolicy.s3Policy.dlcdns).call(r,(function(t){return bu(e).call(e,t)>=0}))?2:null},t.getNosAccessToken=function(e){return Al({url:{type:"string",allowEmpty:!1}},e),this.nos.getNosAccessToken(e)},t.deleteNosAccessToken=function(e){return Al({token:{type:"string",allowEmpty:!1}},e),this.nos.deleteNosAccessToken(e)},t.process=function(e){var t=Qp(e,"error.detail.ignore");return e.error&&!t?ls.reject(e.error):ls.resolve(e)},at(e,[{key:"grayConfig",get:function(){return this.mixStorage.grayConfig}},{key:"mixStorePolicy",get:function(){return this.mixStorage.mixStorePolicy}}]),e}(),Jy=function(e){function t(t){var r;return(r=e.call(this,"V2NIMStorageService",t)||this).sceneMap={nim_default_profile_icon:{sceneName:"nim_default_profile_icon",expireTime:0},nim_default_im:{sceneName:"nim_default_im",expireTime:0},nim_system_nos_scene:{sceneName:"nim_system_nos_scene",expireTime:0},nim_security:{sceneName:"nim_security",expireTime:0}},r.uploadingMessageInfo={},r.core=t,r.core._registerDep(zy,"cloudStorage"),r.core._registerDep(Ey,"V2NIMStorageUtil"),r}er(t,e);var r=t.prototype;return r.addCustomStorageScene=function(e,t){return this.checkV2(),Al({sceneName:{type:"string",allowEmpty:!1},expireTime:{type:"number",min:0}},{sceneName:e,expireTime:t},"",!0),this.sceneMap[e]={sceneName:e,expireTime:t},{sceneName:e,expireTime:t}},r.getStorageSceneList=function(){return this.checkV2(),ys(this.sceneMap)},r.getStorageScene=function(e){return e&&this.sceneMap[e]||this.sceneMap.nim_default_im},r.hasStorageScene=function(e){return void 0!==this.sceneMap[e]},r.createUploadFileTask=function(e){var t;if(this.checkV2(),"string"==typeof e.fileObj&&0===bu(t=e.fileObj).call(t,"nim-external")){var r=document.getElementById(e.fileObj);r&&r.files&&r.files[0]&&(e.fileObj=r.files[0])}return{taskId:Tp(),uploadParams:e}},r.uploadFile=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),r.next=4,this._uploadFile(e,t);case 4:return n=r.sent,r.abrupt("return",n[0]);case 6:case"end":return r.stop()}}),r,this)})))},r.uploadFileWithMetaInfo=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),r.next=4,this._uploadFile(e,t);case 4:return n=r.sent,r.abrupt("return",(o=void 0,a=void 0,s=void 0,c=void 0,u=void 0,d=void 0,l=void 0,p=void 0,m=void 0,h=void 0,f=void 0,g=void 0,o=(i=n[1]).url,a=i.name,s=i.size,c=i.ext,u=i.md5,d=i.h,l=i.w,p=i.orientation,m=i.dur,h=i.audioCodec,f=i.videoCodec,g=i.container,JSON.parse(Ti({url:o,name:a,size:s,ext:c,md5:u,height:d,width:l,orientation:p,duration:m,audioCodec:h,videoCodec:f,container:g}))));case 6:case"end":return r.stop()}var i,o,a,s,c,u,d,l,p,m,h,f,g}),r,this)})))},r._uploadFile=function(e,t,r){var n;return Wl(this,void 0,void 0,jl.mark((function i(){var o,a,s,c,u,d,l,p,m,h,f=this;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){i.next=2;break}throw new Error('Service "cloudStorage" does not exist');case 2:if(o=e.uploadParams,a=e.taskId,s=Ty(o.fileObj),c=s.file,u=s.path,d=(r||{}).fileType,!this.uploadingMessageInfo[a]){i.next=7;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST,detail:{reason:"V2NIMStorageService.uploadFile: repeat upload"}});case 7:if(i.prev=7,l={},c?l.file=c:u&&(0===(null==u?void 0:bu(u).call(u,"nim-external"))?l.fileInput=u:l.filePath=u),p=this.getStorageScene(o.sceneName),l.nosScenes=p.sceneName,l.nosSurvivalTime=p.expireTime,l.type=1===d?"image":2===d?"audio":3===d?"video":"file",!l.file||!this.core.pluginMap["browser-md5-file"]){i.next=19;break}return i.next=17,this.getFileMd5(this.core.pluginMap["browser-md5-file"],a,l.file);case 17:m=i.sent,l.md5=m;case 19:return l.onUploadProgress=function(e){"function"==typeof t&&t(Math.round(100*e.percentage))},l.onUploadStart=function(e){var t;if(null===(t=f.uploadingMessageInfo[a])||void 0===t?void 0:t.abort)return e.abort(),void delete f.uploadingMessageInfo[a];f.uploadingMessageInfo[a]={abort:!1,task:e}},this.uploadingMessageInfo[a]={abort:!1},i.next=24,this.core.cloudStorage.uploadFile(l);case 24:if(h=i.sent,!(null===(n=this.uploadingMessageInfo[a])||void 0===n?void 0:n.abort)){i.next=27;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}});case 27:return delete this.uploadingMessageInfo[a],i.abrupt("return",[h.url,h]);case 31:throw i.prev=31,i.t0=i.catch(7),delete this.uploadingMessageInfo[a],this.core.logger.error("sendFile:: upload File error or abort.",i.t0),i.t0;case 36:case"end":return i.stop()}}),i,this,[[7,31]])})))},r.cancelUploadFile=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.next=3,this._cancelUploadFile(e.taskId);case 3:case"end":return t.stop()}}),t,this)})))},r._cancelUploadFile=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),!(null==(r=this.uploadingMessageInfo[e])?void 0:r.task)){t.next=16;break}return t.prev=3,this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task exist"),t.next=7,r.task.abort();case 7:delete this.uploadingMessageInfo[e],t.next=14;break;case 10:t.prev=10,t.t0=t.catch(3),delete this.uploadingMessageInfo[e],this.core.logger.error("cancelMessageAttachmentUpload::abort error.",t.t0);case 14:t.next=22;break;case 16:if(!r){t.next=21;break}this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task not exist"),r.abort=!0,t.next=22;break;case 21:throw new Tl({code:yl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"V2NIMStorageService.cancelUploadFile: uploadInfo not exist"}});case 22:case"end":return t.stop()}}),t,this,[[3,10]])})))},r.getFileMd5=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i=this;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new ls((function(n,o){var a,s=new e;(null===(a=i.uploadingMessageInfo[t])||void 0===a?void 0:a.abort)?o(new Tl({code:yl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}})):i.uploadingMessageInfo[t]={abort:!1,task:s};try{s.md5(r,(function(e,t){"aborted"===e?o(new Tl({code:yl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:e}})):e?o(new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error in callback",rawError:e}})):n(t)}))}catch(c){o(new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error",rawError:c}}))}})));case 1:case"end":return n.stop()}}),n)})))},r.shortUrlToLong=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.abrupt("return",this.core.cloudStorage.getOriginUrl(e));case 2:case"end":return t.stop()}}),t,this)})))},r.getImageThumbUrl=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.core.V2NIMStorageUtil.getImageThumbUrl(e,t));case 1:case"end":return r.stop()}}),r,this)})))},r.getVideoCoverUrl=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.core.V2NIMStorageUtil.getVideoCoverUrl(e,t));case 1:case"end":return r.stop()}}),r,this)})))},t}($h),$y=function(e){function t(t){var r;return(r=e.call(this,"V2NIMMessageCreator",t)||this).name="V2NIMMessageCreator",r.defaultNosSceneName="nim_default_im",r.core=t,r}er(t,e);var r=t.prototype;return r.createMessage=function(e,t){return sr(sr(sr({messageClientId:Tp(),messageType:e,createTime:Ts(),sendingState:0,messageStatus:{errorCode:200},isSelf:!0},t),t.attachment?{attachment:sr(sr({},t.attachment),{raw:Lg(e,t.attachment)})}:{}),{senderId:"",receiverId:"",conversationType:0,conversationId:"",messageServerId:"",messageConfig:sr({unreadEnabled:!0,roamingEnabled:!0,readReceiptEnabled:!1,lastMessageUpdateEnabled:!0,historyEnabled:!0,onlineSyncEnabled:!0,offlineEnabled:!0},t.messageConfig),pushConfig:sr({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},t.pushConfig),routeConfig:sr({routeEnabled:!0},t.routeConfig),antispamConfig:sr({antispamEnabled:!0},t.antispamConfig)})},r.createTextMessage=function(e){return this.checkV2(),Al({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(0,{text:e})},r.createImageMessage=function(e,t,r,n,i){this.checkV2(),Al(iy,{name:t,sceneName:r,width:n,height:i},"",!0);var o=this.createGenericFileMessageAttachment(e,t,r,void 0,n,i,"jpeg");return this.createMessage(1,{attachment:o,attachmentUploadState:0})},r.createAudioMessage=function(e,t,r,n){this.checkV2(),Al(ry,{name:t,sceneName:r,duration:n},"",!0);var i=this.createGenericFileMessageAttachment(e,t,r,n,void 0,void 0,"aac");return this.createMessage(2,{attachment:i,attachmentUploadState:0})},r.createVideoMessage=function(e,t,r,n,i,o){this.checkV2(),Al(ny,{name:t,sceneName:r,duration:n,width:i,height:o},"",!0);var a=this.createGenericFileMessageAttachment(e,t,r,n,i,o,"mp4");return this.createMessage(3,{attachment:a,attachmentUploadState:0})},r.createFileMessage=function(e,t,r){this.checkV2(),Al(ty,{name:t,sceneName:r},"",!0);var n=this.createGenericFileMessageAttachment(e,t,r,void 0,void 0,void 0,"txt");return this.createMessage(6,{attachment:n,attachmentUploadState:0})},r.createGenericFileMessageAttachment=function(e,t,r,n,i,o,a){if(r=r||this.defaultNosSceneName,!this.core.V2NIMStorageService.hasStorageScene)throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMStorageService not exist"}});if(!this.core.V2NIMStorageService.hasStorageScene(r))throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sceneName: "+r+" has not been added"}});var s=Ty(e),c=s.file,u=s.path,d=sr(sr(sr({name:t,uploadState:0,sceneName:r||this.defaultNosSceneName},n?{duration:n}:{}),i?{width:i}:{}),o?{height:o}:{});if(c){var l,p=sp(l=c.name).call(l,"."),m=-1===p?c.name:c.name.substring(0,p);d.name=d.name||m,d.size=c.size,d.ext="."+(wp(c.name)||wp(t||"")||a)}else if(u){var h=sp(u).call(u,"/"),f=sp(u).call(u,"."),g=-1===f?u.substring(h+1):u.substring(h+1,f);d.name=d.name||g,d.ext="."+(wp(u)||wp(t||"")||a)}return d=JSON.parse(Ti(d)),u?d.path=u:c&&(d.file=c),d},r.createLocationMessage=function(e,t,r){return this.checkV2(),Al({latitude:{type:"number",allowEmpty:!1},longitude:{type:"number",allowEmpty:!1},address:{type:"string",allowEmpty:!1}},{latitude:e,longitude:t,address:r},"",!0),this.createMessage(4,{attachment:{latitude:e,longitude:t,address:r}})},r.createCustomMessage=function(e,t){return this.checkV2(),Al({text:{type:"string"}},{text:e},"",!0),Al({rawAttachment:{type:"string"}},{rawAttachment:t},"",!0),this.createMessage(100,{text:e,attachment:{raw:t}})},r.createCustomMessageWithAttachment=function(e,t){return this.checkV2(),Al({raw:{type:"string"}},e,"attachment",!0),Al({subType:{type:"number",min:0,required:!1}},{subType:t},"",!0),this.createMessage(100,t?{attachment:e,subType:t}:{attachment:e})},r.createCallMessage=function(e,t,r,n,i){return this.checkV2(),Al({type:{type:"number",allowEmpty:!1}},{type:e},"",!0),Al({channelId:{type:"string",allowEmpty:!1}},{channelId:t},"",!0),Al({status:{type:"number",allowEmpty:!1}},{status:r},"",!0),Al({durations:{type:"array",allowEmpty:!1}},{durations:n},"",!0),this.createMessage(12,{text:i||"",attachment:{type:e,channelId:t,durations:n,status:r}})},r.createForwardMessage=function(e){this.checkV2();var t=[11,5,7,10];if(!e||tu(t).call(t,e.messageType))return null;var r={messageClientId:Tp(),messageType:e.messageType};return e.text&&(r.text=e.text),e.attachment&&(r.attachment=e.attachment),e.attachment&&"uploadState"in e.attachment&&(r.attachmentUploadState=e.attachment.uploadState),this.createMessage(e.messageType,r)},r.createTipsMessage=function(e){return this.checkV2(),Al({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(10,{text:e})},t}($h),Xy=function(){function e(){this.name="V2NIMMessageAttachmentCreator"}var t=e.prototype;return t.createLocationMessageAttachment=function(e,t,r){return{latitude:"number"==typeof e?e:0,longitude:"number"==typeof t?t:0,address:"string"==typeof r?r:""}},t.createCustomMessageAttachment=function(e){return{raw:"string"==typeof e?e:""}},e}(),Zy=zt("Array").keys,eI=Array.prototype,tI={DOMTokenList:!0,NodeList:!0},rI=function(e){var t=e.keys;return e===eI||G(eI,e)&&t===eI.keys||pe(tI,Kr(e))?Zy:t},nI=function(){function e(e){this.config={enable:!0},this.name="V2NIMClientAntispamUtil",this.core=e}var t=e.prototype;return t.setOptions=function(e){this.config=sr(this.config,e)},t.reset=function(e){"destroy"===e&&(this.vocabInfo=void 0)},t.downloadLocalAntiSpamVocabs=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.enable){e.next=2;break}return e.abrupt("return");case 2:if(!this.vocabInfo){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,this.core.sendCmd("v2DownloadLocalAntiSpamVocabs",{tag:{version:0,md5:""}});case 7:t=e.sent,this.vocabInfo=sr(sr({},t.content.data),{thesaurus:JSON.parse(t.content.data.thesaurus).thesaurus}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),this.core.logger.warn("V2NIMLocalAntispamUtil::downloadLocalAntiSpamVocabs error",e.t0);case 14:case"end":return e.stop()}}),e,this,[[4,11]])})))},t.checkTextAntispam=function(e,t){if(void 0===t&&(t="**"),!this.config.enable)return{operateType:0,replacedText:e};if(Al({text:{type:"string",required:!0,allowEmpty:!1},replace:{type:"string"}},{text:e,replace:t},"",!0),!this.vocabInfo)return{operateType:0,replacedText:e};for(var r=e,n=0;n<this.vocabInfo.thesaurus.length;n++){var i=this.filterContent(r,this.vocabInfo.thesaurus[n],t);if(r=i.replacedText,2===i.operateType||3===i.operateType)return i}return{operateType:r===e?0:1,replacedText:r}},t.filterContent=function(e,t,r){for(var n=0;n<rI(t).length;n++){var i=rI(t)[n],o=i.match||t.match,a=i.operate||t.operate,s=void 0;try{s=this.matchContent(e,i.key,o,a,r)}catch(c){}if(s&&(e=s.replacedText,2===s.operateType||3===s.operateType))return s}return{operateType:1,replacedText:e}},t.matchContent=function(e,t,r,n,i){var o=!1,a="";if(1===r?bu(e).call(e,t)>=0&&(o=!0,a=t):2===r&&new RegExp(t,"g").test(e)&&(o=!0),o&&""!==a)switch(n){case 1:return{operateType:1,replacedText:e.replace(a,i)};case 2:return{operateType:2,replacedText:e};case 3:return{operateType:3,replacedText:e}}return{operateType:0,replacedText:e}},e}(),iI=function(e){function t(t){var r;return(r=e.call(this,"YSFService",t)||this).core._registerDep(hg,"V2NIMConversationIdUtil"),r.core._registerDep($y,"V2NIMMessageCreator"),r.core._registerDep(Xy,"V2NIMMessageAttachmentCreator"),r.core._registerDep(nI,"V2NIMClientAntispamUtil"),r.core._registerDep(Jy,"V2NIMStorageService"),r.sendUtil=new oI(r.core,st(r)),r.fileUtil=new uy(r.core),r.model=new Cv,r.notificationUtil=new My(r.core),hh({cmdMap:vy,cmdConfig:yy}),r}er(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i,o=this.name+"::emit "+t.toString(),a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];if("onSendMessage"===t){var u=s[0];this.logger.log(""+o,u.messageClientId+"/"+u.messageServerId+";createTime:"+u.createTime+";","sendingState:"+u.sendingState+";attachmentUploadState:"+(u.attachmentUploadState||0)+";messageStatus:"+(null===(i=u.messageStatus)||void 0===i?void 0:i.errorCode))}else if("onReceiveMessages"===t){var d=s[0];this.logger.log(""+o,au(d).call(d,(function(e){return e.messageClientId+"/"+e.messageServerId+";createTime:"+e.createTime})))}else if("onReceiveCustomNotifications"===t){var l=s[0];this.logger.log(""+o,au(l).call(l,(function(e){return"sender:"+e.senderId+";receiver:"+e.receiverId+";ctype:"+e.conversationType+";time:"+e.timestamp})))}else{var p,m;(p=this.logger).log.apply(p,Rs(m=[""+o]).call(m,s))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,s))},r.sendMessage=function(e,t,r,n){return void 0===r&&(r={}),Wl(this,void 0,void 0,jl.mark((function i(){var o,a,s,c,u,d;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return Al({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||Tp(),Al(Pv,{conversationId:t,message:e,params:r},"",!0),Nl(this.core.account,t),o=this.core.timeOrigin.getTimeNode(),a=this.sendUtil.prepareMessage(e,t,r),s=a.messageBeforeSend,c=a.clientAntispamResult,u=a.hiddenParams,i.next=8,this.sendUtil.doSendMessage({apiCallingTimeNode:o,messageBeforeSend:s,clientAntispamResult:c,hiddenParams:u,progress:n});case 8:return(d=i.sent).message.senderId===d.message.receiverId&&this.markMsgsAck([d.message]),i.abrupt("return",d);case 11:case"end":return i.stop()}}),i,this)})))},r.sendCustomNotification=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Nl(this.core.account,e),Al(Iy,{content:t,params:r},"",!0),(i=this.notificationUtil.generateNotificationTag(e,t,r)).type=100,n.next=7,this.core.sendCmd("ysfSendCustomNotification",{tag:i});case 7:case"end":return n.stop()}}),n,this)})))},r.sendMessageHandler=function(e){},r.cancelMessageAttachmentUpload=function(e){return this.fileUtil.cancelMessageAttachmentUpload(e)},r.markMsgsAck=function(e){var t;if(e&&e.length>0){var r=lu(t=au(e).call(e,(function(e){return e.messageServerId}))).call(t,(function(e){return e&&"0"!==e}));0!==r.length&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:2,ids:r})}},r.markNotificationAck=function(e){var t;if(e&&e.length>0){var r=lu(t=au(e).call(e,(function(e){return e.idServer}))).call(t,(function(e){return e&&"0"!==e}));0!==r.length&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:3,ids:r})}},r.ysfOnMsgHandler=function(e){var t=e.content.data,r=Pg(Rg(this.core,t),this.core);delete r.__clientExt,this.emit("onReceiveMessages",[r]),this.model.upsertMessages([r]),this.markMsgsAck([r])},r.ysfSyncOfflineMsgsHandler=function(e){var t=this,r=e.content.datas;r=au(r).call(r,(function(e){return Pg(Rg(t.core,e),t.core)})),this.markMsgsAck(r),this.emit("onReceiveMessages",r),this.model.upsertMessages(r)},r.ysfOnSysNotificationHandler=function(e){this.markNotificationAck([e.content.data]);var t=this.processSystemNotification(e.content.data);t&&this.emit("onReceiveCustomNotifications",[t])},r.processSystemNotification=function(e){var t=sr(sr({},e),{conversationType:1});return delete t.type,t},r.ysfSyncSysNotificationHandler=function(e){var t,r,n,i=this;this.markNotificationAck(e.content.datas);var o=lu(t=au(r=xm(n=e.content.datas).call(n,(function(e,t){return e.timestamp-t.timestamp}))).call(r,(function(e){return i.processSystemNotification(e)}))).call(t,(function(e){return e}));o&&this.emit("onReceiveCustomNotifications",o)},t}($h),oI=function(){function e(e,t){this.uploadingMessageInfo={},this.core=e,this.service=t}var t=e.prototype;return t.prepareMessage=function(e,t,r,n){var i=this.checkIfResend(e),o=this.generateSendMessage({message:e,params:r,resend:i,conversationId:t,replyMessage:n}),a=sr({},r.targetConfig?{targetConfig:r.targetConfig}:{}),s=this.checkIfAntispam(r,o),c=s.clientAntispamResult,u=s.text;return o.text=u,o.clientAntispamHit=!!c&&3===c.operateType,{messageBeforeSend:o,clientAntispamResult:c,hiddenParams:a}},t.checkIfAntispam=function(e,t){var r,n=t.text;if(e.clientAntispamEnabled&&(0===t.messageType||10===t.messageType))if(1===(r=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(t.text||"",e.clientAntispamReplace):{operateType:0,replacedText:""}).operateType)n=r.replacedText;else if(2===r.operateType)throw this.service.emit("onSendMessage",sr(sr({},t),{sendingState:2,messageStatus:{errorCode:yl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM}})),new Tl({code:yl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:r,text:n}},t.doMsgReceiveReport=function(e,t){if(e.senderId!==this.core.account){var r=Qp(e,"__clientExt.statistics.apiCallingTime")||0,n=Qp(e,"__clientExt.statistics.sendTime")||0,i=Qp(e,"__clientExt.statistics.attachUploadDuration")||0,o=this.core.timeOrigin.getNTPTime(),a=e.createTime,s=this.core.timeOrigin.checkNodeReliable(t.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(t.__receiveTimeNode):o;this.core.reporter.report("msgReceive",{msgId:e.messageServerId,clientId:e.messageClientId,serverTime:e.createTime,receiveTime:s,fromAccid:1===e.conversationType?e.senderId:"",toAccid:e.receiverId,type:Yg(e.conversationType),tid:1===e.conversationType?"":e.receiverId,apiCallingTime:r,sendTime:n,attachUploadDuration:i,callbackTime:o,preHandleTime:o,result:200,failReason:"",rt:o-a})}},t.checkIfResend=function(e){var t=this.service.model.getMessageById(e.messageClientId),r=!1;if(e.messageServerId||1===e.sendingState)throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});if(1===(null==t?void 0:t.sendingState))throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});return t&&(r=!0),r},t.doSendMessage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p,m,h;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.apiCallingTimeNode,n=e.messageBeforeSend,i=e.clientAntispamResult,o=e.hiddenParams,a=e.progress,s={},!(c=this.service instanceof iI)){t.next=7;break}u="ysfSendMessage",t.next=20;break;case 7:if(1!==n.conversationType){t.next=11;break}u="v2SendP2pMessage",t.next=20;break;case 11:if(2!==n.conversationType){t.next=15;break}u="v2SendTeamMessage",t.next=20;break;case 15:if(3!==n.conversationType){t.next=19;break}u="v2SendSuperTeamMessage",t.next=20;break;case 19:throw new bl({detail:{reason:"conversationType: "+n.conversationType+" is not supported"}});case 20:if(this.service.sendMessageHandler(n),!c&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",n),!n.attachment||!("uploadState"in n.attachment)||n.attachment.url||0!==n.attachment.uploadState&&2!==n.attachment.uploadState){t.next=48;break}return d=Ts(),t.prev=24,n.attachmentUploadState=3,n.attachment.uploadState=3,this.service.emit("onSendMessage",n),t.next=30,this.service.fileUtil.doSendFile(n,a);case 30:n.attachmentUploadState=1,n.attachment.uploadState=1,this.service.emit("onSendMessage",n),t.next=45;break;case 35:throw t.prev=35,t.t0=t.catch(24),n.attachmentUploadState=2,n.attachment.uploadState=2,n.sendingState=2,n.messageStatus={errorCode:t.t0.code||yl.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",n),s.attachUploadDuration=Ts()-d,this.doSendMessageFailed(r,s,n,t.t0),t.t0;case 45:s.attachUploadDuration=Ts()-d,t.next=49;break;case 48:this.service.emit("onSendMessage",n);case 49:return this.core.timeOrigin.checkNodeReliable(r)&&(s.apiCallingTime=this.core.timeOrigin.getNTPTime(r),s.sendTime=this.core.timeOrigin.getNTPTime(),n.__clientExt={statistics:s}),t.prev=50,t.next=53,this.core.sendCmd(u,{tag:sr({},n,o)});case 53:l=t.sent,t.next=63;break;case 56:throw t.prev=56,t.t1=t.catch(50),this.doSendMessageFailed(r,s,n,t.t1),n.sendingState=2,n.messageStatus={errorCode:t.t1.code||yl.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",n),t.t1;case 63:return p=Qp(l,"content.data.errorCode"),m=sr(sr(sr({},n),l.content.data),{sendingState:1,messageStatus:{errorCode:p&&200!==p?p:200}}),this.service.sendMessageHandler(m),!c&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",m),this.doMsgSendReport(r,s,n),(h=m.antispamResult)&&(m.messageStatus.errorCode=yl.V2NIM_ERROR_CODE_SERVER_ANTISPAM),delete m.antispamResult,this.service.emit("onSendMessage",m),t.abrupt("return",sr(sr({message:m},h?{antispamResult:h}:{}),i?{clientAntispamResult:i}:{}));case 73:case"end":return t.stop()}}),t,this,[[24,35],[50,56]])})))},t.doSendMessageFailed=function(e,t,r,n){var i=sr(sr({},r),{sendingState:2});this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",i),this.service.sendMessageHandler(i),this.doMsgSendReport(e,t,r,n)},t.doMsgSendReport=function(e,t,r,n){t.apiCallingTime=this.core.timeOrigin.getNTPTime(e),t.sendTime=this.core.timeOrigin.getNTPTime();var i=this.core.timeOrigin.getNTPTime(),o=Qp(n,"detail.reason");this.core.reporter.report("msgSend",{msgId:r.messageServerId,clientId:r.messageClientId,msgTime:r.createTime,fromAccid:1===r.conversationType?r.senderId:"",toAccid:r.receiverId,type:Yg(r.conversationType),tid:1===r.conversationType?"":r.receiverId,result:n?n.code:200,failReason:o||(null==n?void 0:n.message)||"",rt:i-t.apiCallingTime,apiCallingTime:t.apiCallingTime,sendTime:t.sendTime,attachUploadDuration:t.attachUploadDuration,apiCallbackTime:i})},t.generateSendMessage=function(e){var t,r,n=e.conversationId,i=e.replyMessage,o=e.resend,a=e.message,s=e.params,c={};if(i){var u=i.threadRoot;c={threadReply:{senderId:i.senderId,receiverId:i.receiverId,messageServerId:i.messageServerId,createTime:i.createTime,messageClientId:i.messageClientId,conversationType:i.conversationType,conversationId:i.conversationId},threadRoot:{senderId:u?u.senderId:i.senderId,receiverId:u?u.receiverId:i.receiverId,messageServerId:u?u.messageServerId:i.messageServerId,createTime:u?u.createTime:i.createTime,messageClientId:u?u.messageClientId:i.messageClientId,conversationType:u?u.conversationType:i.conversationType,conversationId:u?u.conversationId:i.conversationId}}}var d=this.core.V2NIMConversationIdUtil.parseConversationType(n),l=this.core.V2NIMConversationIdUtil.parseConversationTargetId(n);s.pushConfig&&!0!==s.pushConfig.forcePush&&(delete s.pushConfig.forcePushContent,delete s.pushConfig.forcePushAccountIds);var p={},m={};if(s.aiConfig){var h=Qp(s,"aiConfig.content.msg"),f=Qp(s,"aiConfig.content.type")||0;h?m={msg:h,type:f}:void 0===h&&0===a.messageType&&(m={msg:a.text||"",type:f}),(p=sr({},s.aiConfig)).aiStatus=1,void 0!==m.msg&&(p.content=m)}var g=null===(r=null===(t=this.core.V2NIMUserService)||void 0===t?void 0:t.model)||void 0===r?void 0:r.getUser(this.core.account),v=(null==g?void 0:g.updateTime)||0;return sr(sr(sr(sr(sr(sr(sr(sr({},a),c),{messageConfig:sr(sr({},a.messageConfig),s.messageConfig),routeConfig:sr(sr({},a.routeConfig),s.routeConfig),pushConfig:sr(sr({},a.pushConfig),s.pushConfig),antispamConfig:sr(sr({},a.antispamConfig),s.antispamConfig),robotConfig:sr(sr({},a.robotConfig),s.robotConfig)}),p&&p.accountId?{aiConfig:p}:{}),a.attachment?{attachment:sr({},a.attachment)}:{}),{resend:o,senderId:this.core.account,conversationType:d,receiverId:l,conversationId:this.core.V2NIMConversationIdUtil.messageConversationId({conversationType:d,senderId:this.core.account,receiverId:l})}),v?{userUpdateTime:v}:{}),{sendingState:3})},e}(),aI=function(){function e(e,t){this.core=e,this.service=t}var t=e.prototype;return t.checkIfModify=function(e,t){var r,n;if("0"===e.messageServerId)throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageServerId cannot be empty"}});if(1===e.conversationType&&e.senderId!==this.core.account)throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: senderId should be self"}});if(!tu(r=[0,1,2,3,4,6,10,12,100]).call(r,e.messageType))throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+e.messageType+" not correct"}});if(tu(n=[0,1,2,3,6,10,12]).call(n,e.messageType)&&t.attachment)throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+e.messageType+" can not modify attachment"}});var i=["subType","text","serverExtension","attachment"];if(!Um(i).call(i,(function(e){return void 0!==Qp(t,e)})))throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: missing modified params"}});if(Ru(i).call(i,(function(r){return"attachment"===r?e.attachment&&t.attachment?Lg(e.messageType,e.attachment)===Lg(e.messageType,t.attachment):!t.attachment:Qp(e,r)===Qp(t,r)})))throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: no change"}})},t.prepareMessage=function(e,t){var r=this.generateSendMessage(e,t),n=this.checkIfAntispam(t,r),i=n.clientAntispamResult,o=n.text;return r.text=o,r.clientAntispamHit=!!i&&3===i.operateType,{messageBeforeSend:r,clientAntispamResult:i}},t.modifyMessage=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(1!==e.conversationType){r.next=4;break}n="v2MessageP2pModify",r.next=13;break;case 4:if(2!==e.conversationType){r.next=8;break}n="v2MessageTeamModify",r.next=13;break;case 8:if(3!==e.conversationType){r.next=12;break}n="v2MessageSuperTeamModify",r.next=13;break;case 12:throw new bl({detail:{reason:"conversationType: "+e.conversationType+" is not supported"}});case 13:return r.next=15,this.core.sendCmd(n,{tag:e});case 15:if(i=r.sent,!t||3!==t.operateType){r.next=18;break}return r.abrupt("return",{errorCode:yl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,clientAntispamResult:t});case 18:if(o=sr(sr({},e),i.content.data),!(a=o.antispamResult)){r.next=22;break}return r.abrupt("return",sr({errorCode:yl.V2NIM_ERROR_CODE_SERVER_ANTISPAM,antispamResult:a},t?{clientAntispamResult:t}:{}));case 22:return delete o.antispamResult,s=Rg(this.core,o),this.service.model.upsertMessages([s]),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",s),r.abrupt("return",sr(sr({errorCode:200,message:s},a?{antispamResult:a}:{}),t?{clientAntispamResult:t}:{}));case 27:case"end":return r.stop()}}),r,this)})))},t.checkIfAntispam=function(e,t){var r,n=t.text;if(e.clientAntispamEnabled&&(0===t.messageType||10===t.messageType))if(1===(r=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(t.text||"",e.clientAntispamReplace):{operateType:0,replacedText:""}).operateType)n=r.replacedText;else if(2===r.operateType)throw new Tl({code:yl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:r,text:n}},t.generateSendMessage=function(e,t){var r;return sr(sr({messageConfig:{lastMessageUpdateEnabled:null===(r=e.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled},routeConfig:sr({routeEnabled:!0},t.routeConfig),pushConfig:sr({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},t.pushConfig),antispamConfig:sr({antispamEnabled:!0},t.antispamConfig)},t.attachment?{attachment:t.attachment}:{}),{conversationType:e.conversationType,senderId:e.senderId,receiverId:e.receiverId,createTime:e.createTime,messageClientId:e.messageClientId,messageServerId:e.messageServerId,messageType:e.messageType,subType:t.subType,text:t.text,serverExtension:t.serverExtension})},e}(),sI=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMMessageService",t)||this).customAttachmentParsers=[],n.config={compatibleWithV1:!0},n.emitRevokeMessage=function(e){var t=au(e).call(e,(function(e){return xg(n.core,e)}));Bn(t).call(t,(function(e){n.model.deleteMessage(e.messageRefer.messageClientId)})),n.emit("onMessageRevokeNotifications",t),n.core.eventBus.emit("V2NIMConversationService/revokeMessages",t)},n.sendMessageHandler=function(e){if(e.msgAckSnapshot){var t=e.msgAckSnapshot,r={conversationId:e.conversationId,messageServerId:e.messageServerId,messageClientId:e.messageClientId,readCount:0,unreadCount:Number(t)};delete e.msgAckSnapshot,n.emit("onReceiveTeamMessageReadReceipts",[r])}e=Pg(e,n.core),n.model.upsertMessages([e]),n.core.eventBus.emit("V2NIMConversationService/sendMessage",e,e.sendingState)},n.revokeMessagesHandler=function(e){Bn(e).call(e,(function(e){n.model.deleteMessage(e.messageRefer.messageClientId)})),n.emit("onMessageRevokeNotifications",e),n.core.eventBus.emit("V2NIMConversationService/revokeMessages",e)},n.deleteMessagesHandler=function(e){Bn(e).call(e,(function(e){n.model.deleteMessage(e.messageRefer.messageClientId)})),n.emit("onMessageDeletedNotifications",e),n.core.eventBus.emit("V2NIMConversationService/deleteMessages",e)},n.core._registerDep(hg,"V2NIMConversationIdUtil"),n.core._registerDep($y,"V2NIMMessageCreator"),n.core._registerDep(Xy,"V2NIMMessageAttachmentCreator"),n.core._registerDep(nI,"V2NIMClientAntispamUtil"),n.receiptUtil=new cy(n.core,st(n)),n.fileUtil=new uy(n.core),n.sendUtil=new oI(n.core,st(n)),n.modifyUtil=new aI(n.core,st(n)),n.model=new Cv,"v2"!==n.core.options.apiVersion?st(n):(hh({cmdMap:Dg,cmdConfig:Wg}),n.setOptions(r),n.setListener(),n)}er(t,e);var r=t.prototype;return r.setOptions=function(e){var t;(null===(t=this.core.msg)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=sr(this.config,e)},r.setListener=function(){var e=this;this.core.eventBus.on("forwardReceive/V2NIMMessageService/sendMsg",this.sendMessageHandler),this.core.eventBus.on("forwardReceive/V2NIMMessageService/revokeMessages",this.emitRevokeMessage),this.core.eventBus.on("forwardReceive/V2NIMMessageService/deleteMessages",this.deleteMessagesHandler),this.core.eventBus.on("V2NIMConversationService/deleteConversation",(function(t){Bn(t).call(t,(function(t){return e.model.deleteMessages(t)}))}))},r.reset=function(){this.model.reset()},r.emit=function(t){for(var r,n,i,o=this.name+"::emit "+t.toString(),a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];if("onSendMessage"===t){var u=s[0];this.logger.log(""+o,u.messageClientId+"/"+u.messageServerId+"/"+u.createTime+";","sendingState:"+u.sendingState+";attachmentUploadState:"+(u.attachmentUploadState||0)+";messageStatus:"+(null===(i=u.messageStatus)||void 0===i?void 0:i.errorCode))}else if("onReceiveMessages"===t||"onReceiveMessagesModified"===t){var d=s[0];this.logger.log(""+o,au(d).call(d,(function(e){return e.messageClientId+"/"+e.messageServerId+"/"+e.createTime})))}else if("onMessageRevokeNotifications"===t){var l=s[0];this.logger.log(""+o,au(l).call(l,(function(e){return"msg:"+e.messageRefer.messageClientId+"/"+e.messageRefer.messageServerId+";revokeAccountId:"+e.revokeAccountId})))}else if("onMessageDeletedNotifications"===t){var p=s[0];this.logger.log(""+o,au(p).call(p,(function(e){return"msg:"+e.messageRefer.messageClientId+"/"+e.messageRefer.messageServerId})))}else{var m,h;(m=this.logger).log.apply(m,Rs(h=[""+o]).call(h,s))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,s))},r.checkExtendUtil=function(){var e;if(!(null===(e=this.core.V2NIMMessageExtendUtil)||void 0===e?void 0:e.name))throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageLogUtil is not registered"}})},r.checkLogUtil=function(){var e;if(!(null===(e=this.core.V2NIMMessageLogUtil)||void 0===e?void 0:e.name))throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageExtendUtil is not registered"}})},r.getMessageList=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.getMessageList(e)},r.getMessageListByRefers=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.getMessageListByRefers(e)},r.clearHistoryMessage=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.clearHistoryMessage(e)},r.pinMessage=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.pinMessage(e,t)},r.unpinMessage=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.unpinMessage(e,t)},r.updatePinMessage=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updatePinMessage(e,t)},r.voiceToText=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.voiceToText(e)},r.getPinnedMessageList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getPinnedMessageList(e)},r.addQuickComment=function(e,t,r,n){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addQuickComment(e,t,r,n)},r.removeQuickComment=function(e,t,r){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeQuickComment(e,t,r)},r.getQuickCommentList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getQuickCommentList(e)},r.addCollection=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addCollection(e)},r.removeCollections=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeCollections(e)},r.updateCollectionExtension=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updateCollectionExtension(e,t)},r.getCollectionListByOption=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListByOption(e)},r.getCollectionListExByOption=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListExByOption(e)},r.searchCloudMessages=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.searchCloudMessages(e)},r.getThreadMessageList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getThreadMessageList(e)},r.registerCustomAttachmentParser=function(e){var t;"function"==typeof e&&-1===bu(t=this.customAttachmentParsers).call(t,e)&&this.customAttachmentParsers.unshift(e)},r.unregisterCustomAttachmentParser=function(e){var t,r,n=bu(t=this.customAttachmentParsers).call(t,e);n>-1&&si(r=this.customAttachmentParsers).call(r,n,1)},r.sendP2PMessageReceipt=function(e){return this.checkV2(),this.receiptUtil.sendP2PMessageReceipt(e)},r.isPeerRead=function(e){return this.checkV2(),this.receiptUtil.isPeerRead(e)},r.getP2PMessageReceipt=function(e){return this.checkV2(),this.receiptUtil.getP2PMessageReceipt(e)},r.getTeamMessageReceipts=function(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceipts(e)},r.getTeamMessageReceiptDetail=function(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceiptDetail(e)},r.sendTeamMessageReceipts=function(e){return this.checkV2(),this.receiptUtil.sendTeamMessageReceipts(e)},r.revokeMessage=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(Lv,{message:e,params:t},"",!0),Nl(this.core.account,e.conversationId),1!==e.conversationType||e.senderId===this.core.account){r.next=7;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: p2p message senderId is not current user"}});case 7:if(e.messageServerId&&"0"!==e.messageServerId){r.next=9;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: cannot revoke message with invalid messageServerId: "+e.messageServerId}});case 9:return o=3===e.conversationType?"v2RevokeSuperTeamMessage":"v2RevokeMessage",(n={})[1]=7,n[2]=8,n[3]=12,a=n,s=sr(sr(sr({},e),t),{attach:t&&t.serverExtension,sysMsgType:a[e.conversationType],opeAccount:this.core.account}),r.next=14,this.core.sendCmd(o,{tag:s});case 14:(i={})[1]=1,i[2]=2,i[3]=3,c=i,u=[JSON.parse(Ti({postscript:t&&t.postscript,revokeType:c[e.conversationType],revokeAccountId:this.core.account,serverExtension:t&&t.serverExtension,messageRefer:Ag(this.core,e)}))],this.revokeMessagesHandler(u),this.core.eventBus.emit("forwardSend/V2NIMMessageService/revokeMessage",s);case 18:case"end":return r.stop()}}),r,this)})))},r.deleteMessage=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(qv,e,"",!0),3!==e.sendingState){r.next=6;break}this.fileUtil.cancelMessageAttachmentUpload(e),r.next=8;break;case 6:if(!e.sendingState||1===e.sendingState){r.next=8;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: cannot delete unsent message"}});case 8:if(n={messageRefer:Ag(this.core,e),serverExtension:t},i=Ts(),!e.messageServerId||"0"===e.messageServerId){r.next=15;break}return r.next=13,this.core.sendCmd("v2DeleteMessage",{tag:n});case 13:o=r.sent,i=o.content.timetag;case 15:a=[{serverExtension:t,messageRefer:Ag(this.core,e),deleteTime:i}],this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",[sr(sr({},n),{deleteTime:i})]),this.deleteMessagesHandler(a);case 18:case"end":return r.stop()}}),r,this)})))},r.deleteMessages=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u,d,l,p,m=this;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(Bv,{messages:e},"",!0),i=[],o=[],0!==e.length){r.next=8;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: message array length is 0"}});case 8:a=e[0].conversationId,s=0;case 10:if(!(s<e.length)){r.next=23;break}if(3!==e[s].sendingState){r.next=15;break}this.fileUtil.cancelMessageAttachmentUpload(e[s]),r.next=17;break;case 15:if(!e[s].sendingState||1===e[s].sendingState){r.next=17;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: sendingState should be succeeded, please check message at index: "+s}});case 17:if(!(s>=1&&e[s].conversationId!==a)){r.next=19;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: only allow to delete messages from same conversation"}});case 19:e[s].messageServerId&&"0"!==e[s].messageServerId?i.push(e[s]):o.push(e[s]);case 20:s++,r.next=10;break;case 23:if(c=Ts(),u=Rs(n=[]).call(n,o),r.prev=25,!(i.length>0)){r.next=32;break}return r.next=29,this.core.sendCmd("v2DeleteMessages",{tag:au(i).call(i,(function(e){return{messageRefer:e,serverExtension:t}}))});case 29:l=r.sent,c=l.content.timetag,u=Rs(d=[]).call(d,u,i);case 32:r.next=41;break;case 34:if(r.prev=34,r.t0=r.catch(25),0!==o.length){r.next=40;break}throw r.t0;case 40:this.logger.warn("V2NIMMessageService:deleteMessages: delete messages with serverId failed");case 41:p=au(u).call(u,(function(e){return{serverExtension:t,messageRefer:Ag(m.core,e),deleteTime:c}})),this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",au(u).call(u,(function(e){return{messageRefer:e,serverExtension:t,deleteTime:c}}))),this.deleteMessagesHandler(p);case 44:case"end":return r.stop()}}),r,this,[[25,34]])})))},r.cancelMessageAttachmentUpload=function(e){return this.checkV2(),this.fileUtil.cancelMessageAttachmentUpload(e)},r.markMsgsAck=function(e){var t=this;if(e&&e.length>0){var r=[],n=[];Bn(e).call(e,(function(e){e.senderId===t.core.account&&e.senderId!==e.receiverId||(1===e.conversationType?r.push(e):2===e.conversationType&&n.push(e))})),r.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:2,ids:au(r).call(r,(function(e){return e.messageServerId}))}),n.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:8,cid:3,ids:au(n).call(n,(function(e){return e.messageServerId}))})}},r.onMsgHandler=function(e){var t=e.content.msg,r=t._conversationOnlineSyncNotify,n=t._conversationOnlineSyncData,i=Hl(t,["_conversationOnlineSyncNotify","_conversationOnlineSyncData"]),o=Rg(this.core,i),a=Pg(o,this.core);this.logger.log("v2OnMsgHandler::recvMsg "+a.messageClientId+" "+a.messageServerId),5!==a.messageType&&this.core.V2NIMUserService.checkUserUpdate&&this.core.V2NIMUserService.checkUserUpdate(a,a.userUpdateTime),!this.config.compatibleWithV1&&this.sendUtil.doMsgReceiveReport(a,e),delete a.__clientExt,this.emit("onReceiveMessages",[a]),this.model.upsertMessages([a]),!this.config.compatibleWithV1&&this.markMsgsAck([a]),r&&this.core.eventBus.emit("V2NIMConversationService/conversationOnlineSyncNotify",{content:{info:JSON.parse(r),data:JSON.parse(n)}},a),5===a.messageType&&this.core.eventBus.emit("V2NIMTeamService/notification",o)},r.syncOfflineMsgsHandler=function(e){var t=this,r=e.content.datas,n=au(r).call(r,(function(e){return Pg(Rg(t.core,e),t.core)}));!this.config.compatibleWithV1&&this.markMsgsAck(n),this.emit("onReceiveMessages",n),this.model.upsertMessages(n),this.core.eventBus.emit("V2NIMConversationService/checkBackFill",au(n).call(n,(function(e){return e.conversationId})))},r.syncRoamingMsgsHandler=function(e){var t=this,r=e.content.datas;r=au(r).call(r,(function(e){return Pg(Rg(t.core,e),t.core)})),this.emit("onReceiveMessages",r),this.model.upsertMessages(r),this.core.eventBus.emit("V2NIMConversationService/checkBackFill",au(r).call(r,(function(e){return e.conversationId})))},r.onP2PMessageReceiptsHandler=function(e){this.receiptUtil.onP2PMessageReceiptsHandler(e)},r.onTeamMessageReceiptsHandler=function(e){this.receiptUtil.onTeamMessageReceiptsHandler(e)},r.syncP2PMessagReceiptsHandler=function(e){this.receiptUtil.syncP2PMessagReceiptsHandler(e)},r.syncRevokeMessageHandler=function(e){this.emitRevokeMessage(e.content.datas)},r.onRevokeMessageHandler=function(e){this.emitRevokeMessage([e.content.data])},r.onDeleteMessageHandler=function(e){var t=e.content.data,r={serverExtension:t.serverExtension,deleteTime:t.deleteTime,messageRefer:wg(this.core,t.messageRefer)};this.deleteMessagesHandler([r])},r.onDeleteMessagesHandler=function(e){var t,r=this,n=au(t=e.content.data).call(t,(function(e){return{serverExtension:e.serverExtension,deleteTime:e.deleteTime,messageRefer:wg(r.core,e.messageRefer)}}));this.deleteMessagesHandler(n)},r.syncOnDeleteMessagesHandler=function(e){var t=this,r=e.content.datas,n=au(r).call(r,(function(e){return{serverExtension:e.serverExtension,deleteTime:e.deleteTime,messageRefer:wg(t.core,e.messageRefer)}}));this.emit("onMessageDeletedNotifications",n)},r.sendMessage=function(e,t,r,n){return void 0===r&&(r={}),Wl(this,void 0,void 0,jl.mark((function i(){var o,a,s,c,u,d,l,p,m=this;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Al({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||Tp(),!e.conversationId||e.conversationId===t){i.next=5;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message.conversationId is not equal to conversationId"}});case 5:if(Al(Pv,{conversationId:t,message:e,params:r},"",!0),Nl(this.core.account,t),2!==(o=this.core.V2NIMConversationIdUtil.parseConversationType(t))&&3!==o||!r.robotConfig||r.robotConfig.accountId){i.next=10;break}throw new bl({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 10:if(2!==o&&3!==o||!r.targetConfig){i.next=20;break}if(a=r.targetConfig.receiverIds,3!==o||!1!==r.targetConfig.inclusive){i.next=14;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"setting inclusive to false for super teams is not allowed"}});case 14:if(0!==(a=lu(a).call(a,(function(e){return e&&e!==m.core.account}))).length){i.next=17;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"receiverIds cannot be empty or only contain yourself"}});case 17:r.targetConfig.receiverIds=a,i.next=21;break;case 20:r.targetConfig=void 0;case 21:return s=this.core.timeOrigin.getTimeNode(),c=this.sendUtil.prepareMessage(e,t,r),u=c.messageBeforeSend,d=c.clientAntispamResult,l=c.hiddenParams,this.logger.log("V2SendMessage start:"+u.messageClientId+"/"+u.createTime+";conversation:"+t+";","NTPTime:"+this.core.timeOrigin.getNTPTime(s)),i.prev=24,i.next=27,this.sendUtil.doSendMessage({apiCallingTimeNode:s,messageBeforeSend:u,clientAntispamResult:d,hiddenParams:l,progress:n});case 27:p=i.sent,i.next=34;break;case 30:throw i.prev=30,i.t0=i.catch(24),this.logger.warn("V2SendMessage end:"+u.messageClientId+".",i.t0 instanceof Tl?"failed:"+i.t0.code:"failed"),i.t0;case 34:return p.message.senderId===p.message.receiverId&&this.markMsgsAck([p.message]),this.logger.log("V2SendMessage end:"+p.message.messageClientId+"/"+p.message.messageServerId+"/"+p.message.createTime),i.abrupt("return",p);case 37:case"end":return i.stop()}}),i,this,[[24,30]])})))},r.replyMessage=function(e,t,r,n){return void 0===r&&(r={}),Wl(this,void 0,void 0,jl.mark((function i(){var o,a,s,c,u,d;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Al({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||Tp(),Al(Ov,{message:e,replyMessage:t,params:r},"",!0),Nl(this.core.account,t.conversationId),2!==e.conversationType&&3!==e.conversationType||!r.robotConfig||r.robotConfig.accountId){i.next=7;break}throw new bl({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 7:return o=this.core.timeOrigin.getTimeNode(),a=this.sendUtil.prepareMessage(e,t.conversationId,r,t),s=a.messageBeforeSend,c=a.clientAntispamResult,u=a.hiddenParams,i.next=11,this.sendUtil.doSendMessage({apiCallingTimeNode:o,messageBeforeSend:s,clientAntispamResult:c,hiddenParams:u,progress:n});case 11:return(d=i.sent).message.senderId===d.message.receiverId&&this.markMsgsAck([d.message]),i.abrupt("return",d);case 14:case"end":return i.stop()}}),i,this)})))},r.modifyMessage=function(e,t){this.checkV2(),this.checkLogin(),Al(ay,e,"message",!0),Al(sy,t,"params",!0),this.modifyUtil.checkIfModify(e,t);var r=this.modifyUtil.prepareMessage(e,t),n=r.messageBeforeSend,i=r.clientAntispamResult;return this.modifyUtil.modifyMessage(n,i)},r.v2MessageOnModifiedHandler=function(e){var t=Rg(this.core,e.content.data);this.model.upsertMessages([t]),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",t),this.emit("onReceiveMessagesModified",[t])},r.v2MessageSyncModifiedHandler=function(e){var t,r,n=this,i=lu(t=au(r=e.content.datas).call(r,(function(e){return Rg(n.core,e)}))).call(t,(function(e){var t,r=(null===(t=n.model.getMessageById(e.messageClientId))||void 0===t?void 0:t.modifyTime)||0;return(e.modifyTime||0)>r}));i.length>0&&(this.model.upsertMessages(i),Bn(i).call(i,(function(e){return n.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",e)})),this.emit("onReceiveMessagesModified",i))},r.v2MessageSyncSuperTeamModifiedHandler=function(e){this.v2MessageSyncModifiedHandler(e)},t}($h),cI="V2NIMMessageLogUtil",uI={"30_6":"v2GetMessageList","33_2":"v2GetMessageListByRefers","30_18":"v2ClearHistoryMessage","7_118":"onClearHistoryMessage","4_24":"syncClearHistoryMessage","31_23":"v2GetTeamMessageList","32_14":"v2GetSuperTeamMessageList"},dI={conversationType:{id:0,retType:"number"},receiverId:1,deleteRoam:{id:2,converter:vh},teamId:3,onlineSync:{id:4,converter:vh},deleteTime:{id:6,retType:"number"},serverExtension:7},lI=[{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"direction"},{type:"LongArray",name:"msgTypes"}],pI={v2GetMessageList:{sid:30,cid:6,service:cI,params:Rs(Gy=[{type:"String",name:"to"}]).call(Gy,lI),response:[{type:"PropertyArray",name:"msgs",reflectMapper:gh(qg)}]},v2GetMessageListByRefers:{sid:33,cid:2,service:cI,params:[{type:"PropertyArray",name:"tag",reflectMapper:qg,select:["conversationType","senderId","receiverId","createTime","messageServerId"]}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:gh(qg)}]},v2ClearHistoryMessage:{sid:30,cid:18,service:cI,params:[{type:"Property",name:"tag",reflectMapper:dI}],response:[{type:"Long",name:"timetag"}]},v2GetTeamMessageList:{sid:31,cid:23,service:cI,params:Rs(jy=[{type:"Long",name:"to"}]).call(jy,lI),response:[{type:"PropertyArray",name:"msgs",reflectMapper:gh(qg)}]},v2GetSuperTeamMessageList:{sid:32,cid:14,service:cI,params:Rs(Hy=[{type:"Long",name:"to"}]).call(Hy,lI),response:[{type:"PropertyArray",name:"msgs",reflectMapper:gh(qg)}]},onClearHistoryMessage:{sid:7,cid:118,service:cI,response:[{type:"Property",name:"data",reflectMapper:gh(dI)}]},syncClearHistoryMessage:{sid:4,cid:24,service:cI,response:[{type:"PropertyArray",name:"data",reflectMapper:gh(dI)}]}},mI=function(e){function t(t){var r;return(r=e.call(this,"V2NIMMessageLogUtil",t)||this).clearHistoryMessageHandler=function(e){var t=Ng(r.core,e);r.emitClearHistoryMessage([t])},r.core=t,r.service=r.core.V2NIMMessageService,"v2"!==r.core.options.apiVersion?st(r):(hh({cmdMap:uI,cmdConfig:pI}),r.setListener(),r)}er(t,e);var r=t.prototype;return r.setListener=function(){this.core.eventBus.on("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",this.clearHistoryMessageHandler)},r.getMessageListByRefers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Al(Dv,{messageRefers:e},"",!0),0!==e.length){t.next=4;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageListByRefers: messageRefers cannot be an empty array"}});case 4:if(i=[],o=au(e).call(e,(function(e){var t=c.service.model.getMessageById(e.messageClientId);return!t&&e.messageServerId&&"0"!==e.messageServerId&&i.push(e),t})),a=[],!(i.length>0)){t.next=12;break}return t.next=10,this.core.sendCmd("v2GetMessageListByRefers",{tag:i});case 10:s=t.sent,a=s.content.msgs;case 12:return t.abrupt("return",au(r=lu(n=au(o).call(o,(function(t,r){if(t)return t;var n=e[r],i=eh(a).call(a,(function(e){return e.messageServerId===n.messageServerId}));return i?Rg(c.core,i):void 0}))).call(n,(function(e){return void 0!==e}))).call(r,(function(e){return Pg(e,c.core)})));case 13:case"end":return t.stop()}}),t,this)})))},r.getMessageList=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u,d,l,p,m,h,f,g=this;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){r.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:if(Al(Vv,e,"",!0),Nl(this.core.account,e.conversationId),a=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),c=1===a?"v2GetMessageList":2===a?"v2GetTeamMessageList":"v2GetSuperTeamMessageList",u=e.beginTime||0,d=e.endTime||0,!(0!==u&&0!==d&&u>d)){r.next=12;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: beginTime cannot be greater than endTime"}});case 12:if(l=void 0===e.direction?0:e.direction,!e.anchorMessage){r.next=29;break}if(0!==e.direction){r.next=23;break}if(0!==d){r.next=19;break}d=e.anchorMessage.createTime,r.next=21;break;case 19:if(d===e.anchorMessage.createTime){r.next=21;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorMessage.createTime"}});case 21:r.next=29;break;case 23:if(0!==u){r.next=27;break}u=e.anchorMessage.createTime,r.next=29;break;case 27:if(u===e.anchorMessage.createTime){r.next=29;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorMessage.createTime"}});case 29:return p=null===(t=e.anchorMessage)||void 0===t?void 0:t.messageServerId,r.next=32,this.core.sendCmd(c,{beginTime:u,endTime:d,lastMsgId:p||0,limit:e.limit||50,direction:l,msgTypes:e.messageTypes?Fc(n=e.messageTypes).call(n):[],to:s});case 32:return m=r.sent,h=m.content,f=[],f=au(i=h.msgs).call(i,(function(e){return Rg(g.core,e)})),p&&(f=lu(f).call(f,(function(e){return e.messageServerId!==p}))),r.abrupt("return",au(o=this.getMessageListMonkeyPatch(f,e)).call(o,(function(e){return Pg(e,g.core)})));case 38:case"end":return r.stop()}}),r,this)})))},r.getMessageListMonkeyPatch=function(e,t){var r=t.conversationId,n=e,i=fl(n).call(n,(function(e,t){return e[t.messageClientId]=!0,e}),{}),o=this.service.model.getMessagesByConversationId(r);o=xm(o).call(o,(function(e,r){return 1===t.direction?e.createTime-r.createTime:r.createTime-e.createTime}));var a=0,s=t.beginTime||0,c=t.endTime||0;t.anchorMessage&&(0===t.direction?c=t.anchorMessage.createTime:s=t.anchorMessage.createTime,a=Wn(o).call(o,(function(e){var r;return e.messageClientId===(null===(r=t.anchorMessage)||void 0===r?void 0:r.messageClientId)})),a+=1);for(var u=a;u<o.length;u++){var d,l=o[u],p=!i[l.messageClientId],m=void 0===l.sendingState||1===l.sendingState,h=l.conversationId===r,f=l.createTime>s&&(l.createTime<c||0===c),g=!t.messageTypes||tu(d=t.messageTypes).call(d,l.messageType);p&&m&&h&&f&&g&&n.push(o[u])}return n=xm(n).call(n,(function(e,r){return 1===t.direction?e.createTime-r.createTime:r.createTime-e.createTime})),Fc(n).call(n,0,t.limit||50)},r.clearHistoryMessage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c,u;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(Fv,e,"",!0),Nl(this.core.account,e.conversationId),r=e.conversationId,n=e.deleteRoam,i=e.onlineSync,o=e.serverExtension,a=this.core.V2NIMConversationIdUtil.parseConversationType(r),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(r),c={deleteRoam:n,onlineSync:i,serverExtension:o,conversationType:a},1===a?c.receiverId=s:c.teamId=s,t.next=10,this.core.sendCmd("v2ClearHistoryMessage",{tag:c});case 10:u=t.sent,this.core.eventBus.emit("forwardSend/V2NIMMessageLogService/clearHistoryMessage",sr(sr({},c),{deleteTime:u.content.timetag})),this.emitClearHistoryMessage([{deleteTime:u.content.timetag,serverExtension:o,conversationId:r}]);case 13:case"end":return t.stop()}}),t,this)})))},r.syncClearHistoryMessageHandler=function(e){var t,r=this,n=au(t=e.content.data).call(t,(function(e){return Ng(r.core,e)}));this.emitClearHistoryMessage(n)},r.onClearHistoryMessageHandler=function(e){var t=Ng(this.core,e.content.data);this.emitClearHistoryMessage([t])},r.emitClearHistoryMessage=function(e){var t=this;Bn(e).call(e,(function(e){t.service.model.deleteMessages(e.conversationId,e.deleteTime)})),this.service.emit("onClearHistoryNotifications",e)},t}($h),hI="V2NIMMessageExtendUtil",fI={"29_5":"v2VoiceToText","33_15":"v2PinMessage","33_16":"v2UpdatePinMessage","33_17":"v2UnpinMessage","23_18":"onPinMessage","23_19":"onUpdatePinMessage","23_20":"onUnpinMessage","23_115":"onPinMessage","23_116":"onUpdatePinMessage","23_117":"onUnpinMessage","33_21":"v2GetPinMessageList","33_3":"v2AddQuickComment","33_4":"v2RemoveQuickComment","33_7":"v2GetQuickComment","23_5":"onAddQuickComment","23_6":"onRemoveQuickComment","23_103":"onAddQuickComment","23_104":"onRemoveQuickComment","33_8":"v2AddCollection","33_9":"v2RemoveCollections","33_10":"v2UpdateCollectionExtension","33_11":"v2GetCollectionListByOption","30_26":"v2SearchCloudMessagesGroupByConversation","30_27":"v2SearchCloudMessages","33_1":"v2GetThreadMessageList"},gI={conversationType:{id:1,converter:Yg,retConverter:Kg,access:"messageRefer.conversationType"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},createTime:{id:4,retType:"number",access:"messageRefer.createTime"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},detail:7,modify:{id:8,retType:"number"}},vI={conversationType:{id:1,access:"messageRefer.conversationType",retConverter:Kg},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},time:{id:4,access:"messageRefer.createTime",converter:vh,retType:"number"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},operatorId:7,serverExtension:8,createTime:{id:9,converter:vh,retType:"number"},updateTime:{id:10,converter:vh,retType:"number"}},yI={operatorId:1,index:{id:2,retType:"number"},createTime:{id:3,retType:"number"},serverExtension:4,pushEnabled:{id:5,access:"pushConfig.pushEnabled",converter:vh},needBadge:{id:6,access:"pushConfig.needBadge",converter:vh},title:{id:7,access:"pushConfig.title"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"}},II={accid:1,serverExtension:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},MI={collectionId:1,collectionType:{id:2,retType:"number"},collectionData:3,serverExtension:4,uniqueId:5,createTime:{id:6,retType:"number"},updateTime:{id:7,retType:"number"}},TI={keyword:1,beginTime:2,endTime:3,messageLimit:5,sortOrder:{id:6,converter:function(e){return 0===e?2:1}},p2pAccountIds:{id:7,converter:function(e){return e.join(",")}},teamIds:{id:8,converter:function(e){return e.join(",")}},senderAccountIds:{id:9,converter:function(e){return e.join(",")}},messageTypes:{id:10,converter:function(e){return e.join(",")}},messageSubtypes:{id:11,converter:function(e){return e.join(",")}}},SI=sr(sr({},TI),{conversationLimit:4}),bI={v2PinMessage:{sid:33,cid:15,service:hI,params:[{type:"Property",name:"msg",reflectMapper:qg,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:II}],response:[{type:"Long",name:"timetag"}]},v2UnpinMessage:{sid:33,cid:17,service:hI,params:[{type:"Property",name:"msg",reflectMapper:qg,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:II}],response:[{type:"Long",name:"timetag"}]},v2UpdatePinMessage:{sid:33,cid:16,service:hI,params:[{type:"Property",name:"msg",reflectMapper:qg,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:II}],response:[{type:"Long",name:"timetag"}]},v2GetPinMessageList:{sid:33,cid:21,service:hI,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,timetag:2}}],response:[{type:"Long",name:"timetag"},{type:"Bool",name:"changed"},{type:"PropertyArray",name:"data",reflectMapper:gh(vI)}]},v2VoiceToText:{sid:29,cid:5,service:hI,params:[{type:"Property",name:"tag",reflectMapper:{mimeType:0,sampleRate:1,voiceUrl:2,duration:3}}],response:[{type:"String",name:"data"}]},v2AddQuickComment:{sid:33,cid:3,service:hI,params:[{type:"Property",name:"message",reflectMapper:qg,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:yI}],response:[{type:"Long",name:"timetag"}]},v2RemoveQuickComment:{sid:33,cid:4,service:hI,params:[{type:"Property",name:"message",reflectMapper:qg,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:yI}],response:[{type:"Long",name:"timetag"}]},onAddQuickComment:{sid:23,cid:5,service:hI,response:[{type:"Property",name:"message",reflectMapper:gh(qg)},{type:"Property",name:"quickComment",reflectMapper:gh(yI)}]},onRemoveQuickComment:{sid:23,cid:6,service:hI,response:[{type:"Property",name:"message",reflectMapper:gh(qg)},{type:"Property",name:"quickComment",reflectMapper:gh(yI)}]},v2GetQuickComment:{sid:33,cid:7,service:hI,params:[{type:"PropertyArray",name:"tag",reflectMapper:gI}],response:[{type:"PropertyArray",name:"data",reflectMapper:gh(gI)}]},onPinMessage:{sid:23,cid:18,service:hI,response:[{type:"Property",name:"msg",reflectMapper:gh(qg)},{type:"Property",name:"pinInfo",reflectMapper:gh(II)}]},onUpdatePinMessage:{sid:23,cid:19,service:hI,response:[{type:"Property",name:"msg",reflectMapper:gh(qg)},{type:"Property",name:"pinInfo",reflectMapper:gh(II)}]},onUnpinMessage:{sid:23,cid:20,service:hI,response:[{type:"Property",name:"msg",reflectMapper:gh(qg)},{type:"Property",name:"pinInfo",reflectMapper:gh(II)}]},v2AddCollection:{sid:33,cid:8,service:hI,params:[{type:"Property",name:"tag",reflectMapper:MI}],response:[{type:"Property",name:"data",reflectMapper:gh(MI)}]},v2RemoveCollections:{sid:33,cid:9,service:hI,params:[{type:"PropertyArray",name:"tag",reflectMapper:MI,select:["collectionId","createTime"]}],response:[{type:"Int",name:"data"}]},v2UpdateCollectionExtension:{sid:33,cid:10,service:hI,params:[{type:"Property",name:"tag",reflectMapper:MI}],response:[{type:"Property",name:"data",reflectMapper:gh(MI)}]},v2GetCollectionListByOption:{sid:33,cid:11,service:hI,params:[{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeId:3,limit:4,direction:5,collectionType:6}}],response:[{type:"Long",name:"total"},{type:"PropertyArray",name:"data",reflectMapper:gh(MI)}]},v2SearchCloudMessagesGroupByConversation:{sid:30,cid:26,service:hI,params:[{type:"Property",name:"tag",reflectMapper:SI}],response:[{type:"PropertyArray",name:"data",reflectMapper:gh(qg)}]},v2SearchCloudMessages:{sid:30,cid:27,service:hI,params:[{type:"Property",name:"tag",reflectMapper:TI}],response:[{type:"PropertyArray",name:"data",reflectMapper:gh(qg)}]},v2GetThreadMessageList:{sid:33,cid:1,service:hI,params:[{type:"Property",name:"messageRefer",reflectMapper:qg},{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeMessageServerId:3,limit:4,reverse:5}}],response:[{type:"Property",name:"message",reflectMapper:gh(qg)},{type:"Property",name:"replyResult",reflectMapper:gh({total:{id:1,retType:"number"},timestamp:{id:2,retType:"number"}})},{type:"PropertyArray",name:"replyList",reflectMapper:gh(qg)}]}},CI=function(e){function t(t){var r;return(r=e.call(this,"V2NIMMessageExtendUtil",t)||this).core=t,"v2"!==r.core.options.apiVersion?st(r):(hh({cmdMap:fI,cmdConfig:bI}),r)}er(t,e);var r=t.prototype;return r.pinMessage=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(Uv,e,"message",!0),Al(Gv,{serverExtension:t},"",!0),r.next=5,this.core.sendCmd("v2PinMessage",{msg:e,msgPin:{serverExtension:t}});case 5:n=r.sent,this.emitPinNotification({pinState:1,message:e,serverExtension:t,createTime:n.content.timetag,updateTime:n.content.timetag,operatorId:this.core.account});case 7:case"end":return r.stop()}}),r,this)})))},r.unpinMessage=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(Uv,e,"messageRefer",!0),Al(Gv,{serverExtension:t},"",!0),r.next=5,this.core.sendCmd("v2UnpinMessage",{msg:e,msgPin:{serverExtension:t}});case 5:n=r.sent,this.emitPinNotification({pinState:0,message:e,serverExtension:t,updateTime:n.content.timetag,operatorId:this.core.account});case 7:case"end":return r.stop()}}),r,this)})))},r.updatePinMessage=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(Uv,e,"message",!0),Al(Gv,{serverExtension:t},"",!0),r.next=5,this.core.sendCmd("v2UpdatePinMessage",{msg:e,msgPin:{serverExtension:t}});case 5:n=r.sent,this.emitPinNotification({pinState:2,message:e,serverExtension:t,updateTime:n.content.timetag,operatorId:this.core.account});case 7:case"end":return r.stop()}}),r,this)})))},r.getPinnedMessageList=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){t.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:return Nl(this.core.account,e),i=(i=this.core.V2NIMConversationIdUtil.convertToV1ConversationId(e)).replace("superTeam","super_team"),t.next=8,this.core.sendCmd("v2GetPinMessageList",{tag:{conversationId:i,timetag:0}});case 8:return o=t.sent,t.abrupt("return",xm(r=au(n=o.content.data).call(n,(function(e){return sr(sr({},e),{messageRefer:sr(sr({},e.messageRefer),{conversationId:a.core.V2NIMConversationIdUtil.messageConversationId(e.messageRefer)})})}))).call(r,(function(e,t){return t.updateTime-e.updateTime})));case 10:case"end":return t.stop()}}),t,this)})))},r.addQuickComment=function(e,t,r,n){return Wl(this,void 0,void 0,jl.mark((function i(){var o,a;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Al(Yv,{message:e,index:t,serverExtension:r,pushConfig:n},"",!0),i.next=4,this.core.sendCmd("v2AddQuickComment",{message:e,quickComment:{index:t,serverExtension:r,pushConfig:n}});case 4:o=i.sent,a={operationType:1,quickComment:{messageRefer:Ag(this.core,e),createTime:o.content.timetag,index:t,serverExtension:r||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",a);case 7:case"end":return i.stop()}}),i,this)})))},r.removeQuickComment=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(Uv,e,"messageRefer",!0),Al({index:{type:"number",min:1}},{index:t},"",!0),Al({serverExtension:{type:"string",required:!1}},{serverExtension:r},"",!0),n.next=6,this.core.sendCmd("v2RemoveQuickComment",{message:e,quickComment:{index:t,serverExtension:r}});case 6:i=n.sent,o={operationType:2,quickComment:{messageRefer:Ag(this.core,e),createTime:i.content.timetag,index:t,serverExtension:r||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",o);case 9:case"end":return n.stop()}}),n,this)})))},r.getQuickCommentList=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(Kv,{messages:e},"",!0),n={},t.next=5,this.core.sendCmd("v2GetQuickComment",{tag:au(e).call(e,(function(e){return{messageRefer:e}}))});case 5:return i=t.sent,Bn(r=i.content.data).call(r,(function(e){var t,r;try{if(!e.detail)return void(n[t=e.messageRefer.messageClientId]||(n[t]=[]));var i=JSON.parse(e.detail);n[r=e.messageRefer.messageClientId]||(n[r]=[]),Bn(i).call(i,(function(t){n[e.messageRefer.messageClientId].push({messageRefer:sr(sr({},e.messageRefer),{conversationId:o.core.V2NIMConversationIdUtil.messageConversationId(e.messageRefer)}),operatorId:t[1],index:Kp(t[2]),createTime:Kp(t[3]),serverExtension:t[4]})}))}catch(a){o.logger.error("getQuickCommentList JSON Parse Error",e.detail,a)}})),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},r.voiceToText=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Al(Wv,e,"",!0),e.voicePath||e.voiceUrl||e.file){t.next=4;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"voiceToText: voicePath、voiceUrl、file cannot be empty at the same time"}});case 4:if(r=e.voicePath,n=e.file,i=e.mimeType,o=e.sampleRate,a=e.duration,s=e.sceneName,c=s?this.core.V2NIMStorageService.getStorageScene(s):null,u=e.voiceUrl){t.next=14;break}return d={},n?d.file=n:0===(null==r?void 0:bu(r).call(r,"nim-external"))?d.fileInput=r:d.filePath=r,t.next=12,this.core.cloudStorage.uploadFile(sr({type:"audio",nosScenes:c?c.sceneName:void 0,nosSurvivalTime:c?c.expireTime:void 0},d));case 12:l=t.sent,u=l.url;case 14:return t.next=16,this.core.sendCmd("v2VoiceToText",{tag:{voiceUrl:u,mimeType:i,sampleRate:o,duration:a}},{timeout:3e4});case 16:return p=t.sent,t.abrupt("return",p.content.data);case 18:case"end":return t.stop()}}),t,this)})))},r.onPinMessageHandler=function(e){return this.pinMessageChangeHandler(e,1)},r.onUnpinMessageHandler=function(e){return this.pinMessageChangeHandler(e,0)},r.onUpdatePinMessageHandler=function(e){return this.pinMessageChangeHandler(e,2)},r.pinMessageChangeHandler=function(e,t){var r=e.content.msg,n=e.content.pinInfo;r.conversationId=this.core.V2NIMConversationIdUtil.messageConversationId(r),this.emitPinNotification({pinState:t,message:r,serverExtension:n.serverExtension,createTime:n.createTime,updateTime:n.updateTime,operatorId:n.accid})},r.emitPinNotification=function(e){var t={pinState:e.pinState,pin:sr(sr({serverExtension:e.serverExtension||"",operatorId:e.operatorId},e.createTime?{createTime:e.createTime}:{}),{updateTime:e.updateTime,messageRefer:Ag(this.core,e.message)})};this.core.V2NIMMessageService.emit("onMessagePinNotification",t)},r.onAddQuickCommentHandler=function(e){return this.onQuickCommentNotificationHandler(e,1)},r.onRemoveQuickCommentHandler=function(e){return this.onQuickCommentNotificationHandler(e,2)},r.onQuickCommentNotificationHandler=function(e,t){var r={operationType:t,quickComment:sr({messageRefer:sr(sr({},e.content.message),{conversationId:this.core.V2NIMConversationIdUtil.messageConversationId(e.content.message)})},e.content.quickComment)};this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",r)},r.addCollection=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(Qv,{params:e},"",!0),t.next=4,this.core.sendCmd("v2AddCollection",{tag:e});case 4:return r=t.sent,t.abrupt("return",r.content.data);case 6:case"end":return t.stop()}}),t,this)})))},r.removeCollections=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(zv,{collections:e},"",!0),t.next=4,this.core.sendCmd("v2RemoveCollections",{tag:e});case 4:return r=t.sent,t.abrupt("return",r.content.data);case 6:case"end":return t.stop()}}),t,this)})))},r.updateCollectionExtension=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(Jv,{collection:e,serverExtension:t},"",!0),r.next=4,this.core.sendCmd("v2UpdateCollectionExtension",{tag:sr(sr({},e),{serverExtension:t})});case 4:return n=r.sent,r.abrupt("return",n.content.data);case 6:case"end":return r.stop()}}),r,this)})))},r.getCollectionListByOption=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al($v,e,"",!0),t.next=4,this.getCollectionListExByOption(e);case 4:return r=t.sent,t.abrupt("return",r.collectionList);case 6:case"end":return t.stop()}}),t,this)})))},r.getCollectionListExByOption=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),Al($v,e,"",!0),i=e.beginTime||0,o=e.endTime||0,a=void 0===e.direction?0:e.direction,void 0===(null===(t=e.anchorCollection)||void 0===t?void 0:t.collectionId)){n.next=21;break}if(0!==e.direction){n.next=15;break}if(0!==o){n.next=11;break}o=e.anchorCollection.createTime,n.next=13;break;case 11:if(o===e.anchorCollection.createTime){n.next=13;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorCollection.createTime"}});case 13:n.next=21;break;case 15:if(0!==i){n.next=19;break}i=e.anchorCollection.createTime,n.next=21;break;case 19:if(i===e.anchorCollection.createTime){n.next=21;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorCollection.createTime"}});case 21:if(!(0!==i&&0!==o&&i>=o)){n.next=23;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: beginTime cannot be greater than endTime"}});case 23:return(s={beginTime:i,endTime:o,direction:a,limit:e.limit,collectionType:e.collectionType,excludeId:(null===(r=e.anchorCollection)||void 0===r?void 0:r.collectionId)?e.anchorCollection.collectionId:0}).collectionType||delete s.collectionType,n.next=27,this.core.sendCmd("v2GetCollectionListByOption",{tag:s});case 27:return c=n.sent,n.abrupt("return",{totalCount:c.content.total,collectionList:c.content.data});case 29:case"end":return n.stop()}}),n,this)})))},r.searchCloudMessages=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c,u,d=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Al(Xv,e,"",!0),n=e.beginTime||0,i=e.endTime||0,!(0!==n&&0!==i&&n>i)){t.next=6;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchCloudMessages: beginTime cannot be greater than endTime"}});case 6:return o=void 0===e.sortOrder?0:e.sortOrder,a=e.conversationLimit||0,s=e.messageLimit||10,c=a>0?"v2SearchCloudMessagesGroupByConversation":"v2SearchCloudMessages",t.next=12,this.core.sendCmd(c,{tag:sr(sr({},e),{beginTime:n,endTime:i,sortOrder:o,conversationLimit:a,messageLimit:s})});case 12:return u=t.sent,t.abrupt("return",au(r=u.content.data).call(r,(function(e){return Rg(d.core,e)})));case 14:case"end":return t.stop()}}),t,this)})))},r.getThreadMessageList=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al(oy,e,"getThreadMessageList",!0),e.beginTime=e.beginTime||0,!(e.endTime&&e.beginTime>e.endTime)){t.next=4;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getThreadMessageList: beginTime cannot be greater than endTime"}});case 4:return t.next=6,this.core.sendCmd("v2GetThreadMessageList",{messageRefer:e.messageRefer,tag:{beginTime:e.beginTime,endTime:e.endTime,limit:e.limit,reverse:1===e.direction?1:0,excludeMessageServerId:e.excludeMessageServerId}});case 6:return r=t.sent,n=r.content,i=n.message,o=n.replyResult,a=n.replyList,t.abrupt("return",{message:Rg(this.core,i),timestamp:o.timestamp,replyCount:o.total,replyList:au(a).call(a,(function(e){return Rg(s.core,e)}))});case 9:case"end":return t.stop()}}),t,this)})))},t}($h),EI={joinMode:{type:"enum",values:[1,0,2],required:!1},agreeMode:{type:"enum",values:[0,1],required:!1},inviteMode:{type:"enum",values:[1,0],required:!1},updateInfoMode:{type:"enum",values:[1,0],required:!1},updateExtensionMode:{type:"enum",values:[1,0],required:!1},chatBannedMode:{type:"enum",values:[0,1],required:!1}},_I={type:"object",required:!0,rules:sr({name:{type:"string",allowEmpty:!1},teamType:{type:"enum",values:[1,2]},memberLimit:{type:"number",min:1,required:!1}},EI)},kI={type:"array",min:1,itemType:"string"},RI={type:"boolean"},wI={type:"string"},AI={type:"string",allowEmpty:!1},xI={type:"object",rules:{antispamBusinessId:{type:"string",required:!1}},required:!1},NI={teamId:{type:"string",regExp:/^[1-9]\d*$/,allowEmpty:!1}},OI={teamIds:{type:"array",itemType:"string",regExp:/^[1-9]\d*$/,min:1,allowEmpty:!1}},PI={teamType:{type:"enum",values:[1,2]}},LI={teamTypes:{type:"array",itemType:"enum",values:[1,2],required:!1}},VI={updateTeamInfoParams:{type:"object",required:!0,rules:sr({name:{type:"string",allowEmpty:!1,required:!1},memberLimit:{type:"number",min:1,required:!1}},EI)}},UI={type:"enum",values:[0,2]},DI={memberInfoParams:{type:"object",rules:{teamNick:{type:"string",required:!1},serverExtension:{type:"string",required:!1}}}},qI={chatBannedMode:{type:"enum",values:[0,1]}},BI={queryOption:{type:"object",rules:{roleQueryType:{type:"enum",values:[0,2,1]},onlyChatBanned:{type:"boolean",required:!1},direction:{type:"enum",values:[1,0],required:!1},limit:{type:"number",min:1,required:!1},nextToken:{type:"string",required:!1}}}},FI={teamId:NI.teamId,teamType:{type:"enum",values:[1,2]},operatorAccountId:{type:"string",allowEmpty:!1}},GI={actionType:{type:"enum",values:[2,0,1,3]}},jI={actionType:{type:"enum",values:[2]}},HI={actionType:{type:"enum",values:[0]}},WI={types:{type:"array",itemType:"enum",values:[0,2,1,3],required:!1},status:{type:"array",itemType:"enum",values:[1,3,0,2],required:!1},offset:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},YI={teamId:NI.teamId,teamType:PI.teamType,accountIds:kI},KI=function(){function e(){this.teamMap=new rd,this.superTeamMap=new rd}var t=e.prototype;return t.set=function(e){var t=this;Bn(e).call(e,(function(e){t.chooseMap(e.teamType).set(e.teamId,e)}))},t.reset=function(){this.teamMap.clear(),this.superTeamMap.clear()},t.count=function(e,t){void 0===t&&(t=!0);var r=this.chooseMap(e),n=0;return Bn(r).call(r,(function(e){t&&e.isValidTeam&&n++,t||n++})),n},t.chooseMap=function(e){return 2===e?this.superTeamMap:1===e?this.teamMap:new rd},t.getById=function(e,t,r){void 0===r&&(r=!0);var n=this.chooseMap(t).get(e);if(n){if(r&&n.isValidTeam)return n;if(!r)return n}},t.getAll=function(e,t){void 0===t&&(t=!0);var r=this.chooseMap(e),n=Vl(gu(r).call(r)),i=lu(n).call(n,(function(e){return!(!t||!e.isValidTeam)||!t||void 0}));return xm(i).call(i,(function(e,t){return t.updateTime-e.updateTime}))},t.upsert=function(e){var t=e.teamId,r=e.teamType,n=this.chooseMap(r),i=n.get(t)||{},o=sr({},i,e);return n.set(t,o),o},t.deleteById=function(e,t){var r=this.getById(e,t);if(r)return r.isValidTeam=!1,r},t.searchTeamByKeyword=function(e){var t,r,n=[];return Bn(t=this.teamMap).call(t,(function(t){var r;tu(r=t.name).call(r,e)&&n.push(t)})),Bn(r=this.superTeamMap).call(r,(function(t){var r;tu(r=t.name).call(r,e)&&n.push(t)})),n},e}(),QI=function(){function e(){this.teamMembers=[],this.superTeamMembers=[],this.maxSize=2e3}var t=e.prototype;return t.reset=function(){this.teamMembers=[],this.superTeamMembers=[]},t.setData=function(e){var t=this;Bn(e).call(e,(function(e){t.chooseList(e.teamType).push(e)}))},t.chooseList=function(e){return 2===e?this.superTeamMembers:1===e?this.teamMembers:[]},t.getById=function(e,t,r){var n=this.chooseList(t);return eh(n).call(n,(function(t){return t.teamId===e&&t.accountId===r}))},t.upsert=function(e){var t=e.teamType,r=e.teamId,n=this.chooseList(t),i=Wn(n).call(n,(function(t){return t.teamId===r&&t.accountId===e.accountId}));-1===i?n.push(e):n[i]=sr(sr({},n[i]),e),n.length>this.maxSize&&n.shift()},t.deleteByAccount=function(e,t,r){var n=this.chooseList(t),i=Wn(n).call(n,(function(t){return t.teamId===e&&t.accountId===r}));if(-1!==i){var o=n[i];return o.inTeam=!1,si(n).call(n,i,1),o}},t.deleteByTeamId=function(e,t){var r=this.chooseList(t),n=lu(r).call(r,(function(t){return t.teamId!==e}));2===t?this.superTeamMembers=n:this.teamMembers=n},e}(),zI=function(){function e(e,t){this.core=e,this.service=t}var t=e.prototype;return t.processNotification=function(e){var t=this,r=e.attachment,n=e.senderId,i=e.receiverId,o=r.id,a=r.data,s=o>400?2:1,c=Cg(a,s),u=c.id,d=c.ids,l=c.tinfo,p=c.mute,m=this.service.model.getById(i,s);switch(this.core.logger.log("v2Team::processNotification, notificationType:"+o+", teamId:"+i,a),o){case Wy.SUPER_TEAM_INVITATION:case Wy.TEAM_INVITATION:tu(d).call(d,this.core.account)&&this.onTeamJoined(l),this.onTeamMembersJoined(l,lu(d).call(d,(function(e){return e!==t.core.account})));break;case Wy.SUPER_TEAM_INVITE_ACCEPT:case Wy.TEAM_INVITE_ACCEPT:n===this.core.account?this.onTeamJoined(l):this.onTeamMemberJoined(l,n);break;case Wy.SUPER_TEAM_APPLY_ACCEPT:case Wy.TEAM_APPLY_ACCEPT:u===this.core.account?this.onTeamJoined(l):this.onTeamMemberJoined(l,u);break;case Wy.SUPER_TEAM_ADD_MANAGER:case Wy.TEAM_ADD_MANAGER:this.updateTeamMemberRole(i,s,d,{memberRole:2});break;case Wy.SUPER_TEAM_REMOVE_MANAGER:case Wy.TEAM_REMOVE_MANAGER:this.updateTeamMemberRole(i,s,d,{memberRole:0});break;case Wy.SUPER_TEAM_KICK:case Wy.TEAM_KICK:this.onTeamInfoUpdated(l),Bn(d).call(d,(function(e){e===t.core.account?t.onTeamLeft(i,s,!0):t.onTeamMemberKicked(n,l.teamId,l.teamType,e)}));break;case Wy.SUPER_TEAM_LEAVE:case Wy.TEAM_LEAVE:l?this.onTeamInfoUpdated(l):m&&n===this.core.account&&(m.isValidTeam=!1,this.onTeamInfoUpdated(m)),n===this.core.account?this.onTeamLeft(i,s,!1):this.onTeamMemberLeft(i,s,n);break;case Wy.SUPER_TEAM_DISMISS:case Wy.TEAM_DISMISS:this.onTeamDismissed(i,s);break;case Wy.SUPER_TEAM_UPDATE:case Wy.TEAM_UPDATED:this.onTeamInfoUpdated(l);break;case Wy.SUPER_TEAM_TRANSFER_OWNER:case Wy.TEAM_TRANSFER_OWNER:this.onTeamInfoUpdated(l),this.updateTeamMemberRole(i,s,[n,l.ownerAccountId],[{memberRole:0},{memberRole:1}]);break;case Wy.SUPER_TEAM_MEMBER_MUTE:case Wy.TEAM_MEMBER_MUTE:this.service.model.upsert(l),this.updateTeamMemberRole(i,s,u?[u]:d,{chatBanned:0!==p})}},t.onTeamJoined=function(e){var t=this;this.service.model.upsert(e),this.service.emit("onTeamJoined",e),this.service.getTeamMemberListByIds(e.teamId,e.teamType,[this.core.account]).catch((function(e){t.core.logger.error("Get Member error after onTeamJoined",e)}))},t.onTeamLeft=function(e,t,r){var n=this.service.model.deleteById(e,t)||Eg(e,t,{isValidTeam:!1});this.service.memberModel.deleteByAccount(e,t,this.core.account),this.service.emit("onTeamLeft",n,r)},t.onTeamDismissed=function(e,t){var r=this.service.model.deleteById(e,t);r||(r=Eg(e,t,{isValidTeam:!1})),this.service.memberModel.deleteByTeamId(e,t),this.service.emit("onTeamDismissed",r)},t.onTeamInfoUpdated=function(e){var t=this.service.model.upsert(e);this.service.emit("onTeamInfoUpdated",t)},t.onTeamMemberJoined=function(e,t){this.service.model.upsert(e),this.service.emit("onTeamInfoUpdated",e);var r=e.updateTime||e.createTime,n=_g(e.teamId,e.teamType,t,{joinTime:r,updateTime:r});this.service.emit("onTeamMemberJoined",[n])},t.onTeamMembersJoined=function(e,t){var r=e.updateTime||e.createTime,n=au(t).call(t,(function(t){return _g(e.teamId,e.teamType,t,{joinTime:r,updateTime:r})}));0!==n.length&&(this.service.model.upsert(e),this.service.emit("onTeamInfoUpdated",e),this.service.emit("onTeamMemberJoined",n))},t.onTeamMemberLeft=function(e,t,r){var n=this.service.memberModel.deleteByAccount(e,t,r);n||(n=_g(e,t,r,{inTeam:!1})),this.service.emit("onTeamMemberLeft",[n])},t.onTeamMemberKicked=function(e,t,r,n){var i=this.service.memberModel.deleteByAccount(t,r,n);i||(i=_g(t,r,n,{inTeam:!1})),this.service.emit("onTeamMemberKicked",e,[i])},t.onTeamMemberInfoUpdated=function(e){var t=this;Bn(e).call(e,(function(e){if(e.accountId===t.core.account&&t.core.V2NIMSettingService.name&&t.core.V2NIMConversationIdUtil.name){var r=1===e.teamType?t.core.V2NIMConversationIdUtil.teamConversationId(e.teamId):t.core.V2NIMConversationIdUtil.superTeamConversationId(e.teamId),n=t.core.V2NIMSettingService.getConversationMuteStatus(r);t.core.eventBus.emit("V2NIMConversationService/setMute",r,n)}})),this.service.emit("onTeamMemberInfoUpdated",e)},t.updateTeamMemberRole=function(e,t,r,n){return Wl(this,void 0,void 0,jl.mark((function i(){var o,a,s,c,u=this;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!((a=lu(r).call(r,(function(r,i){var o=u.service.memberModel.getById(e,t,r);return o&&u.service.memberModel.upsert(sr(sr({},o),Si(n)?n[i]:n)),!o}))).length>0)){i.next=12;break}return i.prev=2,i.next=5,this.service.getTeamMemberListByIds(e,t,a);case 5:s=i.sent,Bn(s).call(s,(function(e){return u.service.memberModel.upsert(e)})),i.next=12;break;case 9:i.prev=9,i.t0=i.catch(2),this.core.logger.warn("v2Team::processNotification, getTeamMemberListByIds failed",i.t0);case 12:(c=lu(o=au(r).call(r,(function(r){return u.service.memberModel.getById(e,t,r)}))).call(o,(function(e){return!!e}))).length>0&&this.onTeamMemberInfoUpdated(c);case 14:case"end":return i.stop()}}),i,this,[[2,9]])})))},t.processSysNotification=function(e){var t=e.receiverId,r=e.postscript,n=e.senderId,i=e.timestamp;e.idServer;var o={actionType:{0:0,1:1,2:2,3:3,15:0,16:1,17:2,18:3}[e.type],teamId:t,teamType:e.type>=15?2:1,operatorAccountId:n,postscript:r,timestamp:i,actionStatus:0};this.core.logger.log("v2Team::processSysNotification, type:",e.type,o),this.service.notificationModel.create(o),this.service.emit("onReceiveTeamJoinActionInfo",o)},t.updateTeamActionStatus=function(e,t){this.service.notificationModel.update({teamId:e.teamId,teamType:e.teamType,operatorAccountId:e.operatorAccountId,actionType:e.actionType,actionStatus:t})},t.checkIfExpired=function(e){return!(!e||509!==e&&(e>=500&&e<=599||e>=19e4))},e}();!function(e){e[e.TEAM_INVITATION=0]="TEAM_INVITATION",e[e.TEAM_KICK=1]="TEAM_KICK",e[e.TEAM_LEAVE=2]="TEAM_LEAVE",e[e.TEAM_UPDATED=3]="TEAM_UPDATED",e[e.TEAM_DISMISS=4]="TEAM_DISMISS",e[e.TEAM_APPLY_ACCEPT=5]="TEAM_APPLY_ACCEPT",e[e.TEAM_TRANSFER_OWNER=6]="TEAM_TRANSFER_OWNER",e[e.TEAM_ADD_MANAGER=7]="TEAM_ADD_MANAGER",e[e.TEAM_REMOVE_MANAGER=8]="TEAM_REMOVE_MANAGER",e[e.TEAM_INVITE_ACCEPT=9]="TEAM_INVITE_ACCEPT",e[e.TEAM_MEMBER_MUTE=10]="TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_INVITATION=401]="SUPER_TEAM_INVITATION",e[e.SUPER_TEAM_KICK=402]="SUPER_TEAM_KICK",e[e.SUPER_TEAM_LEAVE=403]="SUPER_TEAM_LEAVE",e[e.SUPER_TEAM_UPDATE=404]="SUPER_TEAM_UPDATE",e[e.SUPER_TEAM_DISMISS=405]="SUPER_TEAM_DISMISS",e[e.SUPER_TEAM_TRANSFER_OWNER=406]="SUPER_TEAM_TRANSFER_OWNER",e[e.SUPER_TEAM_ADD_MANAGER=407]="SUPER_TEAM_ADD_MANAGER",e[e.SUPER_TEAM_REMOVE_MANAGER=408]="SUPER_TEAM_REMOVE_MANAGER",e[e.SUPER_TEAM_MEMBER_MUTE=409]="SUPER_TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_APPLY_ACCEPT=410]="SUPER_TEAM_APPLY_ACCEPT",e[e.SUPER_TEAM_INVITE_ACCEPT=411]="SUPER_TEAM_INVITE_ACCEPT"}(Wy||(Wy={}));var JI=function(){function e(){this.list=[],this.maxCount=1e3}var t=e.prototype;return t.reset=function(){this.list=[]},t.create=function(e){this.list.push(e),this.list.length>this.maxCount&&this.list.shift()},t.update=function(e){var t;Bn(t=this.list).call(t,(function(t){t.teamId===e.teamId&&t.teamType===e.teamType&&t.actionType===e.actionType&&t.operatorAccountId===e.operatorAccountId&&0===t.actionStatus&&sr(t,e)}))},t.delete=function(e){var t,r;this.list=lu(t=au(r=this.list).call(r,(function(t){if(t.teamId!==e.teamId||t.teamType!==e.teamType||t.operatorAccountId!==e.operatorAccountId||t.actionType!==e.actionType||t.timestamp!==e.timestamp)return t}))).call(t,(function(e){return e}))},t.getByOption=function(e){var t,r=e.types,n=e.status,i=e.offset,o=void 0===i?0:i,a=e.limit,s=void 0===a?50:a,c=[];Bn(t=this.list).call(t,(function(e){r&&r.length>0&&!tu(r).call(r,e.actionType)||n&&n.length>0&&!tu(n).call(n,e.actionStatus)||c.push(e)})),c=xm(c).call(c,(function(e,t){return t.timestamp-e.timestamp}));var u=0;o>0&&(u=Ap(c,"timestamp",o),c[u]&&c[u].timestamp===o&&(u+=1));var d=Fc(c).call(c,u).length;return(c=Fc(c).call(c,u,u+s)).length>0?{offset:d>s?c[c.length-1].timestamp:0,finished:!(d>s),infos:c}:{offset:0,finished:!0,infos:c}},e}(),$I=function(e){function t(t){var r;return(r=e.call(this,"V2NIMTeamService",t)||this).core._registerDep(hg,"V2NIMConversationIdUtil"),r.notification=new zI(t,st(r)),r.model=new KI,r.memberModel=new QI,r.notificationModel=new JI,"v2"!==r.core.options.apiVersion?st(r):(hh({cmdMap:gg,cmdConfig:bg}),r.setListener(),r)}er(t,e);var r=t.prototype;return r.setListener=function(){var e,t,r,n=this;this.core.eventBus.on("forwardReceive/V2NIMTeamService/created",(function(e){n.model.upsert(e);var t=_g(e.teamId,e.teamType,n.core.account,{memberRole:1});n.memberModel.upsert(t),n.emit("onTeamCreated",e)})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",(function(e){n.memberModel.upsert(e),n.emit("onTeamInfoUpdated",[e])})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateTeamActionStatus",Xt(e=this.notification.updateTeamActionStatus).call(e,this.notification)),this.core.eventBus.on("V2NIMTeamService/sysNotification",Xt(t=this.notification.processSysNotification).call(t,this.notification)),this.core.eventBus.on("V2NIMTeamService/notification",Xt(r=this.notification.processNotification).call(r,this.notification)),this.core.eventBus.on("V2NIMTeamService/onSyncStarted",(function(){n.emit("onSyncStarted")})),this.core.eventBus.on("V2NIMTeamService/onSyncFinished",(function(){n.emit("onSyncFinished")})),this.core.eventBus.on("V2NIMTeamService/onSyncFailed",(function(e){n.emit("onSyncFailed",e)}))},r.reset=function(){this.model.reset(),this.memberModel.reset(),this.notificationModel.reset()},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onTeamCreated"===t||"onTeamDismissed"===t||"onTeamJoined"===t||"onTeamLeft"===t||"onTeamInfoUpdated"===t){var c=a[0];this.logger.log(""+i,"team:"+c.teamId+"_"+c.teamType+";updateTime:"+c.updateTime)}else if("onTeamMemberJoined"===t||"onTeamMemberLeft"===t||"onTeamMemberInfoUpdated"===t){var u=a[0];this.logger.log(""+i,au(u).call(u,(function(e){return"team:"+e.teamId+"_"+e.teamType+";account:"+e.accountId})))}else if("onTeamMemberKicked"===t){var d=a[0],l=a[1];this.logger.log(""+i,"operator"+d,au(l).call(l,(function(e){return"team:"+e.teamId+"_"+e.teamType+";account:"+e.accountId})))}else{var p,m;(p=this.logger).log.apply(p,Rs(m=[""+i]).call(m,a))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,a))},r.createTeam=function(e,t,r,n){return Wl(this,void 0,void 0,jl.mark((function i(){var o,a,s,c=this;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Al({createTeamParams:_I},{createTeamParams:e},"",!0),Al({inviteeAccountIds:sr(sr({},kI),{min:0,required:!1})},{inviteeAccountIds:t},"",!0),Al({antispamConfig:xI},{antispamConfig:n},"",!0),o=2===e.teamType?"v2SuperTeamCreate":"v2TeamCreate",i.next=7,this.core.sendCmd(o,{team:e,inviteeAccountIds:t||[],postscript:r||"",antispamConfig:n});case 7:return a=i.sent,s=a.content.team,this.model.upsert(s),this.getTeamMemberListByIds(s.teamId,s.teamType,[this.core.account]).catch((function(e){c.core.logger.error("Get Member error after createTeam",e)})),this.emit("onTeamCreated",s),i.abrupt("return",{team:s,failedList:a.content.failedList});case 13:case"end":return i.stop()}}),i,this)})))},r.updateTeamInfo=function(e,t,r,n){return Wl(this,void 0,void 0,jl.mark((function i(){var o,a;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al(VI,{updateTeamInfoParams:r},"",!0),Al({antispamConfig:xI},{antispamConfig:n},"",!0),o=sr({teamId:e,teamType:t},r),a=2===t?"v2SuperTeamUpdateInfo":"v2TeamUpdateInfo",i.next=9,this.core.sendCmd(a,{team:o,antispamConfig:n});case 9:this.model.upsert(o);case 10:case"end":return i.stop()}}),i,this)})))},r.leaveTeam=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),n=2===t?"v2SuperTeamLeave":"v2TeamLeave",r.next=6,this.core.sendCmd(n,{teamId:e});case 6:this.model.deleteById(e,t);case 7:case"end":return r.stop()}}),r,this)})))},r.getTeamInfo=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),n=2===t?"v2SuperTeamGetInfo":"v2TeamGetInfo",!(i=this.model.getById(e,t,!1))){r.next=7;break}return r.abrupt("return",i);case 7:return r.next=9,this.core.sendCmd(n,{teamId:e});case 9:return o=r.sent,a=o.content.team,this.model.upsert(a),r.abrupt("return",a);case 13:case"end":return r.stop()}}),r,this)})))},r.getJoinedTeamList=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(LI,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&0!==e.length||(e=[1,2]),r=[],Bn(e).call(e,(function(e){r=Rs(r).call(r,n.model.getAll(e))})),t.abrupt("return",xm(r).call(r,(function(e,t){return e.createTime-t.createTime})));case 7:case"end":return t.stop()}}),t,this)})))},r.getJoinedTeamCount=function(e){var t=this;this.checkV2(),Al(LI,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&0!==e.length||(e=[1,2]);var r=0;return Bn(e).call(e,(function(e){r+=t.model.count(e)})),r},r.getTeamInfoByIds=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u=this;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(OI,{teamIds:e},"",!0),Al(PI,{teamType:t},"",!0),i=2===t?"v2SuperTeamGetByIds":"v2TeamGetByIds",o=au(e).call(e,(function(e){return u.model.getById(e,t,!1)})),0!==(a=lu(e).call(e,(function(e,t){return!o[t]}))).length){r.next=8;break}return r.abrupt("return",o);case 8:return r.next=10,this.core.sendCmd(i,{teamIds:a});case 10:return s=r.sent,c=s.content.teams,r.abrupt("return",lu(n=au(o).call(o,(function(t,r){if(t)return t;var n=e[r],i=eh(c).call(c,(function(e){return e.teamId===n}));return i&&u.model.upsert(i),i}))).call(n,(function(e){return!!e})));case 13:case"end":return r.stop()}}),r,this)})))},r.dismissTeam=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),n=2===t?"v2SuperTeamDismiss":"v2TeamDismiss",r.next=6,this.core.sendCmd(n,{teamId:e});case 6:case"end":return r.stop()}}),r,this)})))},r.inviteMember=function(e,t,r,n){return Wl(this,void 0,void 0,jl.mark((function i(){var o,a;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al({inviteeAccountIds:kI},{inviteeAccountIds:r},"",!0),Al({postscript:sr(sr({},wI),{required:!1})},{postscript:n},"",!0),o=2===t?"v2SuperTeamInviteMembers":"v2TeamInviteMembers",i.next=8,this.core.sendCmd(o,{teamId:e,accounts:r,ps:n||""});case 8:return a=i.sent,i.abrupt("return",a.content.abortedAccidList);case 10:case"end":return i.stop()}}),i,this)})))},r.acceptInvitation=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(FI,e,"invitationInfo",!0),Al(jI,e,"invitationInfo",!0),r=e.teamType,n=e.teamId,i=e.operatorAccountId,o=2===r?"v2SuperTeamAcceptInvitation":"v2TeamAcceptInvitation",t.prev=5,t.next=8,this.core.sendCmd(o,{teamId:n,from:i});case 8:return a=t.sent,this.notification.updateTeamActionStatus(e,1),t.abrupt("return",a.content.team);case 13:throw t.prev=13,t.t0=t.catch(5),s=t.t0,this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),t.t0;case 18:case"end":return t.stop()}}),t,this,[[5,13]])})))},r.rejectInvitation=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(FI,e,"invitationInfo",!0),Al(jI,e,"invitationInfo",!0),Al({postscript:sr(sr({},wI),{required:!1})},{postscript:t},"",!0),n=e.teamType,i=e.teamId,o=e.operatorAccountId,a=2===n?"v2SuperTeamRejectInvite":"v2TeamRejectInvite",r.prev=6,r.next=9,this.core.sendCmd(a,{teamId:i,from:o,ps:t||""});case 9:this.notification.updateTeamActionStatus(e,2),r.next=17;break;case 12:throw r.prev=12,r.t0=r.catch(6),s=r.t0,this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),r.t0;case 17:case"end":return r.stop()}}),r,this,[[6,12]])})))},r.kickMember=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al({memberAccountIds:kI},{memberAccountIds:r},"",!0),i=2===t?"v2SuperTeamKickMembers":"v2TeamKickMembers",n.next=7,this.core.sendCmd(i,{teamId:e,accounts:r});case 7:case"end":return n.stop()}}),n,this)})))},r.applyJoinTeam=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),i=2===t?"v2SuperTeamApplyToJoin":"v2TeamApplyToJoin",n.next=6,this.core.sendCmd(i,{teamId:e,ps:r||""});case 6:return o=n.sent,a=o.content.team,s=o.content.isInTeam,a.isValidTeam=!!a.isValidTeam&&!!s,n.abrupt("return",a);case 11:case"end":return n.stop()}}),n,this)})))},r.acceptJoinApplication=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(FI,e,"applicationInfo",!0),Al(HI,e,"applicationInfo",!0),r=e.teamType,n=e.teamId,i=e.operatorAccountId,o=2===r?"v2SuperTeamAcceptJoinApplication":"v2TeamAcceptJoinApplication",t.prev=5,t.next=8,this.core.sendCmd(o,{teamId:n,from:i});case 8:this.notification.updateTeamActionStatus(e,1),t.next=16;break;case 11:throw t.prev=11,t.t0=t.catch(5),a=t.t0,this.notification.checkIfExpired(a.code)&&this.notification.updateTeamActionStatus(e,3),t.t0;case 16:case"end":return t.stop()}}),t,this,[[5,11]])})))},r.rejectJoinApplication=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(FI,e,"applicationInfo",!0),Al(HI,e,"applicationInfo",!0),Al({postscript:sr(sr({},wI),{required:!1})},{postscript:t},"",!0),n=e.teamType,i=e.teamId,o=e.operatorAccountId,a=2===n?"v2SuperTeamRejectJoinApplication":"v2TeamRejectJoinApplication",r.prev=6,r.next=9,this.core.sendCmd(a,{teamId:i,from:o,ps:t||""});case 9:this.notification.updateTeamActionStatus(e,2),r.next=17;break;case 12:throw r.prev=12,r.t0=r.catch(6),s=r.t0,this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),r.t0;case 17:case"end":return r.stop()}}),r,this,[[6,12]])})))},r.updateTeamMemberRole=function(e,t,r,n){return Wl(this,void 0,void 0,jl.mark((function i(){var o;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al({memberAccountIds:kI},{memberAccountIds:r},"",!0),Al({memberRole:UI},{memberRole:n},"",!0),o=2===n?"AddManagers":"RemoveManagers",o=2===t?"v2SuperTeam"+o:"v2Team"+o,i.next=9,this.core.sendCmd(o,{teamId:e,accounts:Wh(r)});case 9:case"end":return i.stop()}}),i,this)})))},r.transferTeamOwner=function(e,t,r,n){return Wl(this,void 0,void 0,jl.mark((function i(){var o;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al({accountId:AI},{accountId:r},"",!0),Al({leave:{type:"boolean",required:!1}},{leave:n},"",!0),o=2===t?"v2SuperTeamTransferOwner":"v2TeamTransferOwner",i.next=8,this.core.sendCmd(o,{teamId:e,account:r,leave:n||!1});case 8:case"end":return i.stop()}}),i,this)})))},r.updateSelfTeamMemberInfo=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al(DI,{memberInfoParams:r},"",!0),void 0!==r.teamNick||void 0!==r.serverExtension){n.next=6;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",o=sr(sr({},r),{teamId:e,accountId:this.core.account}),n.next=10,this.core.sendCmd(i,{teamMember:o});case 10:return n.next=12,this.notification.updateTeamMemberRole(e,t,[this.core.account],o);case 12:a=this.memberModel.getById(e,t,this.core.account),this.core.V2NIMSettingService.name&&this.core.V2NIMConversationIdUtil.name&&(s=1===t?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),c=this.core.V2NIMSettingService.getConversationMuteStatus(s),this.core.eventBus.emit("V2NIMConversationService/setMute",s,c)),this.core.eventBus.emit("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",a);case 15:case"end":return n.stop()}}),n,this)})))},r.updateTeamMemberNick=function(e,t,r,n){return Wl(this,void 0,void 0,jl.mark((function i(){var o;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al({accountId:AI},{accountId:r},"",!0),Al({nick:wI},{nick:n},"",!0),r!==this.core.account){i.next=7;break}return i.abrupt("return",this.updateSelfTeamMemberInfo(e,t,{teamNick:n}));case 7:return o=2===t?"v2SuperTeamUpdateMember":"v2TeamUpdateMember",i.next=10,this.core.sendCmd(o,{teamMember:{teamNick:n,teamId:e,accountId:r}});case 10:case"end":return i.stop()}}),i,this)})))},r.setTeamChatBannedMode=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al(qI,{chatBannedMode:r},"",!0),i=2===t?"v2SuperTeamSetChatBannedMode":"v2TeamSetChatBannedMode",n.next=7,this.core.sendCmd(i,{teamId:e,chatBannedMode:r});case 7:this.model.upsert({teamId:e,teamType:t,chatBannedMode:r});case 8:case"end":return n.stop()}}),n,this)})))},r.setTeamMemberChatBannedStatus=function(e,t,r,n){return Wl(this,void 0,void 0,jl.mark((function i(){var o;return jl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al({accountId:AI},{accountId:r},"",!0),Al({chatBanned:RI},{chatBanned:n},"",!0),o=2===t?"v2SuperTeamMemberSetChatBannedStatus":"v2TeamMemberSetChatBannedStatus",i.next=8,this.core.sendCmd(o,{teamId:e,accountId:2===t?[r]:r,chatBanned:n?1:0});case 8:case"end":return i.stop()}}),i,this)})))},r.getTeamMemberList=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al(BI,{queryOption:r},"",!0),i=0===(i=void 0===r.direction?0:r.direction)?1:0,n.next=8,this.core.sendCmd("v2TeamMemberGetList",{tag:sr(sr({teamId:e,teamType:t,onlyChatBanned:!1,nextToken:"",limit:100},r),{direction:i})});case 8:return o=n.sent,a=o.content.datas,s=Qp(o,"raw.r.0"),2===t&&s&&au(s)&&(a=au(s).call(s,(function(e){return mh(e,gh(Tg))}))),n.abrupt("return",{nextToken:o.content.pageInfo.nextToken||"",finished:!+o.content.pageInfo.hasMore,memberList:kg(a,t)});case 13:case"end":return n.stop()}}),n,this)})))},r.getTeamMemberListByIds=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c,u,d=this;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al({accountIds:kI},{accountIds:r},"",!0),i=2===t?"v2SuperTeamMemberGetListByIds":"v2TeamMemberGetListByIds",o=au(r).call(r,(function(t){return e+"|"+t})),a=[],s=0;case 8:if(!(s<o.length)){n.next=18;break}return n.next=11,this.core.sendCmd(i,{tag:Fc(o).call(o,s,s+20)});case 11:c=n.sent,u=kg(c.content.datas,t),a=Rs(a).call(a,u),Bn(u).call(u,(function(e){return d.memberModel.upsert(e)}));case 15:s+=20,n.next=8;break;case 18:return n.abrupt("return",a);case 19:case"end":return n.stop()}}),n,this)})))},r.getTeamMemberInvitor=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al({accountIds:kI},{accountIds:r},"",!0),i=2===t?"v2SuperTeamGetMemberInvitor":"v2TeamGetMemberInvitor",n.next=7,this.core.sendCmd(i,{teamId:e,accounts:r});case 7:return o=n.sent,n.abrupt("return",o.content.accountsMap);case 9:case"end":return n.stop()}}),n,this)})))},r.searchTeamByKeyword=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.checkLogin(),Al({keyword:AI},{keyword:e},"",!0),t.abrupt("return",this.model.searchTeamByKeyword(e));case 4:case"end":return t.stop()}}),t,this)})))},r.addTeamMembersFollow=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(YI,{teamId:e,teamType:t,accountIds:r},"",!0),i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",n.next=5,this.getTeamMemberListByIds(e,t,[this.core.account]);case 5:return o=n.sent,a=o[0],n.next=9,this.core.sendCmd(i,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:r,operation:1}});case 9:s=n.sent,c=s.content.data,pr(c).length>0&&(sr(a,c),this.emit("onTeamMemberInfoUpdated",[a]),this.memberModel.upsert(a));case 12:case"end":return n.stop()}}),n,this)})))},r.removeTeamMembersFollow=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(YI,{teamId:e,teamType:t,accountIds:r},"",!0),n.next=4,this.getTeamMemberListByIds(e,t,[this.core.account]);case 4:return i=n.sent,o=i[0],a=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",n.next=9,this.core.sendCmd(a,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:r,operation:0}});case 9:s=n.sent,c=s.content.data,pr(c).length>0&&(sr(o,c),this.emit("onTeamMemberInfoUpdated",[o]),this.memberModel.upsert(o));case 12:case"end":return n.stop()}}),n,this)})))},r.getTeamJoinActionInfoList=function(e){return this.checkV2(),Al(WI,e,"option",!0),this.core.V2NIMLoginService.checkIllegalState(),ls.resolve(this.notificationModel.getByOption(e))},r.clearAllTeamJoinActionInfo=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.notificationModel.reset();case 3:case"end":return e.stop()}}),e,this)})))},r.deleteTeamJoinActionInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Al(FI,e,"",!0),Al(GI,e,"",!0),Al({timestamp:{type:"number",min:1}},e,"",!0),this.notificationModel.delete(e);case 6:case"end":return t.stop()}}),t,this)})))},r.v2TeamSyncHandler=function(e){this.model.set(e.content.datas)},r.v2SuperTeamSyncHandler=function(e){this.model.set(e.content.datas)},r.v2TeamCreateMultiSyncHandler=function(e){var t=e.content.data;this.model.upsert(t);var r=_g(t.teamId,t.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(r),this.emit("onTeamCreated",t)},r.v2SuperTeamCreateMultiSyncHandler=function(e){var t=e.content.data;this.model.upsert(t);var r=_g(t.teamId,t.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(r),this.emit("onTeamCreated",t)},r.v2TeamMemberUpdateMultiSyncHandler=function(e){var t=e.content.data;t.teamType=1;var r=this.memberModel.getById(t.teamId,t.teamType,t.accountId);this.notification.updateTeamMemberRole(t.teamId,t.teamType,[t.accountId],t),t.accountId===this.core.account&&r&&r.bits!==t.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",t.teamId,t.teamType,t.bits)},r.v2SuperTeamMemberUpdateMultiSyncHandler=function(e){var t=e.content.data;t.teamType=2;var r=this.memberModel.getById(t.teamId,t.teamType,t.accountId);this.notification.updateTeamMemberRole(t.teamId,t.teamType,[t.accountId],t),t.accountId===this.core.account&&r&&r.bits!==t.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",t.teamId,t.teamType,t.bits)},r.v2TeamMembersOfSelfInSyncHandler=function(e){var t=e.content.datas;Bn(t).call(t,(function(e){e.teamType=1})),this.memberModel.setData(t)},r.v2SuperTeamMembersOfSelfInSyncHandler=function(e){var t=e.content.datas;Bn(t).call(t,(function(e){e.teamType=2})),this.memberModel.setData(t)},t}($h),XI="V2NIMUserService",ZI={"34_3":"v2UpdateBlockList","34_7":"v2GetUserList","34_10":"v2UpdateSelfUserProfile","3_109":"v2SyncSelfUserInfo","3_110":"onUpdateUserProfile","3_103":"onUpdateBlockList","3_8":"syncBlockAndMuteList","34_5":"v2SetP2PMessageMuteMode","3_105":"v2OnUpdateMuteList"},eM={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"}},tM={v2UpdateBlockList:{sid:34,cid:3,service:XI,params:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},v2GetUserList:{sid:34,cid:7,service:XI,params:[{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:gh(eM)}]},v2UpdateSelfUserProfile:{sid:34,cid:10,service:XI,params:[{type:"Property",name:"tag",reflectMapper:eM}],response:[{type:"Long",name:"updateTime"}]},onUpdateUserProfile:{sid:3,cid:110,service:XI,response:[{type:"Property",name:"data",reflectMapper:gh(eM)}]},onUpdateBlockList:{sid:3,cid:103,service:XI,response:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},syncBlockAndMuteList:{sid:3,cid:8,service:XI,response:[{type:"PropertyArray",name:"data",reflectMapper:gh({accountId:0,isMute:{id:1,retType:"boolean"},isBlock:{id:2,retType:"boolean"}})},{type:"Long",name:"timetag"}]},v2SyncSelfUserInfo:{sid:3,cid:109,service:XI,response:[{type:"Property",name:"user",reflectMapper:gh(eM)}]},v2SetP2PMessageMuteMode:{sid:34,cid:5,service:XI,params:[{type:"String",name:"accountId"},{type:"Bool",name:"muteMode"}]},v2OnUpdateMuteList:{sid:3,cid:105,service:XI,response:[{type:"String",name:"accountId"},{type:"Bool",name:"mute"}]}};Du("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Hu);var rM=q.Set;rt({target:"Set",stat:!0,forced:!0},{from:Ku}),rt({target:"Set",stat:!0,forced:!0},{of:Qu}),rt({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=He(this),t=re(e.add),r=0,n=arguments.length;r<n;r++)S(t,e,arguments[r]);return e}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:zu});var nM=Fi;rt({target:"Set",proto:!0,real:!0,forced:!0},{every:function(e){var t=He(this),r=nM(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return!Yi(r,(function(e,r){if(!n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(e){var t=He(this),r=new(fo(t,F("Set")))(t),n=re(r.delete);return Yi(e,(function(e){S(n,r,e)})),r}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(e){var t=He(this),r=nM(t),n=Be(e,arguments.length>1?arguments[1]:void 0),i=new(fo(t,F("Set"))),o=re(i.add);return Yi(r,(function(e){n(e,e,t)&&S(o,i,e)}),{IS_ITERATOR:!0}),i}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{find:function(e){var t=He(this),r=nM(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return Yi(r,(function(e,r){if(n(e,e,t))return r(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(e){var t=He(this),r=new(fo(t,F("Set"))),n=re(t.has),i=re(r.add);return Yi(e,(function(e){S(n,t,e)&&S(i,r,e)})),r}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){var t=He(this),r=re(t.has);return!Yi(e,(function(e,n){if(!0===S(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){var t=Fi(this),r=He(e),n=r.has;return I(n)||(r=new(F("Set"))(e),n=re(r.has)),!Yi(t,(function(e,t){if(!1===S(n,r,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(e){var t=He(this),r=re(t.has);return!Yi(e,(function(e,n){if(!1===S(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}});var iM=y([].join),oM=[].push;rt({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=He(this),r=nM(t),n=void 0===e?",":Qi(e),i=[];return Yi(r,oM,{that:i,IS_ITERATOR:!0}),iM(i,n)}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=He(this),r=nM(t),n=Be(e,arguments.length>1?arguments[1]:void 0),i=new(fo(t,F("Set"))),o=re(i.add);return Yi(r,(function(e){S(o,i,n(e,e,t))}),{IS_ITERATOR:!0}),i}});var aM=TypeError;rt({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=He(this),r=nM(t),n=arguments.length<2,i=n?void 0:arguments[1];if(re(e),Yi(r,(function(r){n?(n=!1,i=r):i=e(i,r,r,t)}),{IS_ITERATOR:!0}),n)throw aM("Reduce of empty set with no initial value");return i}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{some:function(e){var t=He(this),r=nM(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return Yi(r,(function(e,r){if(n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(e){var t=He(this),r=new(fo(t,F("Set")))(t),n=re(r.delete),i=re(r.add);return Yi(e,(function(e){S(n,r,e)||S(i,r,e)})),r}}),rt({target:"Set",proto:!0,real:!0,forced:!0},{union:function(e){var t=He(this),r=new(fo(t,F("Set")))(t);return Yi(e,re(r.add),{that:r}),r}});var sM=rM,cM=function(){function e(){this.muteList=new sM,this.userMap=new rd,this.blockList=[]}var t=e.prototype;return t.reset=function(){this.muteList.clear(),this.userMap.clear(),this.blockList=[]},t.setAccountMuteMode=function(e,t){1===t?this.muteList.add(e):this.muteList.delete(e)},t.setUser=function(e){this.userMap.set(e.accountId,e)},t.getUser=function(e){return this.userMap.get(e)},t.getUserListBySearchOption=function(e){var t,r;return lu(t=Vl(gu(r=this.userMap).call(r))).call(t,(function(t){var r,n,i;return!(void 0!==e.searchName&&!e.searchName||!tu(r=t.name).call(r,e.keyword))||!(!e.searchAccountId||!tu(n=t.accountId).call(n,e.keyword))||!!(t.mobile&&e.searchMobile&&tu(i=t.mobile).call(i,e.keyword))}))},t.addToBlockList=function(e){var t=this;Bn(e).call(e,(function(e){var r;tu(r=t.blockList).call(r,e)||t.blockList.push(e)}))},t.removeFromBlockList=function(e){var t=this;Bn(e).call(e,(function(e){var r,n,i=bu(r=t.blockList).call(r,e);-1!==i&&si(n=t.blockList).call(n,i,1)}))},e}(),uM={type:"string",required:!0,allowEmpty:!1},dM={type:"string",required:!1,allowEmpty:!0},lM={name:{type:"string",required:!1,allowEmpty:!0},avatar:dM,sign:dM,email:dM,birthday:dM,mobile:dM,gender:{type:"number",required:!1},serverExtension:dM};function pM(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return mM(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mM(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function mM(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var hM=function(e){function t(t){var r;return r=e.call(this,"V2NIMUserService",t)||this,hh({cmdMap:ZI,cmdConfig:tM}),r.model=new cM,"v2"!==r.core.options.apiVersion?st(r):(r.setListener(),r)}er(t,e);var r=t.prototype;return r.reset=function(){this.model.reset()},r.setListener=function(){var e,t=this;this.core.eventBus.on("V2NIMUserService/refreshUserInfo",Xt(e=this.refreshUserInfo).call(e,this)),this.core.eventBus.on("forwardReceive/V2NIMUserService/updateBlockList",(function(e,r){r?t.model.addToBlockList([e]):t.model.removeFromBlockList([e]),r?t.emitBlockListAdded(e):t.emit("onBlockListRemoved",e)})),this.core.eventBus.on("forwardReceive/V2NIMUserService/updateUserProfile",(function(e){t.updateUserProfileInMemory(e)}))},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onUserProfileChanged"===t){var c=a[0];this.logger.log(""+i,au(c).call(c,(function(e){return"id:"+e.accountId+";name:"+e.name+";updateTime:"+e.updateTime})))}else if("onBlockListAdded"===t){var u=a[0];this.logger.log(""+i,"id:"+u.accountId+";name:"+u.name+";updateTime:"+u.updateTime)}else{var d,l;(d=this.logger).log.apply(d,Rs(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,a))},r.getUserList=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.abrupt("return",this._getUserList(e));case 2:case"end":return t.stop()}}),t,this)})))},r._getUserList=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s=this;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Al({accountIds:kI},{accountIds:e},"",!0),n=[],Bn(e).call(e,(function(e){s.model.getUser(e)||n.push(e)})),i=null,!(n.length>0)){r.next=8;break}return r.next=7,this.core.sendCmd("v2GetUserList",{accountIds:n});case 7:i=r.sent;case 8:return o=(null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.data)||[],Bn(o).call(o,(function(e){s.model.setUser(e)})),a=[],Bn(e).call(e,(function(e){var t=s.model.getUser(e);t&&a.push(t)})),r.abrupt("return",a);case 13:case"end":return r.stop()}}),r,this)})))},r.getUserListFromCloud=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al({accountIds:{type:"array",min:1,max:500,itemType:"string"}},{accountIds:e},"",!0),t.next=4,this.core.sendCmd("v2GetUserList",{accountIds:e});case 4:return r=t.sent,n=r.content.data||[],i=[],Bn(n).call(n,(function(e){var t=a.model.getUser(e.accountId);a.compareUserForUpdate(t,e)&&i.push(e),a.model.setUser(e)})),o=fl(e).call(e,(function(e,t){var r=a.model.getUser(t);return r&&e.push(r),e}),[]),i.length>0&&this.emit("onUserProfileChanged",i),t.abrupt("return",o);case 11:case"end":return t.stop()}}),t,this)})))},r.compareUserForUpdate=function(e,t){return!e||!("number"==typeof e.updateTime&&"number"==typeof t.updateTime&&e.updateTime>=t.updateTime)},r.updateSelfUserProfile=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(lM,e,"",!0),t.next=4,this.core.sendCmd("v2UpdateSelfUserProfile",{tag:sr(sr({},e),{accountId:this.core.account})});case 4:return r=t.sent,t.next=7,this.updateUserProfileInMemory(sr({updateTime:r.content.updateTime},e));case 7:case"end":return t.stop()}}),t,this)})))},r.addUserToBlockList=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),e!==this.core.account){t.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot block yourself"}});case 3:return Al({accountId:uM},{accountId:e},"",!0),t.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!0});case 6:this.model.addToBlockList([e]),this.emitBlockListAdded(e);case 8:case"end":return t.stop()}}),t,this)})))},r.removeUserFromBlockList=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),e!==this.core.account){t.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot unblock yourself"}});case 3:return Al({accountId:uM},{accountId:e},"",!0),t.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!1});case 6:this.model.removeFromBlockList([e]),this.emit("onBlockListRemoved",e);case 8:case"end":return t.stop()}}),t,this)})))},r.searchUserByOption=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Al({keyword:{type:"string",allowEmpty:!1},searchName:{type:"boolean",required:!1},searchAccountId:{type:"boolean",required:!1},searchMobile:{type:"boolean",required:!1}},e,"",!0),!1!==(void 0===e.searchName||e.searchName)||e.searchAccountId||e.searchMobile){t.next=6;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"one of searchName, searchAccountId, searchMobile must be true"}});case 6:return t.abrupt("return",this.model.getUserListBySearchOption(e));case 7:case"end":return t.stop()}}),t,this)})))},r.getBlockList=function(){return this.checkV2(),ls.resolve(this.model.blockList)},r.updateUserProfileInMemory=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=this.model.getUser(this.core.account))){t.next=6;break}sr(r,e),this.model.setUser(r),t.next=10;break;case 6:return t.next=8,this._getUserList([this.core.account]);case 8:n=t.sent,r=n[0];case 10:r&&this.emit("onUserProfileChanged",[r]);case 11:case"end":return t.stop()}}),t,this)})))},r.onUpdateUserProfileHandler=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.content.data,t.next=3,this.updateUserProfileInMemory(r);case 3:case"end":return t.stop()}}),t,this)})))},r.onUpdateBlockListHandler=function(e){var t=e.content.accountId;e.content.addToBlockList?(this.model.addToBlockList([t]),this.emitBlockListAdded(t)):(this.model.removeFromBlockList([t]),this.emit("onBlockListRemoved",t))},r.syncBlockAndMuteListHandler=function(e){var t=this,r=e.content.data;Bn(r).call(r,(function(e){e.isBlock?t.model.addToBlockList([e.accountId]):t.model.setAccountMuteMode(e.accountId,e.isMute?1:0)}))},r.v2SyncSelfUserInfoHandler=function(e){var t=e.content.user;this.model.setUser(t)},r.checkUserUpdate=function(e,t){var r=e.senderId;r!==this.core.account&&this.refreshUserInfo(r,t)},r.refreshUserInfo=function(e,t){return void 0===t&&(t=0),Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&"string"==typeof e){r.next=2;break}return r.abrupt("return");case 2:if(n=this.model.getUser(e),i=[],!(!n||n&&"number"==typeof n.updateTime&&"number"==typeof t&&!isNaN(n.updateTime)&&!isNaN(t)&&n.updateTime<t)){r.next=15;break}return r.prev=5,r.next=8,this.core.sendCmd("v2GetUserList",{accountIds:[e]});case 8:o=r.sent,i=o.content.data,r.next=15;break;case 12:r.prev=12,r.t0=r.catch(5),this.logger.warn("V2NIMUserService:refreshUserInfo: failed for "+e);case 15:for(a=pM(i);!(s=a()).done;)c=s.value,this.model.setUser(c),this.emit("onUserProfileChanged",[c]);case 16:case"end":return r.stop()}}),r,this,[[5,12]])})))},r.emitBlockListAdded=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getUserList([e]);case 2:1===(r=t.sent).length&&this.emit("onBlockListAdded",r[0]);case 4:case"end":return t.stop()}}),t,this)})))},r.v2OnUpdateMuteListHandler=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.content,n=r.accountId,i=r.mute,o=i?1:0,this.core.eventBus.emit("v2NIMUserService/updateMuteList",n,o);case 3:case"end":return t.stop()}}),t,this)})))},t}($h),fM="V2NIMFriendService",gM={"35_1":"v2AddFriend","35_2":"v2DeleteFriend","35_3":"v2SetFriendInfo","35_4":"v2IncFriendInfo","12_101":"v2OnAddFriend","12_102":"v2OnDeleteFriend","12_103":"v2OnUpdateFriendInfo","12_5":"v2SyncFriendList","12_6":"v2SyncFriendUserList"},vM={accountId:4,source:{id:7,retType:"number"},alias:8,serverExtension:10,createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},customerExtension:13},yM={v2AddFriend:{sid:35,cid:1,service:fM,params:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"}],response:[]},v2DeleteFriend:{sid:35,cid:2,service:fM,params:[{type:"String",name:"accountId"},{type:"Property",name:"params",reflectMapper:{deleteAlias:{id:1,converter:vh}}}]},v2SetFriendInfo:{sid:35,cid:3,service:fM,params:[{type:"Property",name:"tag",reflectMapper:vM}]},v2OnAddFriend:{sid:12,cid:101,service:fM,response:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"},{type:"Property",name:"ext",reflectMapper:gh({serverExt:1})}]},v2OnDeleteFriend:{sid:12,cid:102,service:fM,response:[{type:"String",name:"accountId"}]},v2OnUpdateFriendInfo:{sid:12,cid:103,service:fM,response:[{type:"Property",name:"data",reflectMapper:gh(vM)}]},v2SyncFriendList:{sid:12,cid:5,service:fM,response:[{type:"PropertyArray",name:"friends",reflectMapper:gh(vM)},{type:"Long",name:"timetag"}]},v2SyncFriendUserList:{sid:12,cid:6,service:fM,response:[{type:"PropertyArray",name:"users",reflectMapper:gh(eM)}]},v2IncFriendInfo:{sid:35,cid:4,service:fM,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:gh(vM)},{type:"Long",name:"timetag"}]}},IM={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!0,rules:{addMode:{type:"enum",required:!0,values:[1,2]},postscript:{type:"string",required:!1,allowEmpty:!0}}}},MM={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{deleteAlias:{type:"boolean",required:!1}}}},TM={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{alias:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0}}}},SM={applicantAccountId:{type:"string",required:!0,allowEmpty:!1},recipientAccountId:{type:"string",required:!0,allowEmpty:!1},operatorAccountId:{type:"string",required:!1,allowEmpty:!1},postscript:{type:"string",required:!1,allowEmpty:!0},status:{type:"enum",required:!0,values:[1,4,3,0,2]},timestamp:{type:"number",min:1}},bM={offset:{type:"number",required:!1},limit:{type:"number",required:!1},status:{type:"array",itemType:"enum",required:!1,values:[1,4,3,0,2]}},CM=function(){function e(e,t){this.core=e,this.service=t}return e.prototype.processSysNotification=function(e){if(6===e.type){var t=e.senderId;this.core.V2NIMFriendService.handleDeleteFriend(t,2)}else if(5===e.type)try{var r=JSON.parse(e.content);if(1===(null==r?void 0:r.vt)){this.core.V2NIMFriendService.handleAddFriend(e.senderId,e.timestamp);var n={applicantAccountId:e.senderId,recipientAccountId:e.receiverId,operatorAccountId:e.senderId,postscript:e.postscript,timestamp:e.timestamp,status:4,read:!0};this.service.model.appendFriendAddApplication(n),this.service.model.updateFriendAddApplicationStatus(n.applicantAccountId,4,n.applicantAccountId)}else if(2===(null==r?void 0:r.vt)){var i={applicantAccountId:e.senderId,recipientAccountId:e.receiverId,operatorAccountId:e.senderId,postscript:e.postscript,timestamp:e.timestamp,status:0,read:!1};this.service.handleApplyFriend(i),this.service.model.appendFriendAddApplication(i)}else if(3===(null==r?void 0:r.vt)){this.core.V2NIMFriendService.handleAddFriend(e.senderId,e.timestamp);var o={applicantAccountId:e.receiverId,recipientAccountId:e.senderId,operatorAccountId:e.senderId,timestamp:e.timestamp,postscript:e.postscript,status:1,read:!0};this.service.model.appendFriendAddApplication(o)}else if(4===(null==r?void 0:r.vt)){var a={applicantAccountId:e.receiverId,recipientAccountId:e.senderId,operatorAccountId:e.senderId,timestamp:e.timestamp,postscript:e.postscript,status:2,read:!0};this.service.model.appendFriendAddApplication(a),this.service.emit("onFriendAddRejected",a)}}catch(s){this.core.logger.warn("V2NIMFriendNotificationImpl::processSysNotification, parse content error:",s)}},e}();function EM(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return _M(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_M(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var kM=function(){function e(){this.validFriendIds=new sM,this.friendMap=new rd,this.applicationInfoList=[],this.friendTimetag=0}var t=e.prototype;return t.getAddApplicationList=function(e){var t,r,n=void 0===e.offset?0:e.offset,i=Pc(t=lu(r=this.applicationInfoList).call(r,(function(t){var r=e.status||[];return 0===r.length||!!tu(r).call(r,t.status)}))).call(t),o=e.limit||50,a=Fc(i).call(i,n,n+o),s=n+o>=i.length;return{infos:a,finished:s,offset:s?0:n+o}},t.reset=function(){this.friendMap.clear(),this.validFriendIds.clear(),this.applicationInfoList=[]},t.setAddApplicationRead=function(){for(var e,t=EM(this.applicationInfoList);!(e=t()).done;)e.value.read=!0},t.getAddApplicationUnreadCount=function(){for(var e,t=new sM,r=EM(this.applicationInfoList);!(e=r()).done;){var n=e.value;n.read||0!==n.status||t.add(n.applicantAccountId)}return t.size},t.appendFriendAddApplication=function(e){this.applicationInfoList.push(e)},t.clearApplicationList=function(){this.applicationInfoList=[]},t.deleteApplication=function(e){var t,r;this.applicationInfoList=lu(t=au(r=this.applicationInfoList).call(r,(function(t){if(t.applicantAccountId!==e.applicantAccountId||t.recipientAccountId!==e.recipientAccountId||t.timestamp!==e.timestamp)return t}))).call(t,(function(e){return e}))},t.updateFriendAddApplicationStatus=function(e,t,r){if(0!==t)for(var n,i=EM(this.applicationInfoList);!(n=i()).done;){var o=n.value;o.applicantAccountId===e&&0===o.status&&(o.status=t,o.operatorAccountId=r,o.read=!0)}},t.upsertFriend=function(e,t){var r=this.friendMap.get(e)||{},n=sr({accountId:e},r,t);return this.friendMap.set(e,n),this.validFriendIds.add(e),n},t.addFriend=function(e){this.validFriendIds.add(e)},t.deleteFriend=function(e){this.validFriendIds.delete(e)},t.getFriend=function(e){return this.validFriendIds.has(e)?this.friendMap.get(e):void 0},t.getFriendList=function(){var e,t,r,n=this;return lu(e=au(t=Vl(gu(r=this.validFriendIds).call(r))).call(t,(function(e){return n.getFriend(e)}))).call(e,(function(e){return!!e}))},t.getFriendListBySearchOption=function(e){var t,r,n,i=this;return lu(t=au(r=Vl(gu(n=this.validFriendIds).call(n))).call(r,(function(e){return i.getFriend(e)}))).call(t,(function(t){var r,n,i=void 0===e.searchAlias||e.searchAlias;return!(void 0===t||!(i&&t.alias&&tu(r=t.alias).call(r,e.keyword)||e.searchAccountId&&tu(n=t.accountId).call(n,e.keyword)))}))},t.getFriendByIds=function(e){var t,r=this;return lu(t=au(e).call(e,(function(e){return r.getFriend(e)}))).call(t,(function(e){return!!e}))},t.setFriendTimetag=function(e){this.friendTimetag=e},t.getFriendTimetag=function(){return this.friendTimetag},e}(),RM=function(e){function t(t){var r;return(r=e.call(this,"V2NIMFriendService",t)||this).notification=new CM(r.core,st(r)),r.model=new kM,"v2"!==r.core.options.apiVersion?st(r):(hh({cmdMap:gM,cmdConfig:yM}),r.setListener(),r)}er(t,e);var r=t.prototype;return r.reset=function(){this.model.reset()},r.setListener=function(){var e,t,r,n,i,o;this.core.eventBus.on("V2NIMFriendService/sysNotification",Xt(e=this.notification.processSysNotification).call(e,this.notification)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/addFriend",Xt(t=this.handleAddFriend).call(t,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/deleteFriend",Xt(r=this.handleDeleteFriend).call(r,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/setFriendInfo",Xt(n=this.handleSetFriendInfo).call(n,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/acceptAddApplication",Xt(i=this.handlePassFriendApply).call(i,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/rejectAddApplication",Xt(o=this.handleRejectFriendApply).call(o,this))},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onFriendAdded"===t||"onFriendInfoChanged"===t){var c=a[0];this.logger.log(""+i,c.accountId+";updateTime:"+c.updateTime)}else{var u,d;(u=this.logger).log.apply(u,Rs(d=[""+i]).call(d,a))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,a))},r.addFriend=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),e!==this.core.account){r.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot add yourself"}});case 3:return Al(IM,{accountId:e,params:t},"",!0),r.next=6,this.core.sendCmd("v2AddFriend",{accountId:e,verifyType:t.addMode,postscript:t.postscript||""});case 6:if(1!==t.addMode){r.next=9;break}return r.next=9,this.handleAddFriend(e);case 9:case"end":return r.stop()}}),r,this)})))},r.deleteFriend=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),e!==this.core.account){r.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot delete yourself"}});case 3:return Al(MM,{accountId:e,params:t},"",!0),r.next=6,this.core.sendCmd("v2DeleteFriend",{accountId:e,params:t});case 6:t.deleteAlias&&this.model.upsertFriend(e,{alias:""}),this.handleDeleteFriend(e);case 8:case"end":return r.stop()}}),r,this)})))},r.acceptAddApplication=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(SM,e,"",!0),t.prev=2,t.next=5,this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:3,postscript:""});case 5:this.handlePassFriendApply(e.applicantAccountId),t.next=12;break;case 8:throw t.prev=8,t.t0=t.catch(2),this.handlePassFriendApply(e.applicantAccountId,t.t0),t.t0;case 12:case"end":return t.stop()}}),t,this,[[2,8]])})))},r.rejectAddApplication=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(SM,e,"",!0),r.prev=2,r.next=5,this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:4,postscript:t||""});case 5:this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:t||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:2}),r.next=12;break;case 8:throw r.prev=8,r.t0=r.catch(2),this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:t||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:3},r.t0),r.t0;case 12:case"end":return r.stop()}}),r,this,[[2,8]])})))},r.setFriendInfo=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(TM,{accountId:e,params:t},"",!0),e!==this.core.account){r.next=4;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot set yourself"}});case 4:return r.next=6,this.core.sendCmd("v2SetFriendInfo",{tag:sr({accountId:e},t)});case 6:this.handleSetFriendInfo(e,t);case 7:case"end":return r.stop()}}),r,this)})))},r.getFriendList=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),e.abrupt("return",this.computedFields(this.model.getFriendList()));case 3:case"end":return e.stop()}}),e,this)})))},r.getFriendByIds=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Al({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0),t.abrupt("return",this.computedFields(this.model.getFriendByIds(e)));case 4:case"end":return t.stop()}}),t,this)})))},r.checkFriend=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Al({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0),r={},Bn(e).call(e,(function(e){r[e]=!!n.model.getFriend(e)})),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})))},r.getAddApplicationList=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Al(bM,e,"",!0),t.abrupt("return",this.model.getAddApplicationList(e));case 4:case"end":return t.stop()}}),t,this)})))},r.setAddApplicationRead=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.setAddApplicationRead();case 3:case"end":return e.stop()}}),e,this)})))},r.getAddApplicationUnreadCount=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),e.abrupt("return",this.model.getAddApplicationUnreadCount());case 3:case"end":return e.stop()}}),e,this)})))},r.clearAllAddApplication=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.clearApplicationList();case 3:case"end":return e.stop()}}),e,this)})))},r.deleteAddApplication=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Al(SM,e,"",!0),e.applicantAccountId===this.core.account||e.recipientAccountId===this.core.account){t.next=5;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"The applicant and recipient are not youself"}});case 5:this.model.deleteApplication(e);case 6:case"end":return t.stop()}}),t,this)})))},r.searchFriendByOption=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Al({keyword:{type:"string",allowEmpty:!1},searchAccountId:{type:"boolean",required:!1}},e,"",!0),void 0===e.searchAlias||e.searchAlias||e.searchAccountId){t.next=6;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchAlias and searchAccountId cannot be false at the same time"}});case 6:return t.abrupt("return",this.computedFields(this.model.getFriendListBySearchOption(e)));case 7:case"end":return t.stop()}}),t,this)})))},r.v2OnAddFriendHandler=function(e){var t=e.content,r=t.accountId,n=t.verifyType,i=t.postscript;if(1===n)this.handleAddFriend(r);else if(2===n){var o={applicantAccountId:this.core.account,recipientAccountId:r,operatorAccountId:this.core.account,postscript:i,timestamp:this.core.timeOrigin.getNTPTime(),status:0,read:!1};this.handleApplyFriend(o)}else if(3===n)this.handlePassFriendApply(r);else if(4===n){var a={applicantAccountId:r,recipientAccountId:this.core.account,operatorAccountId:this.core.account,postscript:i,timestamp:this.core.timeOrigin.getNTPTime(),status:2,read:!0};this.handleRejectFriendApply(a)}},r.v2OnDeleteFriendHandler=function(e){var t=e.content.accountId;this.handleDeleteFriend(t)},r.v2OnUpdateFriendInfoHandler=function(e){var t=e.content.data,r=this.model.upsertFriend(t.accountId,t);this.emit("onFriendInfoChanged",r)},r.v2SyncFriendListHandler=function(e){var t=this,r=e.content,n=r.friends,i=r.timetag;this.model.setFriendTimetag(i),Bn(n).call(n,(function(e){e.serverExtension||(e.serverExtension=""),e.customerExtension||(e.customerExtension=""),t.model.upsertFriend(e.accountId,e)}))},r.v2SyncFriendUserListHandler=function(e){var t=this,r=e.content.users;this.hasUserService&&Bn(r).call(r,(function(e){t.core.V2NIMUserService.model.setUser(e)}))},r.handleApplyFriend=function(e){this.emit("onFriendAddApplication",e)},r.handleAddFriend=function(e,t){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.model.addFriend(e),t.next=3,this.incrementSyncFriend();case 3:this.core.eventBus.emit("V2NIMUserService/refreshUserInfo",e),(r=this.model.getFriend(e))&&this.emit("onFriendAdded",this.computedField(r));case 6:case"end":return t.stop()}}),t,this)})))},r.handleDeleteFriend=function(e,t){t=void 0===t?1:t,this.emit("onFriendDeleted",e,t),this.model.deleteFriend(e)},r.handleSetFriendInfo=function(e,t){var r=this.model.upsertFriend(e,t);this.emit("onFriendInfoChanged",this.computedField(r))},r.handlePassFriendApply=function(e,t){var r=t?null==t?void 0:t.code:200;if(!(r>=19e4||r===yl.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===r||r===yl.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(e,1,this.core.account),this.handleAddFriend(e);else{if(r>=500&&r<=599&&509!==r)return;this.model.updateFriendAddApplicationStatus(e,3,this.core.account)}},r.handleRejectFriendApply=function(e,t){var r=t?null==t?void 0:t.code:200;if(!(r>=19e4||r===yl.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===r)this.emit("onFriendAddRejected",e),this.model.updateFriendAddApplicationStatus(e.applicantAccountId,2,this.core.account);else if(r===yl.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(e.applicantAccountId,1,this.core.account);else{if(r>=500&&r<=599&&509!==r)return;this.model.updateFriendAddApplicationStatus(e.applicantAccountId,3,this.core.account)}},r.incrementSyncFriend=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i,o=this;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("v2IncFriendInfo",{timetag:this.model.getFriendTimetag()});case 2:t=e.sent,r=t.content,n=r.friends,i=r.timetag,this.model.setFriendTimetag(i),Bn(n).call(n,(function(e){o.model.upsertFriend(e.accountId,e)}));case 6:case"end":return e.stop()}}),e,this)})))},r.computedFields=function(e){var t=this;return au(e).call(e,(function(e){return t.computedField(e)}))},r.computedField=function(e){var t,r,n=null===(r=null===(t=this.core.V2NIMUserService)||void 0===t?void 0:t.model)||void 0===r?void 0:r.getUser(e.accountId);return n?sr({},e,{userProfile:n}):e},at(t,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}}]),t}($h),wM={muteMode:{type:"enum",values:[2,0,1]}},AM={accountId:{type:"string",required:!0,allowEmpty:!1},muteMode:{type:"enum",required:!0,values:[2,0,1]}},xM={type:"object",required:!1,rules:{certificateName:{type:"string",required:!0,allowEmpty:!1},appId:{type:"string",required:!1,allowEmpty:!1},appKey:{type:"string",required:!1,allowEmpty:!1},secret:{type:"string",required:!1,allowEmpty:!1}}},NM={config:{type:"object",required:!0,rules:{apns:xM,hwPush:xM,miPush:xM,vivoPush:xM,oppoPush:xM,honorPush:xM,fcmPush:xM,mzPush:xM}}},OM="V2NIMSettingService",PM={"34_1":"v2SetDeviceToken","34_2":"v2SetAppBackground","34_15":"v2SetPushMobileOnDesktopOnline"},LM={v2SetDeviceToken:{sid:34,cid:1,service:OM,params:[{type:"String",name:"certificateName"},{type:"String",name:"pushDeviceToken"},{type:"Int",name:"pushkit"}]},v2SetAppBackground:{sid:34,cid:2,service:OM,params:[{type:"Bool",name:"isBackground"},{type:"Int",name:"badge"}]},v2SetPushMobileOnDesktopOnline:{sid:34,cid:15,service:OM,params:[{type:"Property",name:"tag",reflectMapper:{need:{id:1,converter:function(e){return e?2:1}}}}]}},VM=VM||function(e){var t;"undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),void 0!==Us&&Us.crypto&&(t=Us.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==ki&&ki.crypto&&(t=ki.crypto);var r=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Ut||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},o=i.lib={},a=o.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=o.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e,t=a.clone.call(this);return t.words=Fc(e=this.words).call(e,0),t},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new s.init(t,e)}}),c=i.enc={},u=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=Kp(e.substr(n,2),16)<<24-n%8*4;return new s.init(r,t/2)}},d=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new s.init(r,t)}},l=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=o.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){var t;"string"==typeof e&&(e=l.parse(e)),Rs(t=this._data).call(t,e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,a=this.blockSize,c=o/(4*a),u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*a,d=e.min(4*u,o);if(u){for(var l=0;l<u;l+=a)this._doProcessBlock(i,l);r=si(i).call(i,0,u),n.sigBytes-=d}return new s.init(r,d)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=p.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new m.HMAC.init(e,r).finalize(t)}}});var m=i.algo={};return i}(Math),UM=VM.enc.Utf8,DM=VM,qM=DM.lib,BM=qM.Base,FM=qM.WordArray,GM=DM.algo,jM=GM.MD5,HM=GM.EvpKDF=BM.extend({cfg:BM.extend({keySize:4,hasher:jM,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),o=FM.create(),a=o.words,s=n.keySize,c=n.iterations;a.length<s;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var u=1;u<c;u++)r=i.finalize(r),i.reset();Rs(o).call(o,r)}return o.sigBytes=4*s,o}});DM.EvpKDF=function(e,t,r){return HM.create(r).compute(e,t)},VM.EvpKDF;var WM=VM,YM=WM.lib.WordArray;WM.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<r;s++)i.push(n.charAt(a>>>6*(3-s)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<r.length;i++)n[r.charCodeAt(i)]=i}var o=r.charAt(64);if(o){var a=bu(e).call(e,o);-1!==a&&(t=a)}return function(e,t,r){for(var n=[],i=0,o=0;o<t;o++)if(o%4){var a=r[e.charCodeAt(o-1)]<<o%4*2|r[e.charCodeAt(o)]>>>6-o%4*2;n[i>>>2]|=a<<24-i%4*8,i++}return YM.create(n,i)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},VM.enc.Base64,function(e){e.lib.Cipher||function(){var t=e,r=t.lib,n=r.Base,i=r.WordArray,o=r.BufferedBlockAlgorithm,a=t.enc;a.Utf8;var s=a.Base64,c=t.algo.EvpKDF,u=r.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:g}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()});r.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=t.mode={},l=r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=d.CBC=function(){var e=l.extend();function t(e,t,r){var n,i=this._iv;i?(n=i,this._iv=void 0):n=this._prevBlock;for(var o=0;o<r;o++)e[t+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i),n.encryptBlock(e,r),this._prevBlock=Fc(e).call(e,r,r+i)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=Fc(e).call(e,r,r+i);n.decryptBlock(e,r),t.call(this,e,r,i),this._prevBlock=o}}),e}(),m=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,o=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(o);var c=i.create(a,n);Rs(e).call(e,c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};r.BlockCipher=u.extend({cfg:u.cfg.extend({mode:p,padding:m}),reset:function(){var e;u.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var h=r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(t.format={}).OpenSSL={stringify:function(e){var t,r,n=e.ciphertext,o=e.salt;return(o?Rs(t=Rs(r=i.create([1398893684,1701076831])).call(r,o)).call(t,n):n).toString(s)},parse:function(e){var t,r=s.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=i.create(Fc(n).call(n,2,4)),si(n).call(n,0,4),r.sigBytes-=16),h.create({ciphertext:r,salt:t})}},g=r.SerializableCipher=n.extend({cfg:n.extend({format:f}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),a=i.cfg;return h.create({ciphertext:o,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(t.kdf={}).OpenSSL={execute:function(e,t,r,n){var o;n||(n=i.random(8));var a=c.create({keySize:t+r}).compute(e,n),s=i.create(Fc(o=a.words).call(o,t),4*r);return a.sigBytes=4*t,h.create({key:a,iv:s,salt:n})}},y=r.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:v}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=g.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);return n.iv=i.iv,g.decrypt.call(this,e,t,i.key,n)}})}()}(VM);var KM=VM,QM=KM.lib.StreamCipher,zM=KM.algo,JM=zM.RC4=QM.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;i=0;for(var o=0;i<256;i++){var a=i%r,s=t[a>>>2]>>>24-a%4*8&255;o=(o+n[i]+s)%256;var c=n[i];n[i]=n[o],n[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=$M.call(this)},keySize:8,ivSize:0});function $M(){for(var e=this._S,t=this._i,r=this._j,n=0,i=0;i<4;i++){r=(r+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[r],e[r]=o,n|=e[(e[t]+e[r])%256]<<24-8*i}return this._i=t,this._j=r,n}KM.RC4=QM._createHelper(JM);var XM=zM.RC4Drop=JM.extend({cfg:JM.cfg.extend({drop:192}),_doReset:function(){JM._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)$M.call(this)}});KM.RC4Drop=QM._createHelper(XM);var ZM=VM.RC4,eT=function(e){function t(t){var r;return(r=e.call(this,"V2NIMSettingService",t)||this).offlinePushPlugin=void 0,r.offlinePushConfig=void 0,r.authConfig=void 0,r.aosPushInfo=void 0,r.appBackgroundOptions={badge:0,isBackground:!1},r.p2pMessageMuteModeChangeHandler=function(e,t){r.emit("onP2PMessageMuteModeChanged",e,t),r.hasUserService&&r.core.V2NIMUserService.model.setAccountMuteMode(e,t);var n=r.core.V2NIMConversationIdUtil.p2pConversationId(e),i=1===t;r.core.eventBus.emit("V2NIMConversationService/setMute",n,i)},r.setTokenAndBackgroundStateAfterLogin=function(e){r.aosPushInfo=e,r.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin"),r.offlinePushPlugin&&(r.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin plugin is provided"),r.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin pushType is: ",e&&e.pushType),r.regToken(),r.core.sendCmd("v2SetAppBackground",{isBackground:r.appBackgroundOptions.isBackground,badge:r.appBackgroundOptions.badge||0}))},r.core._registerDep(hg,"V2NIMConversationIdUtil"),"v2"!==r.core.options.apiVersion?st(r):(r.setListener(),hh({cmdMap:PM,cmdConfig:LM}),r)}er(t,e);var r=t.prototype;return r.setListener=function(){var e=this;this.core.eventBus.on("V2NIMSettingService/updateBits",(function(t,r,n){e.emit("onTeamMessageMuteModeChanged",t,r,n)})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",this.setTokenAndBackgroundStateAfterLogin),this.core.eventBus.on("v2NIMUserService/updateMuteList",this.p2pMessageMuteModeChangeHandler),this.core.eventBus.on("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",this.p2pMessageMuteModeChangeHandler)},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Rs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Rs(o=[this,t]).call(o,c))},r.getConversationMuteStatus=function(e){if("string"!=typeof e)return!1;var t=this.core.V2NIMConversationIdUtil.parseConversationType(e),r=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e);return 3===t?0!==this.getTeamMessageMuteMode(r,2):2===t?0!==this.getTeamMessageMuteMode(r,1):!(1!==t||!this.hasUserService||!this.core.V2NIMUserService.model.muteList.has(r))},r.setTeamMessageMuteMode=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.hasTeamService){n.next=2;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"setTeamMessageMuteMode: no team service"}});case 2:return this.checkV2(),Al(NI,{teamId:e},"",!0),Al(PI,{teamType:t},"",!0),Al(wM,{muteMode:r},"",!0),i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",o={teamId:e,teamType:t,accountId:this.core.account,bits:r},n.next=10,this.core.sendCmd(i,{teamMember:o});case 10:this.core.V2NIMTeamService.memberModel.upsert(o),this.emit("onTeamMessageMuteModeChanged",e,t,r),a=1===t?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),s=this.getConversationMuteStatus(a),this.core.eventBus.emit("V2NIMConversationService/setMute",a,s);case 15:case"end":return n.stop()}}),n,this)})))},r.getTeamMessageMuteMode=function(e,t){var r;return"string"!=typeof e||"number"!=typeof t?0:this.hasTeamService?3&((null===(r=this.core.V2NIMTeamService.memberModel.getById(e,t,this.core.account))||void 0===r?void 0:r.bits)||0):0},r.setP2PMessageMuteMode=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(AM,{accountId:e,muteMode:t},"",!0),e!==this.core.account){r.next=4;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"can not set mute mode for self"}});case 4:return r.next=6,this.core.sendCmd("v2SetP2PMessageMuteMode",{accountId:e,muteMode:1===t});case 6:this.p2pMessageMuteModeChangeHandler(e,t);case 7:case"end":return r.stop()}}),r,this)})))},r.getP2PMessageMuteMode=function(e){return Al({accountId:{type:"string",required:!0,allowEmpty:!1}},{accountId:e},"",!0),this.hasUserService&&this.core.V2NIMUserService.model.muteList.has(e)?1:0},r.getRNDeviceInfo=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){var r=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.log("OfflinePushService:getDeviceInfo start"),null===(e=this.offlinePushPlugin)||void 0===e||e.init(Ti(this.authConfig),(function(e,t,n){if(r.logger.log("OfflinePushService:: type: "+e+", tokenName: "+t+", token: "+n),n){var i="",o=Ql.getSystemInfo()||{},a=o.os?o.os.toLowerCase():"";r.aosPushInfo&&r.aosPushInfo.pushType?i=r.aosPushInfo.pushType:"ios"===a?i="":"android"===a&&(i="8"),r.pushTokenToServer(i,n)}else r.logger.warn("OfflinePushService:: token is empty. Please check your parameters")})),t.abrupt("return",new ls((function(e,t){var n;null===(n=r.offlinePushPlugin)||void 0===n||n.getDeviceInfo((function(n){try{r.logger.log("OfflinePushService:getDeviceInfo result "+(n?Ti(n):"")),e(JSON.parse(n))}catch(i){t(new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo error"}}))}})),Ls((function(){t(new Tl({code:yl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo timeout"}}))}),2e3)})));case 3:case"end":return t.stop()}}),t,this)})))},r.getP2PMessageMuteList=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasUserService){e.next=4;break}return e.abrupt("return",ls.resolve(Vl(this.core.V2NIMUserService.model.muteList)));case 4:return e.abrupt("return",ls.resolve([]));case 5:case"end":return e.stop()}}),e,this)})))},r.setAppBackground=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al({isBackground:{type:"boolean"},badge:{type:"number",required:!1}},{isBackground:e,badge:t},"",!0),this.appBackgroundOptions={isBackground:e,badge:t||0},r.next=5,this.core.sendCmd("v2SetAppBackground",{isBackground:e,badge:t||0});case 5:case"end":return r.stop()}}),r,this)})))},r.setPushMobileOnDesktopOnline=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al({need:{type:"boolean",required:!1}},{need:e},"",!0),e=void 0===e||e,t.next=5,this.core.sendCmd("v2SetPushMobileOnDesktopOnline",{tag:{need:e}});case 5:case"end":return t.stop()}}),t,this)})))},r.setOfflinePushConfig=function(e,t){var r,n,i,o,a,s,c,u,d,l,p,m,h,f,g,v,y,I,M,T,S,b,C,E,_,k,R,w,A,x,N,O,P,L,V,U;Al(NM,{config:t},"",!0),this.logger.log("setOfflinePushConfig","plugin",e,"config",t),this.offlinePushPlugin=e,this.offlinePushConfig=t,this.authConfig={xmAppId:null===(n=null===(r=this.offlinePushConfig)||void 0===r?void 0:r.miPush)||void 0===n?void 0:n.appId,xmAppKey:null===(o=null===(i=this.offlinePushConfig)||void 0===i?void 0:i.miPush)||void 0===o?void 0:o.appKey,xmCertificateName:null===(s=null===(a=this.offlinePushConfig)||void 0===a?void 0:a.miPush)||void 0===s?void 0:s.certificateName,hwAppId:null===(u=null===(c=this.offlinePushConfig)||void 0===c?void 0:c.hwPush)||void 0===u?void 0:u.appId,hwCertificateName:null===(l=null===(d=this.offlinePushConfig)||void 0===d?void 0:d.hwPush)||void 0===l?void 0:l.certificateName,oppoAppId:null===(m=null===(p=this.offlinePushConfig)||void 0===p?void 0:p.oppoPush)||void 0===m?void 0:m.appId,oppoAppKey:null===(f=null===(h=this.offlinePushConfig)||void 0===h?void 0:h.oppoPush)||void 0===f?void 0:f.appKey,oppoAppSecret:null===(v=null===(g=this.offlinePushConfig)||void 0===g?void 0:g.oppoPush)||void 0===v?void 0:v.secret,oppoCertificateName:null===(I=null===(y=this.offlinePushConfig)||void 0===y?void 0:y.oppoPush)||void 0===I?void 0:I.certificateName,vivoAppId:null===(T=null===(M=this.offlinePushConfig)||void 0===M?void 0:M.vivoPush)||void 0===T?void 0:T.appId,vivoAppKey:null===(b=null===(S=this.offlinePushConfig)||void 0===S?void 0:S.vivoPush)||void 0===b?void 0:b.appKey,vivoCertificateName:null===(E=null===(C=this.offlinePushConfig)||void 0===C?void 0:C.vivoPush)||void 0===E?void 0:E.certificateName,fcmCertificateName:null===(k=null===(_=this.offlinePushConfig)||void 0===_?void 0:_.fcmPush)||void 0===k?void 0:k.certificateName,mzAppId:null===(w=null===(R=this.offlinePushConfig)||void 0===R?void 0:R.mzPush)||void 0===w?void 0:w.appId,mzAppKey:null===(x=null===(A=this.offlinePushConfig)||void 0===A?void 0:A.mzPush)||void 0===x?void 0:x.appKey,mzCertificateName:null===(O=null===(N=this.offlinePushConfig)||void 0===N?void 0:N.mzPush)||void 0===O?void 0:O.certificateName,apnsCertificateName:null===(L=null===(P=this.offlinePushConfig)||void 0===P?void 0:P.apns)||void 0===L?void 0:L.certificateName,honorCertificateName:null===(U=null===(V=this.offlinePushConfig)||void 0===V?void 0:V.honorPush)||void 0===U?void 0:U.certificateName}},r.regToken=function(){var e=this,t=Ql.getSystemInfo()||{},r=t.os?t.os.toLowerCase():"";if(this.logger.log("OfflinePushService: os",r),"ios"===r||"android"===r)if(!this.offlinePushPlugin||"UNIAPP"===Ql.platform&&"function"!=typeof this.offlinePushPlugin.getDeviceToken||"React Native"===Ql.platform&&"android"===r&&"function"!=typeof this.offlinePushPlugin.init||"React Native"===Ql.platform&&"ios"===r&&"function"!=typeof this.offlinePushPlugin.checkPermissions)this.logger.warn("OfflinePushService: plugin is not correct, please check your plugin according to Yunxin Official Documentation");else{var n;"React Native"===Ql.platform&&Ql.envPayload.AppState&&Ql.envPayload.AppState.addEventListener("change",Xt(n=this.handleRNAppStateChange).call(n,this));var i="";this.aosPushInfo&&this.aosPushInfo.pushType?i=this.aosPushInfo.pushType:"ios"===r?i="":"android"===r&&(i="8"),this.logger.log("OfflinePushService:: prepare to get device token. suggestPushType: "+i),this.logger.log("OfflinePushService push config",Ti(this.authConfig,null,2),"platform",Ql.platform),"UNIAPP"===Ql.platform?this.offlinePushPlugin.getDeviceToken({suggestPushType:i,config:this.authConfig},(function(t){t?(e.logger.log("OfflinePushService:: token is :"+t),e.pushTokenToServer(i,t)):e.logger.warn("OfflinePushService:: token is empty. Please check your parameters")})):"React Native"===Ql.platform&&"android"===r?(this.logger.log("OfflinePushService:: onLogin",this.core.account,typeof i,i),this.offlinePushPlugin.onLogin(this.core.account,Kp(i),!1,"")):"React Native"===Ql.platform&&"ios"===r?this.offlinePushPlugin.checkPermissions((function(){e.logger.log("OfflinePushService addEventListener requestPermissions");try{e.offlinePushPlugin.requestPermissions()}catch(t){e.logger.log("OfflinePushService:: requestPermissions error",t)}e.offlinePushPlugin.addEventListener("register",(function(t){e.logger.log("OfflinePushService:: ios token: "+t),e.pushTokenToServer(i,t)})),e.offlinePushPlugin.addEventListener("registrationError",(function(t){e.logger.log("OfflinePushService:: ios registerError",t)}))})):this.logger.error("OfflinePushService:: platform is not supported. Please check your parameters. Platform: "+Ql.platform+". os: "+r)}else this.logger.warn("OfflinePushService: only Android or IOS support offline push")},r.pushTokenToServer=function(e,t){var r,n,i,o,a,s,c,u,d="",l=this.offlinePushConfig;switch(e){case"5":d=null===(r=null==l?void 0:l.miPush)||void 0===r?void 0:r.certificateName;break;case"6":d=null===(n=null==l?void 0:l.hwPush)||void 0===n?void 0:n.certificateName;break;case"7":d=null===(i=null==l?void 0:l.mzPush)||void 0===i?void 0:i.certificateName;break;case"8":d=null===(o=null==l?void 0:l.fcmPush)||void 0===o?void 0:o.certificateName;break;case"9":d=null===(a=null==l?void 0:l.vivoPush)||void 0===a?void 0:a.certificateName;break;case"10":d=null===(s=null==l?void 0:l.oppoPush)||void 0===s?void 0:s.certificateName;break;case"11":d=null===(c=null==l?void 0:l.honorPush)||void 0===c?void 0:c.certificateName;break;default:d=null===(u=null==l?void 0:l.apns)||void 0===u?void 0:u.certificateName}if(""===d||void 0===d)this.logger.warn("OfflinePushService:: certificate name is empty for push type: ",e);else try{if("UNIAPP"===Ql.platform){var p=UM.parse("557d1e3cafa43e2589a588270c53d56f"),m=UM.stringify(ZM.decrypt(t,p));this.logger.log("OfflinePushService:: token",m),this.core.sendCmd("v2SetDeviceToken",{certificateName:d,pushDeviceToken:m,pushkit:0})}else this.core.sendCmd("v2SetDeviceToken",{certificateName:d,pushDeviceToken:t,pushkit:0})}catch(h){return this.logger.log("OfflinePushService:: decrypt error",h),void this.logger.warn("OfflinePushService:: token before decrypt",t)}},r.handleRNAppStateChange=function(e){this.logger.log("push::handleAppStateChange: pushConfig ios/aos; state: "+e),this.appBackgroundOptions={badge:this.core.V2NIMConversationService.getTotalUnreadCount(),isBackground:"background"===e||"inactive"===e},this.setAppBackground(this.appBackgroundOptions.isBackground,this.appBackgroundOptions.badge)},at(t,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}},{key:"hasTeamService",get:function(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}}]),t}($h);rt({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var tT,rT=q.Number.isNaN,nT=cf({none:0,normal:1,all:3}),iT={normal:0,advanced:1},oT=cf(iT),aT=cf({normal:0,owner:1,manager:2}),sT={noVerify:0,needVerify:1,rejectAll:2},cT=cf(sT),uT={needVerify:0,noVerify:1},dT=cf(uT),lT={manager:0,all:1},pT=cf(lT),mT={manager:0,all:1},hT=cf(mT),fT={manager:0,all:1},gT=cf(fT);function vT(e){var t,r=["teamId"],n=["level","memberNum","memberUpdateTime","createTime","updateTime"],i=["valid","validToCurrentUser","mute"],o={type:oT,muteType:nT,joinMode:cT,beInviteMode:dT,inviteMode:pT,updateTeamMode:hT,updateExtMode:gT};e.bits;var a=Hl(e,["bits"]);return Bn(r).call(r,(function(e){a[e]&&(a[e]=a[e].toString())})),Bn(n).call(n,(function(e){void 0!==a[e]&&(a[e]=Kp(a[e]))})),Bn(i).call(i,(function(e){void 0!==a[e]&&(a[e]=1===Kp(a[e]))})),Bn(t=pr(o)).call(t,(function(e){void 0!==a[e]&&(a[e]=o[e][a[e]]||a[e])})),a}function yT(e){return e&&e.length>0?au(e).call(e,(function(e){return vT(e)})):[]}function IT(e){var t,r=sr({},e),n=["avatar","name","intro","announcement","ext"],i={type:iT,joinMode:sT,beInviteMode:uT,inviteMode:lT,updateTeamMode:mT,updateExtMode:fT};return Bn(n).call(n,(function(e){void 0!==r[e]&&(r[e]=r[e].toString())})),Bn(t=pr(i)).call(t,(function(e){void 0!==r[e]&&(r[e]=i[e][r[e]])})),r}function MT(e){var t=["teamId","ext","account","nickInTeam"],r={};return void 0!==e.bitConfigMask&&(r.bits=Kp(e.bitConfigMask)),Bn(t).call(t,(function(t){e[t]&&(r[t]=e[t].toString())})),Object.prototype.hasOwnProperty.call(e,"nickInTeam")&&(r.nickInTeam=e.nickInTeam),r}function TT(e){var t,r=["teamId"],n=["joinTime","updateTime","bitConfigMask"],i=["active","valid","mute"],o={type:aT},a=e.bits,s=Hl(e,["bits"]);return void 0!==a&&(s.muteTeam=1===Kp(a),s.bitConfigMask=a),s.id=s.teamId+"-"+s.account,Bn(r).call(r,(function(e){s[e]&&(s[e]=s[e].toString())})),Bn(n).call(n,(function(e){void 0!==s[e]&&(s[e]=Kp(s[e]))})),Bn(i).call(i,(function(e){void 0!==s[e]&&(s[e]=1===Kp(s[e]))})),Bn(t=pr(o)).call(t,(function(e){void 0!==s[e]&&(s[e]=o[e][s[e]]||s[e])})),s}function ST(e){return e&&e.length>0?au(e).call(e,(function(e){return TT(e)})):[]}function bT(e,t,r){return void 0===r&&(r="normal"),{id:e.teamId+"-"+t,teamId:e.teamId,account:t,type:r,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function CT(e,t,r){return void 0===r&&(r="normal"),t&&t.length>0?au(t).call(t,(function(t){return bT(e,t,r)})):[]}function ET(e){var t=sr({},e);return t.createTime&&(t.createTime=+t.createTime),t.updateTime&&(t.updateTime=+t.updateTime),t.gender&&(t.gender=tT[+t.gender]),t}!function(e){e[e.unknown=0]="unknown",e[e.male=1]="male",e[e.female=2]="female"}(tT||(tT={}));var _T={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember","8_126":"syncMyTeamMembers"},kT={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},RT=fh(kT),wT={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:RT.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:RT.team},{type:"Long",name:"timetag"}],ignoreErrCodes:[803]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:kT.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:RT.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:kT.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:RT.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:kT.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:RT.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:kT.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:RT.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:RT.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:kT.team}],response:[{type:"Long",name:"id"},{type:"Long",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:RT.team},{type:"LongArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:RT.teamMember},{type:"Long",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:RT.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:RT.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:kT.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:kT.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:RT.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:RT.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:RT.teamMember}]},syncMyTeamMembers:{sid:8,cid:126,ext:"sync",service:"team",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember",reflectMapper:RT.teamMember},{type:"Long",name:"timetag"}]}},AT={"3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},xT={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},NT=fh(xT),OT={syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:NT.user},{type:"Long",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:NT.relationMember},{type:"Long",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:NT.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:xT.user}],response:[{type:"Long",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:NT.user}]}},PT={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needForcePush:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},forcePushContent:{type:"string",allowEmpty:!1,required:!1}},LT={function:{type:"string",required:!1},topic:{type:"string",required:!1},customContent:{type:"string",required:!1},account:{type:"string",required:!1}};function VT(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return UT(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?UT(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function UT(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var DT={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:PT,robotInfo:LT,teamSpecializationInfo:{needACK:{type:"boolean"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},qT={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function BT(e,t){return Th[e.scene]+"-"+(e.to===t?e.from:e.to)}function FT(e,t){return e.from===t?e.to===t?"in":"out":"in"}function GT(e,t){var r=t.account,n=t.featureValue,i=t.statusValue,o=t.sessionAck,a=t.msgReceiptTime,s=Th[e.scene],c=e.to===r?e.from:e.to,u=Ch.default,d=bh.unread;Kp(e.isInBlackList)>0?(d=bh.refused,delete e.isInBlackList):d=e.from===r?a&&a>=+e.time?bh.receipt:bh.sent:o&&o>=+e.time?bh.read:bh.unread;var l=sr(sr({},wh(DT,e)),{scene:s,type:Mh[e.type],fromClientType:Sh[e.fromClientType],flow:FT(e,r),target:c,to:e.to,from:e.from,time:e.time?+e.time:void 0,userUpdateTime:e.userUpdateTime?+e.userUpdateTime:void 0,idClient:e.idClient,sessionId:s+"-"+c,status:bh[i||d],feature:Ch[n||u]});if("string"==typeof l.attach)try{l.attach=JSON.parse(l.attach)}catch(p){}return"notification"===l.type&&(l.attach=l.attach?function(e){var t,r={};if(r.type=qT[e.id]||e.id,!e.data)return r;var n,i={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},o=e.data;return Bn(t=pr(i)).call(t,(function(e){void 0!==o[e]&&(r[i[e]]=o[e])})),o.tinfo&&(r.team=vT(mh(o.tinfo,RT.team))),o.uinfos&&(r.users=au(n=o.uinfos).call(n,(function(e){return ET(mh(e,NT.user))}))),void 0!==o.mute&&(r.mute=1===Kp(o.mute)),r}(l.attach):{}),l}function jT(e,t){return e&&e.length>0?HT(au(e).call(e,(function(e){return GT(e,t)}))):[]}function HT(e){for(var t,r,n={},i=VT(e);!(r=i()).done;){var o=r.value,a=n[o.idClient];a&&a.time>o.time||(n[o.idClient]=o)}return au(t=pr(n)).call(t,(function(e){return n[e]}))}function WT(e,t){void 0===t&&(t=!0);var r=sr({},e);if(r.pushInfo&&t){for(var n in r.pushInfo)"boolean"==typeof r.pushInfo[n]?r[n]=r.pushInfo[n]?1:0:r[n]=r.pushInfo[n];delete r.pushInfo}return r.scene===Th.team&&r.needForcePush&&(r.forcePushContent=r.forcePushContent||r.pushContent,r.forcePushIDsList=r.forcePushIDsList?r.forcePushIDsList:"#%@all@%#"),r}function YT(e,t,r,n){e.onSendBefore,e.onUploadStart,e.onUploadDone;var i=e.replyMsg,o=Hl(e,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),a=sr(sr({},Nh(DT,o)),{scene:Th[e.scene],type:Mh[e.type],from:t,fromClientType:16,fromDeviceId:r,fromNick:null==n?void 0:n.nick,userUpdateTime:null==n?void 0:n.updateTime,status:bh[bh.sending]});if(a.idClient=a.resendFlag?e.idClient:Tp(),!a.idClient)throw new Cl("idClient is required to resend a message","idClient","required");return a=WT(a,!1),i&&(a.replyMsgFromAccount=i.from,a.replyMsgToAccount=i.to,a.replyMsgTime=+i.time,a.replyMsgIdServer=i.idServer,a.replyMsgIdClient=i.idClient,a.threadMsgFromAccount=i.from,a.threadMsgToAccount=i.to,a.threadMsgTime=+i.time,a.threadMsgIdServer=i.idServer,a.threadMsgIdClient=i.idClient,i.threadMessageInfo&&i.threadMessageInfo.threadMsgIdServer&&(a.threadMsgFromAccount=i.threadMessageInfo.threadMsgFromAccount,a.threadMsgToAccount=i.threadMessageInfo.threadMsgToAccount,a.threadMsgTime=i.threadMessageInfo.threadMsgTime,a.threadMsgIdServer=i.threadMessageInfo.threadMsgIdServer,a.threadMsgIdClient=i.threadMessageInfo.threadMsgIdClient)),a}function KT(e,t){return au(e).call(e,(function(e){var r;return r=t||(rT(Kp(e.scene))?e.scene:1===Kp(e.scene)?"p2p":"team"),{deletedTime:Kp(e.time),from:e.from,idClient:e.deletedIdClient||e.idClient,idServer:e.deletedIdServer||e.idServer,scene:r,time:Kp(e.deletedMsgCreateTime),to:e.to,ext:"string"==typeof e.ext?e.ext:null}}))}function QT(e){for(var t=[],r=(e=e||[]).length-1;r>=0;r--)t.push(e[r]);return t}var zT,JT,$T,XT=function(){function e(e){this.core=e}return e.prototype.processBroadcastMsg=function(e){var t=au(e).call(e,(function(e){return sr(sr({},e),{time:Kp(e.time)})}));return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:au(t).call(t,(function(e){return e.id}))}),t},e}(),ZT={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,required:!1}},eS={pushContent:8,pushPayload:9,needPush:107,needPushBadge:109,needPushNick:110},tS={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},rS=sr(sr({scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,__clientExt:{id:46,converter:yh,retConverter:Ih},needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needOffline:108,isReplyMsg:111,ackSnapshot:112},{pushContent:17,pushPayload:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,needPush:107,needPushBadge:109,needPushNick:110}),{function:47,topic:48,customContent:49,account:50}),nS={msg:rS,recallMsgTag:sr({time:0,type:1,to:2,from:3,ps:4,attach:5,deletedIdClient:10,deletedIdServer:11,deleteMsgCreatetime:14,opeAccount:16,env:21},eS),deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,deletedMsgCreateTime:6,time:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},iS=fh(nS),oS={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:nS.msg}],response:[{type:"Property",name:"msg",reflectMapper:iS.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:nS.msg}],response:[{type:"Property",name:"msg",reflectMapper:iS.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:nS.msg}],response:[{type:"Property",name:"msg",reflectMapper:iS.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:iS.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:iS.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:iS.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:iS.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:nS.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:nS.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:nS.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:nS.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:iS.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:iS.msgReceiptTag},{type:"Long",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:iS.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:iS.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:iS.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:iS.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:iS.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:iS.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:iS.deleteSelfMsgTag}]}};!function(e){e[e.none=0]="none",e[e.pass=1]="pass",e[e.decline=2]="decline",e[e.read=3]="read",e[e.deleted=4]="deleted",e[e.invalid=5]="invalid"}(zT||(zT={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(JT||(JT={})),function(e){e[e.applyTeam=0]="applyTeam",e[e.rejectTeamApply=1]="rejectTeamApply",e[e.teamInvite=2]="teamInvite",e[e.rejectTeamInvite=3]="rejectTeamInvite",e[e.friendRequest=5]="friendRequest",e[e.deleteFriend=6]="deleteFriend",e[e.recallMsgP2p=7]="recallMsgP2p",e[e.recallMsgTeam=8]="recallMsgTeam",e[e.recallMsgSuperTeam=12]="recallMsgSuperTeam",e[e.deleteMsgP2pOneWay=13]="deleteMsgP2pOneWay",e[e.deleteMsgTeamOneWay=14]="deleteMsgTeamOneWay",e[e.applySuperTeam=15]="applySuperTeam",e[e.rejectSuperTeamApply=16]="rejectSuperTeamApply",e[e.superTeamInvite=17]="superTeamInvite",e[e.rejectSuperTeamInvite=18]="rejectSuperTeamInvite",e[e.customP2p=100]="customP2p",e[e.customTeam=101]="customTeam",e[e.customSuperTeam=103]="customSuperTeam"}($T||($T={}));var aS={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},sS={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:ZT,recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgCreateTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function cS(e,t,r){var n=+e.type,i=bp($T,n);r=r||JT.default;var o,a,s,c,u=sr(sr({},wh(sS,e)),{type:i,time:+e.time,to:e.to,from:e.from,idServer:e.idServer,state:zT[zT.none],feature:JT[r]});if("0"===u.idServer&&u.setting&&(u.setting.needSaveOffline=!1),"string"==typeof u.attach)try{u.attach=JSON.parse(u.attach)}catch(o){t.error("formatSystemMessage: "+u.idServer+" parse attach error",o&&o.message)}return 5===n&&u.attach?(u.attach.type=aS[+u.attach.vt],"passFriendApply"===u.attach.type?u.state=zT[zT.pass]:"rejectFriendApply"===u.attach.type&&(u.state=zT[zT.decline])):n<=3&&u.attach&&(u.attach=(o=u.attach,a=o.attach,s=o.tinfo,(c=Hl(o,["attach","tinfo"])).ext=a,void 0!==s&&(c.team=vT(mh(o.tinfo,RT.team))),c)),u}function uS(e){var t=sr({},e);return sr(sr({},Nh(sS,t)),{type:$T[t.type],to:t.to,attach:t.attach})}function dS(e){return e===$T.recallMsgP2p?"p2p":e===$T.recallMsgTeam?"team":e===$T.recallMsgSuperTeam?"superTeam":""}var lS=function(e){function t(t){var r;return(r=e.call(this,"msg",t)||this).onV2SendMessage=function(e){var t=GT(e,{account:r.core.account,featureValue:Ch.default});t.status=e.status,r.core.eventBus.emit("session/updateForNewMsg",t)},r.onV2ModifyMessage=function(e){var t,n=Th[e.scene]+"-"+(e.to===r.core.account?e.from:e.to),i=null===(t=r.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:n}),o=GT(e,i?{account:r.core.account,sessionAck:i.ack,msgReceiptTime:i.msgReceiptTime}:{account:r.core.account});r.core.eventBus.emit("session/updateForModifyMsg",o)},r.onV2RecallMsg=function(e){var t=KT([e],dS(+e.type));r.core.eventBus.emit("session/updateForDeletedMsg",t)},r.onV2DeleteSelfMsgs=function(e){var t=KT(e);r.core.eventBus.emit("session/updateForDeletedMsg",t)},r.service=new XT(t),hh({cmdMap:tS,cmdConfig:oS}),r.registerListener(),r}er(t,e);var r=t.prototype;return r.registerListener=function(){this.core.eventBus.on("forwardReceive/msg/sendMsg",this.onV2SendMessage),this.core.eventBus.on("forwardReceive/msg/modifyMsg",this.onV2ModifyMessage),this.core.eventBus.on("forwardReceive/msg/recallMsg",this.onV2RecallMsg),this.core.eventBus.on("forwardReceive/msg/deleteSelfMsgs",this.onV2DeleteSelfMsgs)},r.sendTextMsg=function(e){return Al({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(sr(sr({},e),{type:"text"}))},r.sendTipMsg=function(e){return Al({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(sr(sr({},e),{type:"tip"}))},r.sendGeoLocationMsg=function(e){return Al({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},e),this.sendMsg(sr(sr({},e),{type:"geo",attach:Ti(e.attach)}))},r.sendCustomMsg=function(e){return Al({attach:{type:"string",allowEmpty:!1}},e),this.sendMsg(sr(sr({},e),{type:"custom"}))},r.sendMsg=function(e){var t,r=this;if(Al({scene:{type:"enum",values:Sp(Th)},type:{type:"enum",values:Sp(Mh)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:PT},robotInfo:{type:"object",required:!1,rules:LT},teamSpecializationInfo:{type:"object",required:!1,rules:{needACK:{type:"boolean",required:!1}}}},e),"team"===e.scene&&e.robotInfo&&!e.robotInfo.account)throw new Sl('When "scene" equals "team", account is required in robotInfo',{key:"account"},"required");var n,i="p2p"===e.scene?"sendMsg":"team"===e.scene?"sendTeamMsg":"sendSuperTeamMsg",o=YT(e,this.core.account,this.core.config.deviceId,null===(t=this.core.user)||void 0===t?void 0:t.myInfo),a=GT(sr(sr({},o),{time:(new Date).getTime()}),{account:this.core.account,featureValue:Ch.default,statusValue:bh.sending});try{e.onSendBefore&&e.onSendBefore(a)}catch(s){this.logger.error("sendMsg: options.onSendBefore error",s)}return this.core.eventBus.emit("session/updateForNewMsg",a),this.core.eventBus.emit("forwardSend/msg/sendMsg",o),this.core.sendCmd(i,{msg:o}).then((function(t){var i=t.content,s=t.error;if(n=i.msg,s)throw s;var c=GT(sr(sr({},o),i.msg),{account:r.core.account,featureValue:Ch.default,statusValue:bh.sent});return c.from===c.to&&r.markMsgsAck([c]),r.core.eventBus.emit("session/updateForNewMsg",c),r.core.eventBus.emit("forwardSend/msg/sendMsg",sr(sr({},YT(c,c.from,c.fromDeviceId)),{idClient:c.idClient,status:"sent"})),r.core.reporter.report("msgSend",{msgId:c.idServer,clientId:c.idClient,msgTime:c.time,fromAccid:"p2p"===e.scene?r.core.account:"",toAccid:c.to,type:Th[c.scene],roomId:"",tid:"p2p"===e.scene?"":c.to,result:200,failReason:"",rt:Ts()-a.time}),c})).catch((function(t){var i=GT(sr(sr(sr({},o),{time:(new Date).getTime()}),n),{account:r.core.account,featureValue:Ch.default,statusValue:7101===t.code?bh.refused:bh.sendFailed});throw t.msg=i,r.core.eventBus.emit("session/updateForNewMsg",i),r.core.eventBus.emit("forwardSend/msg/sendMsg",sr(sr({},YT(i,i.from,i.fromDeviceId)),{status:"sendFailed"})),r.core.reporter.report("msgSend",{msgId:i.idServer,clientId:i.idClient,msgTime:i.time,fromAccid:"p2p"===e.scene?r.core.account:"",toAccid:i.to,type:Th[i.scene],roomId:"",tid:"p2p"===e.scene?"":i.to,result:null==t?void 0:t.code,failReason:(null==t?void 0:t.message)||"",rt:Ts()-a.time}),t}))},r.resendMsg=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},e),r=e.msg,n=sr(sr({},r),{attach:r.attach?Ti(r.attach):void 0,setting:{resendFlag:!0}}),r.from===this.core.account){t.next=5;break}throw new Error("You can only resend messages that you sent: "+r.idClient);case 5:return t.abrupt("return",this.sendMsg(n));case 6:case"end":return t.stop()}}),t,this)})))},r.forwardMsg=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:Sp(Th)},to:{type:"string",allowEmpty:!1}},e),r=e.msg,n=sr(sr({},r),{scene:e.scene,to:e.to,attach:r.attach?Ti(r.attach):void 0}),t.abrupt("return",this.sendMsg(n));case 4:case"end":return t.stop()}}),t,this)})))},r.sendImageMsg=function(e){return this.doSendFile(sr(sr({},e),{type:"image"}))},r.sendFileMsg=function(e){return this.doSendFile(sr(sr({},e),{type:"file"}))},r.sendAudioMsg=function(e){return this.doSendFile(sr(sr({},e),{type:"audio"}))},r.sendVideoMsg=function(e){return this.doSendFile(sr(sr({},e),{type:"video"}))},r.doSendFile=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({scene:{type:"enum",values:Sp(Th)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e),r=e.attach){t.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){t.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return t.prev=5,t.next=8,this.core.cloudStorage.uploadFile(e);case 8:r=t.sent,t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(5),this.logger.error("sendFile:: upload File error or abort.",t.t0),t.t0;case 15:return t.abrupt("return",this.sendMsg(sr(sr({},e),{attach:Ti(r),type:e.type})));case 16:case"end":return t.stop()}}),t,this,[[5,11]])})))},r.recallMsg=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:Sp(Th)},time:{type:"number"}}},pushInfo:{type:"object",required:!1,rules:ZT},ps:{type:"string",allowEmpty:!1,required:!1}},e),r=e.msg,n={p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"},i={p2p:7,team:8,superTeam:12},o=WT({time:r.time,type:i[r.scene],to:r.to,from:r.from,ps:e.ps,attach:e.attach,deletedIdClient:r.idClient,deletedIdServer:r.idServer,opeAccount:r.from,env:e.env,pushInfo:e.pushInfo}),t.next=7,this.core.sendCmd(n[r.scene],{recallMsgTag:o});case 7:return a=sr({},r,{deletedMsgCreateTime:r.time}),s=KT([a]),this.core.eventBus.emit("session/updateForDeletedMsg",s),this.core.eventBus.emit("forwardSend/msg/recallMsg",o),t.abrupt("return",r);case 12:case"end":return t.stop()}}),t,this)})))},r.deleteSelfMsgs=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=e.msgs,n=au(r).call(r,(function(t){return{scene:"p2p"===t.scene?1:2,from:t.from,to:t.to,idServer:t.idServer,idClient:t.idClient,deletedMsgCreateTime:t.time,ext:e.ext}})),t.next=5,this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:n});case 5:return i=t.sent,o=au(n).call(n,(function(e){var t;return sr({},e,{time:null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.timetag})})),a=KT(o),this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.eventBus.emit("forwardSend/msg/deleteSelfMsgs",au(n).call(n,(function(e){var t;return sr(sr({},e),{time:null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.timetag})}))),t.abrupt("return",a);case 11:case"end":return t.stop()}}),t,this)})))},r.sendMsgReceipt=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Al({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),"p2p"===(i=e.msg).scene&&"in"===i.flow){n.next=5;break}return this.logger.warn("Msg scene: "+i.scene+", flow: "+i.flow+" is not allowed to send msg receipt"),n.abrupt("return",void 0);case 5:return o={to:i.target,idClient:i.idClient,time:i.time},n.next=8,this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:o});case 8:return a=n.sent,s=Kp(null===(r=null===(t=a.content)||void 0===t?void 0:t.msgReceiptTag)||void 0===r?void 0:r.time),n.abrupt("return",sr(sr({},o),{time:s?Math.min(s,o.time):o.time}));case 11:case"end":return n.stop()}}),n,this)})))},r.sendTeamMsgReceipt=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},e),r=e.teamMsgReceipts,this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:r}),t.abrupt("return",void 0);case 4:case"end":return t.stop()}}),t,this)})))},r.getTeamMsgReads=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),n=e.teamMsgReceipts,r.next=4,this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:n});case 4:return i=r.sent,o=(o=null===(t=i.content)||void 0===t?void 0:t.teamMsgReceipts)?au(o).call(o,(function(e){return sr(sr({},e),{read:Kp(e.read),unread:Kp(e.unread)})})):[],r.abrupt("return",o);case 8:case"end":return r.stop()}}),r,this)})))},r.getTeamMsgReadAccounts=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),r=e.teamMsgReceipt,t.next=4,this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:r});case 4:return n=t.sent,t.abrupt("return",n.content);case 6:case"end":return t.stop()}}),t,this)})))},r.markMsgsAck=function(e){if(e&&e.length>0){var t=[],r=[];Bn(e).call(e,(function(e){"p2p"===e.scene&&"in"===e.flow?t.push(e):"team"===e.scene&&"in"===e.flow&&r.push(e)})),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:au(t).call(t,(function(e){return e.idServer}))}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:au(r).call(r,(function(e){return e.idServer}))})}},r.onMsgHandler=function(e){var t;if(e.error)this.logger.error("msgHandler::recvError",e.error);else{var r="number"==typeof Qp(e,"raw.r[0]")?""+e.raw.r[0]:void 0,n=e.content.msg;n.idServer=n.idServer||r;var i=BT(n,this.core.account),o=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:i}),a=GT(n,o?{account:this.core.account,sessionAck:o.ack,msgReceiptTime:o.msgReceiptTime}:{account:this.core.account});this.logger.getDebugMode()?this.logger.debug("msgHandler::recvMsg",a.idClient,a.idServer,a):this.logger.log("msgHandler::recvMsg",a.idClient,a.idServer),this.markMsgsAck([a]),this.core.eventBus.emit("session/updateForNewMsg",a),"superTeam"===a.scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:a.time}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:a.time}),this.core.emit("msg",a),"notification"===a.type?this.core.eventBus.emit("team/onNotification",a):"out"!==a.flow&&this.doMsgReceiveReport(a,e),"notification"!==a.type&&this.core.user.checkUserUpdate(a)}},r.doMsgReceiveReport=function(e,t){if(e.from!==this.core.account){var r="p2p"===e.scene,n=Qp(e,"__clientExt.statistics.apiCallingTime")||0,i=Qp(e,"__clientExt.statistics.sendTime")||0,o=Qp(e,"__clientExt.statistics.attachUploadDuration")||0,a=this.core.timeOrigin.getNTPTime(),s=e.time,c=this.core.timeOrigin.checkNodeReliable(t.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(t.__receiveTimeNode):a;this.core.reporter.report("msgReceive",{msgId:e.idServer,clientId:e.idClient,serverTime:s,receiveTime:c,fromAccid:r?e.from:"",toAccid:e.to,type:Th[e.scene],tid:r?"":e.to,apiCallingTime:n,sendTime:i,attachUploadDuration:o,callbackTime:a,preHandleTime:a,result:200,failReason:"",rt:a-s})}},r.nimOnTeamMsgsHandler=function(e){var t,r=this;Bn(t=e.content.datas).call(t,(function(t){r.onMsgHandler(sr({},e,{content:{msg:t}}))}))},r.syncRoamingMsgsHandler=function(e){var t,r,n=e.content.msgs||[];if(0!==n.length){var i=BT(n[0],this.core.account),o=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:i}),a=(n=jT(n,o?{account:this.core.account,featureValue:Ch.roam,sessionAck:o.ack,msgReceiptTime:o.msgReceiptTime}:{account:this.core.account,featureValue:Ch.roam}))[0].time,s={timetag:a,sessionId:i,msgs:QT(n)};"function"!=typeof(null===(r=this.core.sync)||void 0===r?void 0:r.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.core.eventBus.emit("session/syncMsgs",s),this.core.emit("syncRoamingMsgs",s),"superTeam"===n[0].scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:a}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:a})}},r.syncOfflineMsgsHandler=function(e){var t,r=this,n=e.content.msgs||[];if(0!==n.length){var i={},o=[];Bn(n).call(n,(function(e){var t=BT(e,r.core.account),n=r.core.session.getSessionWithUncomplete({id:t}),a=GT(e,n?{account:r.core.account,featureValue:Ch.leave,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:r.core.account,featureValue:Ch.leave});o.push(a),i[a.sessionId]?i[a.sessionId].push(a):i[a.sessionId]=[a]})),this.markMsgsAck(o);var a=0;Bn(t=pr(i)).call(t,(function(e){var t,n=xm(t=i[e]).call(t,(function(e,t){return t.time-e.time}));(n=HT(n))[0].time>a&&(a=n[0].time);var o={timetag:n[0].time,sessionId:e,msgs:n};r.core.eventBus.emit("session/syncMsgs",o),r.core.emit("syncOfflineMsgs",o)})),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:a})}},r.syncDeleteSelfMsgsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.deletedMsgs;r&&r.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var n=r[r.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:n})},r.onDeleteSelfMsgHandler=function(e){var t=KT([e.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)},r.onDeleteSelfMsgsHandler=function(e){var t=KT(e.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)},r.onBroadcastMsgHandler=function(e){var t=e.content.msg,r=this.service.processBroadcastMsg([t]);this.core.emit("broadcastMsgs",r)},r.syncBroadcastMsgHandler=function(e){var t=e.content.msgs,r=this.service.processBroadcastMsg(t);this.core.emit("broadcastMsgs",r)},t}(Xh),pS={"5_1":"sync"},mS={sync:{sid:5,cid:1,service:"sync",hasPacketTimer:!1,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Long",name:"timetag"}]}},hS=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"sync",t)||this).syncDoneFlag=!1,n.config={myInfo:!!t.user.name,offlineMsgs:!!t.msg.name,teams:!!t.team.name,myTeamMembers:!!t.team.name,roamingMsgs:!!t.msg.name,relations:!!t.user.name,friends:!!t.friend.name,friendUsers:!!t.user.name,msgReceipts:!!t.msg.name,broadcastMsgs:!!t.msg.name,recallMsg:!!t.msg.name,sessionAck:!!t.session.name,superTeamSessionAck:!!t.session.name,superTeams:!!t.superTeam.name,mySuperTeamMembers:!!t.superTeam.name,superTeamRoamingMsgs:!!t.superTeam.name,deleteSuperTeamMsg:!!t.superTeam.name,deleteSelfMsgs:!!t.msg.name,sessionHistoryMsgsDelete:!!t.msgLog.name,avSignal:!!t.signaling.name},n.setOptions(r),n.timetags={},n.initEventListeners(),hh({cmdMap:pS,cmdConfig:mS}),n}er(t,e);var r=t.prototype;return r.setOptions=function(e){sr(this.config,e)},r.reset=function(){this.timetags={},this.syncDoneFlag=!1},r.getSyncDoneFlag=function(){return this.syncDoneFlag},r.doSync=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.genSyncParams(),this.logger.log("sync::doSyncV1: ",r),t.prev=2,t.next=5,this.core.clientSocket.sendCmd("sync",{sync:r});case 5:n=t.sent,this.core.logger.log("sync::doSyncV1 done in",null===(e=n.content)||void 0===e?void 0:e.timetag),this.syncDoneFlag=!0,this.core.emit("syncdone"),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(2),this.core.logger.error("sync::doSyncV1 error",t.t0),this.syncDoneFlag=!0,this.core.emit("syncdone"),t.abrupt("return");case 17:case"end":return t.stop()}}),t,this,[[2,11]])})))},r.initEventListeners=function(){var e=this;this.core.eventBus.on("logined",(function(){e.syncDoneFlag=!1,e.doSync()})),this.core.eventBus.on("sync/updateTimetag",(function(t){var r;Bn(r=pr(t)).call(r,(function(r){t[r]>(e.timetags[r]||0)&&(e.timetags[r]=t[r])}))}))},r.genSyncParams=function(){var e,t,r=this;return fl(e=lu(t=pr(this.config)).call(t,(function(e){var t=e;return r.config[t]}))).call(e,(function(e,t){var n=t;return e[n]=r.timetags[n]||0,e}),{})},r.handleImmediate=function(e){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),ls.resolve(e)},r.delaySyncDone=function(e){var t=this;return"ALI"===Ep()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new ls((function(r){Ls((function(){t.handleImmediate(e).then((function(){r(e)}))}),100)}))):this.handleImmediate(e)},r.syncHandler=function(e){return this.delaySyncDone(e)},t}(Xh);function fS(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return gS(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function gS(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var vS=function(e){function t(t){var r;return(r=e.call(this,"user",t)||this).userInfoMap=new rd,r.myInfo=ET({}),hh({cmdMap:AT,cmdConfig:OT}),r}er(t,e);var r=t.prototype;return r.setBlack=function(e){var t=this;return Al({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),this.core.sendCmd("setBlack",e).then((function(){t.core.eventBus.emit("forwardSend/user/updateBlackList",e.account,e.isAdd)}))},r.setMute=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),t.next=3,this.core.sendCmd("setMute",e).then((function(){}));case 3:this.core.eventBus.emit("forwardSend/user/setMute",e.account,e.isAdd);case 4:case"end":return t.stop()}}),t,this)})))},r.getRelations=function(){return this.core.sendCmd("syncRelations",{timetag:0})},r.getBlackList=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=e.sent,e.abrupt("return",t.blackList||[]);case 4:case"end":return e.stop()}}),e,this)})))},r.getMuteList=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=e.sent,e.abrupt("return",t.muteList||[]);case 4:case"end":return e.stop()}}),e,this)})))},r.updatePushToken=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return e.stop()}}),e,this)})))},r.updateAppBackground=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return e.stop()}}),e,this)})))},r.getUsersNameCardFromServer=function(e){var t=this;return Al({accounts:{type:"array",max:150,itemType:"string"}},e),this.core.sendCmd("getUsersNameCardFromServer",eg(e,["accounts"])).then((function(r){var n,i=r.content;return t.logger.log("user:: getUsers done",e.accounts),i&&i.users?au(n=i.users).call(n,(function(e){return ET(e)})):[]}))},r.updateMyNameCard=function(e){var t=this;if(Al({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:Sp(tT),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},e),0===pr(e).length)return ls.resolve(this.myInfo);var r=eg(e,["nick","avatar","signature","email","birth","tel","ext"]);return e.gender&&(r.gender=tT[e.gender]),this.core.sendCmd("updateMyNameCard",{user:r}).then((function(n){var i=n.content;return i&&i.timetag&&t.core.eventBus.emit("sync/updateTimetag",{myInfo:+i.timetag}),e.gender&&(r.gender=e.gender),t.myInfo=sr({},t.myInfo,r),t.core.eventBus.emit("forwardSend/user/updateUserInfo",r),t.myInfo}))},r.checkUserUpdate=function(e){var t=e.from;if(t!==this.core.account){var r=this.userInfoMap.get(t);if(r){var n=r.updateTime,i=e.userUpdateTime;!isNaN(n)&&!isNaN(i)&&"number"==typeof n&&"number"==typeof i&&n<i&&this.refreshUserInfo(t)}else this.refreshUserInfo(t)}},r.refreshUserInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getUsersNameCardFromServer({accounts:[e]});case 2:for(r=t.sent,n=fS(r);!(i=n()).done;)o=i.value,this.userInfoMap.set(o.account,o),this.core.emit("updateUserInfo",o);case 4:case"end":return t.stop()}}),t,this)})))},r.onUpdateBlackListHandler=function(e){var t=e.content;t.account?this.core.emit("updateBlackList",t):this.logger.warn("onUpdateBlackListHandler: no account")},r.onUpdateMuteListHandler=function(e){var t=e.content;t.account?this.core.emit("updateMuteList",t):this.logger.warn("onUpdateBlackListHandler: no account")},r.syncRelationsHandler=function(e){var t=e.content,r=t.list,n=t.timetag,i={blackList:[],muteList:[]};return n&&this.core.eventBus.emit("sync/updateTimetag",{relations:n}),r&&r.length&&Bn(r).call(r,(function(e){var t,r,n=(r={account:(t=e).account,updateTime:+t.updateTime,createTime:+t.createTime},"1"===t.isMuted&&(r.isMuted=!0),"1"===t.isBlack&&(r.isBlack=!0),r);n.isBlack&&i.blackList.push(n),n.isMuted&&i.muteList.push(n)})),this.core.emit("relations",i),ls.resolve(i)},r.syncMyNameCardHandler=function(e){e.content.user&&(this.myInfo=ET(e.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:e.content.timetag}))},r.onUpdateMyNameCardHandler=function(e){var t=e.content.user;t?(sr(this.myInfo,ET(t)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")},t}(Xh),yS={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},IS={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},MS=fh(IS),TS={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:MS.msgReceiptTag},{type:"Long",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Long",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:MS.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:IS.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:IS.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:MS.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:IS.stickTopSessionTag}],response:[{type:"Long",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:IS.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:MS.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:MS.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:MS.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:MS.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:MS.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:IS.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:4,cid:22,service:"session",response:[]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[]}},SS={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function bS(e,t,r){void 0===r&&(r=!0);var n=wh(SS,e);n.isStickOnTop=r,n.id=t.id,r||(n.ext="");var i=sr(sr({},t),{stickTopInfo:t.stickTopInfo?sr({},t.stickTopInfo,n):n});return void 0===i.lastMsg&&(i.lastMsg=null),i}var CS=function(){function e(e){this.core=e}var t=e.prototype;return t.getSession=function(e){return this.core.session.getSessionWithUncomplete({id:e})||this.core.session.createSession(e)},t.addStickTopSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),r=Cp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimAddStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i,ext:e.ext||""}});case 4:return o=t.sent,a=this.getSession(e.id),s=bS(o.content.data,a),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))},t.deleteStickTopSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({id:{type:"string",allowEmpty:!1}},e),r=Cp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i}});case 4:return o=t.sent,a=this.getSession(e.id),s=bS({updateTime:o.content.timetag,ext:""},a,!1),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))},t.updateStickTopSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),r=Cp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i,ext:e.ext||""}});case 4:return o=t.sent,a=this.getSession(e.id),s=bS(o.content.data,a),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))},t.stickTopSessionHandler=function(e,t){void 0===t&&(t=!0);var r=Cp(e.id,"|"),n=r.scene+"-"+r.accid;return bS(e,this.getSession(n),t)},e}(),ES=function(){function e(e){this.core=e,this.logger=e.logger}var t=e.prototype;return t.canSessionResetUnreadCount=function(e){var t=e.id;if(void 0===e.lastMsg)throw new Error("Session::canSessionResetUnreadCount: session "+t+" is not completly, lastMsg undefined");return null!==e.lastMsg||e.unread>0?!(e.ack&&e.lastMsg&&e.ack>=e.lastMsg.time&&(this.logger.log("Session::canSessionResetUnreadCount: session "+t+" reset failed, ack time is greater than last message time"),1)):(this.logger.log("Session::canSessionResetUnreadCount: session "+t+" doesn't need to be updated, lastMsg null and unread 0"),!1)},t.filterSessionForResetUnreadCount=function(e){var t=this,r={cmd:"markMultSuperTeamSessionsAck",params:[]},n={cmd:"markMultSessionsAck",params:[]};return Bn(e).call(e,(function(e){var i,o;try{if(!t.canSessionResetUnreadCount(e))return;var a=Cp(e.id),s=a.accid,c=a.scene,u={to:s,sessionId:e.id,timetag:(null===(i=null==e?void 0:e.lastMsg)||void 0===i?void 0:i.time)||e.updateTime||0},d=Nh({scene:{type:"enum",values:Th}},o={scene:c});"superTeam"===c?r.params.push(u):n.params.push(sr(sr({},u),d))}catch(o){t.logger.warn(o)}})),{superTeam:r,p2pOrTeam:n}},e}();function _S(e,t){e=e||[],t=t||1,t=Math.max(Math.floor(t),1);for(var r=[],n=0;n<e.length;n+=t)r.push(Fc(e).call(e,n,n+t));return r}function kS(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return RS(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?RS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function RS(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var wS=function(e){function t(t,r){var n;return(n=e.call(this,"session",t)||this).list=new rd,n.unreadCountFilterFn=function(e){return!0},n.lastMessageFilterFn=function(e){return!0},n.initEventListeners(),hh({cmdMap:yS,cmdConfig:TS}),n.stickTopService=new CS(t),n.unreadModule=new ES(t),r&&n.setOptions(r),n}er(t,e);var r=t.prototype;return r.setOptions=function(e){"function"==typeof(null==e?void 0:e.unreadCountFilterFn)&&(this.unreadCountFilterFn=e.unreadCountFilterFn),"function"==typeof(null==e?void 0:e.lastMessageFilterFn)&&(this.lastMessageFilterFn=e.lastMessageFilterFn)},r.reset=function(){var e;Bn(e=this.list).call(e,(function(e){e.unreadMsgs=[]})),this.list.clear()},r.initEventListeners=function(){var e,t,r,n,i=this;this.core.eventBus.on("session/syncMsgs",Xt(e=this.onSyncMsgs).call(e,this)),this.core.eventBus.on("session/updateForNewMsg",Xt(t=this.updateSessionWithMsg).call(t,this)),this.core.eventBus.on("session/updateForModifyMsg",Xt(r=this.updateSessionByModifyMsg).call(r,this)),this.core.eventBus.on("session/updateForClearMsg",(function(e,t){void 0===t&&(t=!0),e&&e.length>0&&Bn(e).call(e,(function(e){i.updateSession({id:e.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},t)}))})),this.core.eventBus.on("session/updateForDeletedMsg",Xt(n=this.updateSessionForDeletedMsg).call(n,this))},r.createSession=function(e,t){try{var r=Cp(e);return{id:e,scene:r.scene,to:r.accid,lastMsg:t,updateTime:t?t.time:0,unread:0,unreadMsgs:[],ack:0}}catch(n){throw this.logger.error("Failed to create session with "+e,n),new Error("Failed to create session with "+e)}},r.getSession=function(e){Al({id:{type:"string",allowEmpty:!1}},e);var t=this.list.get(e.id);if(this.isSessionComplete(t))return t},r.getSessionWithUncomplete=function(e){return this.list.get(e.id)},r.getAllSessions=function(){for(var e,t=[],r=kS(this.list);!(e=r()).done;){var n=e.value;n[0];var i=n[1];this.isSessionComplete(i)&&t.push(i)}return t},r.getSessions=function(e){Al({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},e);var t=[],r=e.limit,n=void 0===r?100:r,i=e.desc,o=void 0===i||i,a=e.lastSessionId,s=0;if(o){for(var c,u,d=kS(this.list);!(u=d()).done;){var l=u.value,p=l[0],m=l[1];if(a===p)break;this.isSessionComplete(m)&&t.push(m)}return Pc(c=Fc(t).call(t,-n)).call(c)}for(var h,f=kS(this.list);!(h=f()).done;){var g=h.value,v=g[0],y=g[1];if(a)v===a&&(a=void 0);else if(this.isSessionComplete(y)){if(++s>n)break;t.push(y)}}return t},r.resetSessionUnreadCount=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u,d,l=this;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Al({id:{type:"string",allowEmpty:!1}},e),Al({id:{type:"string",allowEmpty:!1}},e),n=e.id,i=this.list.get(n)){r.next=7;break}throw this.logger.warn("resetSessionUnreadCount: can not find session "+n),new Error("Session::canSessionResetUnreadCount: can not find session "+n);case 7:o=!1;try{o=this.unreadModule.canSessionResetUnreadCount(i)}catch(p){this.logger.warn(p)}if(!1!==o){r.next=11;break}return r.abrupt("return");case 11:return a=Cp(n),s=a.accid,c=a.scene,u={to:s,timetag:(null===(t=null==i?void 0:i.lastMsg)||void 0===t?void 0:t.time)||i.updateTime||0},d="markSuperTeamSessionAck","superTeam"!==c&&(u.scene="p2p"===c?0:1,d="markSessionAck"),r.abrupt("return",this.core.sendCmd(d,u).then((function(){var e=l.storeUnreadByAck(n,u.timetag);e&&l.core.emit("updateSession",e)})));case 16:case"end":return r.stop()}}),r,this)})))},r.resetMultiSessionUnreadCount=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p,m,h,f,g=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Al({ids:{type:"array",itemType:"string",min:1}},e),i=lu(r=au(n=e.ids).call(n,(function(e){return g.list.get(e)}))).call(r,(function(t,r){return!!t||(g.logger.warn("Session::canSessionResetUnreadCount: can not find session "+e.ids[r]),!1)})),o=this.unreadModule.filterSessionForResetUnreadCount(i),a=o.superTeam,s=o.p2pOrTeam,c=_S(a.params,50),u=_S(s.params,50),d=kS(c);case 6:if((l=d()).done){t.next=13;break}return p=l.value,t.next=10,this.core.sendCmd(a.cmd,{datas:p});case 10:Bn(p).call(p,(function(e){var t=g.storeUnreadByAck(e.sessionId,e.timetag);t&&g.core.emit("updateSession",t)}));case 11:t.next=6;break;case 13:m=kS(u);case 14:if((h=m()).done){t.next=21;break}return f=h.value,t.next=18,this.core.sendCmd(s.cmd,{datas:f});case 18:Bn(f).call(f,(function(e){var t=g.storeUnreadByAck(e.sessionId,e.timetag);t&&g.core.emit("updateSession",t)}));case 19:t.next=14;break;case 21:case"end":return t.stop()}}),t,this)})))},r.resetAllSessionsUnreadCount=function(){var e,t=[];return Bn(e=this.list).call(e,(function(e){t.push(e.id)})),0===t.length?ls.resolve():this.resetMultiSessionUnreadCount({ids:t})},r.deleteSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},e),this.list.delete(e.id),!this.core.msgLog||!e.isSyncToServer){t.next=5;break}return t.next=5,this.core.msgLog.deleteRoamingMsgs({ids:[e.id]});case 5:case"end":return t.stop()}}),t,this)})))},r.deleteAllSessionsFromLocal=function(){this.list.clear()},r.addStickTopSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.addStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.deleteStickTopSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.deleteStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.updateStickTopSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.updateStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.nimMultiSyncAddStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimMultiSyncDeleteStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler({id:e.content.data.id,updateTime:e.content.timetag,ext:""},!1);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimMultiSyncUpdateStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimSyncStickTopSessionsHandler=function(e){var t,r=this;if(this.core.eventBus.emit("sync/updateTimetag",{stickTopSessions:e.content.timetag}),e.content.isThereAnyChange){var n=e.content.datas,i=[];Bn(t=this.list).call(t,(function(e){var t;e&&(null===(t=null==e?void 0:e.stickTopInfo)||void 0===t?void 0:t.isStickOnTop)&&i.push(e)})),Bn(i).call(i,(function(e){var t=e.id;if(!eh(n).call(n,(function(e){var r=Cp(e.id,"|");return r.scene+"-"+r.accid===t}))){var r={},i=Cp(t,"-"),o=i.scene,a=i.accid;r.id=o+"|"+a,r.ext="",r.isTop=!1,n.push(r)}})),Bn(n).call(n,(function(e){var t;!1===e.isTop?(delete e.isTop,t=r.stickTopService.stickTopSessionHandler(e,!1)):t=r.stickTopService.stickTopSessionHandler(e),r.list.set(t.id,t)}))}},r.updateSessionWithMsg=function(e){var t,r,n=!0,i=!0,o="boolean"!=typeof(null===(t=e.pushInfo)||void 0===t?void 0:t.needPushBadge)||(null===(r=e.pushInfo)||void 0===r?void 0:r.needPushBadge);try{n=!!this.unreadCountFilterFn(e)}catch(u){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",u)}try{i=!!this.lastMessageFilterFn(e)}catch(u){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",u)}var a=this.list.get(e.sessionId)||this.createSession(e.sessionId),s=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",e.sessionId,e.idClient,e.idServer,i,n),i&&(!a.lastMsg||a.lastMsg.time<e.time||e.status===bh[bh.sending]||a.lastMsg.status===bh[bh.sending])&&(a.lastMsg=e,a.updateTime=e.time,s=!0),n&&o&&e.status===bh[bh.unread]&&e.time>(a.ack||0)){a.unread++;var c=a.unreadMsgs||[];c.unshift(e),xm(c).call(c,(function(e,t){return t.time-e.time})),a.unreadMsgs=c,s=!0}s&&(this.logger.log("session:updateSessionWithMsg updating ",a.id,a.unread,a.lastMsg&&a.lastMsg.idClient),this.list.set(a.id,a),this.core.emit("updateSession",a))},r.updateSessionByModifyMsg=function(e){var t=this.list.get(e.sessionId)||this.createSession(e.sessionId),r=t.unreadMsgs||[],n=Wn(r).call(r,(function(t){return t.idClient===e.idClient}));n>-1&&(r[n]=e),t.unreadMsgs=r,this.list.set(t.id,t);var i=!0;try{i=!!this.lastMessageFilterFn(e)}catch(o){this.logger.error("session:updateSessionByModifyMsg, lastMessageFilterFn error",o)}i&&(t.lastMsg&&t.lastMsg.idClient!==e.idClient||(t.lastMsg=e,t.updateTime=e.time,this.logger.log("session:updateSessionByModifyMsg updating ",t.id,t.unread,t.lastMsg&&t.lastMsg.idClient),this.list.set(t.id,t),this.core.emit("updateSession",t)))},r.storeUnreadByAck=function(e,t){var r=this.list.get(e)||this.createSession(e);if(!(r.ack&&t<r.ack)){var n=r.unreadMsgs||[],i=[],o=[],a=0;return r.unreadMsgs=[],n.length>0&&(Bn(n).call(n,(function(e){tu(o).call(o,e.idClient)||e.time>t&&(a++,o.push(e.idClient),i.push(e))})),r.unreadMsgs=xm(i).call(i,(function(e,t){return t.time-e.time}))),r.ack=t,r.unread=a,r.lastMsg&&"unread"===r.lastMsg.status&&t>=r.lastMsg.time&&(r.lastMsg.status="read"),this.list.set(e,r),r}this.logger.warn("storeUnreadByAck: not need update ack",e,t,r.ack)},r.updateSession=function(e,t){void 0===t&&(t=!0);var r=e.id,n=this.list.get(r)||this.createSession(e.id),i=sr(n,e);return this.list.set(r,i),this.logger.log("updateSession: update",t,eg(e,["id","ack","unread"]),i.lastMsg&&i.lastMsg.idClient),t&&this.core.emit("updateSession",i),i},r.isSessionComplete=function(e){return!!e&&!!(e.id&&e.scene&&e.to)&&void 0!==e.lastMsg},r.syncSessionAckHandler=function(e){var t,r,n=this,i=e.content.p2p||{},o=e.content.team.m_map||{};this.logger.log("syncSessionAck::",i,o),Bn(t=pr(i)).call(t,(function(e){n.updateSession({id:"p2p-"+e,ack:i[e]},!1)})),Bn(r=pr(o)).call(r,(function(e){n.updateSession({id:"team-"+e,ack:o[e]},!1)}))},r.syncSuperTeamSessionAckHandler=function(e){var t,r=this,n=e.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",n),Bn(t=pr(n)).call(t,(function(e){r.updateSession({id:"superTeam-"+e,ack:n[e]},!1)}))},r.syncMarkSessionAckHandler=function(e){var t=e.content,r=(0===t.scene?"p2p":1===t.scene?"team":"superTeam")+"-"+t.to,n=this.list.get(r);if(n&&n.ack&&t.timetag<n.ack)this.logger.warn("syncMarkSessionAckHandler: "+r+" do not need update ack",n.ack,t.timetag);else{var i=this.storeUnreadByAck(r,t.timetag);i&&this.core.emit("updateSession",i)}},r.syncMarkSuperTeamSessionAckHandler=function(e){e.content.scene=5,this.syncMarkSessionAckHandler(e)},r.onSyncDone=function(){var e,t,r,n=this,i=[];Bn(e=this.list).call(e,(function(e,t){i.push(n.storeUnreadByAck(t,e.ack||0))})),this.list.clear(),Bn(t=xm(i).call(i,(function(e,t){return e.updateTime-t.updateTime}))).call(t,(function(e){n.list.set(e.id,e)})),(i=xm(r=lu(i).call(i,(function(e){return n.isSessionComplete(e)}))).call(r,(function(e,t){return t.updateTime-e.updateTime}))).length>0&&this.core.emit("sessions",i)},r.onSyncMsgs=function(e){var t,r=this,n=this.list.get(e.sessionId),i=[];try{var o;i=lu(o=e.msgs).call(o,(function(e){var t,n,i="boolean"!=typeof(null===(t=e.pushInfo)||void 0===t?void 0:t.needPushBadge)||(null===(n=e.pushInfo)||void 0===n?void 0:n.needPushBadge);return r.unreadCountFilterFn(JSON.parse(Ti(e)))&&i}))}catch(d){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",d)}var a,s=[];try{var c;s=lu(c=e.msgs).call(c,(function(e){return r.lastMessageFilterFn(JSON.parse(Ti(e)))}))}catch(d){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",d)}s&&s.length>0&&(a=s[s.length-1],a=s[0].time>a.time?s[0]:a);var u=a?a.time:0;n||(n=a?this.createSession(e.sessionId,a):this.createSession(e.sessionId)),n.unreadMsgs=n.unreadMsgs?lu(t=Rs(i).call(i,n.unreadMsgs)).call(t,(function(e){return e.status===bh[bh.unread]})):lu(i).call(i,(function(e){return e.status===bh[bh.unread]})),n.updateTime&&n.updateTime>=u||(n.updateTime=u),n.lastMsg&&n.lastMsg.time>=u||(n.lastMsg=a),this.list.set(n.id,n)},r.updateSessionForDeletedMsg=function(e){var t,r=this,n={};Bn(e).call(e,(function(e){var t,i=e.to===r.core.account?e.from:e.to,o=e.scene+"-"+i,a=r.list.get(o);if(a){var s=Um(t=a.unreadMsgs).call(t,(function(t){return t.idClient===e.idClient})),c=!0;try{c=!!r.unreadCountFilterFn(e)}catch(p){r.logger.error("session:updateSessionForDeletedMsg, unreadCountFilterFn error",p)}var u=a.ack||0;if(c&&s&&u<e.time&&e.from!==r.core.account&&a.unread>0&&(a.unread=a.unread-1,a.unreadMsgs&&a.unreadMsgs.length>0)){var d,l=function(e,t){e=e||[],t=t||{};for(var r=0;r<e.length;r++){var n=!0;for(var i in t)if(e[r][i]!==t[i]){n=!1;break}if(n)return r}return-1}(a.unreadMsgs,{idClient:e.idClient});l>=0&&si(d=a.unreadMsgs).call(d,l,1)}a.lastMsg&&a.lastMsg.idClient===e.idClient&&(a.lastMsg=null),n[a.id]=!0}})),Bn(t=pr(n)).call(t,(function(e){var t=r.list.get(e);t&&r.core.emit("updateSession",t)}))},r.multiSyncMsgReceiptHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.msgReceiptTag;if(r){this.updateSessionMsgReceiptTime([r],!0),r.msgReceiptTime=r.time,r.sessionId="p2p-"+r.from,r.time,r.from;var n=Hl(r,["time","from"]);this.core.emit("msgReceipts",[n])}},r.syncMsgReceiptsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.msgReceipts;r&&this.updateSessionMsgReceiptTime(r,!1)},r.updateSessionMsgReceiptTime=function(e,t){var r=this;void 0===t&&(t=!0),e&&e.length>0&&Bn(e).call(e,(function(e){var n=r.list.get("p2p-"+e.from);n||(n=r.createSession("p2p-"+e.from));var i=Kp(e.time);n.msgReceiptTime&&n.msgReceiptTime>=i||(n.msgReceiptTime=i,n.lastMsg&&"sent"===n.lastMsg.status&&i>=n.lastMsg.time&&(n.lastMsg.status="receipt"),r.logger.log("session: update session "+n.id+" msgReceiptTime: "+n.msgReceiptTime),r.list.set(n.id,n),t&&r.core.emit("updateSession",n))}))},t}(Xh),AS=function(){function e(e){this.core=e}var t=e.prototype;return t.notifyAddTeamMembers=function(e,t){this.core.emit("addTeamMembers",{team:e,accounts:t,members:CT(e,t)})},t.notifyUpdateTeamManagers=function(e,t,r,n){this.core.emit("updateTeamManagers",{team:{teamId:e,memberUpdateTime:n},accounts:t,isManager:r,members:au(t).call(t,(function(t){return{id:e+"-"+t,account:t,type:r?"manager":"normal",updateTime:n}}))})},t.notifyRemoveTeamMembers=function(e,t){this.core.emit("removeTeamMembers",{team:e,accounts:t})},t.notifyTransferTeam=function(e,t,r){this.core.emit("transferTeam",{team:e,from:{id:e.teamId+"-"+t,type:"normal",account:t,updateTime:e.memberUpdateTime},to:{id:e.teamId+"-"+r,type:"owner",account:r,updateTime:e.memberUpdateTime}})},t.notifyUpdateTeamMembersMute=function(e,t,r){this.core.emit("updateTeamMembersMute",{team:e,accounts:t,members:au(t).call(t,(function(t){return{id:e.teamId+"-"+t,account:t,teamId:e.teamId,mute:r,updateTime:e.memberUpdateTime}})),mute:r})},e}();function xS(e,t){if((t=new rd).get(e))return e;if(e instanceof RegExp)return new RegExp(e);if(e instanceof Date)return new Date(e.getTime());if(Si(e))return t.set(e,!0),au(e).call(e,(function(e){return xS(e,t)}));if("object"==typeof e&&null!==e){var r;t.set(e,!0);var n={};return Bn(r=pr(e)).call(r,(function(r){n[r]=xS(e[r],t)})),n}return e}var NS=function(e){function t(t){var r;return(r=e.call(this,"team",t)||this).myTeamMembersMap=new rd,r.service=new AS(t),r.setListeners(),hh({cmdMap:_T,cmdConfig:wT}),r}er(t,e);var r=t.prototype;return r.setListeners=function(){var e=this;this.core.eventBus.on("forwardReceive/team/updateMyMemberInfo",(function(t){e.emitMemberUpdate(t)})),this.core.eventBus.on("team/onNotification",(function(t){return e.notificationHandler(t)}))},r.reset=function(){this.myTeamMembersMap.clear()},r.mergeMyTeamMembers=function(e){var t=this;Bn(e).call(e,(function(e){var r=e.teamId,n=t.myTeamMembersMap.get(r),i=sr({},n,e);t.myTeamMembersMap.set(r,i)}))},r.getTeamInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getTeamInfo",{teamId:e.teamId});case 3:return r=t.sent,n=r.content.team,t.abrupt("return",vT(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getTeams=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("getTeams",{timetag:0});case 2:return t=e.sent,r=t.content.teams,e.abrupt("return",yT(r));case 5:case"end":return e.stop()}}),e,this)})))},r.getTeamsById=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamIds:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("getTeamsById",{teamIds:e.teamIds});case 3:return r=t.sent,n=yT(r.content.teams),t.abrupt("return",{teams:n,tids:r.content.tids});case 6:case"end":return t.stop()}}),t,this)})))},r.createTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),r=IT(e),t.next=4,this.core.sendCmd("createTeam",{team:r,accounts:e.accounts||[],ps:e.ps||""});case 4:return n=t.sent,i=vT(n.content.team),this.core.eventBus.emit("forwardSend/team/created",i),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})))},r.dismissTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("dismissTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.leaveTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("leaveTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.transferTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),t.next=3,this.core.sendCmd("transferTeam",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateTeamInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),r=IT(e),t.next=4,this.core.sendCmd("updateTeamInfo",{team:r});case 4:return t.abrupt("return",vT(r));case 5:case"end":return t.stop()}}),t,this)})))},r.getTeamMembers=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},e),r.next=3,this.core.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0});case 3:if(n=r.sent,i=ST(null===(t=n.content)||void 0===t?void 0:t.teamMembers),e.accounts&&e.accounts.length>0){r.next=7;break}return r.abrupt("return",i);case 7:return r.abrupt("return",lu(i).call(i,(function(t){var r;return null===(r=e.accounts)||void 0===r?void 0:tu(r).call(r,t.account)})));case 8:case"end":return r.stop()}}),r,this)})))},r.getMutedTeamMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getMutedTeamMembers",{teamId:e.teamId});case 3:return r=t.sent,n=r.content,t.abrupt("return",ST(n.teamMembers));case 6:case"end":return t.stop()}}),t,this)})))},r.addTeamMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("addTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return t.stop()}}),t,this)})))},r.removeTeamMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("removeTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return t.stop()}}),t,this)})))},r.applyTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("applyTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return r=t.sent,t.abrupt("return",vT(r.content.team));case 5:case"end":return t.stop()}}),t,this)})))},r.addTeamManagers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("addTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.removeTeamManagers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("removeTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),r=MT({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),t.next=4,this.core.sendCmd("updateMyMemberInfo",{teamMember:r});case 4:return n=TT(sr({updateTime:(new Date).getTime(),account:this.core.account},r)),i=this.emitMemberUpdate(n),this.core.eventBus.emit("forwardSend/team/updateMyMemberInfo",i),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},r.emitMemberUpdate=function(e){e=TT(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var t=xS(this.myTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[t]),t},r.updateMemberNick=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e),r=MT({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),t.next=4,this.core.sendCmd("updateNickInTeam",{teamMember:r});case 4:return n=TT(sr({updateTime:(new Date).getTime()},r)),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.muteTeamMember=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteTeamMember",{teamId:e.teamId,account:e.account,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.getTeamMemberInvitorAccid=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},e),n={teamId:e.teamId},e.accounts&&e.accounts.length>0&&(n.accounts=e.accounts),r.next=5,this.core.sendCmd("getTeamMemberInvitorAccid",n);case 5:return i=r.sent,r.abrupt("return",(null===(t=i.content)||void 0===t?void 0:t.accountsMap)||{});case 7:case"end":return r.stop()}}),r,this)})))},r.muteTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.passTeamApply=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("passTeamApply",e);case 4:this.core.eventBus.emit("forwardSend/team/passTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/passTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectTeamApply=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.acceptTeamInvite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("acceptTeamInvite",e);case 4:this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectTeamInvite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.notifyTeamMsgReceiptsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.teamMsgReceipts;r&&r.length>0&&(this.core.emit("teamMsgReceipts",r),this.core.emit("msgReceipts",r))},r.syncTeamsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{teams:Kp(t.timetag)});var r=null==t?void 0:t.teams;if(r&&r.length){var n=yT(r);this.core.emit("teams",n)}},r.syncCreateTeamHandler=function(e){var t=e.content,r=vT(null==t?void 0:t.team),n=bT(r,r.owner,"owner");this.core.emit("createTeam",r,n)},r.syncUpdateTeamMemberHandler=function(e){var t=e.content,r=TT(null==t?void 0:t.teamMember);r.updateTime||(r.updateTime=(new Date).getTime()),this.mergeMyTeamMembers([r]),this.core.emit("updateTeamMember",r);var n=xS(this.myTeamMembersMap.get(r.teamId));this.core.emit("myTeamMembers",[n])},r.syncMyTeamMembersHandler=function(e){var t,r=e.content;this.core.eventBus.emit("sync/updateTimetag",{myTeamMembers:Kp(r.timetag)});var n=null==r?void 0:au(t=r.teamMembers).call(t,(function(e){return TT(e)}));this.mergeMyTeamMembers(n),this.core.emit("myTeamMembers",xS(n))},r.notificationHandler=function(e){var t=e.attach,r=e.scene,n=e.from,i=e.to,o=e.time,a=e.idServer,s=e.idClient,c=t.team,u=t.account,d=t.accounts,l=t.type;if("team"===r)switch(this.logger.getDebugMode()?this.logger.debug("team::recvNotification",a,s,t):this.logger.log("team::recvNotification",a,s,i,l,u,d),l){case"updateTeam":c.updateTime=o,this.core.emit("updateTeam",c);break;case"addTeamMembers":this.service.notifyAddTeamMembers(c,d);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(c,[n]);break;case"passTeamApply":this.service.notifyAddTeamMembers(c,[u]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(i,d,!0,o);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(i,d,!1,o);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(c,d);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(c,[n]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:i});break;case"transferTeam":this.service.notifyTransferTeam(c,n,u);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(c,[u],t.mute)}},t}(Xh),OS={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg"},PS={sysMsg:sr({time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,envConfig:21,callbackExt:22,isRoutable:105},eS)},LS=fh(PS),VS={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:LS.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:PS.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:PS.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:PS.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:LS.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:LS.sysMsg},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:LS.sysMsg}]}},US=function(e){function t(t){var r;return(r=e.call(this,"systemMessage",t)||this).sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},r.core.eventBus.on("logined",(function(){r.initEventListeners()})),hh({cmdMap:OS,cmdConfig:VS}),r}er(t,e);var r=t.prototype;return r.initEventListeners=function(){var e=this;this.core.eventBus.on("systemMessage/passFriendApply",(function(t){e.core.emit("updateSystemMessages",[{idServer:t.idServer,from:t.account,state:"pass",type:"friendRequest"}])})),this.core.eventBus.on("systemMessage/rejectFriendApply",(function(t){e.core.emit("updateSystemMessages",[{idServer:t.idServer,from:t.account,state:"decline",type:"friendRequest"}])}))},r.doMarkSysMsgAck=function(e){var t=[],r=[],n=["customSuperTeam"];Bn(e).call(e,(function(e){e.idServer&&(tu(n).call(n,e.type)?r.push(e.idServer):t.push(e.idServer))})),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:t}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:r})},r.sendCustomSysMsg=function(e){var t=this;Al({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:ZT}},e);var r="customSuperTeam"===e.type?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(r,{sysMsg:uS(e)}).then((function(){t.logger.log("sendCustomSysMsg success")})).catch((function(e){throw t.logger.error("sendCustomSysMsg failed",e.message),e}))},r.onSysMsgHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.sysMsg;if(r){var n="number"==typeof Qp(e,"raw.r[0]")?""+e.raw.r[0]:void 0;r.idServer=r.idServer||n;var i=cS(r,this.logger,JT.default);this.core.emit("sysMsg",i),this.doMarkSysMsgAck([i])}else this.logger.warn("onSysMsg no content.sysMsg")},r.syncOfflineSysMsgsHandler=function(e){var t,r=this;if(e.content.sysMsgs&&e.content.sysMsgs.length>0){var n=au(t=e.content.sysMsgs).call(t,(function(e){return cS(e,r.logger,JT.leave)}));this.core.emit("syncSysMsgs",n),this.doMarkSysMsgAck(n)}},r.onRecallMsgHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.sysMsg;if(r){var n="number"==typeof Qp(e,"raw.r[0]")?""+e.raw.r[0]:void 0;r.idServer=r.idServer||n;var i=KT([r],dS(+r.type));this.core.eventBus.emit("session/updateForDeletedMsg",i);var o=cS(r,this.logger,JT.default);this.core.emit("sysMsg",o),this.doMarkSysMsgAck([o])}else this.logger.warn("onSysMsg no content.sysMsg")},r.syncRecallMsgOfflineAndRoamingHandler=function(e){var t=this,r=e.content,n=r.timetag,i=r.type,o=r.sysMsgs,a=Kp(i),s=1===a?JT.leave:JT.roam,c=au(o).call(o,(function(e){return cS(e,t.logger,s)}));1===a&&this.doMarkSysMsgAck(c),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:n}),this.core.emit("syncSysMsgs",c)},t}(Xh);function DS(e){var t=["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"],r=sr({},e);return Bn(t).call(t,(function(e){void 0!==r[e]&&(r[e]=Kp(r[e]))})),void 0!==r.relationShip&&(r.valid=1===r.relationShip),r}var qS={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},BS={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},FS={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},GS=fh(FS),jS={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:GS.friendTag},{type:"Long",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:FS.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:FS.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:GS.friendTag},{type:"Long",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:GS.userTag},{type:"Long",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:GS.friendTag}]}},HS=function(e){function t(t){var r;return r=e.call(this,"friend",t)||this,hh({cmdMap:BS,cmdConfig:jS}),r}er(t,e);var r=t.prototype;return r.getFriends=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getFriends",{timetag:0});case 2:return r=t.sent,n=(null===(e=r.content)||void 0===e?void 0:e.friends)||[],n=au(n).call(n,(function(e){return DS(e)})),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.addFriend=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:1,ps:e.ps||""});case 3:return r=(new Date).getTime(),this.core.eventBus.emit("forwardSend/friend/addFriend",e.account),t.abrupt("return",{account:e.account,createTime:r,updateTime:r,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0});case 6:case"end":return t.stop()}}),t,this)})))},r.applyFriend=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({account:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:2,ps:e.ps||""});case 3:case"end":return t.stop()}}),t,this)})))},r.passFriendApply=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({account:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("friendReuqest",{account:e.account,type:3,ps:e.ps||""}).then((function(t){return r.core.eventBus.emit("systemMessage/passFriendApply",e),t}));case 4:this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(1),this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account,t.t0),t.t0;case 11:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectFriendApply=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({account:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("friendReuqest",{account:e.account,type:4,ps:e.ps||""}).then((function(t){return r.core.eventBus.emit("systemMessage/rejectFriendApply",e),t}));case 4:this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(1),this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps,t.t0),t.t0;case 11:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.deleteFriend=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},e),t.next=3,this.core.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:!0===e.delAlias?1:0}});case 3:this.core.eventBus.emit("forwardSend/friend/deleteFriend",e.account);case 4:case"end":return t.stop()}}),t,this)})))},r.updateFriend=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("updateFriend",{updateFriendTag:e});case 3:this.core.eventBus.emit("forwardSend/friend/updateFriend",e);case 4:case"end":return t.stop()}}),t,this)})))},r.syncFriendRequestHandler=function(e){var t=function(e){var t=sr({},e);try{t.ps=t.ps&&JSON.parse(t.ps)}catch(n){}if(t.type=qS[t.type],"addFriend"===t.type||"passFriendApply"===t.type){var r=(new Date).getTime();t.friend={account:e.account,alias:"",createTime:r,ext:"",updateTime:r,valid:!0}}return t}(e.content);this.core.emit("syncFriend",t)},r.syncDeleteFriendHandler=function(e){var t=e.content.account;this.logger.log("friend::emit syncFriendAction: deleteFriend "+t),this.core.emit("syncFriend",{type:"deleteFriend",account:t})},r.syncUpdateFriendHandler=function(e){var t=DS(e.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",null==t?void 0:t.account),this.core.emit("syncFriend",{type:"updateFriend",friend:t})},r.syncFriendsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friends:Kp(t.timetag)});var r=null==t?void 0:t.friends;if(r&&r.length){var n=au(r).call(r,(function(e){return DS(e)}));this.core.emit("friends",n)}},r.syncFriendUsersHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:Kp(t.timetag)});var r=null==t?void 0:t.users;if(r&&r.length){var n=au(r).call(r,(function(e){return ET(e)}));this.core.emit("users",n)}},t}(Xh);function WS(e){return e&&e.length>0?au(e).call(e,(function(e){return t=sr({},e),Bn(r=["subscribeTime","time"]).call(r,(function(e){t[e]&&(t[e]=Kp(t[e]))})),t;var t,r})):[]}function YS(e){if(!e)return e;var t=e.serverExt,r=Hl(e,["serverExt"]),n=["time","type","value"];if(Bn(n).call(n,(function(e){r[e]&&(r[e]=Kp(r[e]))})),r.clientType&&(r.clientType=bp(Sh,r.clientType)||""),t)try{r.ext=JSON.parse(t),"string"==typeof r.ext[0]&&(r.ext=r.ext[0])}catch(i){}return r}var KS={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},QS={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},zS=fh(QS),JS={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:QS.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:zS.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:zS.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:QS.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:QS.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:QS.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:QS.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:zS.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:QS.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:zS.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:zS.msgEvent}]}},$S=function(e){function t(t){var r;return r=e.call(this,"event",t)||this,hh({cmdMap:KS,cmdConfig:JS}),r}er(t,e);var r=t.prototype;return r.publishEvent=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},e),n=sr(sr({validTime:e.validTime||604800,broadcastType:e.broadcastType||2},e),{idClient:Tp(),sync:!0===e.sync?1:0}),r.next=4,this.core.sendCmd("publishEvent",{msgEvent:n});case 4:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.msgEvent)||{},r.abrupt("return",YS(o));case 7:case"end":return r.stop()}}),r,this)})))},r.subscribeEvent=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},e),n=sr(sr({subscribeTime:2592e3},e),{sync:!0===e.sync?1:0}),r.next=4,this.core.sendCmd("subscribeEvent",{msgEventSubscribe:n,accounts:e.accounts});case 4:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.accounts)||[],r.abrupt("return",{failedAccounts:o});case 7:case"end":return r.stop()}}),r,this)})))},r.unSubscribeEvents=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Al({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),n={type:e.type},!(e.accounts&&e.accounts.length>0)){r.next=9;break}return r.next=5,this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:n,accounts:e.accounts});case 5:o=r.sent,i=(null===(t=o.content)||void 0===t?void 0:t.accounts)||[],r.next=12;break;case 9:return r.next=11,this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:n});case 11:i=[];case 12:return r.abrupt("return",{failedAccounts:i});case 13:case"end":return r.stop()}}),r,this)})))},r.querySubscribeEvents=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Al({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),!(e.accounts&&e.accounts.length>0)){r.next=7;break}return r.next=4,this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:e.type},accounts:e.accounts});case 4:n=r.sent,r.next=10;break;case 7:return r.next=9,this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:e.type}});case 9:n=r.sent;case 10:return r.abrupt("return",WS(null===(t=n.content)||void 0===t?void 0:t.msgEventSubscribes));case 11:case"end":return r.stop()}}),r,this)})))},r.pushEventHandler=function(e){var t,r=(null===(t=e.content)||void 0===t?void 0:t.msgEvent)||{};this.core.emit("pushEvents",[YS(r)])},r.pushEventsHandler=function(e){var t,r,n=(null===(t=e.content)||void 0===t?void 0:t.msgEvents)||{};this.core.emit("pushEvents",Si(r=n)&&r.length>0?au(r).call(r,(function(e){return YS(e)})):[])},t}(Xh);function XS(e){var t={scene:Th[e.scene],from:e.threadMsgFromAccount,to:e.threadMsgToAccount,time:e.threadMsgTime,idServer:e.threadMsgIdServer},r={limit:e.limit<100?e.limit:100,beginTime:"number"==typeof e.beginTime?e.beginTime:0,reverse:!0===Pc(e)?1:0};return e.lastMsgId&&(r.lastMsgId=e.lastMsgId),{msg:t,threadMsgReq:r}}var ZS,eb={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},tb={msg:rS,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},rb=fh(tb),nb={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:tb.msg},{type:"Property",name:"threadMsgReq",reflectMapper:tb.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:rb.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:rb.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:rb.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:tb.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:rb.msg}]}},ib=function(e){function t(t){var r;return r=e.call(this,"msgExtend",t)||this,hh({cmdMap:eb,cmdConfig:nb}),r}er(t,e);var r=t.prototype;return r.getThreadMsgs=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({scene:{type:"enum",values:Sp(Th)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("getThreadMsgs",XS(e));case 3:return n=r.sent,i=n.content,o=i.msgs,a=i.threadMsg,s=n.content.threadMsgsMeta,c=BT(a,this.core.account),u=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:c}),o=jT(o,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account}),a=GT(a,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account}),r.abrupt("return",{msgs:o,threadMsg:a,total:Kp(s.total),timetag:Kp(s.lastMsgTime)});case 11:case"end":return r.stop()}}),r,this)})))},r.getMsgsByIdServer=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:Sp(Th)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},e),t.next=3,this.core.sendCmd("getMsgsByIdServer",{reqMsgs:au(r=e.reqMsgs).call(r,(function(e){return sr(sr({},e),{scene:bp(Th,e.scene)})}))});case 3:return i=t.sent,o=au(n=i.content.msgs).call(n,(function(e){var t,r=BT(e,a.core.account),n=null===(t=a.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:r});return GT(e,n?{account:a.core.account,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:a.core.account})})),t.abrupt("return",o);case 6:case"end":return t.stop()}}),t,this)})))},t}(Xh);!function(e){e[e.ASC=1]="ASC",e[e.DESC=2]="DESC"}(ZS||(ZS={}));var ob,ab={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},sb={msg:rS,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,time:6,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},cb=fh(sb),ub={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:cb.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:sb.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:cb.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:cb.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:sb.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:cb.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:sb.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:cb.msg}]}};!function(e){e[e.p2p=1]="p2p",e[e.team=2]="team"}(ob||(ob={}));var db={type:{type:"enum",values:ob},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function lb(e){var t=wh(db,e);return{sessionId:"p2p"===t.type?"p2p-"+t.otherAccid:"team-"+t.toTid,time:t.time}}var pb={orderRule:{type:"enum",values:ZS}};function mb(e){var t,r=wh(pb,e);Si(r.msgTypeList)&&(r.msgTypeList=au(t=r.msgTypeList).call(t,(function(e){return Mh[e]})).join(","));var n=["p2pSessionList","teamSessionList","senderList","msgSubTypeList"];return Bn(n).call(n,(function(e){Si(r[e])&&(r[e]=r[e].join(","))})),r}var hb=function(e){function t(t){var r;return(r=e.call(this,"msgLog",t)||this).onV2ClearHistoryMessage=function(e){var t=lb(e);r.core.eventBus.emit("session/updateForClearMsg",[t],!0)},hh({cmdMap:ab,cmdConfig:ub}),r.registerListener(),r}er(t,e);var r=t.prototype;return r.registerListener=function(){this.core.eventBus.on("forwardReceive/msgLog/clearHistoryMsgsFromServer",this.onV2ClearHistoryMessage)},r.deleteRoamingMsgs=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Al({ids:{type:"array",itemType:"string"}},e),r=[],t.prev=2,r=au(n=e.ids).call(n,(function(e){var t=Cp(e);return t.scene+"|"+t.accid})),t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(2),this.logger.error("Failed to delete roaming msgs with "+e.ids,t.t0),new Error("Failed to create session with "+e.ids);case 10:return t.next=12,this.core.sendCmd("deleteRoamingMsgs",{ids:r});case 12:case"end":return t.stop()}}),t,this,[[2,6]])})))},r.getHistoryMsgs=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c,u,d;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return"function"!=typeof(null===(t=this.core.sync)||void 0===t?void 0:t.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.logger.warn("Please call getHistoryMsgs after syncdone event"),Al({scene:{type:"enum",values:Sp(Th)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},e),o="p2p"===e.scene?"getHistoryMsgs":"team"===e.scene?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",n.next=5,this.core.sendCmd(o,_p({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},sr(sr({},e),{msgTypes:e.msgTypes?au(i=e.msgTypes).call(i,(function(e){return Mh[e]})):[]})));case 5:if(a=n.sent,(s=a.content).msgs&&s.msgs.length>0){n.next=9;break}return n.abrupt("return",[]);case 9:if(c=BT(s.msgs[0],this.core.account),u=null===(r=this.core.session)||void 0===r?void 0:r.getSessionWithUncomplete({id:c}),d=jT(s.msgs,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account}),!0!==e.asc){n.next=14;break}return n.abrupt("return",xm(d).call(d,(function(e,t){return e.time-t.time})));case 14:return n.abrupt("return",d);case 15:case"end":return n.stop()}}),n,this)})))},r.clearHistoryMsgsFromServer=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},e),(r=sr(sr({isDeleteRoam:1},e),{type:"team"===e.scene?2:1,isSyncSelf:!0===e.isSyncSelf?1:0}))[2===r.type?"toTid":"otherAccid"]=e.to,t.next=5,this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:r});case 5:return n=t.sent,i=n.content,this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:e.scene+"-"+e.to}],!0),this.core.eventBus.emit("forwardSend/msgLog/clearHistoryMsgsFromServer",sr(sr({},r),{time:i.timetag})),t.abrupt("return",i);case 10:case"end":return t.stop()}}),t,this)})))},r.multiSyncClearServerHistoryMsgsHandler=function(e){var t=lb(e.content.data);this.core.eventBus.emit("session/updateForClearMsg",[t],!0),this.core.emit("clearServerHistoryMsgs",[t])},r.ftsCloudMsgLogs=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogs"));case 1:case"end":return t.stop()}}),t,this)})))},r.ftsCloudMsgLogsAggWithSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogsAggWithSession"));case 1:case"end":return t.stop()}}),t,this)})))},r.baseFtsCloudMsgLogs=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a=this;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Al({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:Sp(ZS),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:Sp(Mh),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},e),!(e.fromTime&&e.toTime&&e.toTime<e.fromTime)){r.next=3;break}throw new Sl("Request parameter error: toTime should be greater than fromTime",e,"");case 3:return i=mb(e),r.next=6,this.core.sendCmd(t,{tag:i});case 6:return o=r.sent,r.abrupt("return",au(n=o.content.datas).call(n,(function(e){var t,r=BT(e,a.core.account),n=null===(t=a.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:r});return GT(e,n?{account:a.core.account,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:a.core.account})})));case 8:case"end":return r.stop()}}),r,this)})))},r.syncClearServerHistoryMsgsHandler=function(e){var t,r=(t=e.content.datas,Si(t)&&t.length>0?au(t).call(t,(function(e){return lb(e)})):[]);this.core.emit("clearServerHistoryMsgs",r)},t}(Xh),fb={"22_1":"requestProxy","22_2":"onRequestProxy"},gb={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},vb=fh(gb),yb={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:gb.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:vb.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:vb.requestProxyMsgTag}]}},Ib=function(e){function t(t){var r;return(r=e.call(this,"passThrough",t)||this).core=t,hh({cmdMap:fb,cmdConfig:yb}),r}er(t,e);var r=t.prototype;return r.request=function(e){return Al({path:{type:"string",allowEmpty:!1}},e),this.core.sendCmd("requestProxy",{requestProxyTag:e}).then((function(e){return e.content.requestProxyTag}))},r.onRequestProxyHandler=function(e){var t=e.content.proxyMsg;t&&t.time&&(t.time=+t.time),this.core.emit("proxyMsg",t)},t}(Xh),Mb=cf({none:0,normal:1,all:3}),Tb=cf({normal:0,advanced:1}),Sb=cf({normal:0,owner:1,manager:2}),bb={noVerify:0,needVerify:1,rejectAll:2},Cb=cf(bb),Eb={needVerify:0,noVerify:1},_b=cf(Eb),kb={manager:0,all:1},Rb=cf(kb),wb={manager:0,all:1},Ab=cf(wb),xb={manager:0,all:1},Nb=cf(xb);function Ob(e){var t,r=["teamId"],n=["level","memberNum","memberUpdateTime","createTime","updateTime"],i=["valid","validToCurrentUser","mute"],o={type:Tb,muteType:Mb,joinMode:Cb,beInviteMode:_b,inviteMode:Rb,updateTeamMode:Ab,updateExtMode:Nb};e.bits;var a=Hl(e,["bits"]);return Bn(r).call(r,(function(e){a[e]&&(a[e]=a[e].toString())})),Bn(n).call(n,(function(e){void 0!==a[e]&&(a[e]=Kp(a[e]))})),Bn(i).call(i,(function(e){void 0!==a[e]&&(a[e]=1===Kp(a[e]))})),Bn(t=pr(o)).call(t,(function(e){void 0!==a[e]&&(a[e]=o[e][a[e]]||a[e])})),a}function Pb(e){return e&&e.length>0?au(e).call(e,(function(e){return Ob(e)})):[]}function Lb(e){var t,r=sr({},e),n=["avatar","name","intro","announcement","ext"],i={joinMode:bb,beInviteMode:Eb,inviteMode:kb,updateTeamMode:wb,updateExtMode:xb};return Bn(n).call(n,(function(e){void 0!==r[e]&&(r[e]=r[e].toString())})),Bn(t=pr(i)).call(t,(function(e){void 0!==r[e]&&(r[e]=i[e][r[e]])})),r}function Vb(e){var t=["teamId","ext","account","nickInTeam"],r={};return void 0!==e.bitConfigMask&&(r.bits=Kp(e.bitConfigMask)),Bn(t).call(t,(function(t){e[t]&&(r[t]=e[t].toString())})),Object.prototype.hasOwnProperty.call(e,"nickInTeam")&&(r.nickInTeam=e.nickInTeam),r}function Ub(e){var t,r=["teamId"],n=["joinTime","updateTime","bitConfigMask"],i=["active","valid","mute"],o={type:Sb},a=e.bits,s=Hl(e,["bits"]);return void 0!==a&&(s.muteTeam=1===Kp(a),s.bitConfigMask=a),s.id=s.teamId+"-"+s.account,Bn(r).call(r,(function(e){s[e]&&(s[e]=s[e].toString())})),Bn(n).call(n,(function(e){void 0!==s[e]&&(s[e]=Kp(s[e]))})),Bn(i).call(i,(function(e){void 0!==s[e]&&(s[e]=1===Kp(s[e]))})),Bn(t=pr(o)).call(t,(function(e){void 0!==s[e]&&(s[e]=o[e][s[e]]||s[e])})),s}function Db(e){return e&&e.length>0?au(e).call(e,(function(e){return Ub(e)})):[]}function qb(e,t,r){return void 0===r&&(r="normal"),{id:e.teamId+"-"+t,teamId:e.teamId,account:t,type:r,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function Bb(e,t,r){return void 0===r&&(r="normal"),t&&t.length>0?au(t).call(t,(function(t){return qb(e,t,r)})):[]}var Fb=function(){function e(e){this.core=e}var t=e.prototype;return t.notifyAddSuperTeamMembers=function(e,t){this.core.emit("addSuperTeamMembers",{team:e,accounts:t,members:Bb(e,t)})},t.notifyUpdateSuperTeamManagers=function(e,t,r,n){this.core.emit("updateSuperTeamManagers",{team:{teamId:e,memberUpdateTime:n},accounts:t,isManager:r,members:au(t).call(t,(function(t){return{id:e+"-"+t,type:r?"manager":"normal",account:t,updateTime:n}}))})},t.notifyRemoveSuperTeamMembers=function(e,t){this.core.emit("removeSuperTeamMembers",{team:e,accounts:t})},t.notifyTransferSuperTeam=function(e,t,r){this.core.emit("transferSuperTeam",{team:e,from:{id:e.teamId+"-"+t,account:t,type:"normal",updateTime:e.memberUpdateTime},to:{id:e.teamId+"-"+r,account:r,type:"owner",updateTime:e.memberUpdateTime}})},t.notifyUpdateSuperTeamMembersMute=function(e,t,r){this.core.emit("updateSuperTeamMembersMute",{team:e,accounts:t,members:au(t).call(t,(function(t){return{id:e.teamId+"-"+t,account:t,teamId:e.teamId,mute:r,updateTime:e.memberUpdateTime}})),mute:r})},e}(),Gb={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember","21_111":"syncMySuperTeamMembers"},jb={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},Hb=fh(jb),Wb={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:Hb.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:Hb.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:jb.superTeam}],response:[{type:"Long",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:Hb.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:jb.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:jb.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Hb.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Hb.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Hb.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:Hb.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:Hb.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:Hb.superTeamMember}]},syncMySuperTeamMembers:{sid:21,cid:111,ext:"sync",service:"superTeam",response:[{type:"PropertyArray",name:"teamMembers",reflectMapper:Hb.superTeamMember},{type:"Long",name:"timetag"}]}},Yb=function(e){function t(t){var r;return(r=e.call(this,"superTeam",t)||this).mySuperTeamMembersMap=new rd,r.service=new Fb(t),hh({cmdMap:Gb,cmdConfig:Wb}),r.setListeners(),r}er(t,e);var r=t.prototype;return r.setListeners=function(){var e=this;this.core.eventBus.on("forwardReceive/superTeam/updateMyMemberInfo",(function(t){e.emitMemberUpdate(t)})),this.core.eventBus.on("team/onNotification",(function(t){return e.notificationHandler(t)}))},r.reset=function(){this.mySuperTeamMembersMap.clear()},r.mergeMySuperTeamMembers=function(e){var t=this;Bn(e).call(e,(function(e){var r=e.teamId,n=t.mySuperTeamMembersMap.get(r),i=sr({},n,e);t.mySuperTeamMembersMap.set(r,i)}))},r.getSuperTeamInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getSuperTeamInfo",{teamId:e.teamId});case 3:return r=t.sent,n=r.content.superTeam,t.abrupt("return",Ob(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getSuperTeams=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("getSuperTeams",{timetag:0});case 2:return t=e.sent,r=t.content.superTeams,e.abrupt("return",Pb(r));case 5:case"end":return e.stop()}}),e,this)})))},r.updateSuperTeamInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),r=Lb(e),t.next=4,this.core.sendCmd("updateSuperTeamInfo",{superTeam:r});case 4:return t.abrupt("return",Ob(r));case 5:case"end":return t.stop()}}),t,this)})))},r.addSuperTeamMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("addSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return t.stop()}}),t,this)})))},r.removeSuperTeamMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("removeSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return t.stop()}}),t,this)})))},r.addSuperTeamManagers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("addSuperTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.removeSuperTeamManagers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("removeSuperTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.applySuperTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("applySuperTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return r=t.sent,t.abrupt("return",Ob(r.content.superTeam));case 5:case"end":return t.stop()}}),t,this)})))},r.transferSuperTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),t.next=3,this.core.sendCmd("transferSuperTeam",e);case 3:case"end":return t.stop()}}),t,this)})))},r.muteSuperTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteSuperTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.muteSuperTeamMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.updateMemberNick=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e),r=Vb({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),t.next=4,this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:r});case 4:return n=Ub(sr({updateTime:(new Date).getTime()},r)),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),r=Vb({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),t.next=4,this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:r});case 4:return n=Ub(sr({updateTime:(new Date).getTime(),account:this.core.account},r)),i=this.emitMemberUpdate(n),this.core.eventBus.emit("forwardSend/superTeam/updateMyMemberInfo",i),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},r.getSuperTeamMembersByAccounts=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},e),i=au(n=e.accounts).call(n,(function(t){return e.teamId+"|"+t})),r.next=4,this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:i});case 4:return o=r.sent,r.abrupt("return",Db(null===(t=o.content)||void 0===t?void 0:t.superTeamMembers));case 6:case"end":return r.stop()}}),r,this)})))},r.getSuperTeamMembers=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("getSuperTeamMembers",sr({joinTime:0,limit:100,reverse:!1},e));case 3:return n=r.sent,r.abrupt("return",Db(null===(t=n.content)||void 0===t?void 0:t.superTeamMembers));case 5:case"end":return r.stop()}}),r,this)})))},r.queryMuteMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("queryMuteSuperTeamMembers",sr({limit:100,joinTime:0,reverse:!1},e));case 3:return r=t.sent,n=r.content,t.abrupt("return",Db(n.superTeamMembers));case 6:case"end":return t.stop()}}),t,this)})))},r.leaveSuperTeam=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("leaveSuperTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.passSuperTeamApply=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("passSuperTeamApply",e);case 4:this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectSuperTeamApply=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectSuperTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.acceptSuperTeamInvite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("acceptSuperTeamInvite",e);case 4:this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectSuperTeamInvite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectSuperTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.emitMemberUpdate=function(e){e=Ub(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var t=xS(this.mySuperTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[t]),t},r.mergeMyTeamMembers=function(e){var t=this;Bn(e).call(e,(function(e){var r=e.teamId,n=t.mySuperTeamMembersMap.get(r),i=sr({},n,e);t.mySuperTeamMembersMap.set(r,i)}))},r.syncSuperTeamsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:Kp(t.timetag)});var r=null==t?void 0:t.teams;if(r&&r.length){var n=Pb(r);this.core.emit("superTeams",n)}},r.syncCreateSuperTeamHandler=function(e){var t=e.content,r=Ob(null==t?void 0:t.superTeam),n=qb(r,r.owner,"owner");this.core.emit("createSuperTeam",r,n)},r.syncUpdateSuperTeamMemberHandler=function(e){var t=e.content,r=Ub(null==t?void 0:t.teamMember);r.updateTime||(r.updateTime=(new Date).getTime()),this.mergeMySuperTeamMembers([r]),this.core.emit("updateSuperTeamMember",r);var n=xS(this.mySuperTeamMembersMap.get(r.teamId));this.core.emit("mySuperTeamMembers",[n])},r.syncMySuperTeamMembersHandler=function(e){var t,r=e.content;this.core.eventBus.emit("sync/updateTimetag",{mySuperTeamMembers:Kp(r.timetag)});var n=null==r?void 0:au(t=r.teamMembers).call(t,(function(e){return Ub(e)}));this.mergeMySuperTeamMembers(n),this.core.emit("mySuperTeamMembers",xS(n))},r.notificationHandler=function(e){var t=e.attach,r=e.scene,n=e.from,i=e.to,o=e.time,a=e.idServer,s=e.idClient,c=t.team,u=t.account,d=t.accounts,l=t.type;if("superTeam"===r)switch(this.logger.getDebugMode()?this.logger.debug("superTeam::recvNotification",a,s,t):this.logger.log("superTeam::recvNotification",a,s,i,l,u,d),l){case"updateSuperTeam":c.updateTime=o,this.core.emit("updateSuperTeam",c);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(c,d);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(c,[n]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(c,[u]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,d,!0,o);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,d,!1,o);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(c,d);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(c,[n]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:i});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(c,n,u);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(c,d,t.mute)}},t}(Xh),Kb={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},Qb={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Bool",name:"isWeixinApp"},{type:"Int",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},zb=function(e){function t(t){var r;return(r=e.call(this,"plugin",t)||this).core=t,hh({cmdMap:Kb,cmdConfig:Qb}),r}er(t,e);var r=t.prototype;return r.getChatroomAddress=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("getChatroomAddress",{chatroomId:e.chatroomId,isWeixinApp:"WXAPP"===Ql.platform,ipType:e.ipType||0});case 3:return r=t.sent,t.abrupt("return",r.content.address);case 5:case"end":return t.stop()}}),t,this)})))},r.getQChatAddress=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({ipType:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(null==e?void 0:e.ipType)||0}});case 3:return r=t.sent,t.abrupt("return",r.content.address);case 5:case"end":return t.stop()}}),t,this)})))},t}(Xh),Jb={"7_19":"nimQueryCloudSessionList","7_20":"nimQueryCloudSession","7_21":"nimUpdateCloudSession","7_22":"nimDeleteCloudSessionList","7_121":"nimMultiSyncUpdateCloudSession"},$b={sessionReqTag:{minTimestamp:1,maxTimestamp:2,includedLastMsg:3,limit:4,hasMore:5},sessionTag:{sessionId:1,updateTime:2,ext:3,lastMsg:4,lastMsgType:5}},Xb=fh($b),Zb={nimQueryCloudSessionList:{sid:7,cid:19,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:$b.sessionReqTag}],response:[{type:"Property",name:"tag",reflectMapper:Xb.sessionReqTag},{type:"PropertyArray",name:"sessions",reflectMapper:Xb.sessionTag}]},nimQueryCloudSession:{sid:7,cid:20,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:$b.sessionTag}],response:[{type:"Property",name:"session",reflectMapper:Xb.sessionTag}]},nimUpdateCloudSession:{sid:7,cid:21,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:$b.sessionTag}]},nimDeleteCloudSessionList:{sid:7,cid:22,service:"cloudSession",params:[{type:"PropertyArray",name:"tags",reflectMapper:$b.sessionTag}]},nimMultiSyncUpdateCloudSession:{sid:7,cid:121,service:"cloudSession",response:[{type:"Property",name:"session",reflectMapper:Xb.sessionTag}]}},eC={sessionId:{type:"string"},updateTime:{type:"number"},ext:{type:"string"},lastMsg:{type:"object"},lastMsgType:{type:"number"}};function tC(e,t,r){var n=wh(eC,e),i=Cp(n.sessionId,"|"),o=i.accid,a=i.scene;if(n.sessionId=a+"-"+o,n.lastMsg){var s=1===n.lastMsgType;n.lastMsgInfo=s?{isLastMsgRecalled:s,revokedMsg:cS(mh(n.lastMsg,LS.sysMsg),r)}:{isLastMsgRecalled:s,lastMsg:GT(mh(n.lastMsg,iS.msg),{account:t})}}return delete n.lastMsg,delete n.lastMsgType,n}function rC(e,t,r){return e&&e.length>0?au(e).call(e,(function(e){return tC(e,t,r)})):[]}var nC=function(e){function t(t){var r;return r=e.call(this,"cloudSession",t)||this,hh({cmdMap:Jb,cmdConfig:Zb}),r}er(t,e);var r=t.prototype;return r.queryCloudSessionList=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({minTimestamp:{type:"number",min:0,required:!1},maxTimestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},includedLastMsg:{type:"boolean",required:!1}},e),(n=sr({limit:100,includedLastMsg:!0},e)).includedLastMsg=Lh.boolean(e,"includedLastMsg"),r.next=5,this.core.sendCmd("nimQueryCloudSessionList",{tag:n});case 5:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.tag)||{},a=i.content.sessions,r.abrupt("return",{hasMore:+o.hasMore>0,sessionList:rC(a,this.core.account,this.logger)});case 9:case"end":return r.stop()}}),r,this)})))},r.queryCloudSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({sessionId:{type:"string",allowEmpty:!1}},e),r=Cp(e.sessionId,"-"),n=r.accid,i=r.scene,t.next=4,this.core.sendCmd("nimQueryCloudSession",{tag:{sessionId:"superTeam"===i?"super_team|"+n:i+"|"+n}});case 4:return o=t.sent,t.abrupt("return",tC(o.content.session,this.core.account,this.logger));case 6:case"end":return t.stop()}}),t,this)})))},r.updateCloudSession=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({sessionId:{type:"string",allowEmpty:!1},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=Cp(e.sessionId,"-"),n=r.accid,i=r.scene,t.next=4,this.core.sendCmd("nimUpdateCloudSession",{tag:{sessionId:"superTeam"===i?"super_team|"+n:i+"|"+n,ext:e.ext}});case 4:case"end":return t.stop()}}),t,this)})))},r.deleteCloudSessionList=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({sessionIdList:{type:"array",itemType:"string"}},e),n=au(r=e.sessionIdList).call(r,(function(e){var t=Cp(e,"-"),r=t.accid,n=t.scene;return{sessionId:"superTeam"===n?"super_team|"+r:n+"|"+r}})),t.next=4,this.core.sendCmd("nimDeleteCloudSessionList",{tags:n});case 4:case"end":return t.stop()}}),t,this)})))},r.nimMultiSyncUpdateCloudSessionHandler=function(e){var t=tC(e.content.session,this.core.account,this.logger);this.core.emit("multiSyncUpdateCloudSession",t)},t}(Xh),iC={needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needPushBadge:{type:"boolean",required:!1}},oC={"15_1":"signalingCreate","15_2":"signalingDelay","15_3":"signalingClose","15_4":"signalingJoin","15_5":"signalingLeave","15_6":"signalingInvite","15_7":"signalingCancelInvite","15_8":"signalingReject","15_9":"signalingAccept","15_10":"signalingSendCustomCommand","15_11":"signalingRecvNotification","15_12":"signalingMultiSyncNotification","15_13":"signalingSyncNotification","15_14":"singalingSyncChannels","15_15":"signalingQueryInfo","15_16":"signalingCallEx","15_17":"signalingJoinAndAccept"},aC={avSignalTag:sr({type:1,name:2,channelId:3,createTime:4,expireTime:5,creatorAccid:6,ext:7,invalid:8,fromAccid:10,toAccid:11,requestId:12,members:18,attach:19,attachExt:20,needOffline:21,msgId:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},{needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needPushBadge:17})},sC=fh(aC),cC={signalingCreate:{sid:15,cid:1,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:sC.avSignalTag}]},signalingDelay:{sid:15,cid:2,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:sC.avSignalTag}]},signalingClose:{sid:15,cid:3,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:sC.avSignalTag}]},signalingJoin:{sid:15,cid:4,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:sC.avSignalTag}]},signalingLeave:{sid:15,cid:5,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingInvite:{sid:15,cid:6,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingCancelInvite:{sid:15,cid:7,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingReject:{sid:15,cid:8,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingAccept:{sid:15,cid:9,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingSendCustomCommand:{sid:15,cid:10,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}]},signalingRecvNotification:{sid:15,cid:11,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:sC.avSignalTag}]},signalingMultiSyncNotification:{sid:15,cid:12,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:sC.avSignalTag}]},signalingSyncNotification:{sid:15,cid:13,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:sC.avSignalTag}]},singalingSyncChannels:{sid:15,cid:14,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:sC.avSignalTag}]},signalingQueryInfo:{sid:15,cid:15,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:sC.avSignalTag}]},signalingCallEx:{sid:15,cid:16,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:sC.avSignalTag}]},signalingJoinAndAccept:{sid:15,cid:17,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:aC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:sC.avSignalTag}]},signalingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:"signaling",params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},uC={type:{type:"number"},createTime:{type:"number"},expireTime:{type:"number"},invalid:{type:"boolean"},pushInfo:iC,pluginSetting:{nertcInfo:{nertcChannelName:{type:"string"},nertcTokenTtl:{type:"number"},nertcToken:{type:"string"},nertcJoinRoomQueryParamMap:{type:"string"},callStatus:{type:"number"}}},callStatus:{type:"number"},attach:{type:"object"},members:{type:"object"},needOffline:{type:"boolean"},uid:{type:"number"},time:{type:"number"}};function dC(e){return wh(uC,mh(e,{1:"accid",2:"uid",3:"createTime",4:"expireTime"}))}function lC(e){var t,r=wh(uC,e),n=[];return r.members&&r.members.length>0&&(n=au(t=r.members).call(t,(function(e){return dC(e)})),delete r.members),n.length>0?{channelInfo:r,memberList:n}:{channelInfo:r}}function pC(e){var t,r=wh(uC,e),n=[];r.members&&r.members.length>0&&(n=au(t=r.members).call(t,(function(e){return dC(e)})),delete r.members);var i=200;return e.callStatus&&(i=Number(e.callStatus)),n.length>0?{channelInfo:r,memberList:n,callStatus:i}:{channelInfo:r,callStatus:i}}function mC(e){return Nh(uC,e)}var hC,fC,gC,vC,yC,IC,MC,TC=function(e){function t(t){var r;return(r=e.call(this)||this).timer=0,r.pollingInterval=12e4,r.name="signaling",r.logger=t.logger,r.core=t,r.channels={},hh({cmdMap:oC,cmdConfig:cC}),r}er(t,e);var r=t.prototype;return r.callEx=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({type:{type:"number"},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:iC},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e),r.next=3,this.core.sendCmd("signalingCallEx",{tag:mC(e)});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},o=pC(i),this.channels[o.channelInfo.channelId]=xS(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(Xt(a=this.aotoDelay).call(a,this),this.pollingInterval,-1)),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r,this)})))},r.joinAndAccept=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},uid:{type:"number",required:!1},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e),n=e.fromAccid,(i=Hl(e,["fromAccid"])).toAccid=n,r.next=5,this.core.sendCmd("signalingJoinAndAccept",{tag:mC(i)});case 5:return o=r.sent,a=(null===(t=o.content)||void 0===t?void 0:t.data)||{},s=pC(a),this.channels[s.channelInfo.channelId]=xS(s.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(Xt(c=this.aotoDelay).call(c,this),this.pollingInterval,-1)),r.abrupt("return",s);case 11:case"end":return r.stop()}}),r,this)})))},r.create=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({type:{type:"number"},ext:{type:"string",required:!1}},e),r.next=3,this.core.sendCmd("signalingCreate",{tag:mC(e)});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},r.abrupt("return",lC(i));case 6:case"end":return r.stop()}}),r,this)})))},r.close=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("signalingClose",{tag:mC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.queryInfo=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({name:{type:"string",allowEmpty:!1}},e),r.next=3,this.core.sendCmd("signalingQueryInfo",{tag:e});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},r.abrupt("return",lC(i));case 6:case"end":return r.stop()}}),r,this)})))},r.join=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},uid:{type:"number",min:0,required:!1},needOffline:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("signalingJoin",{tag:mC(e)});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},o=lC(i),this.channels[o.channelInfo.channelId]=xS(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(Xt(a=this.aotoDelay).call(a,this),this.pollingInterval,-1)),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r,this)})))},r.aotoDelay=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i,o;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=pr(this.channels)).length){e.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,e.abrupt("return");case 5:this.logger.log("signling:autoDelay",t),r=0;case 7:if(!(r<t.length)){e.next=24;break}return n=t[r],e.prev=9,e.next=12,this.core.sendCmd("signalingDelay",{tag:{channelId:n}});case 12:i=e.sent,o=lC(i.content.data),this.channels[n]=o.channelInfo,e.next=21;break;case 17:e.prev=17,e.t0=e.catch(9),this.logger.warn("signling:autoDelay "+n+" failed",e.t0),delete this.channels[n];case 21:r++,e.next=7;break;case 24:case"end":return e.stop()}}),e,this,[[9,17]])})))},r.leave=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("signalingLeave",{tag:mC(e)});case 3:delete this.channels[e.channelId];case 4:case"end":return t.stop()}}),t,this)})))},r.invite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:iC}},e),t.next=3,this.core.sendCmd("signalingInvite",{tag:mC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.cancelInvite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("signalingCancelInvite",{tag:mC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.reject=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),r=e.fromAccid,(n=Hl(e,["fromAccid"])).toAccid=r,t.next=5,this.core.sendCmd("signalingReject",{tag:mC(n)});case 5:case"end":return t.stop()}}),t,this)})))},r.accept=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},autoJoin:{type:"boolean",required:!1},uid:{type:"number",min:0,required:!1},joinAttachExt:{type:"string",required:!1}},e),r=e.autoJoin,n=e.joinAttachExt,i=e.fromAccid,(o=Hl(e,["autoJoin","joinAttachExt","fromAccid"])).toAccid=i,t.next=5,this.core.sendCmd("signalingAccept",{tag:mC(o)});case 5:if(this.logger.log("Signaling:accept, accept success, autoJoin "+e.autoJoin),!r){t.next=10;break}return a={channelId:e.channelId,needOffline:e.needOffline,attachExt:n,uid:e.uid},t.next=10,this.join(a);case 10:case"end":return t.stop()}}),t,this)})))},r.sendCustomCommand=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},attachExt:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("signalingSendCustomCommand",{tag:mC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.signalingRecvNotificationHandler=function(e){var t="number"==typeof Qp(e,"raw.r[0]")?""+e.raw.r[0]:"0";e.content.data.msgId=e.content.data.msgId||t,this.doNotify(e.content.data),t&&Kp(t)&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:[t]})},r.signalingMultiSyncNotificationHandler=function(e){this.doNotify(e.content.data,3)},r.doNotify=function(e,t){void 0===t&&(t=0);var r=function(e,t){void 0===t&&(t=0);var r=wh(uC,e),n=r.attach,i=r.attachExt,o=r.time,a=r.msgId;r.fromAccid,r.toAccid,r.members,r.requestId,r.pushInfo;var s=Hl(r,["attach","attachExt","time","msgId","fromAccid","toAccid","members","requestId","pushInfo"]);if(2===n.type)try{r.member={accid:r.attach.member[1],uid:Number(r.attach.member[2]),createTime:Number(r.attach.member[3]),expireTime:Number(r.attach.member[4])}}catch(u){delete r.member}var c=n.type;return delete r.attach,{metaData:{eventType:c,channelInfo:s,feature:t,ext:i||"",time:o,msgId:a},rawData:r}}(e,t),n=r.metaData,i=r.rawData,o=i.fromAccid,a=i.toAccid,s=i.requestId,c=i.pushInfo,u=i.msgId,d=i.member;switch(n.eventType){case 1:this.emit("signalingClose",{fromAccid:o,metaData:n});break;case 2:this.emit("signalingJoin",{fromAccid:o,metaData:n,member:d});break;case 3:this.emit("signalingInvite",{fromAccid:o,toAccid:a,requestId:s,pushInfo:c,metaData:n});break;case 4:this.emit("signalingCancelInvite",{fromAccid:o,toAccid:a,requestId:s,metaData:n});break;case 5:this.emit("signalingReject",{fromAccid:o,toAccid:a,requestId:s,metaData:n});break;case 6:this.emit("signalingAccept",{fromAccid:o,toAccid:a,requestId:s,metaData:n});break;case 7:this.emit("signalingLeave",{fromAccid:o,metaData:n});break;case 8:this.emit("signalingCustomCommand",{fromAccid:o,metaData:n});break;default:this.logger.warn("signaling:notification, no such a type "+n.eventType,i)}return u},r.signalingSyncNotificationHandler=function(e){var t,r,n=this;if(e.content.datas&&e.content.datas.length>0){var i=lu(t=au(r=e.content.datas).call(r,(function(e){return n.doNotify(e,1)}))).call(t,(function(e){return e}));i.length>0&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:i})}},r.singalingSyncChannelsHandler=function(e){var t,r=this;if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var n=au(t=e.content.datas).call(t,(function(e){return lC(e)}));Bn(n).call(n,(function(e){var t=e.channelInfo.channelId;r.channels[t]=xS(e.channelInfo)})),this.emit("singalingSyncChannels",n)}},r.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e),ls.resolve(e);var r=Qp(e,"error.detail.ignore");return e.error&&!r?ls.reject(e.error):ls.resolve(e)},t}(Vs.EventEmitter),SC=function(e){function t(t,r){var n;return(n=e.call(this)||this).name=t,n.core=r,n.name=t,n.logger=r.logger,n.core=r,n}er(t,e);var r=t.prototype;return r.emit=function(t){var r=this;try{for(var n,i,o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return(n=e.prototype.emit).call.apply(n,Rs(i=[this,t]).call(i,a))}catch(c){return Ls((function(){throw r.logger.error(r.name+"::emit throw error in setTimeout. event: "+t.toString()+". Error",c),c}),0),!1}},r.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var r=Qp(e,"error.detail.ignore");return e.error&&!r?ls.reject(e.error):ls.resolve(e)},t}(Vs),bC={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor","25_12":"qchatAutoSubscribe","25_13":"qchatAutoSubscribeNotification"},CC={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},EC={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:CC,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},_C=function(){return fh(EC)},kC=function(){var e=_C();return{qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:EC.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:EC.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:EC.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:EC.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:e.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:EC.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:EC.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:EC.qchatUpdateWhiteBlackRoleTag}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:EC.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:EC.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:EC.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:EC.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:EC.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:EC.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:EC.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:e.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:EC.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:e.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:e.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:EC.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:EC.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:EC.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:EC.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:EC.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:EC.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:EC.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:EC.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:EC.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:EC.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:e.qchatChannelIdInfoTag}]},qchatAutoSubscribe:{sid:25,cid:12,service:"qchatChannel",hasPacketTimer:!1,params:[{type:"Property",name:"qchatAutoSubReqTag"}],response:[{type:"Property",name:"qchatAutoSubInfo",reflectMapper:{1:"time"}}]},qchatAutoSubscribeNotification:{service:"qchatChannel",sid:25,cid:13,response:[{type:"PropertyArray",name:"serverIds",reflectMapper:e.unreadInfo},{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:EC.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:EC.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRoles},{type:"String",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:EC.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:EC.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:EC.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:e.qchatChannelIdInfoTag}]}}};!function(e){e[e.reorderWeight=0]="reorderWeight",e[e.createTime=1]="createTime"}(hC||(hC={})),function(e){e[e.white=1]="white",e[e.black=2]="black"}(fC||(fC={})),function(e){e[e.add=1]="add",e[e.remove=2]="remove"}(gC||(gC={})),function(e){e[e.message=0]="message",e[e.media=1]="media",e[e.ext=100]="ext"}(vC||(vC={})),function(e){e[e.ASC=1]="ASC",e[e.DESC=2]="DESC"}(yC||(yC={})),function(e){e[e.reorderWeight=0]="reorderWeight",e[e.createTime=1]="createTime",e[e.totalMember=2]="totalMember"}(IC||(IC={})),function(e){e[e.square=1]="square",e[e.person=2]="person"}(MC||(MC={}));var RC={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:vC},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},wC={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},AC={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:fC},opeType:{type:"enum",values:gC},toAccids:{type:"object"}},xC={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:fC},opeType:{type:"enum",values:gC},roleId:{type:"string"}},NC={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},OC={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function PC(e){return wh(xC,e)}function LC(e){return wh(RC,e)}function VC(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return LC(e)})):[]}function UC(e){return wh(wC,e)}function DC(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return UC(e)})):[]}function qC(e){return wh(NC,e)}function BC(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return qC(e)})):[]}function FC(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return wh(OC,e)})):[]}function GC(e){try{return JSON.parse(e)}catch(t){return[]}}var jC={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},HC={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},WC={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function YC(e){return wh(jC,e)}function KC(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return YC(e)})):[]}function QC(e){return wh(HC,e)}function zC(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return QC(e)})):[]}function JC(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return wh(WC,e)})):[]}function $C(e){var t,r,n;if(!e.antispamTag)return{};var i=sr({},e.antispamTag);return(null===(t=e.antispamTag)||void 0===t?void 0:t.antiSpamBusinessId)&&"string"!=typeof(null===(r=e.antispamTag)||void 0===r?void 0:r.antiSpamBusinessId)&&(i.antiSpamBusinessId=Ti(null===(n=e.antispamTag)||void 0===n?void 0:n.antiSpamBusinessId)),i}var XC={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function ZC(e){return wh(XC,e)}function eE(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return ZC(e)})):[]}var tE,rE,nE,iE,oE={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function aE(e){return wh(oE,e)}!function(e){e[e.everyone=1]="everyone",e[e.custom=2]="custom"}(tE||(tE={})),function(e){e[e.normal=0]="normal",e[e.owner=1]="owner"}(rE||(rE={})),function(e){e[e.ignore=0]="ignore",e[e.deny=-1]="deny",e[e.allow=1]="allow"}(nE||(nE={})),function(e){e[e.manageServer=1]="manageServer",e[e.manageChannel=2]="manageChannel",e[e.manageRole=3]="manageRole",e[e.sendMsg=4]="sendMsg",e[e.accountInfoSelf=5]="accountInfoSelf",e[e.inviteServer=6]="inviteServer",e[e.kickServer=7]="kickServer",e[e.accountInfoOther=8]="accountInfoOther",e[e.recallMsg=9]="recallMsg",e[e.deleteMsg=10]="deleteMsg",e[e.remindOther=11]="remindOther",e[e.remindEveryone=12]="remindEveryone",e[e.manageBlackWhiteList=13]="manageBlackWhiteList",e[e.banServerMember=14]="banServerMember",e[e.RTCChannelConnect=15]="RTCChannelConnect",e[e.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",e[e.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",e[e.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",e[e.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",e[e.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",e[e.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",e[e.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",e[e.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",e[e.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",e[e.manageInviteApply=25]="manageInviteApply",e[e.manageInviteApplyHistory=26]="manageInviteApplyHistory",e[e.mentionedRole=27]="mentionedRole"}(iE||(iE={}));var sE,cE,uE,dE,lE,pE,mE,hE,fE={type:{type:"enum",values:tE},memberType:{type:"enum",values:rE},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},gE={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:tE},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},vE={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:rE},joinTime:{type:"number"},inviter:{type:"string"}};function yE(e){var t,r,n,i=sr({},e),o=Nh(fE,i);return o.auths&&(o.auths=(t=o.auths,n=fl(r=pr(t)).call(r,(function(e,r){var n=iE[r];return n?e[n]=nE[t[r]]:e[r]=nE[t[r]],e}),{}),Ti(n))),o}function IE(e){var t;return fl(t=pr(e)).call(t,(function(t,r){var n=bp(iE,r);return n?t[n]=nE[e[r]]:t[Kp(r)]=nE[e[r]],t}),{})}function ME(e){var t=wh(fE,e);return e.auths&&(t.auths=IE(JSON.parse(t.auths))),t.isMember&&delete t.isMember,t}function TE(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return ME(e)})):[]}function SE(e){return e.auths&&(e.auths=IE(JSON.parse(e.auths))),wh(gE,e)}function bE(e){return e.auths&&(e.auths=IE(JSON.parse(e.auths))),wh(vE,e)}function CE(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}!function(e){e[e.default=1]="default",e[e.sync=2]="sync"}(sE||(sE={})),function(e){e[e.sendTime=1]="sendTime"}(cE||(cE={})),function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(uE||(uE={})),function(e){e[e.sending=1]="sending",e[e.success=2]="success",e[e.failed=3]="failed"}(dE||(dE={})),function(e){e[e.notifyAll=1]="notifyAll",e[e.notifySubscribe=2]="notifySubscribe"}(lE||(lE={})),function(e){e[e.unknown=0]="unknown",e[e.server=1]="server",e[e.channel=2]="channel",e[e.serverAccids=3]="serverAccids",e[e.channelAccids=4]="channelAccids",e[e.accids=5]="accids"}(pE||(pE={})),function(e){e[e.serverMemberInvite=1]="serverMemberInvite",e[e.serverMemberInviteReject=2]="serverMemberInviteReject",e[e.serverMemberApply=3]="serverMemberApply",e[e.serverMemberApplyReject=4]="serverMemberApplyReject",e[e.serverCreate=5]="serverCreate",e[e.serverRemove=6]="serverRemove",e[e.serverUpdate=7]="serverUpdate",e[e.serverMemberInviteDone=8]="serverMemberInviteDone",e[e.serverMemberInviteAccept=9]="serverMemberInviteAccept",e[e.serverMemberApplyDone=10]="serverMemberApplyDone",e[e.serverMemberApplyAccept=11]="serverMemberApplyAccept",e[e.serverMemberKick=12]="serverMemberKick",e[e.serverMemberLeave=13]="serverMemberLeave",e[e.serverMemberUpdate=14]="serverMemberUpdate",e[e.channelCreate=15]="channelCreate",e[e.channelRemove=16]="channelRemove",e[e.channelUpdate=17]="channelUpdate",e[e.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",e[e.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",e[e.updateQuickComment=20]="updateQuickComment",e[e.channelCategoryCreate=21]="channelCategoryCreate",e[e.channelCategoryRemove=22]="channelCategoryRemove",e[e.channelCategoryUpdate=23]="channelCategoryUpdate",e[e.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",e[e.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",e[e.serverIdentifyAdd=26]="serverIdentifyAdd",e[e.serverIdentifyRemove=27]="serverIdentifyRemove",e[e.serverIdentifyUpdate=28]="serverIdentifyUpdate",e[e.channelIdentifyUpdate=29]="channelIdentifyUpdate",e[e.userIdentifyUpdate=30]="userIdentifyUpdate",e[e.channelVisibilityUpdate=31]="channelVisibilityUpdate",e[e.serverEnterLeave=32]="serverEnterLeave",e[e.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",e[e.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",e[e.myMemberInfoUpdated=35]="myMemberInfoUpdated",e[e.custom=100]="custom",e[e.msgTyping=101]="msgTyping"}(mE||(mE={})),function(e){e[e.reply=1]="reply",e[e.thread=2]="thread",e[e.all=3]="all"}(hE||(hE={}));var EE,_E=Math.max,kE=Math.min;function RE(e,t,r){var n,i,o,a,s,c,u=0,d=!1,l=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var r=n,o=i;return n=i=void 0,u=t,a=e.apply(o,r)}function h(e){return u=e,s=Ls(g,t),d?m(e):a}function f(e){var r=e-c;return void 0===c||r>=t||r<0||l&&e-u>=o}function g(){var e,r,n=Ts();if(f(n))return v(n);s=Ls(g,(r=t-((e=n)-c),l?kE(r,o-(e-u)):r))}function v(e){return s=void 0,p&&n?m(e):(n=i=void 0,a)}function y(){var e=Ts(),r=f(e);if(n=arguments,i=this,c=e,r){if(void 0===s)return h(c);if(l)return clearTimeout(s),s=Ls(g,t),m(c)}return void 0===s&&(s=Ls(g,t)),a}return t=Number(t)||0,CE(r)&&(d=!!r.leading,o=(l="maxWait"in r)?_E(Number(r.maxWait)||0,t):o,p="trailing"in r?!!r.trailing:p),y.cancel=function(){void 0!==s&&clearTimeout(s),u=0,n=c=i=s=void 0},y.flush=function(){return void 0===s?a:v(Ts())},y}function wE(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return CE(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),RE(e,t,{leading:n,maxWait:t,trailing:i})}!function(e){e[e.sub=1]="sub",e[e.unSub=2]="unSub"}(EE||(EE={}));var AE=function(){function e(e){var t=this;this.unreadCount={},this.manualSubscribeUnreadMap={},this.manualSubscribeServerMap={},this.manualSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this._serverUnreadInfo=wE((function(e){t.core.emit("serverUnreadInfo",t.getServerUnreadInfo(e)),Qp(t.core,"qchatServer.emit")&&t.core.qchatServer.emit("serverUnreadInfo",t.getServerUnreadInfo(e))}),100),this.core=e}var t=e.prototype;return t.changeCacheServerRoleIds=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c,u=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.attach.serverIdentifyInfo,i=n.serverId,o=n.roleId,this.serverRoleIdsMap[i]){t.next=4;break}return t.next=4,this.getRoleIdsByServerId([i]);case 4:if(a=this.serverRoleIdsMap[i],!(e.time<a.timeTag)){t.next=7;break}return t.abrupt("return");case 7:if(e.type===mE[mE.serverIdentifyAdd]?a.roleIds.add(o):a.roleIds.delete(o),this.core.logger.debug("QChatChannel::qchatChannel/serverIdentifyChange::now "+i+" roleIds is",Rs(r=[]).call(r,a.roleIds)),s=this.unreadServerCount[i]){t.next=12;break}return t.abrupt("return");case 12:c=_S(pr(s),100),Bn(c).call(c,(function(e){u.core.qchatChannel.getChannelUnreadInfos({channels:au(e).call(e,(function(e){return{serverId:i,channelId:e}}))})}));case 14:case"end":return t.stop()}}),t,this)})))},t.getRoleIdsByServerId=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=lu(e).call(e,(function(e){return!a.serverRoleIdsMap[e]}))).length){t.next=3;break}return t.abrupt("return");case 3:return i={serverIdTimeTags:n},t.next=6,this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:i});case 6:o=t.sent,this.core.logger.debug("QChatChannel:: getRoleIdsByServerId, params is ",i,"result is",o),Bn(r=o.content.serverRoles).call(r,(function(e){try{e.roleIds=JSON.parse(e.roleIds)}catch(t){a.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",t)}a.serverRoleIdsMap[e.serverId]={roleIds:new sM(e.roleIds),timeTag:e.timeTag}}));case 9:case"end":return t.stop()}}),t,this)})))},t._unSubscribeChannel=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e+"_"+t,i=[],this.manualSubscribeUnreadMap[n]?i.push(this.manualSubscribeUnreadMap[n]):this.autoSubscribeUnreadMap[n]&&i.push(this.autoSubscribeUnreadMap[n]),this.manualSubscribeTypingMap[n]&&i.push(this.manualSubscribeTypingMap[n]),0!==i.length){r.next=6;break}return r.abrupt("return");case 6:for(o=0,a=i;o<a.length;o++)s=a[o],this.subscribe({opeType:EE.unSub,type:s,channels:[{serverId:e,channelId:t}]});this.manualSubscribeUnreadMap[n]?this.manualSubscribeUnreadMap[n]=void 0:this.autoSubscribeUnreadMap[n]&&(this.autoSubscribeUnreadMap[n]=void 0),this.manualSubscribeTypingMap[n]&&(this.manualSubscribeTypingMap[n]=void 0);case 9:case"end":return r.stop()}}),r,this)})))},t._unSubscribeServer=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e,n=this.manualSubscribeServerMap[r]||this.autoSubscribeServerMap[r]){t.next=4;break}return t.abrupt("return");case 4:this.subscribe({opeType:EE.unSub,type:n,channels:[{serverId:e,channelId:""}]}),this.manualSubscribeServerMap[r]?this.manualSubscribeServerMap[r]=void 0:this.autoSubscribeServerMap[r]&&(this.autoSubscribeServerMap[r]=void 0);case 6:case"end":return t.stop()}}),t,this)})))},t.subscribe=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},e),t.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:e.type,opeType:e.opeType},channels:e.channels});case 3:return n=t.sent,i=new sM,Bn(r=e.channels).call(r,(function(e){return Wl(a,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.serverRoleIdsMap[e.serverId]||i.add(e.serverId);case 1:case"end":return t.stop()}}),t,this)})))})),o=_S(Vl(i),10),Bn(o).call(o,(function(e){a.getRoleIdsByServerId(e)})),t.abrupt("return",n.content);case 9:case"end":return t.stop()}}),t,this)})))},t.autoSubscribe=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("qchatAutoSubscribe",{qchatAutoSubReqTag:{}});case 2:case"end":return e.stop()}}),e,this)})))},t.resumeSubscribe=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c,u=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.serverRoleIdsMap={},a=100,e){t.next=6;break}return this.unreadServerCount={},this.unreadCount={},t.abrupt("return");case 6:return s={},Bn(r=pr(this.manualSubscribeUnreadMap)).call(r,(function(e){var t=u.manualSubscribeUnreadMap[e];if(t){var r=e.split("_"),n={serverId:r[0],channelId:r[1]};s[t]=s[t]||[],s[t].push(n)}})),s[5]=[],Bn(n=pr(this.manualSubscribeTypingMap)).call(n,(function(e){return Wl(u,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.manualSubscribeTypingMap[e]&&(r=e.split("_"),n=r[0],i=r[1],o={serverId:n,channelId:i},s[5].push(o));case 2:case"end":return t.stop()}}),t,this)})))})),s[4]=[],Bn(i=pr(this.manualSubscribeServerMap)).call(i,(function(e){return Wl(u,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.manualSubscribeServerMap[e]&&(r={serverId:e},s[4].push(r));case 2:case"end":return t.stop()}}),t,this)})))})),c=[],Bn(o=pr(s)).call(o,(function(e){var t=s[e];if(t&&0===t.length)return ls.resolve();if(t.length>a){var r=_S(t,100);return Bn(r).call(r,(function(t){c.push(u.createSubscribePromise(t,e))}))}c.push(u.createSubscribePromise(t,e))})),t.next=16,ls.all(c);case 16:case"end":return t.stop()}}),t,this)})))},t.createSubscribePromise=function(e,t){var r=this,n={type:Kp(t),opeType:1,channels:e};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",n),this.subscribe(n).then((function(e){var t=e.unreadInfos;t&&t.length>0&&(t=DC(t),r.updateUnreads(t))})).catch((function(e){r.core.logger.error("qchatChannel:: autoSubscribeUnread error ",e)}))},t.cacheSubscribe=function(e){var t,r=this;Bn(t=e.channels).call(t,(function(t){var n=t.channelId?t.serverId+"_"+t.channelId:""+t.serverId,i=5===e.type?r.manualSubscribeTypingMap:4===e.type?r.manualSubscribeServerMap:r.manualSubscribeUnreadMap;e.opeType===EE.sub?i[n]=e.type:e.opeType===EE.unSub&&(i[n]=void 0)}))},t.cacheAutoSubscribe=function(e){var t,r=this;Bn(t=e.channels).call(t,(function(t){var n=t.channelId?t.serverId+"_"+t.channelId:""+t.serverId,i=4===e.type?r.autoSubscribeServerMap:r.autoSubscribeUnreadMap;e.opeType===EE.sub?i[n]=e.type:e.opeType===EE.unSub&&(i[n]=void 0)}))},t.cacheUnreadCount=function(e){var t=this;Bn(e).call(e,(function(e){var r=e.serverId+"_"+e.channelId;t.unreadCount[r]=sr({},e),t.unreadServerCount[e.serverId]||(t.unreadServerCount[e.serverId]={}),t.unreadServerCount[e.serverId][e.channelId]=!0}))},t.getServerUnreadInfo=function(e){var t,r=this,n={serverId:e,unreadCount:0,mentionedCount:0,maxCount:0},i=this.unreadServerCount[e];return i&&(Bn(t=pr(i)).call(t,(function(t){var i=e+"_"+t,o=r.unreadCount[i];n.unreadCount+=o.unreadCount,n.mentionedCount+=o.mentionedCount,void 0!==o.maxCount&&(n.maxCount=o.maxCount)})),n.unreadCount=n.unreadCount>n.maxCount?n.maxCount:n.unreadCount,n.mentionedCount=n.mentionedCount>n.maxCount?n.maxCount:n.mentionedCount),n},t.getUnreadInfo=function(e){Al({serverId:{type:"string"},channelId:{type:"string"}},e);var t=e.serverId+"_"+e.channelId;return this.unreadCount[t]?this.unreadCount[t]:null},t.shouldChangeUnread=function(e,t){if(!e.serverId||!e.channelId)return!1;if(this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(e.serverId,e.channelId))return!1;if(!1===e.historyEnable)return!1;if(!1===e.needBadge)return!1;if(e.fromAccount===this.core.account)return!1;if(t&&2!==(null==e?void 0:e.status))return!1;if(e.notifyReason&&e.notifyReason===bp(lE,lE.notifySubscribe)){if(!e.serverId||!e.channelId)return!1;var r=this.getUnreadInfo({serverId:e.serverId,channelId:e.channelId}),n=t?"ackTimestamp":"lastMsgTime";if(!r)return!1;if(e.time&&r[n]&&r[n]>e.time)return!1}return!0},t.shouldChangeMentionedUnread=function(e,t){return void 0===t&&(t=!1),Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.accidsOfMentionedRoles||!tu(n=e.accidsOfMentionedRoles).call(n,this.core.account)){r.next=2;break}return r.abrupt("return",!0);case 2:if(!e.mentionRoleIds||!e.serverId){r.next=16;break}if(this.serverRoleIdsMap[e.serverId]){r.next=9;break}if(t){r.next=7;break}return this.handledRoleMsg(e),r.abrupt("return",!1);case 7:return r.next=9,this.getRoleIdsByServerId([e.serverId]);case 9:i=0;case 10:if(!(i<e.mentionRoleIds.length)){r.next=16;break}if(!this.serverRoleIdsMap[e.serverId].roleIds.has(e.mentionRoleIds[i])){r.next=13;break}return r.abrupt("return",!0);case 13:i++,r.next=10;break;case 16:return r.abrupt("return",!1);case 17:case"end":return r.stop()}}),r,this)})))},t.handledRoleMsg=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.mentionRoleIds){t.next=2;break}return t.abrupt("return");case 2:if(this.serverRoleIdsMap[e.serverId]){t.next=5;break}return t.next=5,this.getRoleIdsByServerId([e.serverId]);case 5:if(this.serverRoleIdsMap[e.serverId]){t.next=8;break}return this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",e.serverId),t.abrupt("return");case 8:if(n=!1,Bn(r=e.mentionRoleIds).call(r,(function(t){s.serverRoleIdsMap[e.serverId].roleIds.has(t)&&(n=!0,s.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCount，message is ",e))})),n){t.next=12;break}return t.abrupt("return");case 12:if(i=this.unreadCount[e.serverId+"_"+e.channelId],o=2===(null==e?void 0:e.status),i.mentionedCount=o?i.mentionedCount?i.mentionedCount-1:0:i.mentionedCount?i.mentionedCount+1:1,"number"!=typeof i.maxCount){t.next=25;break}if(!((a=(a=i.mentionedCount)>i.maxCount?i.maxCount:a)>i.maxCount)){t.next=21;break}return this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount"),t.abrupt("return");case 21:this.core.emit("unreadInfo",sr(sr({},i),{mentionedCount:a})),this.core.emit("unreadInfos",[sr(sr({},i),{mentionedCount:a})]),this.core.qchatChannel.emit("unreadInfos",[sr(sr({},i),{mentionedCount:a})]),this._serverUnreadInfo(e.serverId);case 25:case"end":return t.stop()}}),t,this)})))},t.getMentionedFlag=function(e,t){return void 0===t&&(t=!1),Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.mentionAll){r.next=4;break}return r.abrupt("return",!0);case 4:if(!e.mentionRoleIds&&!e.accidsOfMentionedRoles){r.next=10;break}return r.next=7,this.shouldChangeMentionedUnread(e,t);case 7:return r.abrupt("return",r.sent);case 10:if(!e.mentionAccids||!tu(n=e.mentionAccids).call(n,this.core.account)){r.next=12;break}return r.abrupt("return",!0);case 12:return r.abrupt("return",!1);case 13:case"end":return r.stop()}}),r,this)})))},t.changeUnread=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c,u;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.serverId,i=e.channelId,o=n+"_"+i,this.shouldChangeUnread(e,t)){r.next=6;break}return this.core.logger.debug("changeUnread: "+o+" does not need to update unreadInfo"),r.abrupt("return");case 6:if(this.unreadCount[o]){r.next=11;break}return r.next=9,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:n,channelId:i}]});case 9:return!this.serverRoleIdsMap[n]&&e.mentionRoleIds&&this.getRoleIdsByServerId([n]),r.abrupt("return");case 11:return a=this.unreadCount[o],s=2===(null==e?void 0:e.status),r.next=15,this.getMentionedFlag(e);case 15:if(c=r.sent,s?(a.unreadCount=a.unreadCount?a.unreadCount-1:0,c&&(a.mentionedCount=a.mentionedCount?a.mentionedCount-1:0),delete a.lastMsgTime,this.core.logger.debug("changeUnread: "+o+" unread reduce ",a)):(a.unreadCount=a.unreadCount?a.unreadCount+1:1,c&&(a.mentionedCount=a.mentionedCount?a.mentionedCount+1:1),e.time&&(a.lastMsgTime=e.time),this.core.logger.debug("changeUnread: "+o+" unread add ",a)),u="number"==typeof a.maxCount?a.maxCount:100,!(a.unreadCount>u)){r.next=21;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),r.abrupt("return");case 21:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",sr(sr({},a),{mentionedCount:a.mentionedCount>u?u:a.mentionedCount,unreadCount:a.unreadCount>u?u:a.unreadCount})),this.core.emit("unreadInfos",[sr(sr({},a),{mentionedCount:a.mentionedCount>u?u:a.mentionedCount,unreadCount:a.unreadCount>u?u:a.unreadCount})]),this.core.qchatChannel.emit("unreadInfos",[sr(sr({},a),{mentionedCount:a.mentionedCount>u?u:a.mentionedCount,unreadCount:a.unreadCount>u?u:a.unreadCount})]),this._serverUnreadInfo(n);case 26:case"end":return r.stop()}}),r,this)})))},t.updateUnreads=function(e){var t,r,n=this;if(e&&e.length>0){var i=[],o=[],a=au(t=lu(e).call(e,(function(e){var t=e.serverId+"_"+e.channelId,r=n.unreadCount[t],i=Qp(r,"ackTimestamp"),o=Qp(e,"ackTimestamp");return!(i&&o&&o<i||Qp(r,"unreadCount")===Qp(e,"unreadCount")&&Qp(r,"mentionedCount")===Qp(e,"mentionedCount"))}))).call(t,(function(e){i.push(n.getServerUnreadInfo(e.serverId)),o.push(n.unreadServerCount[e.serverId]);var t=e.serverId,r=e.channelId,a=t+"_"+r;return n.core.logger.debug("qchat channel updateUnread: ",e),n.unreadCount[a]=sr({},e),n.unreadServerCount[t]||(n.unreadServerCount[t]={}),n.unreadServerCount[t][r]=!0,e}));if(0!==a.length){this.core.emit("unreadInfos",a),this.core.qchatChannel.emit("unreadInfos",a);var s={};Bn(a).call(a,(function(e,t){n.core.emit("unreadInfo",e);var r=i[t],a=o[t],c=n.getServerUnreadInfo(e.serverId),u=n.unreadServerCount[e.serverId],d=r.unreadCount!==c.unreadCount,l=!a||0===pr(a).length,p=u&&pr(u).length>0,m=r.mentionedCount!==c.mentionedCount;(d||m||l&&p)&&(s[e.serverId]=!0)})),Bn(r=pr(s)).call(r,(function(e){n.core.emit("serverUnreadInfo",n.getServerUnreadInfo(e)),Qp(n.core,"qchatServer.emit")&&n.core.qchatServer.emit("serverUnreadInfo",n.getServerUnreadInfo(e))}))}}},t.clearUnreadCountByServers=function(e,t){var r=this,n=[];Bn(e).call(e,(function(e){var t;r.unreadServerCount[e]&&Bn(t=pr(r.unreadServerCount[e])).call(t,(function(t){n.push(e+"_"+t)}))}));var i=[];Bn(n).call(n,(function(e){i.push(sr(sr({},r.unreadCount[e]),{unreadCount:0,mentionedCount:0,ackTimestamp:t}))})),this.updateUnreads(i)},e}(),xE=function(){function e(e){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new sM,this.autoVisitorSubscribeServer=new sM,this.autoVisitorSubscribeChannel=new sM,this.core=e}var t=e.prototype;return t.subscribeChannelAsVisitor=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:e.type||6,opeType:e.opeType},datas:e.channels});case 2:return n=t.sent,i=n.content.failedArr,o=lu(r=e.channels).call(r,(function(e){return!Um(i).call(i,(function(t){return t.channelId===e.channelId&&t.serverId===e.serverId}))})),Bn(o).call(o,(function(t){1===e.opeType?a.autoVisitorSubscribeChannel.add(t.serverId+"&"+t.channelId):a.autoVisitorSubscribeChannel.delete(t.serverId+"&"+t.channelId)})),t.abrupt("return",{failedChannels:i});case 7:case"end":return t.stop()}}),t,this)})))},t.subscribeServerAsVisitor=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s,c=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:e.type||7,opeType:e.opeType},datas:au(r=e.serverIds).call(r,(function(e){return{serverId:e}}))});case 2:return o=t.sent,a=o.content.failedArr,s=lu(n=e.serverIds).call(n,(function(e){return!Um(a).call(a,(function(t){return t.serverId===e}))})),Bn(s).call(s,(function(t){1===e.opeType?c.autoVisitorSubscribeServer.add(t):c.autoVisitorSubscribeServer.delete(t)})),t.abrupt("return",{failedServers:au(i=o.content.failedArr).call(i,(function(e){return e.serverId}))});case 7:case"end":return t.stop()}}),t,this)})))},t.deleteServer=function(e){var t;this.autoServers.delete(e),this.autoVisitorSubscribeServer.has(e)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[e]});var r=[];Bn(t=this.autoVisitorSubscribeChannel).call(t,(function(t){if(0===bu(t).call(t,e)){var n=t.replace(e+"&","");r.push({serverId:e,channelId:n})}})),r.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:r})},t.deleteAutoSetInServerId=function(e){var t,r=this;this.autoServers.delete(e),this.autoVisitorSubscribeServer.delete(e),Bn(t=this.autoVisitorSubscribeChannel).call(t,(function(t){0===bu(t).call(t,e)&&r.autoVisitorSubscribeChannel.delete(t)}))},t.deleteAutoSetInChannel=function(e,t){this.autoVisitorSubscribeChannel.delete(e+"&"+t)},t.unSubscribeChannel=function(e,t){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:e,channelId:t}]})},t.isInSubscribeChannels=function(e,t){return this.autoVisitorSubscribeChannel.has(e+"&"+t)},t.isInAutoServers=function(e){return this.autoServers.has(e)},t.doAutoSubscribe=function(){var e=this,t=[],r=_S(Vl(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe);Bn(r).call(r,(function(r){t.push(e.subscribeServerAsVisitor({opeType:1,serverIds:r}))}));var n=_S(Vl(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe);return Bn(n).call(n,(function(r){t.push(e.subscribeChannelAsVisitor({opeType:1,channels:au(r).call(r,(function(e){var t=bu(e).call(e,"&");return{serverId:Fc(e).call(e,0,t),channelId:Fc(e).call(e,t+1)}}))}))})),ls.all(t)},t.doAutoEnterServer=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i=this;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=_S(Vl(this.autoServers),this.limitForBatchEnter),r=[],Bn(t).call(t,(function(e){r.push(i.core.qchatServer.enterAsVisitor({serverIds:e}))})),e.next=5,ls.all(r);case 5:n=e.sent,Bn(n).call(n,(function(e){var t;Bn(t=e.failedServers).call(t,(function(e){i.deleteAutoSetInServerId(e)}))}));case 7:case"end":return e.stop()}}),e,this)})))},t.resumeSubscribe=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=7;break}return t.next=3,this.doAutoEnterServer();case 3:return t.next=5,this.doAutoSubscribe();case 5:t.next=10;break;case 7:this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear();case 10:case"end":return t.stop()}}),t,this)})))},t.cacheServer=function(e){var t=this;Bn(e).call(e,(function(e){return t.autoServers.add(e)}))},e}();function NE(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return OE(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?OE(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function OE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var PE=function(e){function t(t,r){var n;return(n=e.call(this,"qchatChannel",t)||this).config={autoSubscribe:!1},n.core=t,hh({cmdMap:bC,cmdConfig:kC()}),r&&n.setOptions(r),n.subscribeModuleService=new AE(t),n.subscribeForVisitorService=new xE(t),n.setListener(),n}er(t,e);var r=t.prototype;return r.setOptions=function(e){e&&(this.config=sr(this.config,e))},r.setListener=function(){var e,t,r,n,i,o=this;this.core.eventBus.on("logined",(function(e){o.subscribeModuleService.resumeSubscribe(e.isAutoReconnect),o.subscribeForVisitorService.resumeSubscribe(e.isAutoReconnect),o.config.autoSubscribe&&(o.subscribeModuleService.autoSubscribeServerMap={},o.subscribeModuleService.autoSubscribeUnreadMap={},o.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(e){o.subscribeModuleService.resumeSubscribe(e.isReconnect),o.subscribeForVisitorService.resumeSubscribe(e.isReconnect),o.config.autoSubscribe&&(o.subscribeModuleService.autoSubscribeServerMap={},o.subscribeModuleService.autoSubscribeUnreadMap={},o.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("qchatChannel/changeUnread",Xt(e=this.subscribeModuleService.changeUnread).call(e,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/updateUnreads",Xt(t=this.subscribeModuleService.updateUnreads).call(t,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/cacheSubscribe",Xt(r=this.subscribeModuleService.cacheSubscribe).call(r,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/clearUnreadCountByServers",Xt(n=this.subscribeModuleService.clearUnreadCountByServers).call(n,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/getRoleIdsByServerId",Xt(i=this.subscribeModuleService.getRoleIdsByServerId).call(i,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/autoUnSubscribe",(function(e){if(o.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",e),e.type===mE[mE.channelVisibilityUpdate])o.logger.log("QChatChannel::begin autoUnSubscribe channel key is",e.serverId+"_"+e.channelId),o.subscribeModuleService._unSubscribeChannel(e.serverId,e.channelId),o.logger.log("QChatChannel::autoUnSubscribe channel done key is",e.serverId+"_"+e.channelId);else if(e.type===mE[mE.serverEnterLeave]){var t;(o.subscribeModuleService.manualSubscribeServerMap[e.serverId]||o.subscribeModuleService.autoSubscribeServerMap[e.serverId])&&(o.logger.log("QChatChannel::begin autoUnSubscribe server key is",e.serverId),o.subscribeModuleService._unSubscribeServer(e.serverId),o.logger.log("QChatChannel::autoUnSubscribe server done key is",e.serverId));var r=o.subscribeModuleService.unreadServerCount[e.serverId];if(!r)return;o.logger.log("QChatChannel::begin autoUnSubscribe channels key is",pr(r)),Bn(t=pr(r)).call(t,(function(t){o.subscribeModuleService._unSubscribeChannel(e.serverId,t)})),o.logger.log("QChatChannel::autoUnSubscribe channels done key is",pr(r))}})),this.core.eventBus.on("qchatChannel/serverIdentifyChange",(function(e){o.subscribeModuleService.changeCacheServerRoleIds(e)}))},r.createChannel=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},type:{type:"enum",values:Sp(vC)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:sr(sr({},e),{type:vC[e.type]}),antispamTag:$C(e)});case 3:return r=t.sent,t.abrupt("return",LC(r.content.channelInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.deleteChannel=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatDeleteChannel",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannel=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:Sp(vC),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e),r=e,e.type&&(r.type=vC[e.type]),t.next=5,this.core.sendCmd("qchatUpdateChannel",{channelInfo:r,antispamTag:$C(e)});case 5:return n=t.sent,t.abrupt("return",LC(n.content.channelInfo));case 7:case"end":return t.stop()}}),t,this)})))},r.getChannels=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannels",e);case 3:return r=t.sent,t.abrupt("return",VC(r.content.channelList));case 5:case"end":return t.stop()}}),t,this)})))},r.getChannelsByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:sr({limit:100},e)});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:VC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getMembersByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:zC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateWhiteBlackRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:Sp(fC)},opeType:{type:"enum",values:Sp(gC)}},e),t.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:sr(sr({},e),{type:fC[e.type],opeType:gC[e.opeType]})});case 3:case"end":return t.stop()}}),t,this)})))},r.getWhiteBlackRolesPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Sp(fC)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:sr(sr({},e),{type:fC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:TE(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateWhiteBlackMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Sp(fC)},opeType:{type:"enum",values:Sp(gC)},toAccids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:sr(sr({},e),{type:fC[e.type],opeType:gC[e.opeType],toAccids:Ti(e.toAccids)})});case 3:case"end":return t.stop()}}),t,this)})))},r.getWhiteBlackMembersPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Sp(fC)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:sr(sr({limit:100},e),{type:fC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:zC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getExistingWhiteBlackRoles=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Sp(fC)},roleIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:sr(sr({},e),{type:fC[e.type],roleIds:Ti(e.roleIds)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",{datas:TE(n)});case 6:case"end":return t.stop()}}),t,this)})))},r.getExistingWhiteBlackMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Sp(fC)},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:sr(sr({},e),{type:fC[e.type],accids:Ti(e.accids)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",{datas:zC(n)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateCategoryInfoOfChannel=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:e});case 3:return r=t.sent,t.abrupt("return",LC(r.content.channelInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.createChannelCategory=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:e});case 3:return r=t.sent,t.abrupt("return",qC(r.content.QChatChannelCategoryInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.removeChannelCategory=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({categoryId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelCategory",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategory=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:e});case 3:return r=t.sent,t.abrupt("return",qC(r.content.QChatChannelCategoryInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoriesByID=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({categoryIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",e);case 3:return r=t.sent,t.abrupt("return",BC(r.content.channelCategoryList));case 5:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryWhiteBlackRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Sp(fC)},opeType:{type:"enum",values:Sp(gC)},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:sr(sr({},e),{type:fC[e.type],opeType:gC[e.opeType]})});case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackRolesPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Sp(fC)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:sr(sr({},e),{type:fC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:TE(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryWhiteBlackMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Sp(fC)},opeType:{type:"enum",values:Sp(gC)},toAccids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:sr(sr({},e),{type:fC[e.type],opeType:gC[e.opeType],toAccids:Ti(e.toAccids)})});case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackMembersPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Sp(fC)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:sr(sr({},e),{type:fC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:zC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackRoles=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Sp(fC)},roleIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:sr(sr({},e),{type:fC[e.type],roleIds:Ti(e.roleIds)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",TE(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Sp(fC)},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:sr(sr({},e),{type:fC[e.type],accids:Ti(e.accids)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",zC(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoriesPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:BC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryChannelsPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:VC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.subscribeChannel=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},e),!this.config.autoSubscribe||e.isInternalTrigger||5===e.type){t.next=3;break}throw new _l("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:return t.next=5,this.subscribeModuleService.subscribe(e);case 5:if((r=t.sent).unreadInfos=DC(r.unreadInfos),5!==e.type){t.next=10;break}return this.subscribeModuleService.cacheSubscribe(e),t.abrupt("return");case 10:return 1===e.opeType&&(e.channels=au(n=r.unreadInfos).call(n,(function(e){return{serverId:e.serverId,channelId:e.channelId}}))),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",e),this.config.autoSubscribe?this.subscribeModuleService.cacheAutoSubscribe(e):this.subscribeModuleService.cacheSubscribe(e),this.subscribeModuleService.updateUnreads(r.unreadInfos),t.abrupt("return",r);case 15:case"end":return t.stop()}}),t,this)})))},r.getChannelUnreadInfos=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetUnreadInfo",e);case 2:return r=t.sent,n=DC(r.content.unreadInfos),this.subscribeModuleService.updateUnreads(n),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelSearchByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:Sp(yC),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:Sp(hC),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),!(e.startTime&&e.endTime&&e.startTime>=e.endTime)){t.next=3;break}throw new Sl("startTime more than endTime",e,"timeRule");case 3:return t.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:sr(sr({},e),{order:e.order&&yC[e.order],sort:xm(e)&&hC[xm(e)]})});case 5:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag),cursor:o.cursor},datas:VC(i)});case 8:case"end":return t.stop()}}),t,this)})))},r.channelMemberSearch=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:e});case 3:return r=t.sent,t.abrupt("return",FC(r.content.datas));case 5:case"end":return t.stop()}}),t,this)})))},r.subscribeAsVisitor=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},e),t.next=3,this.subscribeForVisitorService.subscribeChannelAsVisitor(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.qchatAutoSubscribeNotificationHandler=function(e){var t=DC(e.content.unreadInfos),r=e.content.serverIds;this.subscribeModuleService.updateUnreads(t);var n=[];if(r.length){var i={opeType:1};i.channels=au(r).call(r,(function(e){return{serverId:e.serverId,channelId:""}})),i.type=4,n.push(i)}if(t.length){var o={opeType:1};o.channels=au(t).call(t,(function(e){return{serverId:e.serverId,channelId:e.channelId}})),o.type=1,n.push(o)}if(n.length)for(var a,s=NE(n);!(a=s()).done;){var c=a.value;this.subscribeModuleService.cacheAutoSubscribe(c)}},t}(SC),LE={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},VE={limit:{type:"number"}};function UE(e){return Si(e)&&e.length>0?au(e).call(e,(function(e){return wh(LE,e)})):[]}function DE(e){try{e.audio&&(e.audio=JSON.parse(e.audio))}catch(t){throw new Sl('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{e.video&&(e.video=JSON.parse(e.video))}catch(t){throw new Sl('result "video" JSON parse error',{key:"video"},"JSON parse error")}return wh(VE,e)}var qE,BE={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},FE={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},GE=function(){var e=fh(FE);return{qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:FE.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:e.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:FE.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:FE.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:e.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:FE.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:e.memberInfo}]}}},jE=function(e){function t(t,r){var n;return(n=e.call(this,"qchatMedia",t)||this).config={},n.tokenExpireTime=24e4,n.getTokenState=!1,n.core=t,hh({cmdMap:BE,cmdConfig:GE()}),r&&n.setOptions(r),n.setListener(),n.tokenExpireTime=24e4,n.channelId="",n.serverId="",n}er(t,e);var r=t.prototype;return r.setOptions=function(e){e&&(this.config=sr(this.config,e),(null==e?void 0:e.neroom)&&this.setNeroom(e.neroom))},r.setNeroom=function(e){this.neroom=new e},r.setListener=function(){var e,t,r,n,i=this;this.core.eventBus.on("disconnect",Xt(e=this._existRomm).call(e,this)),this.core.eventBus.on("kicked",Xt(t=this._existRomm).call(t,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",Xt(r=this._existRomm).call(r,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",Xt(n=this._existRomm).call(n,this)),this.core.eventBus.on("qchatMedia/serverOrChannelLeave",(function(e){return Wl(i,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.type===mE[mE.channelVisibilityUpdate]&&e.channelId===this.channelId||e.type===mE[mE.serverEnterLeave]&&e.serverId===this.serverId)){t.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){t.next=4;break}return t.next=4,this.disconnectChannel();case 4:case"end":return t.stop()}}),t,this)})))}))},r._existRomm=function(){return Wl(this,void 0,void 0,jl.mark((function e(){return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.roomContext){e.next=3;break}return e.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return e.stop()}}),e,this)})))},r._checkPermission=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.qchatRole.checkPermission(e);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)})))},r._checkConnectState=function(){if("connect"!==this.state)throw new _l("QChatMedia::you should connect first")},r.kickMemberOut=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,r.next=5,null===(t=this.roomContext)||void 0===t?void 0:t.kickMemberOut(e.accid);case 5:r.next=11;break;case 7:throw r.prev=7,r.t0=r.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+Ti(e),r.t0),new _l("QChatMedia::kickMemberOut error",r.t0);case 11:case"end":return r.stop()}}),r,this,[[2,7]])})))},r.disconnectChannel=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.debug("QChatMedia::disconnect begin disconnect"),t.prev=1,t.next=4,null===(e=this.roomContext)||void 0===e?void 0:e.leaveRoom();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),this.logger.error("QChatMedia::disconnect error",t.t0);case 9:if(!this.authService){t.next=12;break}return t.next=12,this.authService.logout();case 12:this._setStateInit(),this.core.emit("qchatMediaDisconnect"),this.core.qchatMedia.emit("qchatMediaDisconnect");case 15:case"end":return t.stop()}}),t,this,[[1,6]])})))},r._setStateInit=function(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""},r.muteAudio=function(e){var t,r,n,i,o;return Wl(this,void 0,void 0,jl.mark((function a(){var s;return jl.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1}},e),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)!==e.accid){a.next=14;break}return a.prev=3,a.next=6,null===(r=this.rtcController)||void 0===r?void 0:r.muteMyAudio();case 6:a.next=12;break;case 8:throw a.prev=8,a.t0=a.catch(3),this.logger.error("QChatMedia::muteAudio error",a.t0),new _l("QChatMedia::muteAudio error",a.t0);case 12:case 25:a.next=31;break;case 14:if(a.prev=14,!(s=null===(n=this.roomContext)||void 0===n?void 0:n.roomProperties.audioOff)||"offNotAllowSelfOn"!==(null===(i=s.value)||void 0===i?void 0:i.split("_")[0])){a.next=23;break}return a.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(a.sent){a.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),a.abrupt("return");case 23:return a.next=25,null===(o=this.rtcController)||void 0===o?void 0:o.muteMemberAudio(e.accid);case 27:throw a.prev=27,a.t1=a.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+Ti(e),a.t1),new _l("QChatMedia::muteAudio error",a.t1);case 31:case"end":return a.stop()}}),a,this,[[3,8],[14,27]])})))},r.unMuteAudio=function(e){var t,r,n,i,o;return Wl(this,void 0,void 0,jl.mark((function a(){var s;return jl.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1}},e),!(s=null===(t=this.roomContext)||void 0===t?void 0:t.roomProperties.audioOff)||"offNotAllowSelfOn"!==(null===(r=s.value)||void 0===r?void 0:r.split("_")[0])){a.next=10;break}return a.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(a.sent){a.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),a.abrupt("return");case 10:if((null===(n=this.roomContext)||void 0===n?void 0:n.localMember.uuid)!==e.accid){a.next=22;break}return a.prev=11,a.next=14,null===(i=this.rtcController)||void 0===i?void 0:i.unmuteMyAudio();case 14:a.next=20;break;case 16:throw a.prev=16,a.t0=a.catch(11),this.logger.error("QChatMedia::unMuteAudio error",a.t0),new _l("QChatMedia::unMuteAudio error",a.t0);case 20:case 25:a.next=31;break;case 22:return a.prev=22,a.next=25,null===(o=this.rtcController)||void 0===o?void 0:o.unmuteMemberAudio(e.accid);case 27:throw a.prev=27,a.t1=a.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+Ti(e),a.t1),new _l("QChatMedia::unMuteAudio error",a.t1);case 31:case"end":return a.stop()}}),a,this,[[11,16],[22,27]])})))},r.muteVideo=function(e){var t,r,n,i,o;return Wl(this,void 0,void 0,jl.mark((function a(){var s;return jl.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1}},e),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)!==e.accid){a.next=14;break}return a.prev=3,a.next=6,null===(r=this.rtcController)||void 0===r?void 0:r.muteMyVideo();case 6:a.next=12;break;case 8:throw a.prev=8,a.t0=a.catch(3),this.logger.error("QChatMedia::muteVideo error",a.t0),new _l("QChatMedia::muteVideo error",a.t0);case 12:case 25:a.next=31;break;case 14:if(a.prev=14,!(s=null===(n=this.roomContext)||void 0===n?void 0:n.roomProperties.videoOff)||"offNotAllowSelfOn"!==(null===(i=s.value)||void 0===i?void 0:i.split("_")[0])){a.next=23;break}return a.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(a.sent){a.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),a.abrupt("return");case 23:return a.next=25,null===(o=this.rtcController)||void 0===o?void 0:o.muteMemberVideo(e.accid);case 27:throw a.prev=27,a.t1=a.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+Ti(e),a.t1),new _l("QChatMedia::muteVideo error",a.t1);case 31:case"end":return a.stop()}}),a,this,[[3,8],[14,27]])})))},r.unMuteVideo=function(e){var t,r,n,i,o;return Wl(this,void 0,void 0,jl.mark((function a(){var s;return jl.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1}},e),!(s=null===(t=this.roomContext)||void 0===t?void 0:t.roomProperties.videoOff)||"offNotAllowSelfOn"!==(null===(r=s.value)||void 0===r?void 0:r.split("_")[0])){a.next=10;break}return a.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(a.sent){a.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),a.abrupt("return");case 10:if((null===(n=this.roomContext)||void 0===n?void 0:n.localMember.uuid)!==e.accid){a.next=22;break}return a.prev=11,a.next=14,null===(i=this.rtcController)||void 0===i?void 0:i.unmuteMyVideo();case 14:a.next=20;break;case 16:throw a.prev=16,a.t0=a.catch(11),this.logger.error("QChatMedia::unMuteVideo error",a.t0),new _l("QChatMedia::unMuteVideo error",a.t0);case 20:a.next=30;break;case 22:a.prev=22,null===(o=this.rtcController)||void 0===o||o.unmuteMemberVideo(e.accid),a.next=30;break;case 26:throw a.prev=26,a.t1=a.catch(22),this.logger.error("QChatMedia::unMuteVideo error",a.t1),new _l("QChatMedia::unMuteVideo error",a.t1);case 30:case"end":return a.stop()}}),a,this,[[11,16],[22,26]])})))},r.startScreenShare=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._checkConnectState(),t.prev=1,null===(e=this.rtcController)||void 0===e||e.startScreenShare(),t.next=9;break;case 5:throw t.prev=5,t.t0=t.catch(1),this.logger.error("QChatMedia::startScreenShare error",t.t0),new _l("QChatMedia::startScreenShare error",t.t0);case 9:case"end":return t.stop()}}),t,this,[[1,5]])})))},r.stopScreenShare=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._checkConnectState(),t.prev=1,null===(e=this.rtcController)||void 0===e||e.stopScreenShare(),t.next=9;break;case 5:throw t.prev=5,t.t0=t.catch(1),this.logger.error("QChatMedia::stopScreenShare error",t.t0),new _l("QChatMedia::stopScreenShare error",t.t0);case 9:case"end":return t.stop()}}),t,this,[[1,5]])})))},r.stopMemberScreenShare=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.stopMemberScreenShare(e.accid),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",r.t0),new _l("QChatMedia::stopMemberScreenShare error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.subscribeRemoteVideoStream=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.subscribeRemoteVideoStream(e.accid,e.streamType),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",r.t0),new _l("QChatMedia::subscribeRemoteVideoStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.unSubscribeRemoteVideoStream=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.unsubscribeRemoteVideoStream(e.accid,e.streamType),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",r.t0),new _l("QChatMedia::unSubscribeRemoteVideoStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.setupVideoCanvas=function(e){var t;if(this._checkConnectState(),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)===e.accid)try{return this.rtcController.setupLocalVideoCanvas(e.videoView)}catch(r){throw this.logger.error("QChatMedia::setupVideoCanvas error",r),new _l("QChatMedia::setupVideoCanvas error",r)}else try{return this.rtcController.setupRemoteVideoCanvas(e.videoView,e.accid)}catch(r){throw this.logger.error("QChatMedia::setupVideoCanvas error",r),new _l("QChatMedia::setupVideoCanvas error",r)}},r.setupRemoteVideoSubStreamCanvas=function(e){this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1}},e);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(e.videoView,e.accid)}catch(t){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",t),new _l("QChatMedia::setupRemoteVideoSubStreamCanvas error",t)}},r.getScreenSharingUserUuid=function(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(e){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",e),new _l("QChatMedia::getScreenSharingUserUuid error",e)}},r.initQChatMedia=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.neroom){t.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),t.abrupt("return");case 3:if(void 0===this.state){t.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),t.abrupt("return");case 6:t.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:e.serverConfig}),t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(6),this.logger.error("QChatMedia::initQChatMedia error",t.t0),new _l("QChatMedia::initQChatMedia error",t.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return t.stop()}}),t,this,[[6,10]])})))},r.loginByIM=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("init"===this.state){t.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),t.abrupt("return");case 3:return t.next=5,this._getToken();case 5:return r=t.sent,n=Qp(this.core,"options.token")||Qp(this.core,"V2NIMLoginService.token"),t.prev=7,t.next=10,null===(e=this.authService)||void 0===e?void 0:e.loginByIM(this.core.account,r,n);case 10:t.next=16;break;case 12:throw t.prev=12,t.t0=t.catch(7),this.logger.error("QChatMedia::loginByIM error",t.t0),new _l("QChatMedia::loginByIM error",t.t0);case 16:this.state="login";case 17:case"end":return t.stop()}}),t,this,[[7,12]])})))},r._getToken=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),t.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(e=this.neroom)||void 0===e?void 0:e.deviceId}});case 3:return r=t.sent,n=r.content.neroomToken,i=n.token,o=n.expire,this.logger.log("QChatMedia::getToken success token is "+i+",expire is "+o+" "),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is "+(1e3*o-this.tokenExpireTime)+" "),this.tokenTimer=this.core.timerManager.addTimer((function(){return Wl(a,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,e.next=4,this._getToken();case 4:t=e.sent,this.authService&&this.authService.renewToken(t);case 6:case"end":return e.stop()}}),e,this)})))}),1e3*o-this.tokenExpireTime)),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})))},r.connectChannel=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==this.state){n.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),n.abrupt("return");case 3:if("init"!==this.state){n.next=6;break}return n.next=6,this.loginByIM();case 6:return this.serverId=e.serverId,this.channelId=e.channelId,n.prev=8,n.next=11,null===(t=this.roomService)||void 0===t?void 0:t.joinRoom({roomUuid:e.channelId,role:"qchatAudience",userName:this.core.account,initialProperties:{}},{});case 11:n.next=17;break;case 13:throw n.prev=13,n.t0=n.catch(8),this.logger.error("QChatMedia::connectChannel error",n.t0),new _l("QChatMedia::connectChannel error",n.t0);case 17:if(!(i=null===(r=this.roomService)||void 0===r?void 0:r.getRoomContext(e.channelId))){n.next=28;break}return this.roomContext=i,this.rtcController=this.roomContext.rtcController,this.state="connect",n.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),this.core.qchatMedia.emit("connectChannel"),n.next=29;break;case 28:this.logger.error("QChatMedia::connect room not exited");case 29:case"end":return n.stop()}}),n,this,[[8,13]])})))},r.updateRTCChannelInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:sr(sr({},e),{audio:Ti(e.audio),video:Ti(e.video)})});case 3:case"end":return t.stop()}}),t,this)})))},r.getRTCChannelInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:e});case 3:return r=t.sent,t.abrupt("return",DE(r.content.RTCChannelConfig));case 5:case"end":return t.stop()}}),t,this)})))},r.getRTCChannelOnlineMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:e});case 3:return r=t.sent,t.abrupt("return",UE(r.content.memberList));case 5:case"end":return t.stop()}}),t,this)})))},r.addRTCChannelListener=function(){var e,t,r=this;this._checkConnectState();try{null===(e=this.authService)||void 0===e||e.addAuthListener({onAuthEvent:function(e){return Wl(r,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1026!==e||this.getTokenState){t.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,t.next=5,this._getToken();case 5:if(r=t.sent,!this.authService){t.next=9;break}return t.next=9,this.authService.renewToken(r);case 9:this.getTokenState=!1;case 10:case"end":return t.stop()}}),t,this)})))}})}catch(n){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",n),new _l("QChatMedia::loginByIM addAuthListener error",n)}null===(t=this.roomContext)||void 0===t||t.addRoomListener({onRoomPropertiesChanged:function(e){var t,n,i,o,a,s;if(r.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",e),e.audioOff){var c=null===(t=e.audioOff.value)||void 0===t?void 0:t.split("_")[0];"offNotAllowSelfOn"!==c&&"offAllowSelfOn"!==c||(null===(n=r.roomContext)||void 0===n?void 0:n.localMember.isAudioOn)&&(null===(i=r.rtcController)||void 0===i||i.muteMyAudio())}else if(e.videoOff){var u=null===(o=e.videoOff.value)||void 0===o?void 0:o.split("_")[0];"offNotAllowSelfOn"!==u&&"offAllowSelfOn"!==u||(null===(a=r.roomContext)||void 0===a?void 0:a.localMember.isVideoOn)&&(null===(s=r.rtcController)||void 0===s||s.muteMyVideo())}},onRoomPropertiesDeleted:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",e)},onMemberJoinRtcChannel:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",e);var t=au(e).call(e,(function(e){return e.uuid}));r.core.emit("memberJoinRTCChannel",t),r.core.qchatMedia.emit("memberJoinRTCChannel",t)},onMemberLeaveRoom:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",e);var t=au(e).call(e,(function(e){return e.uuid}));r.core.emit("memberLeaveRTCChannel",t),r.core.qchatMedia.emit("memberLeaveRTCChannel",t)},onRoomEnded:function(e){r.authService&&r.authService.logout(),r._setStateInit(),r.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",e),r.core.emit("RTCChannelEnded",e),r.core.qchatMedia.emit("RTCChannelEnded",e)},onRtcChannelError:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",e),"SOCKET_ERROR"===e&&r.disconnectChannel(),r.core.emit("RTCChannelError",e),r.core.qchatMedia.emit("RTCChannelError",e)},onRtcAudioVolumeIndication:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",e),r.core.emit("onRtcAudioVolumeIndication",e),r.core.qchatMedia.emit("onRtcAudioVolumeIndication",e)},onMemberAudioMuteChanged:function(e,t,n){r.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",e,t),r.core.emit("memberAudioMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid}),r.core.qchatMedia.emit("memberAudioMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid})},onMemberScreenShareStateChanged:function(e,t,n){r.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",e,t),r.core.emit("memberScreenShareStateChanged",{memberAccId:e.uuid,isSharing:t,operateByAccId:n.uuid}),r.core.qchatMedia.emit("memberScreenShareStateChanged",{memberAccId:e.uuid,isSharing:t,operateByAccId:n.uuid})},onMemberVideoMuteChanged:function(e,t,n){r.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",e,t),r.core.emit("memberVideoMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid}),r.core.qchatMedia.emit("memberVideoMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid})}})},r.enumCameraDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then((function(e){return e.data}),(function(t){throw e.logger.error("QChatMedia::enumCameraDevices error",t),new _l("QChatMedia::enumCameraDevices error",t)}))},r.enumPlayoutDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then((function(e){return e.data}),(function(t){throw e.logger.error("QChatMedia::enumPlayoutDevices error",t),new _l("QChatMedia::enumPlayoutDevices error",t)}))},r.enumRecordDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then((function(e){return e.data}),(function(t){throw e.logger.error("QChatMedia::enumRecordDevices error",t),new _l("QChatMedia::enumRecordDevices error",t)}))},r.removeRTCChannelListener=function(){var e,t;this._checkConnectState(),null===(e=this.roomContext)||void 0===e||e.removeRoomListener({}),null===(t=this.authService)||void 0===t||t.removeAuthListener({})},r.setSelectedCameraDevice=function(e){var t=this;return this._checkConnectState(),Al({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedCameraDevice(e.deviceId).then((function(e){return e.data}),(function(e){throw t.logger.error("QChatMedia::setSelectedCameraDevice error",e),new _l("QChatMedia::setSelectedCameraDevice error",e)}))},r.setSelectedPlayoutDevice=function(e){var t=this;return this._checkConnectState(),Al({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedPlayoutDevice(e.deviceId).then((function(e){return e.data}),(function(e){throw t.logger.error("QChatMedia::setSelectedPlayoutDevice error",e),new _l("QChatMedia::setSelectedPlayoutDevice error",e)}))},r.setSelectedRecordDevice=function(e){var t=this;return this._checkConnectState(),Al({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedRecordDevice(e.deviceId).then((function(e){return e.data}),(function(e){throw t.logger.error("QChatMedia::setSelectedRecordDevice error",e),new _l("QChatMedia::setSelectedRecordDevice error",e)}))},r.getRTCMembers=function(){var e,t;return this._checkConnectState(),au(e=lu(t=this.roomContext.remoteMembers).call(t,(function(e){return e.isInRtcChannel}))).call(e,(function(e){return{accid:e.uuid,isAudioOn:!!e.isAudioOn,isVideoOn:!!e.isVideoOn,isSharingScreen:!!e.isSharingScreen,properties:e.properties}}))},r.subscribeRemoteVideoSubStream=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.subscribeRemoteVideoSubStream(e.accid),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",r.t0),new _l("QChatMedia::subscribeRemoteVideoSubStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.unsubscribeRemoteVideoSubStream=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Al({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.unsubscribeRemoteVideoSubStream(e.accid),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",r.t0),new _l("QChatMedia::unsubscribeRemoteVideoSubStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.muteAllAudio=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("audioOff",Ti({value:"offNotAllowSelfOn_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::muteAllAudio error",t.t0),new _l("QChatMedia::muteAllAudio error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},r.muteAllVideo=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("videoOff",Ti({value:"offNotAllowSelfOn_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::muteAllVideo error",t.t0),new _l("QChatMedia::muteAllVideo error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},r.unMuteAllAudio=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("audioOff",Ti({value:"disable_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",t.t0),new _l("QChatMedia::unMuteAllAudio error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},r.unMuteAllVideo=function(){var e;return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("videoOff",Ti({value:"disable_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",t.t0),new _l("QChatMedia::unMuteAllVideo error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},t}(SC),HE={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},WE={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:CC},YE=function(){return fh(WE)},KE=function(){var e=YE();return{qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:WE.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:WE.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:WE.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:WE.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:WE.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:e.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:WE.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:e.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:e.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:WE.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:WE.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:e.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:e.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:WE.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:WE.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:e.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:e.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:WE.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:WE.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:e.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:WE.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:WE.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:WE.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:e.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:e.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:e.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:e.qchatMsgTag}]}}};!function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac",e[e.HarmonyOS=65]="HarmonyOS"}(qE||(qE={}));var QE,zE={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},JE={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:CC},$E=function(){return fh(JE)},XE=function(){var e=$E();return{qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:JE.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:JE.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:e.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:JE.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:JE.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:e.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:e.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:JE.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:e.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:JE.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:JE.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:e.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:JE.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:JE.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:JE.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:JE.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:e.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:JE.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:JE.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:e.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:e.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:JE.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:JE.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:JE.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:JE.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:JE.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.memberInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:e.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:e.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:e.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"Int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo},{type:"String",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]}}},ZE={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},e_={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},t_=function(){return fh(e_)},r_=function(){var e=t_();return{qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:e_.serverRole},{type:"Property",name:"antispamTag",reflectMapper:e_.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:e.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:e_.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:e.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:e_.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:e.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:e.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:e.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:e_.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:e.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:e_.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:e.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:e.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:e.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:e.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:e_.checkPermissionTag}],response:[{type:"Bool",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:e_.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:e.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:e_.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:e.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:e_.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:e.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:e_.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:e.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:e_.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:e.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:e_.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:e.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:e_.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}}},n_=["image","audio","video","file"],i_={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:mE},fromClientType:{type:"enum",values:qE},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function o_(e,t){var r=sr({},e),n=sr({type:t||mE.custom},Nh(i_,r));return n.serverId&&n.channelId&&n.toAccids?n.toType=4:n.serverId&&n.toAccids?n.toType=3:n.serverId&&n.channelId?n.toType=2:n.serverId?n.toType=1:n.toAccids?n.toType=5:n.toType=0,n}function a_(e){var t=eg(e,["msgIdServer","type"]);return Nh(i_,t)}var s_=((QE={})[mE.channelUpdateWhiteBlackIdentify]=function(e){var t=_C();return e.notify=PC(mh(e.notify,t.qchatUpdateWhiteBlackRoleTag)),e},QE[mE.channelUpdateWhiteBlackIdentifyUser]=function(e){var t,r=_C();return e.notify=(t=mh(e.notify,r.qchatUpdateWhiteBlackMembersTag),wh(AC,t)),e},QE[mE.updateQuickComment]=function(e){var t,r=YE();return e.notify=(t=mh(e.notify,r.qchatQuickCommentRequestTag),wh(v_,t)),e},QE[mE.channelCategoryCreate]=function(e){var t=_C();return e.categoryInfo=qC(mh(e.categoryInfo,t.QChatChannelCategoryInfo)),e},QE[mE.channelCategoryUpdate]=function(e){var t=_C();return e.categoryInfo=qC(mh(e.categoryInfo,t.QChatChannelCategoryInfo)),e},QE[mE.channelCategoryUpdateWhiteBlackIdentify]=function(e){var t=_C();return e.notify=PC(mh(e.notify,t.qchatUpdateChannelCategoryWhiteBlackRoleTag)),e},QE[mE.channelCategoryUpdateWhiteBlackIdentifyUser]=function(e){var t=_C();return e.notify=PC(mh(e.notify,t.qchatUpdateChannelCategoryWhiteBlackMembersTag)),e},QE[mE.serverIdentifyAdd]=function(e){var t=t_();return e.serverIdentifyInfo=ME(mh(e.serverIdentifyInfo,t.serverRole)),e},QE[mE.serverIdentifyRemove]=function(e){var t=t_();return e.serverIdentifyInfo=ME(mh(e.serverIdentifyInfo,t.serverRole)),e},QE[mE.serverIdentifyUpdate]=function(e){var t=t_();return e.serverIdentifyInfo=ME(mh(e.serverIdentifyInfo,t.serverRole)),e},QE[mE.channelIdentifyUpdate]=function(e){var t=t_();return e.channelIdentifyInfo=ME(mh(e.channelIdentifyInfo,t.channelRole)),e},QE[mE.userIdentifyUpdate]=function(e){var t=t_();return e.userIdentifyInfo=ME(mh(e.userIdentifyInfo,t.memberRole)),e},QE[mE.myMemberInfoUpdated]=function(e){var t,r=Qp(e,"userInfo.name"),n=Qp(e,"userInfo.icon");return e.updatedInfos=au(t=e.reuseServers).call(t,(function(e){var t={serverId:e.serverId};return 1==(1&e.bits)&&"string"==typeof r&&sr(t,{nickChanged:!0,nick:r}),2==(2&e.bits)&&"string"==typeof n&&sr(t,{avatarChanged:!0,avatar:n}),t})),delete e.userInfo,delete e.reuseServers,e},QE);function c_(e,t){var r=wh(i_,e);if(!r.attach)return r;var n=$E(),i=_C();if(r.attach.serverInfo&&(r.attach.serverInfo=YC(mh(r.attach.serverInfo,n.serverInfo))),r.attach.channelInfo&&(r.attach.channelInfo=LC(mh(r.attach.channelInfo,i.channelInfo))),r.attach.serverMember&&(r.attach.serverMember=QC(mh(r.attach.serverMember,n.memberInfo))),s_[r.attach.type]&&(r.attach=s_[r.attach.type](r.attach)),r.attach.updateAuths)try{r.attach.updateAuths=IE(JSON.parse(r.attach.updateAuths))}catch(o){t.error("formatSystemNotification:JSON parse updateAuths error: ",o)}return r.attach.type&&(r.attach.rawType=r.attach.type,r.attach.type=mE[r.attach.type]),r}var u_={type:{type:"enum",values:uE},fromClientType:{type:"enum",values:qE},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:lE},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function d_(e){e.onSendBefore,e.onUploadStart,e.onUploadDone,e.onUploadProgress;var t=Hl(e,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),r=Nh(u_,t);if(r.msgIdClient=e.resendFlag?e.msgIdClient:Tp(),!r.msgIdClient)throw new Cl("msgIdClient is required for resend a message","msgIdClient","required");return e.replyMessage&&e.replyMessage.msgIdServer&&(r.replyMsgFromAccount=e.replyMessage.fromAccount,r.replyMsgTime=+e.replyMessage.time,r.replyMsgIdServer=e.replyMessage.msgIdServer,r.replyMsgIdClient=e.replyMessage.msgIdClient,e.replyMessage.threadRefer&&e.replyMessage.threadRefer.msgIdServer?(r.threadMsgFromAccount=e.replyMessage.threadRefer.fromAccount,r.threadMsgTime=+e.replyMessage.threadRefer.time,r.threadMsgIdServer=e.replyMessage.threadRefer.msgIdServer,r.threadMsgIdClient=e.replyMessage.threadRefer.msgIdClient):(r.threadMsgFromAccount=e.replyMessage.fromAccount,r.threadMsgTime=+e.replyMessage.time,r.threadMsgIdServer=e.replyMessage.msgIdServer,r.threadMsgIdClient=e.replyMessage.msgIdClient),delete r.replyMessage),r}function l_(e){return wh({operatorClientType:{type:"enum",values:qE},pushPayload:{type:"object"}},e)}function p_(e,t,r){var n,i;return void 0===t&&(t={}),Wl(this,void 0,void 0,jl.mark((function o(){var a,s,c,u;return jl.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return(a=wh(u_,e)).deliveryStatus=t.deliveryStatus?dE[t.deliveryStatus]:dE[dE.success],t.time&&(a.time=t.time),s=YE(),a.updateContent&&(c=wh({status:{type:"number"}},c=mh(c=JSON.parse(a.updateContent),s.qchatMsgTag)),a.updateContent=c),a.updateOperatorInfo&&(u=l_(mh(u=JSON.parse(a.updateOperatorInfo),s.qchatMsgUpdateTag)),a.updateOperatorInfo=u),""===(null===(n=null==a?void 0:a.threadRefer)||void 0===n?void 0:n.fromAccount)&&delete a.threadRefer,""===(null===(i=null==a?void 0:a.replyRefer)||void 0===i?void 0:i.fromAccount)&&delete a.replyRefer,a.attach&&t.attachUrl&&(a.attach.url=t.attachUrl),o.next=11,m_(a,r);case 11:return o.abrupt("return",o.sent);case 12:case"end":return o.stop()}}),o)})))}function m_(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(tu(n_).call(n_,e.type)&&e.attach&&e.attach.url){r.next=2;break}return r.abrupt("return",e);case 2:if(t&&t.cloudStorage&&"function"==typeof t.cloudStorage.getPrivateUrl&&"function"==typeof t.cloudStorage.getOriginUrl){r.next=4;break}return r.abrupt("return",e);case 4:if(!(bu(n=e.attach.url).call(n,"_im_url=1")<0)){r.next=7;break}return e.attach.url=t.cloudStorage.getPrivateUrl(e.attach.url),r.abrupt("return",e);case 7:return r.prev=7,r.next=10,t.cloudStorage.getOriginUrl(e.attach.url);case 10:e.attach.url=r.sent,r.next=16;break;case 13:throw r.prev=13,r.t0=r.catch(7),new Cl('url "'+e.attach.url+'" parse error',"message.attach.url","parse error");case 16:return r.abrupt("return",e);case 17:case"end":return r.stop()}}),r,null,[[7,13]])})))}function h_(e,t,r){return void 0===t&&(t={}),Wl(this,void 0,void 0,jl.mark((function n(){var i;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Si(e)&&e.length>0){n.next=2;break}return n.abrupt("return",[]);case 2:return i=au(e).call(e,(function(e){return p_(e,t,r)})),n.next=5,ls.all(i);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n)})))}var f_={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function g_(e){var t=au(e).call(e,(function(e){var t,r=wh(f_,e);return r.details=au(t=r.details).call(t,(function(e){var t=e.createTime?Kp(e.createTime):0;return t=isNaN(t)?0:t,{count:e.count,hasSelf:e.self,severalAccids:e.topN,type:e.type,createTime:t}})),r})),r={};return Bn(t).call(t,(function(e){return r[e.msgIdServer]=e})),r}var v_={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}},y_={includeSelf:{type:"number"},order:{type:"enum",values:yC},sort:{type:"enum",values:cE},msgTypes:{type:"object"},subTypes:{type:"object"}},I_={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}},M_={6:function(e){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(e.serverId),!0},16:function(e){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(e.serverId,e.channelId),!0},26:function(e){var t=Qp(e,"attach.addAccids");return t&&tu(t).call(t,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",e),!0},27:function(e){var t=Qp(e,"attach.deleteAccids");return t&&tu(t).call(t,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",e),!0},31:function(e){var t,r;return 1===e.attach.event?(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)&&this.core.qchatChannel.subscribeChannel({type:1,opeType:1,channels:[{serverId:e.serverId,channelId:e.channelId}],isInternalTrigger:!0}):2===e.attach.event&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",e),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",e)),!0},32:function(e){var t,r;return 2===e.attach.event?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",e),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",e)):1===e.attach.event&&(this.core.qchatChannel.subscribeForVisitorService.deleteServer(e.serverId),(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)&&this.core.qchatServer.subscribeServer({type:4,opeType:1,servers:[{serverId:e.serverId}],isInternalTrigger:!0})),!0},34:function(e){return 2===e.attach.event&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(e.serverId,e.channelId),!0},101:function(e){var t=eg(e,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",t),this.core.emit("recvTypingEvent",t),this.core.qchatMsg.emit("recvTypingEvent",t),!1}},T_=function(){function e(e){this.core=e,this.logger=e.logger}var t=e.prototype;return t.sendSystemNotification=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:o_(e)});case 2:return r=t.sent,n=c_(r.content.sysMsg,this.logger),this.logger.getDebugMode()?this.logger.debug("sendCustomSysMsg success",n):this.logger.log("sendCustomSysMsg success",n.serverId,n.channelId,n.msgIdServer),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},t.updateSystemNotification=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.systemNotification,n=Hl(e,["systemNotification"]),i=eg(r,["msgIdServer","type","body","ext","status"]),o=o_(i),t.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:o,qchatMsgUpdateTag:sr(sr({},n),{operatorAccount:this.core.account,operatorClientType:qE.Web,pushPayload:Ti(e.pushPayload),routeEnable:Lh.boolean(e,"routeEnable")})});case 5:return a=t.sent,t.abrupt("return",c_(a.content.sysMsg,this.logger));case 7:case"end":return t.stop()}}),t,this)})))},t.markSystemNotificationsRead=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:au(r=e.systemNotifications).call(r,(function(e){return a_(e)}))});case 2:case"end":return t.stop()}}),t,this)})))},t.onSysMsg=function(e){var t=e.content.sysMsg;if(t){var r=c_(t,this.core.logger),n=M_[mE[r.type]];if(n&&!1===n.call(this,r))return;var i={feature:"default",systemNotifications:[r]};this.logger.log("qchat on systemNotification: ",i),this.core.emit("systemNotification",i),this.core.qchatMsg.emit("systemNotification",i)}else this.core.logger.warn("No sysMsg in onSysMsg packet")},t.onMultiSysMsg=function(e){var t=e.content.sysMsg;if(t){var r=c_(t,this.logger);this.core.emit("systemNotificationUpdate",r),this.core.qchatMsg.emit("systemNotificationUpdate",r)}},t.onSyncSysMsg=function(e){var t=this,r=e.content.systemNotifications;if(r&&r.length>0){var n=au(r).call(r,(function(e){return c_(e,t.logger)}));this.core.emit("systemNotification",{feature:"sync",systemNotifications:n}),this.core.qchatMsg.emit("systemNotification",{feature:"sync",systemNotifications:n})}else this.logger.warn("sync system notification not exist")},e}(),S_=["image","audio","video","file"],b_=function(){function e(e){var t=this;this.markMessageRead=wE((function(e){return Wl(t,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:e});case 2:r=t.sent,n=UC(r.content.unreadInfo),this.core.eventBus.emit("qchatChannel/updateUnreads",[n]);case 5:case"end":return t.stop()}}),t,this)})))}),200),this.core=e,this.logger=e.logger}var t=e.prototype;return t.sendMessage=function(e){var t,r,n,i;return Wl(this,void 0,void 0,jl.mark((function o(){var a,s,c,u,d,l;return jl.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!(bu(S_).call(S_,e.type)>-1)){o.next=4;break}return o.next=3,this.doSendFile(e);case 3:e.attach=o.sent;case 4:return a=d_(sr({fromAccount:this.core.account},e)),o.next=7,p_(a,{time:(new Date).getTime(),deliveryStatus:dE.sending},this.core);case 7:s=o.sent;try{e.onSendBefore&&e.onSendBefore(s)}catch(p){this.logger.error("sendMsg: options.onSendBefore error",p)}return o.prev=9,o.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:a});case 12:c=o.sent,o.next=22;break;case 15:return o.prev=15,o.t0=o.catch(9),o.next=19,p_(a,{time:(new Date).getTime(),deliveryStatus:dE.failed,attachUrl:null===(t=s.attach)||void 0===t?void 0:t.url},this.core);case 19:throw u=o.sent,o.t0.msg=u,o.t0;case 22:return d=c.content,o.next=25,p_(sr({},d.qchatMsg),{deliveryStatus:dE.success,attachUrl:null===(r=s.attach)||void 0===r?void 0:r.url},this.core);case 25:if(!(l=o.sent).isAntispam){o.next=29;break}throw{code:10403,msg:l,message:(null===(n=null==l?void 0:l.antiSpamInfo)||void 0===n?void 0:n.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(i=null==l?void 0:l.antiSpamInfo)||void 0===i?void 0:i.yidunAntiSpamRes)||""};case 29:return o.abrupt("return",l);case 30:case"end":return o.stop()}}),o,this,[[9,15]])})))},t.doSendFile=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e),r=e.attach){t.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){t.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return t.prev=5,t.next=8,this.core.cloudStorage.uploadFile(e);case 8:r=t.sent,t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(5),this.logger.error("sendFile:: upload File error or abort.",t.t0),t.t0;case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}}),t,this,[[5,11]])})))},t.resendMessage=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(i=d_(sr(sr({},e),{resendFlag:!0}))).deliveryStatus=dE.sending,n.prev=2,n.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:i});case 5:o=n.sent,n.next=15;break;case 8:return n.prev=8,n.t0=n.catch(2),n.next=12,p_(i,{time:(new Date).getTime(),deliveryStatus:dE.failed},this.core);case 12:throw a=n.sent,n.t0.msg=a,n.t0;case 15:return s=o.content,n.next=18,p_(sr({},s.qchatMsg),{deliveryStatus:dE.success},this.core);case 18:if(!(c=n.sent).isAntispam){n.next=22;break}throw{code:10403,msg:c,message:(null===(t=null==c?void 0:c.antiSpamInfo)||void 0===t?void 0:t.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(r=null==c?void 0:c.antiSpamInfo)||void 0===r?void 0:r.yidunAntiSpamRes)||""};case 22:return n.abrupt("return",c);case 23:case"end":return n.stop()}}),n,this,[[2,8]])})))},t.doUpdateMessage=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a,s,c;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.message,o=Hl(e,["message"]),(a=d_(i)).msgIdClient=void 0,a.time=i.time,n.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:a,qchatMsgUpdateTag:sr(sr({},o),{operatorAccount:this.core.account,operatorClientType:qE.Web,pushPayload:Ti(e.pushPayload),routeEnable:Lh.boolean(e,"routeEnable")})});case 6:return s=n.sent,n.next=9,p_(s.content.qchatMsg,{},this.core);case 9:if(c=n.sent,this.core.eventBus.emit("qchatChannel/changeUnread",c,!0),!s.content.qchatMsg.isAntispam){n.next=14;break}throw{code:10403,msg:a,message:(null===(t=s.content.qchatMsg)||void 0===t?void 0:t.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(r=s.content.qchatMsg)||void 0===r?void 0:r.yidunAntiSpamRes)||""};case 14:return n.abrupt("return",c);case 15:case"end":return n.stop()}}),n,this)})))},t.getHistoryMessage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:sr(sr({},e),{reverse:Pc(e)?1:0})});case 2:return n=t.sent,i=n.content,t.next=6,ls.all(au(r=i.qchatMsgs).call(r,(function(e){return p_(e,{},o.core)})));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))},t.getMentionedMeMessages=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetMentionedMeMessages",{tag:e});case 2:return n=t.sent,c=(i=n.content).page,o=wh(I_,c),t.next=7,ls.all(au(r=i.datas).call(r,(function(e){return p_(e,{},s.core)})));case 7:return a=t.sent,t.abrupt("return",{pageInfo:o,messages:a});case 9:case"end":return t.stop()}var c}),t,this)})))},t.areMentionedMeMessages=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r={},n=0;case 2:if(!(n<e.length)){t.next=13;break}if((i=e[n]).fromAccount!==this.core.account){t.next=7;break}return r[i.msgIdClient]=!1,t.abrupt("continue",10);case 7:return t.next=9,this.core.qchatChannel.subscribeModuleService.getMentionedFlag(i,!0);case 9:r[i.msgIdClient]=t.sent;case 10:n++,t.next=2;break;case 13:return t.abrupt("return",r);case 14:case"end":return t.stop()}}),t,this)})))},t.getLastMessageOfChannels=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:e});case 2:return r=t.sent,n=r.content.msgs,t.next=6,h_(n,{},this.core);case 6:return i=t.sent,t.abrupt("return",fl(i).call(i,(function(e,t){return e[t.channelId]=t,e}),{}));case 8:case"end":return t.stop()}}),t,this)})))},t.messageSearchByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:sr(sr({},(s=e,Nh(y_,s))),{includeSelf:e.includeSelf?1:""})});case 2:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.next=6,h_(i,{},this.core);case 6:return a=t.sent,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:o.nextTimetag?Kp(o.nextTimetag):0,cursor:o.cursor},datas:a});case 8:case"end":return t.stop()}var s}),t,this)})))},t.onMsg=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.content.qchatMsg){t.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),t.abrupt("return");case 4:return t.next=6,p_(r,{},this.core);case 6:n=t.sent,this.core.eventBus.emit("qchatChannel/changeUnread",n,!1),this.core.emit("message",n),this.core.qchatMsg.emit("message",n);case 10:case"end":return t.stop()}}),t,this)})))},t.onRecvUnreadInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.content.qchatMsg){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,p_(r);case 5:n=t.sent,this.core.eventBus.emit("qchatChannel/changeUnread",n,!1);case 7:case"end":return t.stop()}}),t,this)})))},t.onMultiSyncRead=function(e){var t=e.content.unreadInfo;if(t){var r=UC(t);this.core.eventBus.emit("qchatChannel/updateUnreads",[r])}},t.onMultiSyncServersRead=function(e){var t=e.content.qchatMultiSyncServersMessageReadTag;if(t){var r=aE(t),n=r.successServerIds,i=r.ackTimestamp;this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",n,i)}},t.onRecvMsgUpdate=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.content.qchatMsg,n=e.content.qchatMsgUpdateInfo,r){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,p_(r,{},this.core);case 6:i=t.sent,o=l_(n),this.core.eventBus.emit("qchatChannel/changeUnread",i,!0),this.core.emit("messageUpdate",i,o),this.core.qchatMsg.emit("messageUpdate",i,o);case 11:case"end":return t.stop()}}),t,this)})))},e}(),C_=function(){function e(e){var t=this;this._sendTypingEvent=wE((function(e){return Wl(t,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:o_(sr(sr({},e),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),mE.msgTyping)});case 2:case"end":return t.stop()}}),t,this)})))}),3e3),this.core=e,this.logger=e.logger,this.lastChannelIdInTyping=""}var t=e.prototype;return t.getMessageHistoryByIds=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:e.serverId,channelId:e.channelId},messageReferList:e.messageReferList});case 2:return n=t.sent,t.abrupt("return",ls.all(au(r=n.content.qchatMsgs).call(r,(function(e){return p_(e)}))));case 4:case"end":return t.stop()}}),t,this)})))},t.getReferMessages=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((null===(t=e.message.replyRefer)||void 0===t?void 0:t.msgIdServer)&&(null===(r=e.message.threadRefer)||void 0===r?void 0:r.msgIdServer)){n.next=2;break}throw new Error("Message has no reply");case 2:return n.next=4,this.getMessageHistoryByIds({serverId:e.message.serverId,channelId:e.message.channelId,messageReferList:[e.message.replyRefer,e.message.threadRefer]});case 4:if(i=n.sent,e.referType!==hE[hE.all]){n.next=9;break}return n.abrupt("return",{replyMessage:i[0],threadMessage:i[1]});case 9:if(e.referType!==hE[hE.reply]){n.next=13;break}return n.abrupt("return",{replyMessage:i[0]});case 13:if(e.referType!==hE[hE.thread]){n.next=15;break}return n.abrupt("return",{threadMessage:i[1]});case 15:return n.abrupt("return",{replyMessage:i[0],threadMessage:i[1]});case 16:case"end":return n.stop()}}),n,this)})))},t.getThreadMessages=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=(null===(t=e.message.threadRefer)||void 0===t?void 0:t.msgIdServer)?sr({serverId:e.message.serverId,channelId:e.message.channelId},e.message.threadRefer):e.message,r.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:i,getThreadHistoryMsgTag:sr(sr({},e.messageQueryOption),{reverse:Lh.boolean(e.messageQueryOption,"reverse")})});case 3:return o=r.sent,r.next=6,p_(o.content.thread);case 6:return a=r.sent,r.next=9,ls.all(au(n=o.content.qchatMsgs).call(n,(function(e){return p_(e)})));case 9:return s=r.sent,r.abrupt("return",{thread:a,threadInfo:{messageCount:+o.content.threadInfo.messageCount,lastMessageTimestamp:+o.content.threadInfo.lastMessageTimestamp},messages:s});case 11:case"end":return r.stop()}}),r,this)})))},t.getThreadRootMessagesMeta=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.threadRootMessages,n=Hl(e,["threadRootMessages"]),t.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:r,tag:n});case 3:if(i=t.sent,!((o=i.content.metas)&&o.length>0)){t.next=7;break}return t.abrupt("return",au(o).call(o,(function(e){return sr(sr({},e),{total:Kp(e.total),timestamp:Kp(e.timestamp),msgTime:Kp(e.msgTime)})})));case 7:return t.abrupt("return",[]);case 8:case"end":return t.stop()}}),t,this)})))},t.getQuickComments=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:e.serverId,channelId:e.channelId,msgIdServerList:Ti(au(r=e.msgList).call(r,(function(e){return e.msgIdServer})))}});case 2:return n=t.sent,i=n.content.quickCommentResponse,t.abrupt("return",g_(i));case 5:case"end":return t.stop()}}),t,this)})))},t.updateQuickComment=function(e,t){return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a,s,c;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Al({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},e),n=e.commentMessage,i=n.serverId,o=n.channelId,a=n.fromAccount,s=n.msgIdServer,c=n.time,r.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:i,channelId:o,fromAccount:a,msgIdServer:s,time:c,type:e.type,opeType:t,opeAccid:this.core.account}});case 4:case"end":return r.stop()}}),r,this)})))},t.sendTypingEvent=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.channelId!==this.lastChannelIdInTyping){t.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(e),t.abrupt("return");case 4:this.lastChannelIdInTyping=e.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(e);case 7:case"end":return t.stop()}}),t,this)})))},e}(),E_=function(e){function t(t){var r;return(r=e.call(this,"qchatMsg",t)||this).core=t,r.lastChannelIdInMark="",hh({cmdMap:HE,cmdConfig:KE()}),r.notificationModuleService=new T_(t),r.messageModuleService=new b_(t),r.extendModuleService=new C_(t),r}er(t,e);var r=t.prototype;return r.sendMessage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Sp(uE)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},e),t.next=3,this.messageModuleService.sendMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.updateMessage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},e),!("number"==typeof e.message.status&&e.message.status<1e4)){t.next=3;break}throw new _l("Status should be greater than or equal to 10000");case 3:return t.next=5,this.messageModuleService.doUpdateMessage(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))},r.resendMessage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},e),t.next=3,this.messageModuleService.resendMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.deleteMessage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e),(r=JSON.parse(Ti(e))).message.status=2,t.next=5,this.messageModuleService.doUpdateMessage(r);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))},r.revokeMessage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e),(r=JSON.parse(Ti(e))).message=eg(r.message,["serverId","channelId","msgIdServer","time"]),r.message.status=1,t.next=6,this.messageModuleService.doUpdateMessage(r);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))},r.markMessageRead=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Al({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},e),e.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=e.channelId,this.messageModuleService.markMessageRead(e);case 4:case"end":return t.stop()}}),t,this)})))},r.replyMessage=function(e){Al({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},e);var t=e.replyMessage;if(e.serverId!==t.serverId||e.channelId!==t.channelId)throw new _l("Forbid replying to message from other server, channel");return this.sendMessage(e)},r.getMessageHistoryByIds=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),t.next=3,this.extendModuleService.getMessageHistoryByIds(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getReferMessages=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:Sp(hE),required:!1}},e),t.next=3,this.extendModuleService.getReferMessages(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getThreadMessages=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},e),t.next=3,this.extendModuleService.getThreadMessages(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getThreadRootMessagesMeta=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),t.next=3,this.extendModuleService.getThreadRootMessagesMeta(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.sendSystemNotification=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},e),t.next=3,this.notificationModuleService.sendSystemNotification(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.updateSystemNotification=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:Sp(mE)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},e),t.next=3,this.notificationModuleService.updateSystemNotification(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.markSystemNotificationsRead=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},e),t.next=3,this.notificationModuleService.markSystemNotificationsRead(e);case 3:case"end":return t.stop()}}),t,this)})))},r.getHistoryMessage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),t.next=3,this.messageModuleService.getHistoryMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getMentionedMeMessages=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.messageModuleService.getMentionedMeMessages(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.areMentionedMeMessages=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),Ru(r=e.messages).call(r,(function(t){return e.messages[0].serverId===t.serverId}))){t.next=4;break}throw new _l("Different serverId",e,10414);case 4:if(!this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(e.messages[0].serverId)){t.next=7;break}throw new _l("Not allowed for visitor",e,10403);case 7:return t.next=9,this.messageModuleService.areMentionedMeMessages(e.messages);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})))},r.addQuickComment=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extendModuleService.updateQuickComment(e,1);case 2:case"end":return t.stop()}}),t,this)})))},r.removeQuickComment=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extendModuleService.updateQuickComment(e,2);case 2:case"end":return t.stop()}}),t,this)})))},r.getQuickComments=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),t.next=3,this.extendModuleService.getQuickComments(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.sendTypingEvent=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),t.next=3,this.extendModuleService.sendTypingEvent(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getLastMessageOfChannels=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},e),t.next=3,this.messageModuleService.getLastMessageOfChannels(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.qchatOnMsgHandler=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageModuleService.onMsg(e);case 1:case"end":return t.stop()}}),t,this)})))},r.qchatOnRecvUnreadInfoHandler=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageModuleService.onRecvUnreadInfo(e);case 1:case"end":return t.stop()}}),t,this)})))},r.qchatOnSysMsgHandler=function(e){this.notificationModuleService.onSysMsg(e)},r.qchatMultiSyncMessageReadHandler=function(e){this.messageModuleService.onMultiSyncRead(e)},r.qchatMultiSyncSystemNotificationUpdateHandler=function(e){this.notificationModuleService.onMultiSysMsg(e)},r.qchatSyncSystemNotificationHandler=function(e){this.notificationModuleService.onSyncSysMsg(e)},r.qchatRecvMessageUpdateHandler=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageModuleService.onRecvMsgUpdate(e);case 1:case"end":return t.stop()}}),t,this)})))},r.searchMsgByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:Sp(yC),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:Sp(cE),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.messageModuleService.messageSearchByPage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.qchatMultiSyncServersMessageReadHandler=function(e){this.messageModuleService.onMultiSyncServersRead(e)},t}(SC),__=function(){function e(e){this.core=e}var t=e.prototype;return t.addChannelCategoryRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:e});case 3:return r=t.sent,t.abrupt("return",SE(r.content.channelCategoryRole));case 5:case"end":return t.stop()}}),t,this)})))},t.removeChannelCategoryRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",e);case 3:case"end":return t.stop()}}),t,this)})))},t.updateChannelCategoryRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:yE(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new _l("No update required",{},406);case 6:return t.abrupt("return",SE(r.content.channelCategoryRole));case 7:case"end":return t.stop()}}),t,this)})))},t.getChannelCategoryRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:e});case 3:return r=t.sent,t.abrupt("return",(n=r.content.list,Si(n)&&n.length>0?au(n).call(n,(function(e){return SE(e)})):[]));case 5:case"end":return t.stop()}var n}),t,this)})))},t.addChannelCategoryMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:e});case 3:return r=t.sent,t.abrupt("return",bE(r.content.channelCategoryMemberRole));case 5:case"end":return t.stop()}}),t,this)})))},t.removeChannelCategoryMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",e);case 3:case"end":return t.stop()}}),t,this)})))},t.updateChannelCategoryMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:yE(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new _l("No update required",{},406);case 6:return t.abrupt("return",bE(r.content.channelCategoryMemberRole));case 7:case"end":return t.stop()}}),t,this)})))},t.getChannelCategoryMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:e});case 3:return r=t.sent,t.abrupt("return",(n=r.content.list,Si(n)&&n.length>0?au(n).call(n,(function(e){return bE(e)})):[]));case 5:case"end":return t.stop()}var n}),t,this)})))},e}(),k_=function(e){function t(t){var r;return(r=e.call(this,"qchatRole",t)||this).core=t,hh({cmdMap:ZE,cmdConfig:r_()}),r.category=new __(t),r}er(t,e);var r=t.prototype;return r.createServerRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:sr(sr({},yE(e)),{type:tE.custom}),antispamTag:$C(e)});case 3:return r=t.sent,t.abrupt("return",ME(r.content.serverRole));case 5:case"end":return t.stop()}}),t,this)})))},r.updateServerRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:yE(e),antispamTag:$C(e)});case 3:return r=t.sent,t.abrupt("return",ME(r.content.serverRole));case 5:case"end":return t.stop()}}),t,this)})))},r.deleteServerRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatDeleteServerRole",e);case 3:case"end":return t.stop()}}),t,this)})))},r.getServerRoles=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:yE(e)});case 3:return n=t.sent,i=lu(r=n.content.serverRoles).call(r,(function(e){return 1===Kp(e.isMember)})),i=au(i).call(i,(function(e){return e.roleId})),t.abrupt("return",{roles:TE(n.content.serverRoles),isMemberRoles:i});case 7:case"end":return t.stop()}}),t,this)})))},r.addChannelRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:yE(e)});case 3:return r=t.sent,t.abrupt("return",ME(r.content.channelRole));case 5:case"end":return t.stop()}}),t,this)})))},r.getChannelRoles=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:e});case 3:return r=t.sent,t.abrupt("return",TE(r.content.channelRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.removeChannelRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelRole",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:yE(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new _l("No update required",{},406);case 6:return t.abrupt("return",ME(r.content.channelRole));case 7:case"end":return t.stop()}}),t,this)})))},r.addMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:e});case 3:return r=t.sent,t.abrupt("return",ME(r.content.memberRole));case 5:case"end":return t.stop()}}),t,this)})))},r.getMemberRoles=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:e});case 3:return r=t.sent,t.abrupt("return",TE(r.content.memberRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.removeMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:e});case 3:case"end":return t.stop()}}),t,this)})))},r.updateMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:yE(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new _l("No update required",{},406);case 6:return t.abrupt("return",ME(r.content.memberRole));case 7:case"end":return t.stop()}}),t,this)})))},r.addMembersToServerRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatAddMembersToServerRole",sr(sr({},e),{accids:Ti(e.accids)}));case 3:return r=t.sent,n=Qp(r,"content.accids.successAccids"),i=Qp(r,"content.accids.failedAccids"),t.abrupt("return",{successAccids:n?JSON.parse(n):[],failedAccids:i?JSON.parse(i):[]});case 7:case"end":return t.stop()}}),t,this)})))},r.removeMembersFromServerRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",sr(sr({},e),{accids:Ti(e.accids)}));case 3:return r=t.sent,n=Qp(r,"content.accids.successAccids"),i=Qp(r,"content.accids.failedAccids"),t.abrupt("return",{successAccids:n?JSON.parse(n):[],failedAccids:i?JSON.parse(i):[]});case 7:case"end":return t.stop()}}),t,this)})))},r.getMembersFromServerRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:e});case 3:return r=t.sent,t.abrupt("return",TE(r.content.members));case 5:case"end":return t.stop()}}),t,this)})))},r.getServerRolesByAccid=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:e});case 3:return r=t.sent,t.abrupt("return",TE(r.content.serverRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.getExistingServerRolesByAccids=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:e.serverId,accids:Ti(e.accids)});case 3:return r=t.sent,t.prev=4,i=JSON.parse(r.content.serverRoles),Bn(n=pr(i)).call(n,(function(e){var t;Bn(t=i[e]).call(t,(function(t,r){i[e][r]=mh(t,t_().serverRole)})),i[e]=TE(i[e])})),t.abrupt("return",i);case 10:throw t.prev=10,t.t0=t.catch(4),this.logger.error("can not parse serverRolesGroupByAccid from "+e.serverId+" and "+e.accids,r.content.serverRoles),t.t0;case 14:case"end":return t.stop()}}),t,this,[[4,10]])})))},r.getExistingChannelRolesByServerRoleIds=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:e.serverId,channelId:e.channelId,roleIds:Ti(e.roleIds)});case 3:return r=t.sent,t.abrupt("return",TE(r.content.channelRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.getExistingAccidsOfMemberRoles=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:e.serverId,channelId:e.channelId,accids:Ti(e.accids)});case 3:return r=t.sent,n=r.content.memberRoles,t.abrupt("return",n&&n.length>0?au(n).call(n,(function(e){return e.accid})):[]);case 6:case"end":return t.stop()}}),t,this)})))},r.getExistingAccidsInServerRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:e.serverId,roleId:e.roleId,accids:Ti(e.accids)});case 3:return r=t.sent,n=r.content.members,t.abrupt("return",n&&n.length>0?au(n).call(n,(function(e){return e.accid})):[]);case 6:case"end":return t.stop()}}),t,this)})))},r.updateServerRolePriorities=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},e),t.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:e.serverId,serverRoles:au(r=e.serverRoles).call(r,(function(e){return{serverId:e.serverId,roleId:e.roleId,priority:e.priority}}))});case 3:return n=t.sent,t.abrupt("return",TE(n.content.serverRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.checkPermission=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},e),t.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:sr(sr({},e),{auth:iE[e.auth]||e.auth})});case 3:return r=t.sent,t.abrupt("return",r.content.checked);case 5:case"end":return t.stop()}}),t,this)})))},r.addChannelCategoryRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.addChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.removeChannelCategoryRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.removeChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.updateChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.getChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.addChannelCategoryMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.addChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.removeChannelCategoryMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.removeChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.updateChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryMemberRole=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.getChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.checkPermissions=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},e),this.core.logger.log("qchatRole::checkPermission options is",e),t.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:sr(sr({},e),{auths:Ti(au(r=e.auths).call(r,(function(e){return iE[e]||e})))})});case 4:return i=t.sent,this.core.logger.log("qchatRole::checkPermission result is",i.content),o={},Bn(n=i.content.checkPermissionsResult).call(n,(function(e){o[e.auth]=e.isAllow})),this.core.logger.log("qchatRole::checkPermission auths is",o),t.abrupt("return",IE(o));case 10:case"end":return t.stop()}}),t,this)})))},t}(SC);function R_(e,t){var r,n=void 0!==kc&&Ul(e)||e["@@iterator"];if(n)return Xt(r=(n=n.call(e)).next).call(r,n);if(Si(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return w_(e,t);var n=Fc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Vl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w_(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w_(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var A_=function(e){function t(t){var r;return(r=e.call(this,"qchatServer",t)||this).core=t,hh({cmdMap:zE,cmdConfig:XE()}),r}er(t,e);var r=t.prototype;return r.createServer=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:sr(sr({},e),{searchEnable:!1===e.searchEnable?0:1}),antispamTag:$C(e)});case 3:return r=t.sent,t.abrupt("return",YC(r.content.serverInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.deleteServer=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatDeleteServer",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateServer=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:sr(sr({},e),{searchEnable:!1===e.searchEnable?0:1}),antispamTag:$C(e)});case 3:return r=t.sent,t.abrupt("return",YC(r.content.serverInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.getServers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetServers",e);case 3:return r=t.sent,t.abrupt("return",KC(r.content.serverList));case 5:case"end":return t.stop()}}),t,this)})))},r.getServersByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:KC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.inviteServerMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e),t.next=3,this.core.sendCmd("qchatInviteServerMembers",e);case 3:return r=t.sent,n=r.content.record||{},t.abrupt("return",{failByOverAccids:r.content.failByOverAccids,failByBanAccids:r.content.failByBanAccids,recordInfo:ZC(n)});case 6:case"end":return t.stop()}}),t,this)})))},r.acceptServerInvite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatAcceptServerInvite",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectInviteServer=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatRejectInviteServer",e);case 3:case"end":return t.stop()}}),t,this)})))},r.applyServerJoin=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e),t.next=3,this.core.sendCmd("qchatApplyServerJoin",e);case 3:return r=t.sent,t.abrupt("return",ZC(r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.acceptServerApply=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatAcceptServerApply",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectServerApply=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatRejectServerApply",e);case 3:case"end":return t.stop()}}),t,this)})))},r.kickServerMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatKickServerMembers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.leaveServer=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatLeaveServer",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:e,antispamTag:$C(e)});case 3:return r=t.sent,t.abrupt("return",QC(r.content.memberInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.updateServerMemberInfo=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:e,antispamTag:$C(e)});case 3:return r=t.sent,t.abrupt("return",QC(r.content.memberInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.getServerMembers=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({accids:{type:"array"}},e),r=[],e.accids.length)for(n=R_(e.accids);!(i=n()).done;)o=i.value,r.push(o.serverId+"|"+o.accid);return t.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:r});case 5:return a=t.sent,t.abrupt("return",zC(a.content.accidList));case 7:case"end":return t.stop()}}),t,this)})))},r.getServerMembersByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:zC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.subscribeServer=function(e){var t,r,n,i;return Wl(this,void 0,void 0,jl.mark((function o(){var a,s,c,u;return jl.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(Al({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},e),!(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)||e.isInternalTrigger){o.next=3;break}throw new _l("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:if(e.type||(e.type=4),!e.servers.length){o.next=12;break}return s=sr(sr({},e),{channels:au(a=e.servers).call(a,(function(e){return{serverId:e.serverId,channelId:""}}))}),o.next=8,this.core.qchatChannel.subscribeModuleService.subscribe(s);case 8:return c=o.sent,u=c.failedChannels,(null===(i=null===(n=this.core.qchatChannel)||void 0===n?void 0:n.config)||void 0===i?void 0:i.autoSubscribe)?this.core.qchatChannel.subscribeModuleService.cacheAutoSubscribe(s):this.core.qchatChannel.subscribeModuleService.cacheSubscribe(s),o.abrupt("return",{failedServers:u});case 12:case"end":return o.stop()}}),o,this)})))},r.banServerMember=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:sr(sr({},e),{opeType:1})});case 3:case"end":return t.stop()}}),t,this)})))},r.unbanServerMember=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:sr(sr({},e),{opeType:2})});case 3:case"end":return t.stop()}}),t,this)})))},r.getBannedMembersByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag)},datas:JC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.serverSearchByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:Sp(yC),required:!1},searchType:{type:"enum",values:Sp(MC)},sort:{type:"enum",values:Sp(IC),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),!(e.startTime&&e.endTime&&e.startTime>=e.endTime)){t.next=3;break}throw new Sl("startTime more than endTime",e,"timeRule");case 3:return t.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:sr(sr({},e),{order:e.order&&yC[e.order],searchType:MC[e.searchType],sort:xm(e)&&IC[xm(e)],serverType:Ti(e.serverType)})});case 5:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:Kp(o.nextTimetag),cursor:o.cursor},datas:KC(i)});case 8:case"end":return t.stop()}}),t,this)})))},r.serverMemberSearchByPage=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:e});case 3:return r=t.sent,t.abrupt("return",zC(r.content.members));case 5:case"end":return t.stop()}}),t,this)})))},r.generateInviteCode=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},e),t.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:e});case 3:return r=t.sent,t.abrupt("return",wh({expireTime:{type:"number"}},r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.joinByInviteCode=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:e});case 3:case"end":return t.stop()}}),t,this)})))},r.getInviteApplyRecordOfServer=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:sr(sr({},e),{reverse:Pc(e)?1:0})});case 3:return r=t.sent,t.abrupt("return",eE(r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.getInviteApplyRecordOfSelf=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:sr(sr({},e),{reverse:Pc(e)?1:0})});case 3:return r=t.sent,t.abrupt("return",eE(r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.markRead=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverIds:{type:"array",itemType:"string",required:!0}},e),t.next=3,this.core.sendCmd("qchatClearServersUnread",e);case 3:return r=t.sent,n=aE(r.content.clearServersUnreadTag),i=n.successServerIds,o=n.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",i,o),t.abrupt("return",n);case 9:case"end":return t.stop()}}),t,this)})))},r.subscribeAllChannel=function(e){var t,r;return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Al({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},e),!(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)){n.next=3;break}throw new _l("subscribe channel failed, manual subscribe is not allowed in auto subscribe mode.",{},403);case 3:return n.next=5,this.core.sendCmd("qchatSubscribeChannelsByServers",e,{timeout:3e4});case 5:return(o=n.sent).content.unreadInfos=DC(o.content.unreadInfos),o.content.failServerIds=GC(o.content.failServerIds),a={type:e.type,opeType:1,channels:au(i=o.content.unreadInfos).call(i,(function(e){return{serverId:e.serverId,channelId:e.channelId}}))},this.core.eventBus.emit("qchatChannel/cacheSubscribe",a),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",e.serverIds),this.core.eventBus.emit("qchatChannel/updateUnreads",o.content.unreadInfos),n.abrupt("return",o.content);case 13:case"end":return n.stop()}}),n,this)})))},r.enterAsVisitor=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:Ti(e.serverIds)}});case 3:return r=t.sent,n=GC(r.content.failServerIds),i=Rl(e.serverIds,n),this.core.qchatChannel.subscribeForVisitorService.cacheServer(i),t.abrupt("return",{failedServers:n});case 8:case"end":return t.stop()}}),t,this)})))},r.leaveAsVisitor=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o=this;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({serverIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:Ti(e.serverIds)}});case 3:return r=t.sent,n=GC(r.content.failServerIds),i=Rl(e.serverIds,n),Bn(i).call(i,(function(e){o.core.qchatChannel.subscribeForVisitorService.deleteServer(e)})),t.abrupt("return",{failedServers:n});case 8:case"end":return t.stop()}}),t,this)})))},r.subscribeAsVisitor=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},e),!e.serverIds.length){t.next=5;break}return t.next=4,this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(e);case 4:return t.abrupt("return",t.sent);case 5:return t.abrupt("return",{failedServers:[]});case 6:case"end":return t.stop()}}),t,this)})))},t}(SC),x_=function(e){function t(t,r){var n;return(n=e.call(this,"V2NIMNotificationService",t)||this).config={compatibleWithV1:!0},n.notificationUtil=new My(n.core),n.core._registerDep(hg,"V2NIMConversationIdUtil"),"v2"!==n.core.options.apiVersion?st(n):(hh({cmdMap:ly,cmdConfig:fy}),n.setOptions(r),n)}er(t,e);var r=t.prototype;return r.setOptions=function(e){var t;(null===(t=this.core.systemMessage)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=sr(this.config,e)},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onReceiveCustomNotifications"===t){var c=a[0];this.logger.log(""+i,au(c).call(c,(function(e){return"sender:"+e.senderId+";receiver:"+e.receiverId+";ctype:"+e.conversationType+";time:"+e.timestamp})))}else if("onReceiveBroadcastNotifications"===t){var u=a[0];this.logger.log(""+i,au(u).call(u,(function(e){return"id:"+e.id+";sender:"+e.senderId+";time:"+e.time})))}else{var d,l;(d=this.logger).log.apply(d,Rs(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,a))},r.sendCustomNotification=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i,o,a;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Nl(this.core.account,e),Al(Iy,{content:t,params:r},"",!0),i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=3===i?"v2SendCustomNotificationWithSuperTeam":"v2SendCustomNotification",a=this.notificationUtil.generateNotificationTag(e,t,r),n.next=8,this.core.sendCmd(o,{tag:a});case 8:case"end":return n.stop()}}),n,this)})))},r.processSystemNotification=function(e){var t=[0,1,2,3,4,15,16,17,18],r=[5,6],n=e.type;if(tu(t).call(t,n))this.core.eventBus.emit("V2NIMTeamService/sysNotification",e);else{if(!tu(r).call(r,n)){var i=sr(sr({},e),{conversationType:{100:1,101:2,102:1,103:3}[n]});return delete i.type,i}this.core.eventBus.emit("V2NIMFriendService/sysNotification",e)}},r.markBroadcastMsgAck=function(e){this.config.compatibleWithV1||this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:17,ids:au(e).call(e,(function(e){return e.id}))})},r.syncBroadcastMsgHandler=function(e){var t=e.content.datas;this.markBroadcastMsgAck(t),this.emit("onReceiveBroadcastNotifications",t)},r.onBroadcastMsgHandler=function(e){var t=e.content.data;this.markBroadcastMsgAck([t]),this.emit("onReceiveBroadcastNotifications",[t])},r.onSysNotificationHandler=function(e){this.markSysNotificationAck([e.content.data]);var t=this.processSystemNotification(e.content.data);t&&this.emit("onReceiveCustomNotifications",[t])},r.v2SyncOfflineSysNotificationsHandler=function(e){var t,r,n,i=this;this.markSysNotificationAck(e.content.datas);var o=lu(t=au(r=xm(n=e.content.datas).call(n,(function(e,t){return e.timestamp-t.timestamp}))).call(r,(function(e){return i.processSystemNotification(e)}))).call(t,(function(e){return e}));o&&this.emit("onReceiveCustomNotifications",o)},r.v2NotificationRevokeHandler=function(e){this.markSysNotificationAck([e.content.data])},r.v2NotificationSyncRevokeHandler=function(e){var t=e.content.type;1===Kp(t)&&this.markSysNotificationAck(e.content.datas)},r.markSysNotificationAck=function(e){if(!this.config.compatibleWithV1){var t=[],r=[],n=[15,16,17,18,103];Bn(e).call(e,(function(e){e.idServer&&(tu(n).call(n,e.type)?r.push(e.idServer):t.push(e.idServer))})),t.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"7",cid:"3",ids:t}),r.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"21",cid:"19",ids:r})}},t}($h),N_={"27_1":"v2NIMSync","27_10":"v2QChatSync"},O_={v2NIMSync:{sid:27,cid:1,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,p2pTeamModifyMessage:30,superTeamModifyMessage:31,filterMsgs:100}}],response:[{type:"Long",name:"timetag"}]},v2QChatSync:{sid:27,cid:10,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}},P_=function(e){function t(t){var r;return(r=e.call(this,"V2NIMSyncService",t)||this).teamKey=["teams","superTeams","myTeamMembers","mySuperTeamMembers"],r.config={},r.timetags={},"v2"!==r.core.options.apiVersion?st(r):(r.initEventListeners(),hh({cmdMap:N_,cmdConfig:O_}),r)}er(t,e);var r=t.prototype;return r.reset=function(){this.timetags={}},r.setOptions=function(e){var t=this.core;return this.config=sr({myInfo:!!t.user.name,offlineMsgs:!!t.V2NIMMessageService.name,roamingMsgs:!!t.V2NIMMessageService.name,relations:!!t.user.name,friends:!!t.friend.name,friendUsers:!!t.user.name,msgReceipts:!!t.V2NIMMessageService.name,broadcastMsgs:!!t.V2NIMNotificationService.name,recallMsg:!!t.V2NIMMessageService.name,sessionAck:!!t.V2NIMConversationService.name,superTeamSessionAck:!!t.V2NIMConversationService.name,superTeamRoamingMsgs:!!t.V2NIMTeamService.name,deleteSuperTeamMsg:!!t.V2NIMTeamService.name,deleteSelfMsgs:!!t.V2NIMMessageService.name,sessionHistoryMsgsDelete:!!t.V2NIMMessageService.name,avSignal:!!t.signaling.name,teams:!!t.V2NIMTeamService.name,superTeams:!!t.V2NIMTeamService.name,myTeamMembers:!!t.V2NIMTeamService.name,mySuperTeamMembers:!!t.V2NIMTeamService.name,p2pTeamModifyMessage:!!t.V2NIMMessageService.name,superTeamModifyMessage:!!t.V2NIMMessageService.name},e),this.config},r.doBasicSync=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i,o,a=this;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=pr(this.config),r=lu(t).call(t,(function(e){var t;return!tu(t=a.teamKey).call(t,e)&&a.config[e]})),n=this.genSyncParams(r),this.logger.log("V2Sync:basic",n),e.next=6,this.core.clientSocket.sendCmd("v2NIMSync",{tag:n});case 6:return i=e.sent,o=i.content.timetag,this.setTimetags(o,r),e.next=11,this.delaySyncDone();case 11:return e.next=13,this.handleImmediate();case 13:this.core.logger.log("sync::basic sync complete in",o);case 14:case"end":return e.stop()}}),e,this)})))},r.doTeamSync=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i,o,a=this;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(r=lu(t=this.teamKey).call(t,(function(e){return a.config[e]}))).length){e.next=3;break}return e.abrupt("return");case 3:return n=this.genSyncParams(r),this.core.eventBus.emit("V2NIMTeamService/onSyncStarted"),this.logger.log("V2Sync:team",n),i=null,e.prev=7,e.next=10,this.core.clientSocket.sendCmd("v2NIMSync",{tag:n});case 10:i=e.sent,e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),this.core.eventBus.emit("V2NIMTeamService/onSyncFailed",e.t0),e.t0;case 17:this.core.eventBus.emit("V2NIMTeamService/onSyncFinished"),o=i.content.timetag,this.setTimetags(o,this.teamKey),this.core.logger.log("sync::team sync complete in",o);case 21:case"end":return e.stop()}}),e,this,[[7,13]])})))},r.doQchatSync=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.clientSocket.sendCmd("v2QChatSync",{tag:{systemNotification:0}});case 2:t=e.sent,this.core.logger.log("sync::qchat sync complete in",t.content.timetag);case 4:case"end":return e.stop()}}),e,this)})))},r.doSync=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=Qp(this.core,"V2NIMLoginService.authenticator.loginClientOfThisConnection.loginType"))){e.next=4;break}return this.logger.warn("sync::doSync: no loginType, stop sync"),e.abrupt("return");case 4:if(this.logger.log("sync::doSync:type "+t),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2}),1!==t){e.next=20;break}return e.prev=7,e.next=10,this.doBasicSync();case 10:return e.next=12,this.doTeamSync();case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(7),this.doSyncComplete(e.t0),e.abrupt("return");case 18:e.next=49;break;case 20:if(2!==t){e.next=32;break}return e.prev=21,e.next=24,this.doQchatSync();case 24:e.next=30;break;case 26:return e.prev=26,e.t1=e.catch(21),this.doSyncComplete(e.t1),e.abrupt("return");case 30:e.next=49;break;case 32:if(3!==t){e.next=48;break}return e.prev=33,e.next=36,this.doBasicSync();case 36:return e.next=38,this.doTeamSync();case 38:return e.next=40,this.doQchatSync();case 40:e.next=46;break;case 42:return e.prev=42,e.t2=e.catch(33),this.doSyncComplete(e.t2),e.abrupt("return");case 46:e.next=49;break;case 48:return e.abrupt("return");case 49:this.doSyncComplete();case 50:case"end":return e.stop()}}),e,this,[[7,14],[21,26],[33,42]])})))},r.doSyncComplete=function(e){e&&this.core.logger.log("sync::doSync complete but got error",e),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:e,subType:"mainSync"})},r.initEventListeners=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.doSync()}))},r.genSyncParams=function(e){var t=this;return fl(e).call(e,(function(e,r){var n=r;return e[n]=t.timetags[n]||0,e}),{})},r.setTimetags=function(e,t){var r=this;Bn(t).call(t,(function(t){r.timetags[t]=e}))},r.handleImmediate=function(){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),ls.resolve()},r.delaySyncDone=function(){return"ALI"===Ep()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new ls((function(e){Ls((function(){e()}),100)}))):ls.resolve()},t}($h),L_="V2NIMAIService",V_={"4_26":"v2AIChatNotify","29_35":"v2AIProxyModelCall","29_36":"v2AIGetUserList"},U_={accountId:1,messages:{id:2,converter:yh,retConverter:Ih},requestId:3,content:{id:4,converter:yh,retConverter:Ih},promptVariables:5,modelConfigParams:{id:6,converter:yh,retConverter:Ih},antispamBusinessId:7,antispamEnabled:{id:8,converter:vh}},D_={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,modelType:{id:11,retType:"number"},modelConfig:{id:12,retConverter:function(e){if(e=Ih(e)){var t=pr(e),r=fl(t).call(t,(function(t,r){var n;return t[au(n=(r||"").split("_")).call(n,(function(e,t){return 0===t?e:e[0].toUpperCase()+Fc(e).call(e,1)})).join("")]=e[r],t}),{});if("string"==typeof r.promptKeys)try{r.promptKeys=JSON.parse(r.promptKeys)}catch(n){}return r}}},yunxinConfig:{id:13,retConverter:function(e){if(e=Ih(e))return e}},valid:{id:14,retType:"boolean"},createTime:{id:15,retType:"number"},updateTime:{id:16,retType:"number"}},q_={v2AIChatNotify:{sid:4,cid:26,service:L_,response:[{type:"Property",name:"data",reflectMapper:gh({code:{id:1,retType:"number"},accountId:2,requestId:3,content:{id:4,retConverter:Ih}})}]},v2AIProxyModelCall:{sid:29,cid:35,service:L_,params:[{type:"Property",name:"tag",reflectMapper:U_}]},v2AIGetUserList:{sid:29,cid:36,service:L_,params:[{type:"Property",name:"tag",reflectMapper:{pageToken:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(D_)},{type:"Property",name:"queryTag",reflectMapper:gh({hasMore:{id:16,retType:"boolean"},nextToken:2})}]}},B_=function(e){function t(t){var r;return r=e.call(this,"V2NIMAIService",t)||this,hh({cmdMap:V_,cmdConfig:q_}),r}er(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onProxyAIModelCall"===t){var c=a[0];this.logger.log(""+i,"code:"+c.code+";accountId:"+c.accountId+";requestId:"+c.requestId)}else{var u,d;(u=this.logger).log.apply(u,Rs(d=[""+i]).call(d,a))}return(r=e.prototype.emit).call.apply(r,Rs(n=[this,t]).call(n,a))},r.getAIUserList=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),e.next=3,this.core.sendCmd("v2AIGetUserList",{tag:{}});case 3:return t=e.sent,e.abrupt("return",t.content.datas);case 5:case"end":return e.stop()}}),e,this)})))},r.proxyAIModelCall=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al(_v,e,"",!0),t.next=3,this.core.sendCmd("v2AIProxyModelCall",{tag:e});case 3:case"end":return t.stop()}}),t,this)})))},r.v2AIChatNotifyHandler=function(e){var t=e.content.data;t&&t.requestId?this.emit("onProxyAIModelCall",{code:t.code||200,accountId:t.accountId,requestId:t.requestId,content:t.content}):this.logger.warn("v2AIChatNotifyHandler: invalid data",t)},t}($h),F_={"18_1":"v2SignallingCreateRoom","18_2":"v2SignallingDelayRoom","18_3":"v2SignallingCloseRoom","18_4":"v2SignallingJoinRoom","18_5":"v2SignallingLeaveRoom","18_6":"v2SignallingInvite","18_7":"v2SignallingCancelInvite","18_16":"v2SignallingCall","18_17":"v2SignallingCallSetup","18_8":"v2SignallingRejectInvite","18_9":"v2SignallingAcceptInvite","18_10":"v2SignallingSendControl","15_11":"v2SignallingOnlineEvent","15_12":"v2SignallingMultiClientEvent","15_13":"v2SignallingOfflineEvent","15_14":"v2SignallingSyncChannels","18_15":"v2SignallingGetRoomInfo"},G_="V2NIMSignallingService",j_={accountId:1,uid:{id:2,retType:"number"},joinTime:{id:3,retType:"number"},expireTime:{id:4,retType:"number"},deviceId:5},H_={channelType:{id:1,retType:"number",retAccess:"channelInfo.channelType"},channelName:{id:2,retAccess:"channelInfo.channelName"},channelId:{id:3,retAccess:"channelInfo.channelId"},createTime:{id:4,retType:"number",retAccess:"channelInfo.createTime"},expireTime:{id:5,retType:"number",retAccess:"channelInfo.expireTime"},creatorAccountId:{id:6,retAccess:"channelInfo.creatorAccountId"},channelExtension:{id:7,retAccess:"channelInfo.channelExtension"},invalid:8,fromAccid:10,toAccid:11,requestId:12,pushEnabled:{id:13,access:"pushConfig.pushEnabled",converter:vh,retType:"boolean"},pushTitle:{id:14,access:"pushConfig.pushTitle"},pushContent:{id:15,access:"pushConfig.pushContent"},pushPayload:{id:16,access:"pushConfig.pushPayload"},unreadEnabled:{id:17,access:"signallingConfig.unreadEnabled",converter:vh,retType:"boolean",def:1},members:{id:18,retAccess:"members",retConverter:function(e){try{var t=JSON.parse(e);return au(t).call(t,(function(e){return mh(e,gh(j_))}))}catch(r){return}}},attach:{id:19,retConverter:Ih},serverExtension:{id:20,retDef:""},offlineEnabled:{id:21,converter:vh,retType:"boolean",def:1},msgId:22,selfUid:{id:23,retType:"number",access:"signallingConfig.selfUid"},time:{id:24,retType:"number"},rtcChannelName:{id:25,access:"rtcConfig.rtcChannelName"},rtcTokenTtl:{id:26,retType:"number",access:"rtcConfig.rtcTokenTtl",retAccess:"rtcInfo.rtcTokenTtl"},rtcToken:{id:27,retAccess:"rtcInfo.rtcToken"},rtcParams:{id:28,access:"rtcConfig.rtcParams",retAccess:"rtcInfo.rtcParams"},callStatus:{id:30,retType:"number"}},W_={v2SignallingCall:{sid:18,cid:16,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingCallSetup:{sid:18,cid:17,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingCreateRoom:{sid:18,cid:1,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingDelayRoom:{sid:18,cid:2,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingCloseRoom:{sid:18,cid:3,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingJoinRoom:{sid:18,cid:4,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingLeaveRoom:{sid:18,cid:5,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingInvite:{sid:18,cid:6,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingCancelInvite:{sid:18,cid:7,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingRejectInvite:{sid:18,cid:8,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}]},v2SignallingAcceptInvite:{sid:18,cid:9,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}]},v2SignallingSendControl:{sid:18,cid:10,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}]},v2SignallingOnlineEvent:{sid:15,cid:11,service:G_,response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingMultiClientEvent:{sid:15,cid:12,service:G_,response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingOfflineEvent:{sid:15,cid:13,service:G_,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(H_)}]},v2SignallingSyncChannels:{sid:15,cid:14,service:G_,response:[{type:"PropertyArray",name:"datas",reflectMapper:gh(H_)}]},v2SignallingGetRoomInfo:{sid:18,cid:15,service:G_,params:[{type:"Property",name:"tag",reflectMapper:H_}],response:[{type:"Property",name:"data",reflectMapper:gh(H_)}]},v2SignallingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:G_,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},Y_={calleeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},K_={channelId:{type:"string",required:!0,allowEmpty:!1},callerAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},Q_={channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0}},z_={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},J_={channelId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},$_={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},X_={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}}},Z_={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},ek={channelId:{type:"string",allowEmpty:!1},receiverAccountId:{type:"string",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},tk={channelId:{type:"string",allowEmpty:!1},inviterAccountId:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},rk=tk;function nk(e){var t,r=e.attach,n={eventType:r.type,channelInfo:e.channelInfo,operatorAccountId:e.fromAccid,time:e.time,serverExtension:e.serverExtension,requestId:e.requestId,pushConfig:e.pushConfig,unreadEnabled:null===(t=e.signallingConfig)||void 0===t?void 0:t.unreadEnabled},i=e.fromAccid,o=e.toAccid;switch(n.eventType){case 1:break;case 2:n.member={accountId:r.member[1],uid:Number(r.member[2]),joinTime:Number(r.member[3]),expireTime:Number(r.member[4]),deviceId:r.member[5]};break;case 3:case 4:n.operatorAccountId=i,n.inviteeAccountId=o,n.inviterAccountId=i;break;case 5:case 6:n.operatorAccountId=i,n.inviterAccountId=o,n.inviteeAccountId=i}return JSON.parse(Ti(n))}var ik,ok=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMSignallingService",t)||this).config={compatibleWithV1:!0},n.channels={},n.timer=0,n.pollingInterval=12e4,"v2"!==n.core.options.apiVersion?st(n):(hh({cmdMap:F_,cmdConfig:W_}),n.setOptions(r),n)}er(t,e);var r=t.prototype;return r.reset=function(){this.timer=0,this.channels={}},r.setOptions=function(e){var t;(null===(t=this.core.signaling)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=sr(this.config,e)},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Rs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Rs(o=[this,t]).call(o,c))},r.call=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o,a;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(Y_,e,"",!0),e.calleeAccountId!==this.core.account){r.next=4;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"You cannot call yourself"}});case 4:return n=void 0!==e.pushConfig&&void 0!==e.pushConfig.pushEnabled&&e.pushConfig.pushEnabled,r.next=7,this.core.sendCmd("v2SignallingCall",{tag:sr(sr({},e),{toAccid:e.calleeAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled,pushConfig:sr(sr({},e.pushConfig||{}),{pushEnabled:n})})});case 7:return i=r.sent,o=i.content.data,this.channels[o.channelInfo.channelId]=xS(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(Xt(a=this.aotoDelay).call(a,this),this.pollingInterval,-1)),r.abrupt("return",{callStatus:o.callStatus,rtcInfo:o.rtcInfo,roomInfo:{channelInfo:o.channelInfo,members:o.members}});case 12:case"end":return r.stop()}}),r,this)})))},r.callSetup=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(K_,e,"",!0),e.callerAccountId!==this.core.account){r.next=4;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"callSetup: cannot be yourself"}});case 4:return r.next=6,this.core.sendCmd("v2SignallingCallSetup",{tag:sr(sr({},e),{toAccid:e.callerAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled})});case 6:return n=r.sent,i=n.content.data,this.channels[i.channelInfo.channelId]=xS(i.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(Xt(o=this.aotoDelay).call(o,this),this.pollingInterval,-1)),r.abrupt("return",{callStatus:i.callStatus,rtcInfo:i.rtcInfo,roomInfo:{channelInfo:i.channelInfo,members:i.members}});case 11:case"end":return r.stop()}}),r,this)})))},r.createRoom=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){var i;return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(Q_,{channelType:e,channelName:t,channelExtension:r},"",!0),n.next=4,this.core.sendCmd("v2SignallingCreateRoom",{tag:{channelType:e,channelName:t,channelExtension:r}});case 4:return i=n.sent,n.abrupt("return",i.content.data.channelInfo);case 6:case"end":return n.stop()}}),n,this)})))},r.delayRoom=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.next=3,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:e}});case 3:return r=t.sent,t.abrupt("return",{channelInfo:r.content.data.channelInfo,members:r.content.data.members});case 5:case"end":return t.stop()}}),t,this)})))},r.closeRoom=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al(z_,{channelId:e,offlineEnabled:t,serverExtension:r},"",!0),n.next=4,this.core.sendCmd("v2SignallingCloseRoom",{tag:{channelId:e,offlineEnabled:void 0!==t&&t,serverExtension:r}});case 4:case"end":return n.stop()}}),n,this)})))},r.joinRoom=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i,o;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Al(J_,e,"",!0),r.next=4,this.core.sendCmd("v2SignallingJoinRoom",{tag:sr(sr({},e),{offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled})});case 4:return n=r.sent,i=n.content.data,this.channels[i.channelInfo.channelId]=xS(i.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(Xt(o=this.aotoDelay).call(o,this),this.pollingInterval,-1)),r.abrupt("return",{channelInfo:n.content.data.channelInfo,members:n.content.data.members});case 9:case"end":return r.stop()}}),r,this)})))},r.leaveRoom=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Al($_,{channelId:e,offlineEnabled:t,serverExtension:r},"",!0),n.next=4,this.core.sendCmd("v2SignallingLeaveRoom",{tag:{channelId:e,offlineEnabled:void 0!==t&&t,serverExtension:r}});case 4:delete this.channels[e];case 5:case"end":return n.stop()}}),n,this)})))},r.invite=function(e){var t;return Wl(this,void 0,void 0,jl.mark((function r(){var n,i;return jl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Al(X_,e,"",!0),e.inviteeAccountId!==this.core.account){r.next=4;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"invite: cannot be yourself"}});case 4:return n=void 0!==e.pushConfig&&void 0!==e.pushConfig.pushEnabled&&e.pushConfig.pushEnabled,r.next=7,this.core.sendCmd("v2SignallingInvite",{tag:sr(sr({},e),{toAccid:e.inviteeAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled,pushConfig:sr(sr({},e.pushConfig||{}),{pushEnabled:n})})});case 7:return i=r.sent,r.abrupt("return",i.content.data);case 9:case"end":return r.stop()}}),r,this)})))},r.cancelInvite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Al(Z_,e,"",!0),t.next=4,this.core.sendCmd("v2SignallingCancelInvite",{tag:sr(sr({},e),{toAccid:e.inviteeAccountId})});case 4:return r=t.sent,t.abrupt("return",r.content.data);case 6:case"end":return t.stop()}}),t,this)})))},r.rejectInvite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al(tk,e,"",!0),e.inviterAccountId!==this.core.account){t.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"rejectInvite: cannot be yourself"}});case 3:return t.next=5,this.core.sendCmd("v2SignallingRejectInvite",{tag:sr(sr({},e),{toAccid:e.inviterAccountId})});case 5:case"end":return t.stop()}}),t,this)})))},r.acceptInvite=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al(rk,e,"",!0),e.inviterAccountId!==this.core.account){t.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"acceptInvite: cannot be yourself"}});case 3:return t.next=5,this.core.sendCmd("v2SignallingAcceptInvite",{tag:sr(sr({},e),{toAccid:e.inviterAccountId})});case 5:case"end":return t.stop()}}),t,this)})))},r.sendControl=function(e,t,r){return Wl(this,void 0,void 0,jl.mark((function n(){return jl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Al(ek,{channelId:e,receiverAccountId:t,serverExtension:r},"",!0),n.next=3,this.core.sendCmd("v2SignallingSendControl",{tag:{channelId:e,toAccid:t,serverExtension:r}});case 3:case"end":return n.stop()}}),n,this)})))},r.getRoomInfoByChannelName=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Al({channelName:{type:"string",allowEmpty:!1}},{channelName:e},"",!0),t.next=3,this.core.sendCmd("v2SignallingGetRoomInfo",{tag:{channelName:e}});case 3:return r=t.sent,n=r.content.data,i=n.members,o=n.channelInfo,t.abrupt("return",{channelInfo:o,members:i||[]});case 6:case"end":return t.stop()}}),t,this)})))},r.aotoDelay=function(){return Wl(this,void 0,void 0,jl.mark((function e(){var t,r,n,i;return jl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=pr(this.channels)).length){e.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,e.abrupt("return");case 5:this.logger.log("v2Signlling:autoDelay",t),r=0;case 7:if(!(r<t.length)){e.next=23;break}return n=t[r],e.prev=9,e.next=12,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:n}});case 12:i=e.sent,this.channels[n]=i.content.data.channelInfo,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),this.logger.warn("signling:autoDelay "+n+" failed",e.t0),delete this.channels[n];case 20:r++,e.next=7;break;case 23:case"end":return e.stop()}}),e,this,[[9,16]])})))},r.v2SignallingOnlineEventHandler=function(e){var t=e.content.data,r="number"==typeof Qp(e,"raw.r[0]")?""+e.raw.r[0]:"0";!this.config.compatibleWithV1&&r&&Kp(r)&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:[r]}),this.emit("onOnlineEvent",nk(t))},r.v2SignallingMultiClientEventHandler=function(e){this.emit("onMultiClientEvent",nk(e.content.data))},r.v2SignallingOfflineEventHandler=function(e){var t;if(e.content.datas&&e.content.datas.length>0){if(!this.config.compatibleWithV1){var r,n=au(r=e.content.datas).call(r,(function(e){return e.msgId}));n.length>0&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:n})}var i=au(t=e.content.datas).call(t,(function(e){return nk(e)}));this.emit("onOfflineEvent",i)}},r.v2SignallingSyncChannelsHandler=function(e){var t=this;if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var r,n=e.content.datas;Bn(n).call(n,(function(e){var r=e.channelInfo.channelId;t.channels[r]=xS(e.channelInfo)})),this.timer||(this.timer=this.core.timerManager.addTimer(Xt(r=this.aotoDelay).call(r,this),this.pollingInterval,-1)),this.emit("onSyncRoomInfoList",n)}},t}($h),ak={"19_1":"v2PublishEvent","14_2":"v2OnUserStatusChange","19_3":"v2SubscribeUserStatus","19_4":"v2UnsubscribeUserStatus","19_5":"v2UnsubscribeAllUserStatus","19_6":"v2QuerySubscribeEvent","19_7":"v2QueryAllSubscribeEvent","14_9":"v2OnMultiUserStatusChange"},sk="V2NIMSubscriptionService",ck={eventType:{id:1,retType:"number"},statusType:{id:2,retType:"number"},uniqueId:3,extension:4,duration:{id:5,retType:"number"},onlineOnly:{id:6,retType:"boolean",converter:function(e){return e?1:2}},multiSync:{id:7,retType:"boolean",converter:vh},publishTime:{id:10,retType:"number"},serverId:11,clientType:{id:12,retType:"number"},serverExtension:13,extensionReceived:14,accountId:103},uk={eventType:{id:1,retType:"number"},duration:{id:2,retType:"number"},immediateSync:{id:3,retType:"number",converter:vh},accountId:102,subscribeTime:{id:105,retType:"number"}},dk={v2PublishEvent:{sid:19,cid:1,service:sk,params:[{type:"Property",name:"tag",reflectMapper:ck}],response:[{type:"Property",name:"data",reflectMapper:gh(ck)}]},v2OnUserStatusChange:{sid:14,cid:2,service:sk,response:[{type:"Property",name:"data",reflectMapper:gh(ck)}]},v2SubscribeUserStatus:{sid:19,cid:3,service:sk,params:[{type:"Property",name:"tag",reflectMapper:uk},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeUserStatus:{sid:19,cid:4,service:sk,params:[{type:"Property",name:"tag",reflectMapper:uk},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeAllUserStatus:{sid:19,cid:5,service:sk,params:[{type:"Property",name:"tag",reflectMapper:uk}]},v2QuerySubscribeEvent:{sid:19,cid:6,service:sk,params:[{type:"Property",name:"tag",reflectMapper:uk},{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:gh(uk)}]},v2QueryAllSubscribeEvent:{sid:19,cid:7,service:sk,params:[{type:"Property",name:"tag",reflectMapper:uk}],response:[{type:"PropertyArray",name:"data",reflectMapper:gh(uk)}]},v2OnMultiUserStatusChange:{sid:14,cid:9,service:sk,response:[{type:"PropertyArray",name:"data",reflectMapper:gh(ck)}]}},lk={accountIds:{type:"array",required:!0,itemType:"string",min:1,max:100},duration:{type:"number",required:!1,min:60,max:2592e3},immediateSync:{type:"boolean",required:!1}},pk={accountIds:{type:"array",required:!1,itemType:"string",max:100}},mk={statusType:{type:"number",required:!0,min:1e4,max:2147483647},duration:{type:"number",required:!1,min:60,max:604800},extension:{type:"jsonstr",required:!1},onlineOnly:{type:"boolean",required:!1},multiSync:{type:"boolean",required:!1}},hk=function(e){function t(t){var r;return"v2"!==(r=e.call(this,"V2NIMSubscriptionService",t)||this).core.options.apiVersion?st(r):(hh({cmdMap:ak,cmdConfig:dk}),r)}er(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Rs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Rs(o=[this,t]).call(o,c))},r.subscribeUserStatus=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkLogin(),this.checkV2(),Al(lk,e,"",!0),t.next=5,this.core.sendCmd("v2SubscribeUserStatus",{tag:{eventType:1,duration:e.duration||60,immediateSync:void 0!==e.immediateSync&&e.immediateSync},accountIds:e.accountIds});case 5:return r=t.sent,t.abrupt("return",r.content.failedList);case 7:case"end":return t.stop()}}),t,this)})))},r.unsubscribeUserStatus=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkLogin(),this.checkV2(),Al(pk,e,"",!0),r=[],!(e.accountIds.length>0)){t.next=11;break}return t.next=7,this.core.sendCmd("v2UnsubscribeUserStatus",{tag:{eventType:1},accountIds:e.accountIds});case 7:n=t.sent,r=n.content.failedList,t.next=15;break;case 11:return t.next=14,this.core.sendCmd("v2UnsubscribeAllUserStatus",{tag:{eventType:1}});case 14:r=[];case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}}),t,this)})))},r.publishCustomUserStatus=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkLogin(),this.checkV2(),Al(mk,e,"",!0),t.next=5,this.core.sendCmd("v2PublishEvent",{tag:sr(sr({},e),{eventType:1,uniqueId:Tp(),duration:e.duration||60,onlineOnly:void 0===e.onlineOnly||e.onlineOnly,multiSync:void 0!==e.multiSync&&e.multiSync})});case 5:return r=t.sent,t.abrupt("return",r.content.data);case 7:case"end":return t.stop()}}),t,this)})))},r.queryUserStatusSubscriptions=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r,n,i,o,a,s;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkLogin(),this.checkV2(),Al({accountIds:{type:"array",required:!0,itemType:"string",max:3e3}},{accountIds:e},"",!0),r=[],!(e.length>0)){t.next=16;break}n=0;case 6:if(!(n<e.length)){t.next=14;break}return t.next=9,this.core.sendCmd("v2QuerySubscribeEvent",{tag:{eventType:1},accountIds:Fc(e).call(e,n,n+100)});case 9:o=t.sent,r=Rs(r).call(r,au(i=o.content.data).call(i,(function(e){return{accountId:e.accountId,subscribeTime:e.subscribeTime,duration:e.duration}})));case 11:n+=100,t.next=6;break;case 14:t.next=20;break;case 16:return t.next=18,this.core.sendCmd("v2QueryAllSubscribeEvent",{tag:{eventType:1}});case 18:s=t.sent,r=Rs(r).call(r,au(a=s.content.data).call(a,(function(e){return{accountId:e.accountId,subscribeTime:e.subscribeTime,duration:e.duration}})));case 20:return t.abrupt("return",r);case 21:case"end":return t.stop()}}),t,this)})))},r.v2OnUserStatusChangeHandler=function(e){var t=e.content.data,r=t.eventType,n=t.extensionReceived,i=Hl(t,["eventType","extensionReceived"]);1===r?this.emit("onUserStatusChanged",[sr(sr({},i),{extension:n})]):this.logger.log("v2OnUserStatusChangeHandler eventType = ",r,"msgEvent = ",t)},r.v2OnMultiUserStatusChangeHandler=function(e){var t,r=e.content.data,n=au(t=lu(r).call(r,(function(e){return 1===e.eventType}))).call(t,(function(e){e.eventType;var t=e.extensionReceived,r=Hl(e,["eventType","extensionReceived"]);return sr(sr({},r),{extension:t})}));n.length>0&&this.emit("onUserStatusChanged",n)},t}($h);!function(e){e[e.V2NIM_PROXY_REQUEST_METHOD_GET=1]="V2NIM_PROXY_REQUEST_METHOD_GET",e[e.V2NIM_PROXY_REQUEST_METHOD_POST=2]="V2NIM_PROXY_REQUEST_METHOD_POST",e[e.V2NIM_PROXY_REQUEST_METHOD_PUT=3]="V2NIM_PROXY_REQUEST_METHOD_PUT",e[e.V2NIM_PROXY_REQUEST_METHOD_DELETE=4]="V2NIM_PROXY_REQUEST_METHOD_DELETE"}(ik||(ik={}));var fk="V2NIMPassthroughService",gk={"22_1":"v2ProxyRequest","22_2":"v2ProxyOnRequest"},vk={zone:1,path:2,method:3,header:4,body:5},yk={v2ProxyRequest:{sid:22,cid:1,service:fk,params:[{type:"Property",name:"tag",reflectMapper:vk}],response:[{type:"Property",name:"data",reflectMapper:gh(vk)}]},v2ProxyOnRequest:{sid:22,cid:2,service:fk,response:[{type:"Property",name:"data",reflectMapper:gh({fromAccountId:1,body:2,time:{id:3,retType:"number"}})}]}},Ik={path:{type:"string",allowEmpty:!1},zone:{type:"string",required:!1},method:{type:"enum",values:[ik.V2NIM_PROXY_REQUEST_METHOD_DELETE,ik.V2NIM_PROXY_REQUEST_METHOD_GET,ik.V2NIM_PROXY_REQUEST_METHOD_POST,ik.V2NIM_PROXY_REQUEST_METHOD_PUT],required:!1},header:{type:"jsonstr",required:!1},body:{type:"string",required:!1}},Mk=function(e){function t(t){var r;return r=e.call(this,"V2NIMPassthroughService",t)||this,hh({cmdMap:gk,cmdConfig:yk}),r}er(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Rs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Rs(o=[this,t]).call(o,c))},r.httpProxy=function(e){return Wl(this,void 0,void 0,jl.mark((function t(){var r;return jl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Al(Ik,e,"",!0),!(e.method===ik.V2NIM_PROXY_REQUEST_METHOD_GET&&e.body||e.method===ik.V2NIM_PROXY_REQUEST_METHOD_POST&&!e.body||e.method===ik.V2NIM_PROXY_REQUEST_METHOD_PUT&&!e.body)){t.next=3;break}throw new Tl({code:yl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"method "+e.method+", incorrect body"}});case 3:return t.next=5,this.core.sendCmd("v2ProxyRequest",{tag:e});case 5:return r=t.sent,t.abrupt("return",r.content.data);case 7:case"end":return t.stop()}}),t,this)})))},r.v2ProxyOnRequestHandler=function(e){var t=e.content.data;this.emit("onProxyNotify",t)},t}($h),Tk=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(n((function(e,t){e.exports=function(e){var t=function(e,t){return e+t&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(e,r,n,i,o,a){return r=t(t(r,e),t(i,a)),t(r<<o|r>>>32-o,n)}function i(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function o(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function s(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}function c(e,r){var n=e[0],c=e[1],u=e[2],d=e[3];n=i(n,c,u,d,r[0],7,-680876936),d=i(d,n,c,u,r[1],12,-389564586),u=i(u,d,n,c,r[2],17,606105819),c=i(c,u,d,n,r[3],22,-1044525330),n=i(n,c,u,d,r[4],7,-176418897),d=i(d,n,c,u,r[5],12,1200080426),u=i(u,d,n,c,r[6],17,-1473231341),c=i(c,u,d,n,r[7],22,-45705983),n=i(n,c,u,d,r[8],7,1770035416),d=i(d,n,c,u,r[9],12,-1958414417),u=i(u,d,n,c,r[10],17,-42063),c=i(c,u,d,n,r[11],22,-1990404162),n=i(n,c,u,d,r[12],7,1804603682),d=i(d,n,c,u,r[13],12,-40341101),u=i(u,d,n,c,r[14],17,-1502002290),n=o(n,c=i(c,u,d,n,r[15],22,1236535329),u,d,r[1],5,-165796510),d=o(d,n,c,u,r[6],9,-1069501632),u=o(u,d,n,c,r[11],14,643717713),c=o(c,u,d,n,r[0],20,-373897302),n=o(n,c,u,d,r[5],5,-701558691),d=o(d,n,c,u,r[10],9,38016083),u=o(u,d,n,c,r[15],14,-660478335),c=o(c,u,d,n,r[4],20,-405537848),n=o(n,c,u,d,r[9],5,568446438),d=o(d,n,c,u,r[14],9,-1019803690),u=o(u,d,n,c,r[3],14,-187363961),c=o(c,u,d,n,r[8],20,1163531501),n=o(n,c,u,d,r[13],5,-1444681467),d=o(d,n,c,u,r[2],9,-51403784),u=o(u,d,n,c,r[7],14,1735328473),n=a(n,c=o(c,u,d,n,r[12],20,-1926607734),u,d,r[5],4,-378558),d=a(d,n,c,u,r[8],11,-2022574463),u=a(u,d,n,c,r[11],16,1839030562),c=a(c,u,d,n,r[14],23,-35309556),n=a(n,c,u,d,r[1],4,-1530992060),d=a(d,n,c,u,r[4],11,1272893353),u=a(u,d,n,c,r[7],16,-155497632),c=a(c,u,d,n,r[10],23,-1094730640),n=a(n,c,u,d,r[13],4,681279174),d=a(d,n,c,u,r[0],11,-358537222),u=a(u,d,n,c,r[3],16,-722521979),c=a(c,u,d,n,r[6],23,76029189),n=a(n,c,u,d,r[9],4,-640364487),d=a(d,n,c,u,r[12],11,-421815835),u=a(u,d,n,c,r[15],16,530742520),n=s(n,c=a(c,u,d,n,r[2],23,-995338651),u,d,r[0],6,-198630844),d=s(d,n,c,u,r[7],10,1126891415),u=s(u,d,n,c,r[14],15,-1416354905),c=s(c,u,d,n,r[5],21,-57434055),n=s(n,c,u,d,r[12],6,1700485571),d=s(d,n,c,u,r[3],10,-1894986606),u=s(u,d,n,c,r[10],15,-1051523),c=s(c,u,d,n,r[1],21,-2054922799),n=s(n,c,u,d,r[8],6,1873313359),d=s(d,n,c,u,r[15],10,-30611744),u=s(u,d,n,c,r[6],15,-1560198380),c=s(c,u,d,n,r[13],21,1309151649),n=s(n,c,u,d,r[4],6,-145523070),d=s(d,n,c,u,r[11],10,-1120210379),u=s(u,d,n,c,r[2],15,718787259),c=s(c,u,d,n,r[9],21,-343485551),e[0]=t(n,e[0]),e[1]=t(c,e[1]),e[2]=t(u,e[2]),e[3]=t(d,e[3])}function u(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function d(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function l(e){var t,r,n,i,o,a,s=e.length,d=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)c(d,u(e.substring(t-64,t)));for(r=(e=e.substring(t-64)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(c(d,n),t=0;t<16;t+=1)n[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,n[14]=o,n[15]=a,c(d,n),d}function p(e){var t,r,n,i,o,a,s=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)c(u,d(e.subarray(t-64,t)));for(r=(e=t-64<s?e.subarray(t-64):new Uint8Array(0)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)n[t>>2]|=e[t]<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(c(u,n),t=0;t<16;t+=1)n[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,n[14]=o,n[15]=a,c(u,n),u}function m(e){var t,n="";for(t=0;t<4;t+=1)n+=r[e>>8*t+4&15]+r[e>>8*t&15];return n}function h(e){var t;for(t=0;t<e.length;t+=1)e[t]=m(e[t]);return e.join("")}function f(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function g(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}function v(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function y(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function I(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function M(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==h(l("hello"))&&(t=function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,a,s,c=this.byteLength,u=t(r,c),d=c;return n!==e&&(d=t(n,c)),u>d?new ArrayBuffer(0):(i=d-u,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,u,i),a.set(s),o)}}(),M.prototype.append=function(e){return this.appendBinary(f(e)),this},M.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;t<=r;t+=64)c(this._hash,u(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},M.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=h(this._hash),e&&(r=I(r)),this.reset(),r},M.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},M.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},M.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},M.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},M.prototype._finish=function(e,t){var r,n,i,o=t;if(e[o>>2]|=128<<(o%4<<3),o>55)for(c(this._hash,e),o=0;o<16;o+=1)e[o]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),i=parseInt(r[1],16)||0,e[14]=n,e[15]=i,c(this._hash,e)},M.hash=function(e,t){return M.hashBinary(f(e),t)},M.hashBinary=function(e,t){var r=h(l(e));return t?I(r):r},M.ArrayBuffer=function(){this.reset()},M.ArrayBuffer.prototype.append=function(e){var t,r=y(this._buff.buffer,e,!0),n=r.length;for(this._length+=e.byteLength,t=64;t<=n;t+=64)c(this._hash,d(r.subarray(t-64,t)));return this._buff=t-64<n?new Uint8Array(r.buffer.slice(t-64)):new Uint8Array(0),this},M.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=h(this._hash),e&&(r=I(r)),this.reset(),r},M.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},M.ArrayBuffer.prototype.getState=function(){var e=M.prototype.getState.call(this);return e.buff=v(e.buff),e},M.ArrayBuffer.prototype.setState=function(e){return e.buff=g(e.buff,!0),M.prototype.setState.call(this,e)},M.ArrayBuffer.prototype.destroy=M.prototype.destroy,M.ArrayBuffer.prototype._finish=M.prototype._finish,M.ArrayBuffer.hash=function(e,t){var r=h(p(new Uint8Array(e)));return t?I(r):r},M}()}))),Sk=class{md5(e,t,r){this.aborted=!1,this.progress=0;let n=0;const i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,o=2097152,a=Math.ceil(e.size/o),s=new Tk.ArrayBuffer,c=new FileReader;function u(){const t=n*o,r=t+o>=e.size?e.size:t+o;c.readAsArrayBuffer(i.call(e,t,r))}u(),c.onloadend=e=>{s.append(e.target.result),n++,this.progress=n/a,r&&"function"==typeof r&&r(this.progress),this.aborted?t("aborted"):n<a?u():t(null,s.end())}}abort(){this.aborted=!0}},bk=function(){function e(e){this.name="DataStructureConverter",this.core=e}var t=e.prototype;return t.messageConvertToV1=function(e){var t,r=mh(ph(e,qg),cf(rS)),n=BT(r,this.core.account),i=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:n});return GT(r,i?{account:this.core.account,sessionAck:i.ack,msgReceiptTime:i.msgReceiptTime}:{account:this.core.account})},t.messageConvertToV2=function(e){var t=mh(ph(YT(e,e.from,e.fromDeviceId),rS),Bg);return(t=Rg(this.core,t)).sendingState="sending"===e.status?3:"sendFailed"===e.status?2:1,t},e}(),Ck=function(){function e(e){this.name="V2NIMMessageConverter",this.core=e}var t=e.prototype;return t.messageSerialization=function(e){if(!e)return null;var t=ph(e,qg);return Ti(t)},t.messageDeserialization=function(e){var t,r,n,i,o,a,s,c,u,d,l,p,m,h,f,g,v,y,I,M,T,S,b;if(!e)return null;try{var C,E,_,k,R=mh(JSON.parse(e),Bg);return R.sendingState=0,1!==R.conversationType||R.senderId!==this.core.account&&R.receiverId!==this.core.account?2===R.conversationType?R.conversationId=this.core.V2NIMConversationIdUtil.teamConversationId(R.receiverId):3===R.conversationType&&(R.conversationId=this.core.V2NIMConversationIdUtil.superTeamConversationId(R.receiverId)):R.conversationId=this.core.V2NIMConversationIdUtil.p2pConversationId(R.senderId===this.core.account?R.receiverId:R.senderId),R.threadReply&&(R.threadReply.conversationType=R.conversationType,R.threadReply=wg(this.core,R.threadReply)),R.threadRoot&&(R.threadRoot.conversationType=R.conversationType,R.threadRoot=wg(this.core,R.threadRoot)),tu(C=[1,3,2,0]).call(C,R.conversationType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+R.conversationType),R.senderId&&"string"!=typeof R.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+R.senderId),R.receiverId&&"string"!=typeof R.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+R.receiverId),"createTime"in R&&isNaN(R.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+R.createTime),tu(E=[2,7,12,100,6,1,-1,4,5,11,0,10,3]).call(E,R.messageType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageType(enum): "+R.messageType),"subType"in R&&isNaN(R.subType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid subType(number): "+R.subType),R.messageClientId&&"string"!=typeof R.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+R.messageClientId),R.messageServerId&&"string"!=typeof R.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+R.messageServerId),R.attachment&&"object"!=typeof R.attachment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid attachment(object): "+R.attachment),R.text&&"string"!=typeof R.text&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid text(string): "+R.text),R.serverExtension&&"string"!=typeof R.serverExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid serverExtension(string): "+R.serverExtension),R.callbackExtension&&"string"!=typeof R.callbackExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid callbackExtension(string): "+R.callbackExtension),(null===(t=R.pushConfig)||void 0===t?void 0:t.pushContent)&&"string"!=typeof R.pushConfig.pushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushContent(string): "+R.pushConfig.pushContent),(null===(r=R.pushConfig)||void 0===r?void 0:r.pushPayload)&&"string"!=typeof R.pushConfig.pushPayload&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushPayload(string): "+R.pushConfig.pushPayload),(null===(n=R.pushConfig)||void 0===n?void 0:n.forcePushContent)&&"string"!=typeof R.pushConfig.forcePushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushContent(string): "+R.pushConfig.forcePushContent),(null===(i=R.pushConfig)||void 0===i?void 0:i.forcePushAccountIds)&&!Si(R.pushConfig.forcePushAccountIds)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushAccountIds(array): "+R.pushConfig.forcePushAccountIds),(null===(o=R.routeConfig)||void 0===o?void 0:o.routeEnvironment)&&"string"!=typeof R.routeConfig.routeEnvironment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid routeEnvironment(string): "+R.routeConfig.routeEnvironment),(null===(a=R.antispamConfig)||void 0===a?void 0:a.antispamBusinessId)&&"string"!=typeof R.antispamConfig.antispamBusinessId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamBusinessId(string): "+R.antispamConfig.antispamBusinessId),(null===(s=R.antispamConfig)||void 0===s?void 0:s.antispamCustomMessage)&&"string"!=typeof R.antispamConfig.antispamCustomMessage&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCustomMessage(string): "+R.antispamConfig.antispamCustomMessage),(null===(c=R.antispamConfig)||void 0===c?void 0:c.antispamCheating)&&"string"!=typeof R.antispamConfig.antispamCheating&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCheating(string): "+R.antispamConfig.antispamCheating),(null===(u=R.antispamConfig)||void 0===u?void 0:u.antispamExtension)&&"string"!=typeof R.antispamConfig.antispamExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamExtension(string): "+R.antispamConfig.antispamExtension),(null===(d=R.robotConfig)||void 0===d?void 0:d.accountId)&&"string"!=typeof R.robotConfig.accountId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid accountId(string): "+R.robotConfig.accountId),(null===(l=R.robotConfig)||void 0===l?void 0:l.topic)&&"string"!=typeof R.robotConfig.topic&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid topic(string): "+R.robotConfig.topic),(null===(p=R.robotConfig)||void 0===p?void 0:p.function)&&"string"!=typeof R.robotConfig.function&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid function(string): "+R.robotConfig.function),(null===(m=R.robotConfig)||void 0===m?void 0:m.customContent)&&"string"!=typeof R.robotConfig.customContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid customContent(string): "+R.robotConfig.customContent),(null===(h=R.threadRoot)||void 0===h?void 0:h.senderId)&&"string"!=typeof R.threadRoot.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+R.threadRoot.senderId),(null===(f=R.threadRoot)||void 0===f?void 0:f.receiverId)&&"string"!=typeof R.threadRoot.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+R.threadRoot.receiverId),(null===(g=R.threadRoot)||void 0===g?void 0:g.messageClientId)&&"string"!=typeof R.threadRoot.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+R.threadRoot.messageClientId),(null===(v=R.threadRoot)||void 0===v?void 0:v.messageServerId)&&"string"!=typeof R.threadRoot.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+R.threadRoot.messageServerId),R.threadRoot&&"createTime"in R.threadRoot&&isNaN(R.threadRoot.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+R.threadRoot.createTime),R.threadRoot&&!tu(_=[1,3,2,0]).call(_,R.threadRoot.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+R.threadRoot.conversationType),(null===(y=R.threadRoot)||void 0===y?void 0:y.conversationId)&&"string"!=typeof R.threadRoot.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+R.threadRoot.conversationId),(null===(I=R.threadReply)||void 0===I?void 0:I.senderId)&&"string"!=typeof R.threadReply.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+R.threadReply.senderId),(null===(M=R.threadReply)||void 0===M?void 0:M.receiverId)&&"string"!=typeof R.threadReply.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+R.threadReply.receiverId),(null===(T=R.threadReply)||void 0===T?void 0:T.messageClientId)&&"string"!=typeof R.threadReply.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+R.threadReply.messageClientId),(null===(S=R.threadReply)||void 0===S?void 0:S.messageServerId)&&"string"!=typeof R.threadReply.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+R.threadReply.messageServerId),R.threadReply&&"createTime"in R.threadReply&&isNaN(R.threadReply.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+R.threadReply.createTime),R.threadReply&&!tu(k=[1,3,2,0]).call(k,R.threadReply.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+R.threadReply.conversationType),(null===(b=R.threadReply)||void 0===b?void 0:b.conversationId)&&"string"!=typeof R.threadReply.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+R.threadReply.conversationId),delete R.__clientExt,delete R.userUpdateTime,R}catch(w){return this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid message string: "+e),null}},e}();!function(e){Kl(Ql,e())}((function(){return{setLogger:qm,platform:"BROWSER",localStorage:window.localStorage,request:lm,WebSocket:window.WebSocket,uploadFile:jm,getFileUploadInformation:Hm,getSystemInfo:Ym,net:zm,logStorage:ih}})),dm.registerService(af,"V1NIMLoginService"),dm.registerService(lS,"msg"),dm.registerService(vS,"user"),dm.registerService(wS,"session"),dm.registerService(NS,"team"),dm.registerService(US,"systemMessage"),dm.registerService(HS,"friend"),dm.registerService($S,"event"),dm.registerService(ib,"msgExtend"),dm.registerService(hb,"msgLog"),dm.registerService(Ib,"passThrough"),dm.registerService(zy,"cloudStorage"),dm.registerService(Yb,"superTeam"),dm.registerService(hS,"sync"),dm.registerService(zb,"plugin"),dm.registerService(nC,"cloudSession"),dm.registerService(TC,"signaling"),dm.registerService(ng,"V2NIMLoginService"),dm.registerService(yv,"V2NIMConversationService"),dm.registerService(sI,"V2NIMMessageService"),dm.registerService(x_,"V2NIMNotificationService"),dm.registerService(Jy,"V2NIMStorageService"),dm.registerService(Ey,"V2NIMStorageUtil"),dm.registerService(bv,"V2NIMConversationGroupService"),dm.registerService($I,"V2NIMTeamService"),dm.registerService(hM,"V2NIMUserService"),dm.registerService(RM,"V2NIMFriendService"),dm.registerService(eT,"V2NIMSettingService"),dm.registerService(P_,"V2NIMSyncService"),dm.registerService(B_,"V2NIMAIService"),dm.registerService(bk,"DataStructureConverter"),dm.registerService(Ck,"V2NIMMessageConverter"),dm.registerService(mI,"V2NIMMessageLogUtil"),dm.registerService(CI,"V2NIMMessageExtendUtil"),dm.registerService(ok,"V2NIMSignallingService"),dm.registerService(hk,"V2NIMSubscriptionService"),dm.registerService(Mk,"V2NIMPassthroughService"),dm.registerService(iI,"YSFService"),dm.registerService(PE,"qchatChannel"),dm.registerService(jE,"qchatMedia"),dm.registerService(E_,"qchatMsg"),dm.registerService(k_,"qchatRole"),dm.registerService(A_,"qchatServer"),dm.registerPlugin(Sk,"browser-md5-file"),dm.registerPrivateService((function(e){var t=this;this.bindEvents=function(){t.core.eventBus.on("forwardSend/msg/sendMsg",t.onV1SendMsg),t.core.eventBus.on("forwardSend/msg/recallMsg",t.onV1RecallMsg),t.core.eventBus.on("forwardSend/msg/deleteSelfMsgs",t.onV1DeleteSelfMsgs),t.core.eventBus.on("forwardSend/msgLog/clearHistoryMsgsFromServer",t.onV1ClearHistoryMessage),t.core.eventBus.on("forwardSend/V2NIMMessageService/sendMsg",t.onV2SendMsg),t.core.eventBus.on("forwardSend/V2NIMMessageService/modifyMsg",t.onV2ModifyMsg),t.core.eventBus.on("forwardSend/V2NIMMessageService/revokeMessage",t.onV2RevokeMessage),t.core.eventBus.on("forwardSend/V2NIMMessageService/deleteSelfMsgs",t.onV2DeleteSelfMsgs),t.core.eventBus.on("forwardSend/V2NIMMessageLogService/clearHistoryMessage",t.onV2ClearHistoryMessage),t.core.eventBus.on("forwardSend/team/created",t.onV1TeamCreated),t.core.eventBus.on("forwardSend/team/updateMyMemberInfo",t.onV1TeamMemberUpdate),t.core.eventBus.on("forwardSend/superTeam/updateMyMemberInfo",t.onV1SuperTeamMemberUpdate),t.core.eventBus.on("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",t.onV2TeamMemberUpdate),t.core.eventBus.on("forwardSend/team/passTeamApply",(function(e,r){return t.onV1TeamApply(e,1,1,r)})),t.core.eventBus.on("forwardSend/superTeam/passSuperTeamApply",(function(e,r){t.onV1TeamApply(e,2,1,r)})),t.core.eventBus.on("forwardSend/team/rejectTeamApply",(function(e,r){t.onV1TeamApply(e,1,2,r)})),t.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamApply",(function(e,r){t.onV1TeamApply(e,2,2,r)})),t.core.eventBus.on("forwardSend/team/acceptTeamInvite",(function(e,r){t.onV1TeamInvite(e,1,1,r)})),t.core.eventBus.on("forwardSend/superTeam/acceptSuperTeamInvite",(function(e,r){t.onV1TeamInvite(e,2,1,r)})),t.core.eventBus.on("forwardSend/team/rejectTeamInvite",(function(e,r){t.onV1TeamInvite(e,1,2,r)})),t.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamInvite",(function(e,r){t.onV1TeamInvite(e,2,2,r)})),t.core.eventBus.on("forwardSend/user/updateBlackList",t.onV1UpdateBlackList),t.core.eventBus.on("forwardSend/user/updateUserInfo",t.onV1UpdateUserInfo),t.core.eventBus.on("forwardSend/user/setMute",t.onV1SetMute),t.core.eventBus.on("forwardSend/friend/addFriend",t.onV1AddFriend),t.core.eventBus.on("forwardSend/friend/deleteFriend",t.onV1DeleteFriend),t.core.eventBus.on("forwardSend/friend/updateFriend",t.onV1UpdateFriend),t.core.eventBus.on("forwardSend/friend/passFriendApply",t.onV1PassFriendApply),t.core.eventBus.on("forwardSend/friend/rejectFriendApply",t.onV1RejectFriendApply)},this.onV1TeamApply=function(e,r,n,i){if(i){if(!t.core.V2NIMTeamService.notification.checkIfExpired(i))return;n=3}t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:e.teamId,teamType:r,operatorAccountId:e.from,actionType:0},n)},this.onV1TeamInvite=function(e,r,n,i){if(i){if(!t.core.V2NIMTeamService.notification.checkIfExpired(i.code))return;n=3}t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:e.teamId,teamType:r,operatorAccountId:e.from,actionType:2},n)},this.onV1PassFriendApply=function(e,r){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/acceptAddApplication",e,r)},this.onV1RejectFriendApply=function(e,r,n){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/rejectAddApplication",{applicantAccountId:e,recipientAccountId:t.core.account,operatorAccountId:t.core.account,postscript:r||"",timestamp:t.core.timeOrigin.getNTPTime(),read:!0,status:3},n)},this.onV1SetMute=function(e,r){t.core.eventBus.emit("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",e,r?1:0)},this.onV1UpdateFriend=function(e){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/setFriendInfo",e.account,sr(sr({},"alias"in e?{alias:e.alias}:{}),"ext"in e?{serverExtension:e.ext}:{}))},this.onV1AddFriend=function(e){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/addFriend",e)},this.onV1DeleteFriend=function(e){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/deleteFriend",e)},this.onV1UpdateUserInfo=function(e){var r=mh(ph(e,xT.user),gh(eM));t.core.eventBus.emit("forwardReceive/V2NIMUserService/updateUserProfile",r)},this.onV1UpdateBlackList=function(e,r){t.core.eventBus.emit("forwardReceive/V2NIMUserService/updateBlockList",e,r)},this.onV1TeamCreated=function(e){var r=mh(ph(IT(e),kT.team),gh(Ig));t.core.eventBus.emit("forwardReceive/V2NIMTeamService/created",r)},this.onV1TeamMemberUpdate=function(e){(e=sr({},e)).type&&(e.type={normal:0,owner:1,manager:2}[e.type]);var r=mh(ph(e,kT.teamMember),gh(Mg));r.teamType=1,t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",r)},this.onV1SuperTeamMemberUpdate=function(e){(e=sr({},e)).type&&(e.type={normal:0,owner:1,manager:2}[e.type]);var r=mh(ph(e,jb.superTeamMember),gh(Tg));r.teamType=2,t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",r)},this.onV2TeamMemberUpdate=function(e){var r=e.teamType,n=ph(e,Mg);if(2===r){var i=mh(n,gh(jb.superTeamMember));t.core.eventBus.emit("forwardReceive/superTeam/updateMyMemberInfo",i)}else{var o=mh(n,gh(kT.teamMember));t.core.eventBus.emit("forwardReceive/team/updateMyMemberInfo",o)}},this.onV1SendMsg=function(e){var r=mh(ph(e,rS),Bg);(r=Rg(t.core,r)).sendingState="sending"===e.status?3:"sent"===e.status?1:2,t.core.eventBus.emit("forwardReceive/V2NIMMessageService/sendMsg",r)},this.onV2SendMsg=function(e){var r=mh(ph(e,qg),cf(rS));r.status=3===e.sendingState?"sending":1===e.sendingState?"sent":"sendFailed",t.core.eventBus.emit("forwardReceive/msg/sendMsg",r)},this.onV2ModifyMsg=function(e){var r=mh(ph(e,qg),cf(rS));t.core.eventBus.emit("forwardReceive/msg/modifyMsg",r)},this.onV1RecallMsg=function(e){e.deleteMsgCreatetime=e.time;var r=mh(ph(e,nS.recallMsgTag),gh(jg));t.core.eventBus.emit("forwardReceive/V2NIMMessageService/revokeMessages",[r])},this.onV2RevokeMessage=function(e){var r=mh(ph(e,jg),iS.recallMsgTag);t.core.eventBus.emit("forwardReceive/msg/recallMsg",r)},this.onV1DeleteSelfMsgs=function(e){var r=au(e).call(e,(function(e){return mh(ph(e,nS.deleteSelfMsgTag),gh(Fg))}));Bn(r).call(r,(function(e){e.messageRefer=Ag(t.core,e.messageRefer)})),t.core.eventBus.emit("forwardReceive/V2NIMMessageService/deleteMessages",r)},this.onV2DeleteSelfMsgs=function(e){var r=au(e).call(e,(function(e){return mh(ph(e,Fg),iS.deleteSelfMsgTag)}));t.core.eventBus.emit("forwardReceive/msg/deleteSelfMsgs",r)},this.onV1ClearHistoryMessage=function(e){var r=mh(ph(e,sb.clearHistoryMsgsFromServerReqTag),gh(dI));t.core.eventBus.emit("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",r)},this.onV2ClearHistoryMessage=function(e){var r=mh(ph(e,dI),cb.clearHistoryMsgsFromServerReqTag);t.core.eventBus.emit("forwardReceive/msgLog/clearHistoryMsgsFromServer",r)},this.core=e,this.bindEvents()}),"eventForwardCenter"),e.V2NIMConst=Ml,e.default=dm,Object.defineProperty(e,"__esModule",{value:!0})}(wi.exports);var Ai=Ri(wi.exports);
/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const xi="undefined"!=typeof document;function Ni(e){return"object"==typeof e||"displayName"in e||"props"in e||"__vccOpts"in e}const Oi=Object.assign;function Pi(e,t){const r={};for(const n in t){const i=t[n];r[n]=Vi(i)?i.map(e):e(i)}return r}const Li=()=>{},Vi=Array.isArray,Ui=/#/g,Di=/&/g,qi=/\//g,Bi=/=/g,Fi=/\?/g,Gi=/\+/g,ji=/%5B/g,Hi=/%5D/g,Wi=/%5E/g,Yi=/%60/g,Ki=/%7B/g,Qi=/%7C/g,zi=/%7D/g,Ji=/%20/g;function $i(e){return encodeURI(""+e).replace(Qi,"|").replace(ji,"[").replace(Hi,"]")}function Xi(e){return $i(e).replace(Gi,"%2B").replace(Ji,"+").replace(Ui,"%23").replace(Di,"%26").replace(Yi,"`").replace(Ki,"{").replace(zi,"}").replace(Wi,"^")}function Zi(e){return null==e?"":function(e){return $i(e).replace(Ui,"%23").replace(Fi,"%3F")}(e).replace(qi,"%2F")}function eo(e){try{return decodeURIComponent(""+e)}catch(t){}return""+e}const to=/\/$/;function ro(e,t,r="/"){let n,i={},o="",a="";const s=t.indexOf("#");let c=t.indexOf("?");return s<c&&s>=0&&(c=-1),c>-1&&(n=t.slice(0,c),o=t.slice(c+1,s>-1?s:t.length),i=e(o)),s>-1&&(n=n||t.slice(0,s),a=t.slice(s,t.length)),n=function(e,t){if(e.startsWith("/"))return e;if(!e)return t;const r=t.split("/"),n=e.split("/"),i=n[n.length-1];".."!==i&&"."!==i||n.push("");let o,a,s=r.length-1;for(o=0;o<n.length;o++)if(a=n[o],"."!==a){if(".."!==a)break;s>1&&s--}return r.slice(0,s).join("/")+"/"+n.slice(o).join("/")}(null!=n?n:t,r),{fullPath:n+(o&&"?")+o+a,path:n,query:i,hash:eo(a)}}function no(e,t){return t&&e.toLowerCase().startsWith(t.toLowerCase())?e.slice(t.length)||"/":e}function io(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function oo(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!ao(e[r],t[r]))return!1;return!0}function ao(e,t){return Vi(e)?so(e,t):Vi(t)?so(t,e):e===t}function so(e,t){return Vi(t)?e.length===t.length&&e.every(((e,r)=>e===t[r])):1===e.length&&e[0]===t}const co={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var uo,lo,po,mo;function ho(e){if(!e)if(xi){const t=document.querySelector("base");e=(e=t&&t.getAttribute("href")||"/").replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),e.replace(to,"")}(lo=uo||(uo={})).pop="pop",lo.push="push",(mo=po||(po={})).back="back",mo.forward="forward",mo.unknown="";const fo=/^[^#]+#/;function go(e,t){return e.replace(fo,"#")+t}const vo=()=>({left:window.scrollX,top:window.scrollY});function yo(e){let t;if("el"in e){const r=e.el,n="string"==typeof r&&r.startsWith("#"),i="string"==typeof r?n?document.getElementById(r.slice(1)):document.querySelector(r):r;if(!i)return;t=function(e,t){const r=document.documentElement.getBoundingClientRect(),n=e.getBoundingClientRect();return{behavior:t.behavior,left:n.left-r.left-(t.left||0),top:n.top-r.top-(t.top||0)}}(i,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(null!=t.left?t.left:window.scrollX,null!=t.top?t.top:window.scrollY)}function Io(e,t){return(history.state?history.state.position-t:-1)+e}const Mo=new Map;function To(e,t){const{pathname:r,search:n,hash:i}=t,o=e.indexOf("#");if(o>-1){let t=i.includes(e.slice(o))?e.slice(o).length:1,r=i.slice(t);return"/"!==r[0]&&(r="/"+r),no(r,"")}return no(r,e)+n+i}function So(e,t,r,n=!1,i=!1){return{back:e,current:t,forward:r,replaced:n,position:window.history.length,scroll:i?vo():null}}function bo(e){const{history:t,location:r}=window,n={value:To(e,r)},i={value:t.state};function o(n,o,a){const s=e.indexOf("#"),c=s>-1?(r.host&&document.querySelector("base")?e:e.slice(s))+n:location.protocol+"//"+location.host+e+n;try{t[a?"replaceState":"pushState"](o,"",c),i.value=o}catch(u){console.error(u),r[a?"replace":"assign"](c)}}return i.value||o(n.value,{back:null,current:n.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0),{location:n,state:i,push:function(e,r){const a=Oi({},i.value,t.state,{forward:e,scroll:vo()});o(a.current,a,!0),o(e,Oi({},So(n.value,e,null),{position:a.position+1},r),!1),n.value=e},replace:function(e,r){o(e,Oi({},t.state,So(i.value.back,e,i.value.forward,!0),r,{position:i.value.position}),!0),n.value=e}}}function Co(e){const t=bo(e=ho(e)),r=function(e,t,r,n){let i=[],o=[],a=null;const s=({state:o})=>{const s=To(e,location),c=r.value,u=t.value;let d=0;if(o){if(r.value=s,t.value=o,a&&a===c)return void(a=null);d=u?o.position-u.position:0}else n(s);i.forEach((e=>{e(r.value,c,{delta:d,type:uo.pop,direction:d?d>0?po.forward:po.back:po.unknown})}))};function c(){const{history:e}=window;e.state&&e.replaceState(Oi({},e.state,{scroll:vo()}),"")}return window.addEventListener("popstate",s),window.addEventListener("beforeunload",c,{passive:!0}),{pauseListeners:function(){a=r.value},listen:function(e){i.push(e);const t=()=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)};return o.push(t),t},destroy:function(){for(const e of o)e();o=[],window.removeEventListener("popstate",s),window.removeEventListener("beforeunload",c)}}}(e,t.state,t.location,t.replace);const n=Oi({location:"",base:e,go:function(e,t=!0){t||r.pauseListeners(),history.go(e)},createHref:go.bind(null,e)},t,r);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>t.state.value}),n}function Eo(e){return"string"==typeof e||"symbol"==typeof e}const _o=Symbol("");var ko,Ro;function wo(e,t){return Oi(new Error,{type:e,[_o]:!0},t)}function Ao(e,t){return e instanceof Error&&_o in e&&(null==t||!!(e.type&t))}(Ro=ko||(ko={}))[Ro.aborted=4]="aborted",Ro[Ro.cancelled=8]="cancelled",Ro[Ro.duplicated=16]="duplicated";const xo={sensitive:!1,strict:!1,start:!0,end:!0},No=/[.+*?^${}()[\]/\\]/g;function Oo(e,t){let r=0;for(;r<e.length&&r<t.length;){const n=t[r]-e[r];if(n)return n;r++}return e.length<t.length?1===e.length&&80===e[0]?-1:1:e.length>t.length?1===t.length&&80===t[0]?1:-1:0}function Po(e,t){let r=0;const n=e.score,i=t.score;for(;r<n.length&&r<i.length;){const e=Oo(n[r],i[r]);if(e)return e;r++}if(1===Math.abs(i.length-n.length)){if(Lo(n))return 1;if(Lo(i))return-1}return i.length-n.length}function Lo(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const Vo={type:0,value:""},Uo=/[a-zA-Z0-9_]/;function Do(e,t,r){const n=function(e,t){const r=Oi({},xo,t),n=[];let i=r.start?"^":"";const o=[];for(const c of e){const e=c.length?[]:[90];r.strict&&!c.length&&(i+="/");for(let t=0;t<c.length;t++){const n=c[t];let a=40+(r.sensitive?.25:0);if(0===n.type)t||(i+="/"),i+=n.value.replace(No,"\\$&"),a+=40;else if(1===n.type){const{value:e,repeatable:r,optional:u,regexp:d}=n;o.push({name:e,repeatable:r,optional:u});const l=d||"[^/]+?";if("[^/]+?"!==l){a+=10;try{new RegExp(`(${l})`)}catch(s){throw new Error(`Invalid custom RegExp for param "${e}" (${l}): `+s.message)}}let p=r?`((?:${l})(?:/(?:${l}))*)`:`(${l})`;t||(p=u&&c.length<2?`(?:/${p})`:"/"+p),u&&(p+="?"),i+=p,a+=20,u&&(a+=-8),r&&(a+=-20),".*"===l&&(a+=-50)}e.push(a)}n.push(e)}if(r.strict&&r.end){const e=n.length-1;n[e][n[e].length-1]+=.7000000000000001}r.strict||(i+="/?"),r.end?i+="$":r.strict&&!i.endsWith("/")&&(i+="(?:/|$)");const a=new RegExp(i,r.sensitive?"":"i");return{re:a,score:n,keys:o,parse:function(e){const t=e.match(a),r={};if(!t)return null;for(let n=1;n<t.length;n++){const e=t[n]||"",i=o[n-1];r[i.name]=e&&i.repeatable?e.split("/"):e}return r},stringify:function(t){let r="",n=!1;for(const i of e){n&&r.endsWith("/")||(r+="/"),n=!1;for(const e of i)if(0===e.type)r+=e.value;else if(1===e.type){const{value:o,repeatable:a,optional:s}=e,c=o in t?t[o]:"";if(Vi(c)&&!a)throw new Error(`Provided param "${o}" is an array but it is not repeatable (* or + modifiers)`);const u=Vi(c)?c.join("/"):c;if(!u){if(!s)throw new Error(`Missing required param "${o}"`);i.length<2&&(r.endsWith("/")?r=r.slice(0,-1):n=!0)}r+=u}}return r||"/"}}}(function(e){if(!e)return[[]];if("/"===e)return[[Vo]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(e){throw new Error(`ERR (${r})/"${u}": ${e}`)}let r=0,n=r;const i=[];let o;function a(){o&&i.push(o),o=[]}let s,c=0,u="",d="";function l(){u&&(0===r?o.push({type:0,value:u}):1===r||2===r||3===r?(o.length>1&&("*"===s||"+"===s)&&t(`A repeatable param (${u}) must be alone in its segment. eg: '/:ids+.`),o.push({type:1,value:u,regexp:d,repeatable:"*"===s||"+"===s,optional:"*"===s||"?"===s})):t("Invalid state to consume buffer"),u="")}function p(){u+=s}for(;c<e.length;)if(s=e[c++],"\\"!==s||2===r)switch(r){case 0:"/"===s?(u&&l(),a()):":"===s?(l(),r=1):p();break;case 4:p(),r=n;break;case 1:"("===s?r=2:Uo.test(s)?p():(l(),r=0,"*"!==s&&"?"!==s&&"+"!==s&&c--);break;case 2:")"===s?"\\"==d[d.length-1]?d=d.slice(0,-1)+s:r=3:d+=s;break;case 3:l(),r=0,"*"!==s&&"?"!==s&&"+"!==s&&c--,d="";break;default:t("Unknown state")}else n=r,r=4;return 2===r&&t(`Unfinished custom RegExp for param "${u}"`),l(),a(),i}(e.path),r),i=Oi(n,{record:e,parent:t,children:[],alias:[]});return t&&!i.record.aliasOf==!t.record.aliasOf&&t.children.push(i),i}function qo(e,t){const r=[],n=new Map;function i(e,r,n){const s=!n,c=Fo(e);c.aliasOf=n&&n.record;const u=Wo(t,e),d=[c];if("alias"in e){const t="string"==typeof e.alias?[e.alias]:e.alias;for(const e of t)d.push(Fo(Oi({},c,{components:n?n.record.components:c.components,path:e,aliasOf:n?n.record:c})))}let l,p;for(const t of d){const{path:d}=t;if(r&&"/"!==d[0]){const e=r.record.path,n="/"===e[e.length-1]?"":"/";t.path=r.record.path+(d&&n+d)}if(l=Do(t,r,u),n?n.alias.push(l):(p=p||l,p!==l&&p.alias.push(l),s&&e.name&&!jo(l)&&o(e.name)),Yo(l)&&a(l),c.children){const e=c.children;for(let t=0;t<e.length;t++)i(e[t],l,n&&n.children[t])}n=n||l}return p?()=>{o(p)}:Li}function o(e){if(Eo(e)){const t=n.get(e);t&&(n.delete(e),r.splice(r.indexOf(t),1),t.children.forEach(o),t.alias.forEach(o))}else{const t=r.indexOf(e);t>-1&&(r.splice(t,1),e.record.name&&n.delete(e.record.name),e.children.forEach(o),e.alias.forEach(o))}}function a(e){const t=function(e,t){let r=0,n=t.length;for(;r!==n;){const i=r+n>>1;Po(e,t[i])<0?n=i:r=i+1}const i=function(e){let t=e;for(;t=t.parent;)if(Yo(t)&&0===Po(e,t))return t;return}(e);i&&(n=t.lastIndexOf(i,n-1));return n}(e,r);r.splice(t,0,e),e.record.name&&!jo(e)&&n.set(e.record.name,e)}return t=Wo({strict:!1,end:!0,sensitive:!1},t),e.forEach((e=>i(e))),{addRoute:i,resolve:function(e,t){let i,o,a,s={};if("name"in e&&e.name){if(i=n.get(e.name),!i)throw wo(1,{location:e});a=i.record.name,s=Oi(Bo(t.params,i.keys.filter((e=>!e.optional)).concat(i.parent?i.parent.keys.filter((e=>e.optional)):[]).map((e=>e.name))),e.params&&Bo(e.params,i.keys.map((e=>e.name)))),o=i.stringify(s)}else if(null!=e.path)o=e.path,i=r.find((e=>e.re.test(o))),i&&(s=i.parse(o),a=i.record.name);else{if(i=t.name?n.get(t.name):r.find((e=>e.re.test(t.path))),!i)throw wo(1,{location:e,currentLocation:t});a=i.record.name,s=Oi({},t.params,e.params),o=i.stringify(s)}const c=[];let u=i;for(;u;)c.unshift(u.record),u=u.parent;return{name:a,path:o,params:s,matched:c,meta:Ho(c)}},removeRoute:o,clearRoutes:function(){r.length=0,n.clear()},getRoutes:function(){return r},getRecordMatcher:function(e){return n.get(e)}}}function Bo(e,t){const r={};for(const n of t)n in e&&(r[n]=e[n]);return r}function Fo(e){const t={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:Go(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function Go(e){const t={},r=e.props||!1;if("component"in e)t.default=r;else for(const n in e.components)t[n]="object"==typeof r?r[n]:r;return t}function jo(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function Ho(e){return e.reduce(((e,t)=>Oi(e,t.meta)),{})}function Wo(e,t){const r={};for(const n in e)r[n]=n in t?t[n]:e[n];return r}function Yo({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function Ko(e){const t={};if(""===e||"?"===e)return t;const r=("?"===e[0]?e.slice(1):e).split("&");for(let n=0;n<r.length;++n){const e=r[n].replace(Gi," "),i=e.indexOf("="),o=eo(i<0?e:e.slice(0,i)),a=i<0?null:eo(e.slice(i+1));if(o in t){let e=t[o];Vi(e)||(e=t[o]=[e]),e.push(a)}else t[o]=a}return t}function Qo(e){let t="";for(let r in e){const n=e[r];if(r=Xi(r).replace(Bi,"%3D"),null==n){void 0!==n&&(t+=(t.length?"&":"")+r);continue}(Vi(n)?n.map((e=>e&&Xi(e))):[n&&Xi(n)]).forEach((e=>{void 0!==e&&(t+=(t.length?"&":"")+r,null!=e&&(t+="="+e))}))}return t}function zo(e){const t={};for(const r in e){const n=e[r];void 0!==n&&(t[r]=Vi(n)?n.map((e=>null==e?null:""+e)):null==n?n:""+n)}return t}const Jo=Symbol(""),$o=Symbol(""),Xo=Symbol(""),Zo=Symbol(""),ea=Symbol("");function ta(){let e=[];return{add:function(t){return e.push(t),()=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)}},list:()=>e.slice(),reset:function(){e=[]}}}function ra(e,t,r,n,i,o=(e=>e())){const a=n&&(n.enterCallbacks[i]=n.enterCallbacks[i]||[]);return()=>new Promise(((s,c)=>{const u=e=>{var o;!1===e?c(wo(4,{from:r,to:t})):e instanceof Error?c(e):"string"==typeof(o=e)||o&&"object"==typeof o?c(wo(2,{from:t,to:e})):(a&&n.enterCallbacks[i]===a&&"function"==typeof e&&a.push(e),s())},d=o((()=>e.call(n&&n.instances[i],t,r,u)));let l=Promise.resolve(d);e.length<3&&(l=l.then(u)),l.catch((e=>c(e)))}))}function na(e,t,r,n,i=(e=>e())){const o=[];for(const a of e)for(const e in a.components){let s=a.components[e];if("beforeRouteEnter"===t||a.instances[e])if(Ni(s)){const c=(s.__vccOpts||s)[t];c&&o.push(ra(c,r,n,a,e,i))}else{let c=s();o.push((()=>c.then((o=>{if(!o)throw new Error(`Couldn't resolve component "${e}" at "${a.path}"`);const s=(c=o).__esModule||"Module"===c[Symbol.toStringTag]||c.default&&Ni(c.default)?o.default:o;var c;a.mods[e]=o,a.components[e]=s;const u=(s.__vccOpts||s)[t];return u&&ra(u,r,n,a,e,i)()}))))}}return o}function ia(e){const t=Vt(Xo),r=Vt(Zo),n=St((()=>{const r=yt(e.to);return t.resolve(r)})),i=St((()=>{const{matched:e}=n.value,{length:t}=e,i=e[t-1],o=r.matched;if(!i||!o.length)return-1;const a=o.findIndex(io.bind(null,i));if(a>-1)return a;const s=aa(e[t-2]);return t>1&&aa(i)===s&&o[o.length-1].path!==s?o.findIndex(io.bind(null,e[t-2])):a})),o=St((()=>i.value>-1&&function(e,t){for(const r in t){const n=t[r],i=e[r];if("string"==typeof n){if(n!==i)return!1}else if(!Vi(i)||i.length!==n.length||n.some(((e,t)=>e!==i[t])))return!1}return!0}(r.params,n.value.params))),a=St((()=>i.value>-1&&i.value===r.matched.length-1&&oo(r.params,n.value.params)));return{route:n,href:St((()=>n.value.href)),isActive:o,isExactActive:a,navigate:function(r={}){if(function(e){if(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)return;if(e.defaultPrevented)return;if(void 0!==e.button&&0!==e.button)return;if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}e.preventDefault&&e.preventDefault();return!0}(r)){const r=t[yt(e.replace)?"replace":"push"](yt(e.to)).catch(Li);return e.viewTransition&&"undefined"!=typeof document&&"startViewTransition"in document&&document.startViewTransition((()=>r)),r}return Promise.resolve()}}}const oa=Ut({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:ia,setup(e,{slots:t}){const r=rt(ia(e)),{options:n}=Vt(Xo),i=St((()=>({[sa(e.activeClass,n.linkActiveClass,"router-link-active")]:r.isActive,[sa(e.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive})));return()=>{const n=t.default&&(1===(o=t.default(r)).length?o[0]:o);var o;return e.custom?n:ti("a",{"aria-current":r.isExactActive?e.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:i.value},n)}}});function aa(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const sa=(e,t,r)=>null!=e?e:null!=t?t:r;function ca(e,t){if(!e)return null;const r=e(t);return 1===r.length?r[0]:r}const ua=Ut({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:r}){const n=Vt(ea),i=St((()=>e.route||n.value)),o=Vt($o,0),a=St((()=>{let e=yt(o);const{matched:t}=i.value;let r;for(;(r=t[e])&&!r.components;)e++;return e})),s=St((()=>i.value.matched[a.value]));Lt($o,St((()=>a.value+1))),Lt(Jo,s),Lt(ea,i);const c=ft();return Jn((()=>[c.value,s.value,e.name]),(([e,t,r],[n,i,o])=>{t&&(t.instances[r]=e,i&&i!==t&&e&&e===n&&(t.leaveGuards.size||(t.leaveGuards=i.leaveGuards),t.updateGuards.size||(t.updateGuards=i.updateGuards))),!e||!t||i&&io(t,i)&&n||(t.enterCallbacks[r]||[]).forEach((t=>t(e)))}),{flush:"post"}),()=>{const n=i.value,o=e.name,a=s.value,u=a&&a.components[o];if(!u)return ca(r.default,{Component:u,route:n});const d=a.props[o],l=d?!0===d?n.params:"function"==typeof d?d(n):d:null,p=ti(u,Oi({},l,t,{onVnodeUnmounted:e=>{e.component.isUnmounted&&(a.instances[o]=null)},ref:c}));return ca(r.default,{Component:p,route:n})||p}}});function da(e){const t=qo(e.routes,e),r=e.parseQuery||Ko,n=e.stringifyQuery||Qo,i=e.history,o=ta(),a=ta(),s=ta(),c=vt(co,!0);let u=co;xi&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=Pi.bind(null,(e=>""+e)),l=Pi.bind(null,Zi),p=Pi.bind(null,eo);function m(e,o){if(o=Oi({},o||c.value),"string"==typeof e){const n=ro(r,e,o.path),a=t.resolve({path:n.path},o),s=i.createHref(n.fullPath);return Oi(n,a,{params:p(a.params),hash:eo(n.hash),redirectedFrom:void 0,href:s})}let a;if(null!=e.path)a=Oi({},e,{path:ro(r,e.path,o.path).path});else{const t=Oi({},e.params);for(const e in t)null==t[e]&&delete t[e];a=Oi({},e,{params:l(t)}),o.params=l(o.params)}const s=t.resolve(a,o),u=e.hash||"";s.params=d(p(s.params));const m=function(e,t){const r=t.query?e(t.query):"";return t.path+(r&&"?")+r+(t.hash||"")}(n,Oi({},e,{hash:(h=u,$i(h).replace(Ki,"{").replace(zi,"}").replace(Wi,"^")),path:s.path}));var h;const f=i.createHref(m);return Oi({fullPath:m,hash:u,query:n===Qo?zo(e.query):e.query||{}},s,{redirectedFrom:void 0,href:f})}function h(e){return"string"==typeof e?ro(r,e,c.value.path):Oi({},e)}function f(e,t){if(u!==e)return wo(8,{from:t,to:e})}function g(e){return y(e)}function v(e){const t=e.matched[e.matched.length-1];if(t&&t.redirect){const{redirect:r}=t;let n="function"==typeof r?r(e):r;return"string"==typeof n&&(n=n.includes("?")||n.includes("#")?n=h(n):{path:n},n.params={}),Oi({query:e.query,hash:e.hash,params:null!=n.path?{}:e.params},n)}}function y(e,t){const r=u=m(e),i=c.value,o=e.state,a=e.force,s=!0===e.replace,d=v(r);if(d)return y(Oi(h(d),{state:"object"==typeof d?Oi({},o,d.state):o,force:a,replace:s}),t||r);const l=r;let p;return l.redirectedFrom=t,!a&&function(e,t,r){const n=t.matched.length-1,i=r.matched.length-1;return n>-1&&n===i&&io(t.matched[n],r.matched[i])&&oo(t.params,r.params)&&e(t.query)===e(r.query)&&t.hash===r.hash}(n,i,r)&&(p=wo(16,{to:l,from:i}),x(i,i,!0,!1)),(p?Promise.resolve(p):T(l,i)).catch((e=>Ao(e)?Ao(e,2)?e:A(e):w(e,l,i))).then((e=>{if(e){if(Ao(e,2))return y(Oi({replace:s},h(e.to),{state:"object"==typeof e.to?Oi({},o,e.to.state):o,force:a}),t||l)}else e=b(l,i,!0,s,o);return S(l,i,e),e}))}function I(e,t){const r=f(e,t);return r?Promise.reject(r):Promise.resolve()}function M(e){const t=P.values().next().value;return t&&"function"==typeof t.runWithContext?t.runWithContext(e):e()}function T(e,t){let r;const[n,i,s]=function(e,t){const r=[],n=[],i=[],o=Math.max(t.matched.length,e.matched.length);for(let a=0;a<o;a++){const o=t.matched[a];o&&(e.matched.find((e=>io(e,o)))?n.push(o):r.push(o));const s=e.matched[a];s&&(t.matched.find((e=>io(e,s)))||i.push(s))}return[r,n,i]}(e,t);r=na(n.reverse(),"beforeRouteLeave",e,t);for(const o of n)o.leaveGuards.forEach((n=>{r.push(ra(n,e,t))}));const c=I.bind(null,e,t);return r.push(c),V(r).then((()=>{r=[];for(const n of o.list())r.push(ra(n,e,t));return r.push(c),V(r)})).then((()=>{r=na(i,"beforeRouteUpdate",e,t);for(const n of i)n.updateGuards.forEach((n=>{r.push(ra(n,e,t))}));return r.push(c),V(r)})).then((()=>{r=[];for(const n of s)if(n.beforeEnter)if(Vi(n.beforeEnter))for(const i of n.beforeEnter)r.push(ra(i,e,t));else r.push(ra(n.beforeEnter,e,t));return r.push(c),V(r)})).then((()=>(e.matched.forEach((e=>e.enterCallbacks={})),r=na(s,"beforeRouteEnter",e,t,M),r.push(c),V(r)))).then((()=>{r=[];for(const n of a.list())r.push(ra(n,e,t));return r.push(c),V(r)})).catch((e=>Ao(e,8)?e:Promise.reject(e)))}function S(e,t,r){s.list().forEach((n=>M((()=>n(e,t,r)))))}function b(e,t,r,n,o){const a=f(e,t);if(a)return a;const s=t===co,u=xi?history.state:{};r&&(n||s?i.replace(e.fullPath,Oi({scroll:s&&u&&u.scroll},o)):i.push(e.fullPath,o)),c.value=e,x(e,t,r,s),A()}let C;function E(){C||(C=i.listen(((e,t,r)=>{if(!L.listening)return;const n=m(e),o=v(n);if(o)return void y(Oi(o,{replace:!0,force:!0}),n).catch(Li);u=n;const a=c.value;var s,d;xi&&(s=Io(a.fullPath,r.delta),d=vo(),Mo.set(s,d)),T(n,a).catch((e=>Ao(e,12)?e:Ao(e,2)?(y(Oi(h(e.to),{force:!0}),n).then((e=>{Ao(e,20)&&!r.delta&&r.type===uo.pop&&i.go(-1,!1)})).catch(Li),Promise.reject()):(r.delta&&i.go(-r.delta,!1),w(e,n,a)))).then((e=>{(e=e||b(n,a,!1))&&(r.delta&&!Ao(e,8)?i.go(-r.delta,!1):r.type===uo.pop&&Ao(e,20)&&i.go(-1,!1)),S(n,a,e)})).catch(Li)})))}let _,k=ta(),R=ta();function w(e,t,r){A(e);const n=R.list();return n.length?n.forEach((n=>n(e,t,r))):console.error(e),Promise.reject(e)}function A(e){return _||(_=!e,E(),k.list().forEach((([t,r])=>e?r(e):t())),k.reset()),e}function x(t,r,n,i){const{scrollBehavior:o}=e;if(!xi||!o)return Promise.resolve();const a=!n&&function(e){const t=Mo.get(e);return Mo.delete(e),t}(Io(t.fullPath,0))||(i||!n)&&history.state&&history.state.scroll||null;return Fn().then((()=>o(t,r,a))).then((e=>e&&yo(e))).catch((e=>w(e,t,r)))}const N=e=>i.go(e);let O;const P=new Set,L={currentRoute:c,listening:!0,addRoute:function(e,r){let n,i;return Eo(e)?(n=t.getRecordMatcher(e),i=r):i=e,t.addRoute(i,n)},removeRoute:function(e){const r=t.getRecordMatcher(e);r&&t.removeRoute(r)},clearRoutes:t.clearRoutes,hasRoute:function(e){return!!t.getRecordMatcher(e)},getRoutes:function(){return t.getRoutes().map((e=>e.record))},resolve:m,options:e,push:g,replace:function(e){return g(Oi(h(e),{replace:!0}))},go:N,back:()=>N(-1),forward:()=>N(1),beforeEach:o.add,beforeResolve:a.add,afterEach:s.add,onError:R.add,isReady:function(){return _&&c.value!==co?Promise.resolve():new Promise(((e,t)=>{k.add([e,t])}))},install(e){e.component("RouterLink",oa),e.component("RouterView",ua),e.config.globalProperties.$router=this,Object.defineProperty(e.config.globalProperties,"$route",{enumerable:!0,get:()=>yt(c)}),xi&&!O&&c.value===co&&(O=!0,g(i.location).catch((e=>{})));const t={};for(const n in co)Object.defineProperty(t,n,{get:()=>c.value[n],enumerable:!0});e.provide(Xo,this),e.provide(Zo,nt(t)),e.provide(ea,c);const r=e.unmount;P.add(e),e.unmount=function(){P.delete(e),P.size<1&&(u=co,C&&C(),C=null,c.value=co,O=!1,_=!1),r()}}};function V(e){return e.reduce(((e,t)=>e.then((()=>M(t)))),Promise.resolve())}return L}function la(){return Vt(Xo)}export{Dr as F,Ai as N,At as a,tn as b,Qr as c,dn as d,an as e,on as f,Lr as g,zr as h,da as i,Co as j,_i as k,s as n,Hr as o,wt as p,ft as r,c as t,la as u,bi as v,Er as w};
